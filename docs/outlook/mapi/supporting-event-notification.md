---
title: イベント通知をサポートしています。
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: a1e3e49c-8d1d-4f7e-ba5a-be441f0f10ae
description: '�ŏI�X�V��: 2011�N7��23��'
ms.openlocfilehash: 45bfe9f9314a154bd5f096ac20f76f6bf4f259c3
ms.sourcegitcommit: 9d60cd82b5413446e5bc8ace2cd689f683fb41a7
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/11/2018
ms.locfileid: "19804020"
---
# <a name="supporting-event-notification"></a><span data-ttu-id="352fa-103">イベント通知をサポートしています。</span><span class="sxs-lookup"><span data-stu-id="352fa-103">Supporting Event Notification</span></span>

  
  
<span data-ttu-id="352fa-104">**適用されます**: Outlook</span><span class="sxs-lookup"><span data-stu-id="352fa-104">**Applies to**: Outlook</span></span> 
  
<span data-ttu-id="352fa-105">イベント通知をサポートできますが、複雑なために、MAPI には、プロセスの最も困難な部分を実装する 3 つのサポート オブジェクトのメソッドが用意されています。</span><span class="sxs-lookup"><span data-stu-id="352fa-105">Because supporting event notification can be complicated, MAPI supplies three support object methods that implement the most difficult parts of the process.</span></span> <span data-ttu-id="352fa-106">これらのメソッドは、ユニットとして動作し、3 つのすべてまたはどれも、プロバイダーを使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="352fa-106">These methods work as a unit, and a provider must use all three or none of them.</span></span>
  
<span data-ttu-id="352fa-107">MAPI サポートされている方法では、通知のキーを使用して、通知を生成するオブジェクトとアドバイズ シンクの接続を管理します。</span><span class="sxs-lookup"><span data-stu-id="352fa-107">The MAPI support methods use notification keys to manage the connections between the advise sinks and the objects that generate the notifications.</span></span> <span data-ttu-id="352fa-108">通知キーは、プロセス間でオブジェクトを識別するバイナリ データを格納する[NOTIFKEY](notifkey.md)構造です。</span><span class="sxs-lookup"><span data-stu-id="352fa-108">A notification key is a [NOTIFKEY](notifkey.md) structure that contains binary data that identifies an object across processes.</span></span> <span data-ttu-id="352fa-109">通知キーは通常、長期的なエントリのアドバイズ ソース オブジェクトの id からコピーされます。</span><span class="sxs-lookup"><span data-stu-id="352fa-109">A notification key is typically copied from the long-term entry identifier of the advise source object.</span></span> <span data-ttu-id="352fa-110">クライアントには、**アドバイス**の呼び出しのエントリ id が指定されている場合は、通知のキーを使用できます。</span><span class="sxs-lookup"><span data-stu-id="352fa-110">If the client has supplied an entry identifier in the call to **Advise**, you can use it for the notification key.</span></span> <span data-ttu-id="352fa-111">**アドバイズ**する_lpEntryID_パラメーターが NULL の場合は、メッセージ ・ ストアなど、可能な最も外側のコンテナー オブジェクトのエントリ id を使用します。</span><span class="sxs-lookup"><span data-stu-id="352fa-111">If the  _lpEntryID_ parameter to **Advise** is NULL, use the entry identifier of the outermost possible container object, such as the message store.</span></span> 
  
<span data-ttu-id="352fa-112">サポート メソッドを使用するには、クライアントが**通知を登録するのには、メソッド**を呼び出すたびに、 [IMAPISupport::Subscribe](imapisupport-subscribe.md)を呼び出します。</span><span class="sxs-lookup"><span data-stu-id="352fa-112">To use the support methods, call [IMAPISupport::Subscribe](imapisupport-subscribe.md) whenever a client calls your **Advise** method to register for a notification.</span></span> <span data-ttu-id="352fa-113">[NOTIFKEY](notifkey.md)構造体を割り当てるし、アドバイスのソース オブジェクトの通知の一意なキーを作成します。</span><span class="sxs-lookup"><span data-stu-id="352fa-113">Allocate a [NOTIFKEY](notifkey.md) structure and create a unique notification key for your advise source object.</span></span> <span data-ttu-id="352fa-114">などの特定のフォルダーにメッセージを受信したときにクライアントに通知するように要求するメッセージ ストア プロバイダーはそのフォルダーの通知キーを作成します。</span><span class="sxs-lookup"><span data-stu-id="352fa-114">For example, a message store provider that is prompted to notify a client when a message is received into a particular folder creates a notification key for that folder.</span></span> <span data-ttu-id="352fa-115">クライアントへのポインターとは、**購読**への呼び出しに**NOTIFKEY**構造体へのポインターを渡すには、シンクが案内します。</span><span class="sxs-lookup"><span data-stu-id="352fa-115">Pass a pointer to the **NOTIFKEY** structure in the call to **Subscribe** along with a pointer to the client's advise sink.</span></span> <span data-ttu-id="352fa-116">**Subscribe**メソッドを呼び出してアドバイズ シンクの[IUnknown::AddRef](http://msdn.microsoft.com/library/b4316efd-73d4-4995-b898-8025a316ba63%28Office.15%29.aspx)その参照カウントをインクリメントし、MAPI では、登録をキャンセルするまで、ポインターが保持されます。</span><span class="sxs-lookup"><span data-stu-id="352fa-116">**Subscribe** calls the advise sink's [IUnknown::AddRef](http://msdn.microsoft.com/library/b4316efd-73d4-4995-b898-8025a316ba63%28Office.15%29.aspx) method to increment its reference count and MAPI retains the pointer until the registration is canceled.</span></span> 
  
<span data-ttu-id="352fa-117">渡すことができます NOTIFY_SYNC フラグ**購読**の**通知**が動作することを要求する同期していない戻り値の[IMAPIAdviseSink::OnNotify](imapiadvisesink-onnotify.md)メソッドへのすべての呼び出しを行ったことになるまで登録されているアドバイズ シンクします。</span><span class="sxs-lookup"><span data-stu-id="352fa-117">You can pass the NOTIFY_SYNC flag to **Subscribe** to request that **Notify** behave synchronously and not return until it has made all calls to the [IMAPIAdviseSink::OnNotify](imapiadvisesink-onnotify.md) methods of registered advise sinks.</span></span> <span data-ttu-id="352fa-118">独自の内部の使用のためにのみ、このフラグを設定します。</span><span class="sxs-lookup"><span data-stu-id="352fa-118">Set this flag only for your own internal use.</span></span> <span data-ttu-id="352fa-119">クライアントの**アドバイス**の呼び出しに応答する場合は設定しません。</span><span class="sxs-lookup"><span data-stu-id="352fa-119">Do not set it when you respond to a client **Advise** call.</span></span> <span data-ttu-id="352fa-120">クライアントとプロバイダー間でのイベント通知は、常に非同期です。</span><span class="sxs-lookup"><span data-stu-id="352fa-120">Event notification between clients and providers is always asynchronous.</span></span> <span data-ttu-id="352fa-121">MAPI を保証する呼び出しを実行中にイベントが発生した**OnNotify**呼び出しのいずれかが行われる前にクライアントに戻ります。</span><span class="sxs-lookup"><span data-stu-id="352fa-121">That is, MAPI guarantees that the call during which an event happens will return to the client before any of the **OnNotify** calls are made.</span></span> 
  
<span data-ttu-id="352fa-122">NOTIFY_SYNC フラグを設定する場合、アドバイズ シンク オブジェクトのいずれかに、変更しないでくださいし、**購読**する[HrThisThreadAdviseSink](hrthisthreadadvisesink.md)によって作成されたラッパーのアドバイズ シンクを渡さないでください。</span><span class="sxs-lookup"><span data-stu-id="352fa-122">If you set the NOTIFY_SYNC flag, do not make any changes to any of the advise sink objects, and do not pass a wrapper advise sink created by [HrThisThreadAdviseSink](hrthisthreadadvisesink.md) to **Subscribe**.</span></span> <span data-ttu-id="352fa-123">**HrThisThreadAdviseSink**は、スレッド セーフでないバージョンの非同期通知のみに使用するアドバイズ シンクを作成します。</span><span class="sxs-lookup"><span data-stu-id="352fa-123">**HrThisThreadAdviseSink** creates a thread-safe version of an advise sink to be used with asynchronous notification only.</span></span> 
  
<span data-ttu-id="352fa-124">同期通知用に登録されているアドバイズ シンクは、CALLBACK_DISCONTINUE フラグを設定して**OnNotify**から返された場合、 [IMAPISupport::Notify](imapisupport-notify.md)は NOTIFY_CANCELED フラグを設定し、 **OnNotify**への呼び出しを作成せずに返します。</span><span class="sxs-lookup"><span data-stu-id="352fa-124">If an advise sink registered for synchronous notification returns from **OnNotify** with the CALLBACK_DISCONTINUE flag set, [IMAPISupport::Notify](imapisupport-notify.md) sets the NOTIFY_CANCELED flag and returns without making any calls to **OnNotify**.</span></span> 
  
<span data-ttu-id="352fa-125">コピーを保持する必要がする必要がない**購読**が返されると、クライアントのシンクをアドバイスします。</span><span class="sxs-lookup"><span data-stu-id="352fa-125">Once **Subscribe** has returned, you will no longer have any need to hold onto your copy of the client's advise sink.</span></span> <span data-ttu-id="352fa-126">[リ ス](http://msdn.microsoft.com/library/4b494c6f-f0ee-4c35-ae45-ed956f40dc7a%28Office.15%29.aspx)を解放するメソッドを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="352fa-126">Call its [IUnknown::Release](http://msdn.microsoft.com/library/4b494c6f-f0ee-4c35-ae45-ed956f40dc7a%28Office.15%29.aspx) method to release it.</span></span> <span data-ttu-id="352fa-127">**購読**をクライアントに返す必要がありますは 0 以外の接続数を返します。</span><span class="sxs-lookup"><span data-stu-id="352fa-127">**Subscribe** returns a nonzero connection number that you should return to the client.</span></span> <span data-ttu-id="352fa-128">接続数は、ソース アドバイズとアドバイズ シンク間のリンクを表します。</span><span class="sxs-lookup"><span data-stu-id="352fa-128">The connection number represents the link between the advise source and the advise sink.</span></span> <span data-ttu-id="352fa-129">それまで有効のままクライアント**に**正常な呼び出しを行います。</span><span class="sxs-lookup"><span data-stu-id="352fa-129">It remains valid until the client makes a successful call to **Unadvise**.</span></span> 
  
<span data-ttu-id="352fa-130">クライアントの登録をキャンセルする準備ができたら、 **Unadvise**メソッドを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="352fa-130">When the client is ready to cancel a registration, it calls your **Unadvise** method.</span></span> <span data-ttu-id="352fa-131">[IMAPISupport::Unsubscribe](imapisupport-unsubscribe.md) **Unadvise**の呼び出しからの接続数を渡します。</span><span class="sxs-lookup"><span data-stu-id="352fa-131">Pass the connection number from the **Unadvise** call to [IMAPISupport::Unsubscribe](imapisupport-unsubscribe.md).</span></span> <span data-ttu-id="352fa-132">**購読の取り消し**では、アドバイズ シンクの**リ ス**のメソッドを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="352fa-132">**Unsubscribe** calls the advise sink's **IUnknown::Release** method.</span></span> <span data-ttu-id="352fa-133">**アドバイズ**、 **Unadvise**の**購読**および**購読解除**する呼び出しを組み合わせる必要があります。</span><span class="sxs-lookup"><span data-stu-id="352fa-133">As with **Advise** and **Unadvise**, calls to **Subscribe** and **Unsubscribe** must be paired.</span></span> <span data-ttu-id="352fa-134">**購読****購読**に対して行ったすべての呼び出しに対して 1 回の呼び出しを行う必要があります。</span><span class="sxs-lookup"><span data-stu-id="352fa-134">You must make one call to **Unsubscribe** for every call that is made to **Subscribe**.</span></span> <span data-ttu-id="352fa-135">ただし、 **Subscribe**を呼び出して **、メソッド**が呼び出されるたびにする必要はありません。</span><span class="sxs-lookup"><span data-stu-id="352fa-135">However, you do not have to call **Subscribe** every time your **Advise** method is called.</span></span> <span data-ttu-id="352fa-136">逆に、内部通知を設定するために呼び出すことができます。</span><span class="sxs-lookup"><span data-stu-id="352fa-136">Conversely, you can call it for setting up internal notifications.</span></span> 
  
<span data-ttu-id="352fa-137">イベントが発生してイベントの適切な型の 1 つまたは複数の[通知](notification.md)構造体を割り当てる[IMAPISupport::Notify](imapisupport-notify.md)を呼び出します。</span><span class="sxs-lookup"><span data-stu-id="352fa-137">When an event occurs, allocate one or more [NOTIFICATION](notification.md) structures of the type appropriate for the event and call [IMAPISupport::Notify](imapisupport-notify.md).</span></span> <span data-ttu-id="352fa-138">**通知**は、各登録されているアドバイズ シンクに通知を生成します。</span><span class="sxs-lookup"><span data-stu-id="352fa-138">**Notify** generates a notification for each registered advise sink.</span></span> <span data-ttu-id="352fa-139">未使用のすべてのメンバー、[通知](notification.md)の構造体をゼロを設定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="352fa-139">You should set all the unused members of the [NOTIFICATION](notification.md) structure to zero.</span></span> <span data-ttu-id="352fa-140">**通知**の構造体を初期化するためには、この手法は、クライアントが高速で、エラーが発生しやすい**OnNotify**実装のサイズを小さくすると、作成に役立ちます。</span><span class="sxs-lookup"><span data-stu-id="352fa-140">This technique for initializing the **NOTIFICATION** structure can help clients create smaller, faster, and less error-prone **OnNotify** implementations.</span></span> 
  
<span data-ttu-id="352fa-141">個別**通知**の構造体が同じ型の複数のイベントであっても、イベントごとに必要なことに注意してください。</span><span class="sxs-lookup"><span data-stu-id="352fa-141">Note that a separate **NOTIFICATION** structure is necessary for each event, even for multiple events of the same type.</span></span> <span data-ttu-id="352fa-142">たとえば、3 つのクライアントが特定のテーブルにテーブルの通知用に登録されている 5 つの行がテーブルに追加される場合は、作成する必要が 5 つの**OBJECT_NOTIFICATION**構造体の**通知**呼び出しの。</span><span class="sxs-lookup"><span data-stu-id="352fa-142">For example, if three clients are registered for table notification on a particular table and five rows are added to the table, you must create five **OBJECT_NOTIFICATION** structures for your **Notify** call.</span></span> <span data-ttu-id="352fa-143">このバッチ通知は、**通知**5 回の呼び出しよりもパフォーマンスの向上になります。</span><span class="sxs-lookup"><span data-stu-id="352fa-143">A batch notification such as this results in better performance than calling **Notify** five times.</span></span> <span data-ttu-id="352fa-144">各**通知**の呼び出しには、MAPI は、すべての登録されているアドバイズ シンクの[IMAPIAdviseSink::OnNotify](imapiadvisesink-onnotify.md)メソッドを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="352fa-144">For each **Notify** call, MAPI calls the [IMAPIAdviseSink::OnNotify](imapiadvisesink-onnotify.md) method of every registered advise sink.</span></span> <span data-ttu-id="352fa-145">ある場合は no が登録されているアドバイズ シンクでは、MAPI の呼び出しは無視されます。</span><span class="sxs-lookup"><span data-stu-id="352fa-145">If there are no registered advise sinks, MAPI ignores the call.</span></span> 
  
<span data-ttu-id="352fa-146">バッチ通知を送信するサービス プロバイダーで必要があります順序を最後の最初の通知から解釈できるようにします。</span><span class="sxs-lookup"><span data-stu-id="352fa-146">Service providers that send batched notifications must order them so that they can be interpreted from the first notification to the last.</span></span> <span data-ttu-id="352fa-147">通知バッチには、一連の同じバッチ内の別のイベントに追加された前の行を参照する 1 つのイベントと TABLE_ROW_ADDED などのイベントが含まれている場合は、この順序付けすると特に必要があります。</span><span class="sxs-lookup"><span data-stu-id="352fa-147">This ordering is especially necessary when a notification batch contains a series of events, such as TABLE_ROW_ADDED with one event that refers to a prior row that was added in another event in the same batch.</span></span>
  
## <a name="see-also"></a><span data-ttu-id="352fa-148">関連項目</span><span class="sxs-lookup"><span data-stu-id="352fa-148">See also</span></span>



[<span data-ttu-id="352fa-149">MAPI サービス プロバイダー</span><span class="sxs-lookup"><span data-stu-id="352fa-149">MAPI Service Providers</span></span>](mapi-service-providers.md)

