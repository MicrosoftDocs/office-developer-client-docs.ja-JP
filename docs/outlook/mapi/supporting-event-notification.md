---
title: イベント通知のサポート
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: a1e3e49c-8d1d-4f7e-ba5a-be441f0f10ae
description: '最終更新日: 2011 年 7 月 23 日'
ms.openlocfilehash: 83c102c25b17b6769c0c676bbadd874224f75cf6
ms.sourcegitcommit: 8fe462c32b91c87911942c188f3445e85a54137c
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/23/2019
ms.locfileid: "32327427"
---
# <a name="supporting-event-notification"></a>イベント通知のサポート

  
  
**適用対象**: Outlook 2013 | Outlook 2016 
  
サポートイベント通知は複雑になる可能性があるため、MAPI には、プロセスの最も困難な部分を実装する3つのサポートオブジェクトメソッドが用意されています。 これらのメソッドは1つの単位として機能し、プロバイダーはこれらすべてを使用する必要があります。
  
MAPI サポートメソッドは通知キーを使用して、アドバイズシンクと通知を生成するオブジェクトとの間の接続を管理します。 通知キーは、プロセス間でオブジェクトを識別するバイナリデータを含む[NOTIFKEY](notifkey.md)構造です。 通知キーは、通常、アドバイズソースオブジェクトの長期のエントリ識別子からコピーされます。 通知を受け取る呼び出しでクライアントがエントリ識別子を指定し**** ている場合は、それを通知キーに使用できます。 **アドバイズ**の_lな tryid_パラメーターが NULL の場合は、メッセージストアなど、最も外側に考えられるコンテナーオブジェクトのエントリ識別子を使用します。 
  
サポート方法を使用するには、クライアントが通知を登録するために**アドバイズ**メソッドを呼び出すときに、 [imapisupport:: Subscribe](imapisupport-subscribe.md)を呼び出します。 [NOTIFKEY](notifkey.md)構造体を割り当て、アドバイズソースオブジェクト用の一意の通知キーを作成します。 たとえば、メッセージを特定のフォルダーに受信したときにクライアントに通知するように求めるメッセージストアプロバイダーは、そのフォルダーの通知キーを作成します。 呼び出しの**NOTIFKEY**構造体へのポインターを渡して、クライアントのアドバイズシンクへのポインターと共に**サブスクライブ**します。 **Subscribe**は、アドバイズシンクの[IUnknown:: AddRef](https://msdn.microsoft.com/library/b4316efd-73d4-4995-b898-8025a316ba63%28Office.15%29.aspx)メソッドを呼び出して参照カウントをインクリメントし、MAPI は登録が取り消されるまでポインターを保持します。 
  
NOTIFY_SYNC フラグを渡すと、**通知**が同期され、登録されているアドバイズシンクの[IMAPIAdviseSink:: onnotify](imapiadvisesink-onnotify.md)メソッドへのすべての呼び出しが行われるまで返されない要求を**サブスクライブ**できます。 このフラグは、自分の内部使用目的にのみ設定します。 クライアント**アドバイズ**呼び出しに応答するときには、この設定を行わないでください。 クライアントとプロバイダーの間のイベント通知は常に非同期です。 つまり、MAPI では、イベントが発生する呼び出しは、 **onnotify**呼び出しが行われる前にクライアントに返されることが保証されます。 
  
NOTIFY_SYNC フラグを設定した場合は、アドバイズシンクオブジェクトに一切変更を加えず、 [HrThisThreadAdviseSink](hrthisthreadadvisesink.md)によって作成されたラッパーアドバイズシンクを**サブスクライブ**に渡しません。 **HrThisThreadAdviseSink**は、非同期通知にのみ使用される、アドバイズシンクのスレッドセーフバージョンを作成します。 
  
同期通知用に登録されたアドバイズシンクが CALLBACK_DISCONTINUE フラグセットを使用して**onnotify**から戻る場合、 [imapisupport:: notify](imapisupport-notify.md)は NOTIFY_CANCELED フラグを設定し、 **onnotify**を呼び出すことなく戻ります。 
  
**Subscribe**が戻った後、クライアントのアドバイズシンクのコピーを保持する必要がなくなります。 [IUnknown:: release](https://msdn.microsoft.com/library/4b494c6f-f0ee-4c35-ae45-ed956f40dc7a%28Office.15%29.aspx)メソッドを呼び出して解放します。 **Subscribe**は、クライアントに返す必要がある0以外の接続番号を返します。 接続番号は、アドバイズソースとアドバイズシンクの間のリンクを表します。 クライアントが**アドバイズ**中止の呼び出しを正常に行うまで、これは有効なままとなります。 
  
クライアントが登録を取り消す準備ができたら、**アドバイズ**中止メソッドを呼び出します。 **アドバイズ**中止呼び出しから[imapisupport::](imapisupport-unsubscribe.md)登録を解除する接続番号を渡します。 登録**解除**アドバイズシンクの**IUnknown:: Release**メソッドを呼び出します。 **アドバイズ**および**アドバイズ**の場合と同様に、 **Subscribe**および**講読**の呼び出しをペアにする必要があります。 **Subscribe**に対して行われ**** たすべての呼び出しに対して1回の呼び出しをサブスクライブする必要があります。 ただし、**アドバイズ**メソッドが呼び出されるたびに**Subscribe**を呼び出す必要はありません。 逆に、内部通知を設定するために呼び出すことができます。 
  
イベントが発生したときに、そのイベントに適した型の1つまたは複数の[通知](notification.md)構造を割り当て、: [: Notify](imapisupport-notify.md)を呼び出します。 **Notify**登録されたアドバイズシンクごとに通知を生成します。 [通知](notification.md)構造の使用されていないすべてのメンバーを0に設定する必要があります。 **通知**構造を初期化する手法を使用すると、クライアントは、より小さく、短時間、エラーが発生しやすい**onnotify**実装を作成できます。 
  
同じ種類の複数のイベントであっても、各イベントに対して別々の**通知**構造が必要になることに注意してください。 たとえば、特定のテーブルに対してテーブル通知のために3つのクライアントが登録されており、そのテーブルに5つの行が追加されている場合は、**通知**呼び出し用に5つの**OBJECT_NOTIFICATION**構造を作成する必要があります。 このようなバッチ通知は、**通知**を5回呼び出した場合よりもパフォーマンスが向上します。 **通知**呼び出しごとに、MAPI は登録されたすべてのアドバイズシンクの[IMAPIAdviseSink:: onnotify](imapiadvisesink-onnotify.md)メソッドを呼び出します。 登録されたアドバイズシンクが存在しない場合、MAPI は呼び出しを無視します。 
  
バッチ処理された通知を送信するサービスプロバイダーは、最初の通知から最後の通知への変換が可能になるように順序付けする必要があります。 この順序付けが必要になるのは、同じバッチ内で別のイベントに追加された前の行を参照する1つのイベントを含む TABLE_ROW_ADDED などの一連のイベントが通知バッチに含まれている場合です。
  
## <a name="see-also"></a>関連項目



[MAPI サービスプロバイダー](mapi-service-providers.md)

