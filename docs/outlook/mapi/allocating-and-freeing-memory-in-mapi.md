---
title: MAPI でのメモリの割り当てと解放
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: e238f6bc-e9f6-4ea4-a2e4-ff5da2a04bd5
description: '最終更新日: 2015 年 3 月 9 日'
ms.openlocfilehash: 68250c5cbeaa366ed4555bb469c4e68d62302f28
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/28/2019
ms.locfileid: "33419668"
---
# <a name="allocating-and-freeing-memory-in-mapi"></a>MAPI でのメモリの割り当てと解放

  
  
**適用対象**: Outlook 2013 | Outlook 2016 
  
メモリの割り当てと解放の方法を指定するだけでなく、パブリックインターフェイスメソッドと API 関数呼び出し間で渡されるメモリを解放する必要があるかどうかを知るためのモデルを定義します。 モデルは、文字列や構造体へのポインターなど、インターフェイスを指すポインターではないパラメーターに割り当てられたメモリにのみ適用されます。 インターフェイスポインターは、 **IUnknown**を介して実装された参照カウント機構を使用します。 非 MAPI 関連のメモリをクライアントアプリケーションまたはサービスプロバイダー内で内部的に割り当てたり解放したりするときは、意味のあるメカニズムを使用します。 
  
モデルでは、パラメーターを3種類のいずれかとして定義します。 入力パラメーターとして使用できるのは、呼び出し元によって、呼び出された関数またはメソッドによって使用される情報、出力パラメーター、呼び出された関数またはメソッドによって設定され、呼び出し元に返される、または入力出力パラメーター (2 つの型の組み合わせ) です。 出力パラメーターは、データへのポインターへのポインター、またはデータへのポインターへのポインターによく見られます。 呼び出された関数は出力パラメーターのデータを割り当てる役割を担いますが、呼び出し元はポインターのメモリを割り当てます。 
  
次の表では、これらの種類のパラメーターに対してメモリを割り当てて解放するための規則について説明します。
  
|**Type**|**メモリ割り当て**|**メモリリリース**|
|:-----|:-----|:-----|
|Input  <br/> |発信者が責任を担い、任意のメカニズムを使用できます。  <br/> |発信者が責任を担い、任意のメカニズムを使用できます。  <br/> |
|出力  <br/> |呼び出された関数は、 **MAPIAllocateBuffer**を使用する必要があります。 詳細については、「 [MAPIAllocateBuffer](mapiallocatebuffer.md)」を参照してください。  <br/> |発信者が責任を担い、 **MAPIFreeBuffer**を使用する必要があります。 詳細については、「 [MAPIFreeBuffer](mapifreebuffer.md)」を参照してください。  <br/> |
|入力出力  <br/> |発信者は最初の割り当てを行い、呼び出された関数は必要に応じて**MAPIAllocateBuffer**を使用して再割り当てできます。  <br/> |呼び出された関数は、再割り当てが必要な場合に最初の解放を行います。 発信者は、最後の戻り値を解放する必要があります。  <br/> |
   
エラーが発生した場合、通常、呼び出し元は、出力および入力出力パラメーターに注意する必要があります。 エラーが返された場合、各出力または入力出力パラメーターは、呼び出し元によって初期化された値のままにするか、または呼び出し元の部分に対して何の処理もしなくてもクリーンアップできる値に設定する必要があります。 たとえば、の出力ポインターパラメーターは、入力`void ** ppv`時のままにするか、NULL ( `*ppv = NULL`) に設定する必要があります。
  

