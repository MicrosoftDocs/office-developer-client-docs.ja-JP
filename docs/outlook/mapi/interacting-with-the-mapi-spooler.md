---
title: MAPI スプーラーとの対話
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 5cc1d0a8-ad23-4173-b220-b7c0169073fa
description: '�ŏI�X�V��: 2011�N7��23��'
ms.openlocfilehash: c8032172ef19fbb01af68058b2e0255e269183a8
ms.sourcegitcommit: 0cf39e5382b8c6f236c8a63c6036849ed3527ded
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/23/2018
ms.locfileid: "22587895"
---
# <a name="interacting-with-the-mapi-spooler"></a><span data-ttu-id="10101-103">MAPI スプーラーとの対話</span><span class="sxs-lookup"><span data-stu-id="10101-103">Interacting with the MAPI Spooler</span></span>

  
  
<span data-ttu-id="10101-104">**適用対象**: Outlook 2013 | Outlook 2016</span><span class="sxs-lookup"><span data-stu-id="10101-104">**Applies to**: Outlook 2013 | Outlook 2016</span></span> 
  
<span data-ttu-id="10101-105">内のメソッド、 [IXPLogon: IUnknown](ixplogoniunknown.md)トランスポート プロバイダーを呼び出すときに、MAPI スプーラーによってインターフェイスを使用します。</span><span class="sxs-lookup"><span data-stu-id="10101-105">The methods in the [IXPLogon : IUnknown](ixplogoniunknown.md) interface are used by the MAPI spooler when calling the transport provider.</span></span> <span data-ttu-id="10101-106">すばやく戻ることができるように、これらのメソッドのほとんどを実装するトランスポート プロバイダーのほとんどの種類の可能性がある場合があります。</span><span class="sxs-lookup"><span data-stu-id="10101-106">It should be possible for most types of transport providers to implement most of these methods so that they return quickly.</span></span> <span data-ttu-id="10101-107">メソッドで取得するのには時間がかかる場合、分解 MAPI スプーラーに呼び出しを他のタスクの CPU を解放するにこれは望ましいことです。</span><span class="sxs-lookup"><span data-stu-id="10101-107">This is desirable because if a method takes a long time to return then it should be broken up with calls back to the MAPI spooler to release the CPU for other tasks.</span></span> 
  
<span data-ttu-id="10101-108">MAPI スプーラー機能の動作し、フォア グラウンド アプリケーションがアイドル状態のときに、プロバイダーをトランスポートするための呼び出しを行います。</span><span class="sxs-lookup"><span data-stu-id="10101-108">The MAPI spooler does its work and makes its calls to transport providers when foreground applications are idle.</span></span> <span data-ttu-id="10101-109">トランスポート プロバイダーは、最初のログオン (MAPI からトランスポート プロバイダーに渡されるフラグによって制御される) ときにダイアログ ボックスの表示オプションで後のトランスポート プロバイダーはクライアントへのフラッシュの送信および受信キューで呼び出されない限り、バック グラウンドで動作します。</span><span class="sxs-lookup"><span data-stu-id="10101-109">After optionally displaying dialog boxes when the transport provider is first logged on (governed by flags passed from MAPI to the transport provider), transport providers operate in the background unless called by the client to flush send and receive queues.</span></span> <span data-ttu-id="10101-110">フラッシュのキューは、トランスポート プロバイダーが必要な CPU を解放されないことだけにし、長い可能性のあるアクションが、進行状況にあるユーザーに通知される場合のみです。</span><span class="sxs-lookup"><span data-stu-id="10101-110">Flushing queues is the only time that a transport provider need not release the CPU, and then only if the user is informed that a potentially long action is in progress.</span></span> <span data-ttu-id="10101-111">MAPI スプーラーは、通常、トランスポート プロバイダーがユーザーに通知されることを確認するのには何もする必要はありません通常、トランスポート プロバイダーがユーザー アクションへの応答として、キューをフラッシュするを要求します。</span><span class="sxs-lookup"><span data-stu-id="10101-111">The MAPI spooler typically requests that a transport provider flush its queues in response to a user action, so the transport provider typically does not need to do anything to ensure that the user is informed.</span></span>
  
<span data-ttu-id="10101-112">トランスポート プロバイダーは、個別に決定できます、キューをフラッシュし、 **PR_STATUS_CODE** ([PidTagStatusCode](pidtagstatuscode-canonical-property.md)) のプロパティの [状態] 行で STATUS_INBOUND_FLUSH と STATUS_OUTBOUND_FLUSH のビットを使用して、MAPI スプーラーを無効にしようとしているを通知します注意のことが作業を行えるようにします。</span><span class="sxs-lookup"><span data-stu-id="10101-112">A transport provider can independently decide to flush a queue and use the STATUS_INBOUND_FLUSH and STATUS_OUTBOUND_FLUSH bits in the **PR_STATUS_CODE** ([PidTagStatusCode](pidtagstatuscode-canonical-property.md)) property of its status row to inform the MAPI spooler that it wants attention so that it can get the job done.</span></span> <span data-ttu-id="10101-113">[IMAPISupport::ModifyStatusRow](imapisupport-modifystatusrow.md)メソッドを使用して、[状態] 行が更新されます。</span><span class="sxs-lookup"><span data-stu-id="10101-113">The status row is updated using the [IMAPISupport::ModifyStatusRow](imapisupport-modifystatusrow.md) method.</span></span> <span data-ttu-id="10101-114">ここでは、進行状況インジケーターまたはその他のインタ フェースの長いアクションが発生しているかをユーザーに通知するためにトランスポート プロバイダーは、可能性があります表示します。</span><span class="sxs-lookup"><span data-stu-id="10101-114">In this case the transport provider should probably display a progress indicator or other interface to inform the user that a long action is occuring.</span></span> 
  
<span data-ttu-id="10101-115">ネットワークのアクティビティでは、0.2 秒以上の多くの場合はため、トランスポート プロバイダーは、可能な限りを使用して、非同期ネットワーク要求。</span><span class="sxs-lookup"><span data-stu-id="10101-115">Since network activity often takes more than 0.2 seconds, transport providers should, whenever possible, use asynchronous network requests.</span></span> <span data-ttu-id="10101-116">これにより、要求を開始、MAPI スプーラー再度がそれらを確認するかどうかは、ネットワーク要求が完了するのには、コントロールと、MAPI スプーラーを呼び出すことで、CPU を解放することができます。</span><span class="sxs-lookup"><span data-stu-id="10101-116">This enables them to initiate a request, release the CPU by calling back to the MAPI spooler, and when the MAPI spooler again gives them control, to check to see if their network request has completed.</span></span> <span data-ttu-id="10101-117">それがまだ完了していない場合、もう一度リリース、CPU を呼び出すことで、MAPI スプーラーを無効に[IMAPISupport::SpoolerYield](imapisupport-spooleryield.md)メソッドを使用しています。</span><span class="sxs-lookup"><span data-stu-id="10101-117">If it has not yet completed, they again release the CPU by calling back to the MAPI spooler with the [IMAPISupport::SpoolerYield](imapisupport-spooleryield.md) method.</span></span> 
  
<span data-ttu-id="10101-118">メッセージ処理、および[IXPLogon::StartMessage](ixplogon-startmessage.md)、 [IXPLogon::SubmitMessage](ixplogon-submitmessage.md)と[IXPLogon::EndMessage](ixplogon-endmessage.md)の間でトランスポート プロバイダーは、通常は多数の呼び出し、MAPI スプーラーに公開されるオブジェクトにします。</span><span class="sxs-lookup"><span data-stu-id="10101-118">During message processing, between [IXPLogon::SubmitMessage](ixplogon-submitmessage.md) and [IXPLogon::EndMessage](ixplogon-endmessage.md) and during [IXPLogon::StartMessage](ixplogon-startmessage.md), the transport provider typically makes many calls on objects exposed to it by the MAPI spooler.</span></span> <span data-ttu-id="10101-119">これらのオブジェクトの処理の一部として、MAPI スプーラーを無効には、該当する場合、独自に生成することによって、バック グラウンド プロセスとして適切に動作するトランスポート プロバイダーことができます。</span><span class="sxs-lookup"><span data-stu-id="10101-119">As part of its handling of these objects, the MAPI spooler helps the transport provider behave appropriately as a background process by yielding on its own when appropriate.</span></span> <span data-ttu-id="10101-120">タイム クリティカルな処理を必要とするトランスポート プロバイダーは、 [IMAPISupport::SpoolerNotify](imapisupport-spoolernotify.md)のサポート オブジェクトのメソッドを使用して MAPI スプーラーにクリティカル セクションを宣言できます。</span><span class="sxs-lookup"><span data-stu-id="10101-120">A transport provider requiring time-critical processing can declare a critical section to the MAPI spooler using the [IMAPISupport::SpoolerNotify](imapisupport-spoolernotify.md) support object method.</span></span> <span data-ttu-id="10101-121">この例では、CPU により解放された**SpoolerYield**の明示的な呼び出しでのみトランスポート プロバイダーは、トランスポート プロバイダーは、 **SpoolerNotify**に対して別の呼び出しを処理するクリティカル セクションを終了するまでです。</span><span class="sxs-lookup"><span data-stu-id="10101-121">In this case, the CPU is released only on explicit **SpoolerYield** calls by the transport provider until the transport provider ends critical section processing with another call to **SpoolerNotify**.</span></span>
  
> [!NOTE]
> <span data-ttu-id="10101-122">これは Win32 のクリティカル セクションと同じです。</span><span class="sxs-lookup"><span data-stu-id="10101-122">This is not the same as a Win32 critical section.</span></span> <span data-ttu-id="10101-123">これはのみ、トランスポート プロバイダーは、fax 回線からの着信データの読み取りなどの外部リソースのリアルタイム制御を必要なときに行ってください。</span><span class="sxs-lookup"><span data-stu-id="10101-123">This should only be done when the transport provider needs real-time control of external resources such as reading incoming data from a fax line.</span></span> <span data-ttu-id="10101-124">MAPI スプーラ プロセスの優先順位が発生し、操作の間のスレッドが横取りされますワークステーションが発生することができます、ためにが長い可能性のある操作が進行中であるユーザーに通知し、可能な場合は、進行状況インジケーターを提供することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="10101-124">Since this raises the priority of the MAPI spooler process and can cause the workstation to be unresponsive for the duration of the operation, it is a good idea to notify the user that a potentially long action is underway and provide a progress indicator if possible.</span></span> 
  

