---
title: MAPI スプーラーとの対話
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 5cc1d0a8-ad23-4173-b220-b7c0169073fa
description: '最終更新日: 2011 年 7 月 23 日'
ms.openlocfilehash: da94347dcb47e5fdbd4a6c1d404b795f4f7938ab
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/28/2019
ms.locfileid: "33432150"
---
# <a name="interacting-with-the-mapi-spooler"></a><span data-ttu-id="4715e-103">MAPI スプーラーとの対話</span><span class="sxs-lookup"><span data-stu-id="4715e-103">Interacting with the MAPI Spooler</span></span>

  
  
<span data-ttu-id="4715e-104">**適用対象**: Outlook 2013 | Outlook 2016</span><span class="sxs-lookup"><span data-stu-id="4715e-104">**Applies to**: Outlook 2013 | Outlook 2016</span></span> 
  
<span data-ttu-id="4715e-105">[IXPLogon: IUnknown](ixplogoniunknown.md)インターフェイスのメソッドは、トランスポートプロバイダーを呼び出すときに MAPI スプーラーによって使用されます。</span><span class="sxs-lookup"><span data-stu-id="4715e-105">The methods in the [IXPLogon : IUnknown](ixplogoniunknown.md) interface are used by the MAPI spooler when calling the transport provider.</span></span> <span data-ttu-id="4715e-106">ほとんどの種類のトランスポートプロバイダーでは、これらのメソッドのほとんどを実装して迅速に返すことができます。</span><span class="sxs-lookup"><span data-stu-id="4715e-106">It should be possible for most types of transport providers to implement most of these methods so that they return quickly.</span></span> <span data-ttu-id="4715e-107">これは、メソッドが戻るまでに長い時間がかかる場合は、MAPI スプーラーに戻って他のタスクに対する CPU を解放する必要があるため、この方法が適しています。</span><span class="sxs-lookup"><span data-stu-id="4715e-107">This is desirable because if a method takes a long time to return then it should be broken up with calls back to the MAPI spooler to release the CPU for other tasks.</span></span> 
  
<span data-ttu-id="4715e-108">フォアグラウンドアプリケーションがアイドル状態のときに MAPI スプーラーは動作を行い、トランスポートプロバイダーに呼び出しを行います。</span><span class="sxs-lookup"><span data-stu-id="4715e-108">The MAPI spooler does its work and makes its calls to transport providers when foreground applications are idle.</span></span> <span data-ttu-id="4715e-109">トランスポートプロバイダーが最初にログオンしたときにダイアログボックスを表示する (MAPI からトランスポートプロバイダーに渡されるフラグによって制御される) 場合、トランスポートプロバイダーは、送信キューと受信キューをフラッシュするためにクライアントによって呼び出されない限り、バックグラウンドで動作します。</span><span class="sxs-lookup"><span data-stu-id="4715e-109">After optionally displaying dialog boxes when the transport provider is first logged on (governed by flags passed from MAPI to the transport provider), transport providers operate in the background unless called by the client to flush send and receive queues.</span></span> <span data-ttu-id="4715e-110">キューのフラッシュは、トランスポートプロバイダーが CPU を解放する必要がない唯一の時間で、ユーザーが長いアクションが進行中であることが通知されている場合に限られます。</span><span class="sxs-lookup"><span data-stu-id="4715e-110">Flushing queues is the only time that a transport provider need not release the CPU, and then only if the user is informed that a potentially long action is in progress.</span></span> <span data-ttu-id="4715e-111">通常、MAPI スプーラーは、トランスポートプロバイダーがユーザーの操作への応答としてキューをフラッシュすることを要求するので、通常、トランスポートプロバイダーは、ユーザーに通知されるようにするために何もする必要はありません。</span><span class="sxs-lookup"><span data-stu-id="4715e-111">The MAPI spooler typically requests that a transport provider flush its queues in response to a user action, so the transport provider typically does not need to do anything to ensure that the user is informed.</span></span>
  
<span data-ttu-id="4715e-112">トランスポートプロバイダーは、キューをフラッシュして、その状態行の**PR_STATUS_CODE** ([PidTagStatusCode](pidtagstatuscode-canonical-property.md)) プロパティにある STATUS_INBOUND_FLUSH および STATUS_OUTBOUND_FLUSH ビットを使用して、必要な MAPI スプーラーに通知することができます。アテンションを使用して、ジョブを完了できるようにします。</span><span class="sxs-lookup"><span data-stu-id="4715e-112">A transport provider can independently decide to flush a queue and use the STATUS_INBOUND_FLUSH and STATUS_OUTBOUND_FLUSH bits in the **PR_STATUS_CODE** ([PidTagStatusCode](pidtagstatuscode-canonical-property.md)) property of its status row to inform the MAPI spooler that it wants attention so that it can get the job done.</span></span> <span data-ttu-id="4715e-113">状態行は、 [imapisupport:: modifystatusrow](imapisupport-modifystatusrow.md)メソッドを使用して更新されます。</span><span class="sxs-lookup"><span data-stu-id="4715e-113">The status row is updated using the [IMAPISupport::ModifyStatusRow](imapisupport-modifystatusrow.md) method.</span></span> <span data-ttu-id="4715e-114">この場合、トランスポートプロバイダーは、長いアクションが発生していることをユーザーに通知するための進行状況インジケーターまたはその他のインターフェイスを表示する必要があります。</span><span class="sxs-lookup"><span data-stu-id="4715e-114">In this case the transport provider should probably display a progress indicator or other interface to inform the user that a long action is occuring.</span></span> 
  
<span data-ttu-id="4715e-115">ネットワークアクティビティは、多くの場合、0.2 秒以上かかります。可能な場合は、トランスポートプロバイダーが非同期ネットワーク要求を使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="4715e-115">Since network activity often takes more than 0.2 seconds, transport providers should, whenever possible, use asynchronous network requests.</span></span> <span data-ttu-id="4715e-116">これにより、要求を開始し、mapi スプーラーにコールバックして CPU を解放することができます。また、mapi スプーラーがそれらを再度制御できるようになると、ネットワーク要求が完了したかどうかを確認することができます。</span><span class="sxs-lookup"><span data-stu-id="4715e-116">This enables them to initiate a request, release the CPU by calling back to the MAPI spooler, and when the MAPI spooler again gives them control, to check to see if their network request has completed.</span></span> <span data-ttu-id="4715e-117">まだ完了していない場合は、 [imapisupport:: SpoolerYield](imapisupport-spooleryield.md)メソッドを使用して MAPI スプーラーにコールバックして、再度 CPU を解放します。</span><span class="sxs-lookup"><span data-stu-id="4715e-117">If it has not yet completed, they again release the CPU by calling back to the MAPI spooler with the [IMAPISupport::SpoolerYield](imapisupport-spooleryield.md) method.</span></span> 
  
<span data-ttu-id="4715e-118">メッセージ処理の間、 [IXPLogon:: submitmessage](ixplogon-submitmessage.md)と[IXPLogon:: endmessage](ixplogon-endmessage.md)と[IXPLogon:: startmessage](ixplogon-startmessage.md)の間のトランスポートプロバイダーは、通常、MAPI スプーラーによって公開されたオブジェクトに対して多数の呼び出しを行います。</span><span class="sxs-lookup"><span data-stu-id="4715e-118">During message processing, between [IXPLogon::SubmitMessage](ixplogon-submitmessage.md) and [IXPLogon::EndMessage](ixplogon-endmessage.md) and during [IXPLogon::StartMessage](ixplogon-startmessage.md), the transport provider typically makes many calls on objects exposed to it by the MAPI spooler.</span></span> <span data-ttu-id="4715e-119">これらのオブジェクトの処理の一部として、MAPI スプーラーは、トランスポートプロバイダーが必要に応じて独自に実行することにより、バックグラウンドプロセスとして適切に動作するのに役に立ちます。</span><span class="sxs-lookup"><span data-stu-id="4715e-119">As part of its handling of these objects, the MAPI spooler helps the transport provider behave appropriately as a background process by yielding on its own when appropriate.</span></span> <span data-ttu-id="4715e-120">時間が重要な処理を必要とするトランスポートプロバイダーは、 [imapisupport:: SpoolerNotify](imapisupport-spoolernotify.md) support オブジェクトメソッドを使用して、MAPI スプーラーにクリティカルセクションを宣言できます。</span><span class="sxs-lookup"><span data-stu-id="4715e-120">A transport provider requiring time-critical processing can declare a critical section to the MAPI spooler using the [IMAPISupport::SpoolerNotify](imapisupport-spoolernotify.md) support object method.</span></span> <span data-ttu-id="4715e-121">この場合、トランスポートプロバイダーが**SpoolerNotify**への別の呼び出しで重要なセクション処理を終了するまで、トランスポートプロバイダーによる明示的な**SpoolerYield**呼び出しにのみ CPU がリリースされます。</span><span class="sxs-lookup"><span data-stu-id="4715e-121">In this case, the CPU is released only on explicit **SpoolerYield** calls by the transport provider until the transport provider ends critical section processing with another call to **SpoolerNotify**.</span></span>
  
> [!NOTE]
> <span data-ttu-id="4715e-122">これは、Win32 のクリティカルセクションと同じではありません。</span><span class="sxs-lookup"><span data-stu-id="4715e-122">This is not the same as a Win32 critical section.</span></span> <span data-ttu-id="4715e-123">これは、fax 回線からの受信データの読み取りなど、トランスポートプロバイダーが外部リソースをリアルタイムで制御する必要がある場合にのみ実行するようにしてください。</span><span class="sxs-lookup"><span data-stu-id="4715e-123">This should only be done when the transport provider needs real-time control of external resources such as reading incoming data from a fax line.</span></span> <span data-ttu-id="4715e-124">これにより MAPI スプーラープロセスの優先度が高くなり、操作中にワークステーションが応答しなくなる可能性があるため、ユーザーに対して長時間のアクションが進行中であることを通知し、可能な場合は進行状況のインジケーターを提供することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="4715e-124">Since this raises the priority of the MAPI spooler process and can cause the workstation to be unresponsive for the duration of the operation, it is a good idea to notify the user that a potentially long action is underway and provide a progress indicator if possible.</span></span> 
  

