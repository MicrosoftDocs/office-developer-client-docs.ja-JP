---
title: MAPI スプーラーの操作
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 5cc1d0a8-ad23-4173-b220-b7c0169073fa
description: '最終更新日: 2011 年 7 月 23 日'
ms.openlocfilehash: da94347dcb47e5fdbd4a6c1d404b795f4f7938ab
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/28/2019
ms.locfileid: "33432150"
---
# <a name="interacting-with-the-mapi-spooler"></a><span data-ttu-id="bf610-103">MAPI スプーラーの操作</span><span class="sxs-lookup"><span data-stu-id="bf610-103">Interacting with the MAPI Spooler</span></span>

  
  
<span data-ttu-id="bf610-104">**適用対象**: Outlook 2013 | Outlook 2016</span><span class="sxs-lookup"><span data-stu-id="bf610-104">**Applies to**: Outlook 2013 | Outlook 2016</span></span> 
  
<span data-ttu-id="bf610-105">[IXPLogon : IUnknown](ixplogoniunknown.md)インターフェイスのメソッドは、トランスポート プロバイダーを呼び出す際に MAPI スプーラーによって使用されます。</span><span class="sxs-lookup"><span data-stu-id="bf610-105">The methods in the [IXPLogon : IUnknown](ixplogoniunknown.md) interface are used by the MAPI spooler when calling the transport provider.</span></span> <span data-ttu-id="bf610-106">ほとんどの種類のトランスポート プロバイダーがこれらのメソッドのほとんどを実装して、これらのメソッドを迅速に返す必要があります。</span><span class="sxs-lookup"><span data-stu-id="bf610-106">It should be possible for most types of transport providers to implement most of these methods so that they return quickly.</span></span> <span data-ttu-id="bf610-107">これは、メソッドが返すのに長い時間がかかる場合は、他のタスクの CPU を解放するために MAPI スプーラーへの呼び出しで分解する必要があります。</span><span class="sxs-lookup"><span data-stu-id="bf610-107">This is desirable because if a method takes a long time to return then it should be broken up with calls back to the MAPI spooler to release the CPU for other tasks.</span></span> 
  
<span data-ttu-id="bf610-108">MAPI スプーラーは、その作業を実行し、フォアグラウンド アプリケーションがアイドル状態のときにトランスポート プロバイダーへの呼び出しを行います。</span><span class="sxs-lookup"><span data-stu-id="bf610-108">The MAPI spooler does its work and makes its calls to transport providers when foreground applications are idle.</span></span> <span data-ttu-id="bf610-109">必要に応じて、トランスポート プロバイダーが最初にログオンするときにダイアログ ボックスを表示した後 (MAPI からトランスポート プロバイダーに渡されるフラグによって管理されます)、送信キューと受信キューをフラッシュするクライアントによって呼び出されない限り、トランスポート プロバイダーはバックグラウンドで動作します。</span><span class="sxs-lookup"><span data-stu-id="bf610-109">After optionally displaying dialog boxes when the transport provider is first logged on (governed by flags passed from MAPI to the transport provider), transport providers operate in the background unless called by the client to flush send and receive queues.</span></span> <span data-ttu-id="bf610-110">キューのフラッシュは、トランスポート プロバイダーが CPU を解放する必要が生じない唯一の時間であり、その後、潜在的に長いアクションが進行中である可能性があるという通知をユーザーに通知された場合にのみ行います。</span><span class="sxs-lookup"><span data-stu-id="bf610-110">Flushing queues is the only time that a transport provider need not release the CPU, and then only if the user is informed that a potentially long action is in progress.</span></span> <span data-ttu-id="bf610-111">MAPI スプーラーは通常、ユーザーの操作に応じてトランスポート プロバイダーがキューをフラッシュする要求を行うので、通常、トランスポート プロバイダーはユーザーに通知を受け取る必要はありません。</span><span class="sxs-lookup"><span data-stu-id="bf610-111">The MAPI spooler typically requests that a transport provider flush its queues in response to a user action, so the transport provider typically does not need to do anything to ensure that the user is informed.</span></span>
  
<span data-ttu-id="bf610-112">トランスポート プロバイダーは、キューをフラッシュし、状態行の PR_STATUS_CODE ([PidTagStatusCode](pidtagstatuscode-canonical-property.md)) プロパティの **STATUS_INBOUND_FLUSH** ビットと STATUS_OUTBOUND_FLUSH ビットを使用して、ジョブを完了するために MAPI スプーラーに注意を払う必要があることを通知します。</span><span class="sxs-lookup"><span data-stu-id="bf610-112">A transport provider can independently decide to flush a queue and use the STATUS_INBOUND_FLUSH and STATUS_OUTBOUND_FLUSH bits in the **PR_STATUS_CODE** ([PidTagStatusCode](pidtagstatuscode-canonical-property.md)) property of its status row to inform the MAPI spooler that it wants attention so that it can get the job done.</span></span> <span data-ttu-id="bf610-113">状態行は [、IMAPISupport::ModifyStatusRow メソッドを使用して更新](imapisupport-modifystatusrow.md) されます。</span><span class="sxs-lookup"><span data-stu-id="bf610-113">The status row is updated using the [IMAPISupport::ModifyStatusRow](imapisupport-modifystatusrow.md) method.</span></span> <span data-ttu-id="bf610-114">この場合、トランスポート プロバイダーは、長いアクションが発生しているユーザーに通知する進行状況インジケーターまたは他のインターフェイスを表示する必要があります。</span><span class="sxs-lookup"><span data-stu-id="bf610-114">In this case the transport provider should probably display a progress indicator or other interface to inform the user that a long action is occuring.</span></span> 
  
<span data-ttu-id="bf610-115">多くの場合、ネットワーク アクティビティには 0.2 秒以上かかるので、可能な限り、トランスポート プロバイダーは非同期ネットワーク要求を使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="bf610-115">Since network activity often takes more than 0.2 seconds, transport providers should, whenever possible, use asynchronous network requests.</span></span> <span data-ttu-id="bf610-116">これにより、要求を開始し、MAPI スプーラーに呼び出して CPU を解放し、MAPI スプーラーが再び制御を与え、ネットワーク要求が完了したのか確認できます。</span><span class="sxs-lookup"><span data-stu-id="bf610-116">This enables them to initiate a request, release the CPU by calling back to the MAPI spooler, and when the MAPI spooler again gives them control, to check to see if their network request has completed.</span></span> <span data-ttu-id="bf610-117">まだ完了していない場合は [、IMAPISupport::SpoolerYield](imapisupport-spooleryield.md) メソッドを使用して MAPI スプーラーに呼び出して、CPU を再び解放します。</span><span class="sxs-lookup"><span data-stu-id="bf610-117">If it has not yet completed, they again release the CPU by calling back to the MAPI spooler with the [IMAPISupport::SpoolerYield](imapisupport-spooleryield.md) method.</span></span> 
  
<span data-ttu-id="bf610-118">メッセージの処理中 [、IXPLogon::SubmitMessage](ixplogon-submitmessage.md) と [IXPLogon::EndMessage](ixplogon-endmessage.md) の間、 [および IXPLogon::StartMessage](ixplogon-startmessage.md)の間に、トランスポート プロバイダーは通常、MAPI スプーラーによって公開されるオブジェクトに対して多くの呼び出しを行います。</span><span class="sxs-lookup"><span data-stu-id="bf610-118">During message processing, between [IXPLogon::SubmitMessage](ixplogon-submitmessage.md) and [IXPLogon::EndMessage](ixplogon-endmessage.md) and during [IXPLogon::StartMessage](ixplogon-startmessage.md), the transport provider typically makes many calls on objects exposed to it by the MAPI spooler.</span></span> <span data-ttu-id="bf610-119">MAPI スプーラーは、これらのオブジェクトの処理の一環として、必要に応じて独自の処理を行って、トランスポート プロバイダーがバックグラウンド プロセスとして適切に動作するのに役立ちます。</span><span class="sxs-lookup"><span data-stu-id="bf610-119">As part of its handling of these objects, the MAPI spooler helps the transport provider behave appropriately as a background process by yielding on its own when appropriate.</span></span> <span data-ttu-id="bf610-120">タイム クリティカルな処理を必要とするトランスポート プロバイダーは [、IMAPISupport::SpoolerNotify](imapisupport-spoolernotify.md) サポート オブジェクト メソッドを使用して、MAPI スプーラーに重要なセクションを宣言できます。</span><span class="sxs-lookup"><span data-stu-id="bf610-120">A transport provider requiring time-critical processing can declare a critical section to the MAPI spooler using the [IMAPISupport::SpoolerNotify](imapisupport-spoolernotify.md) support object method.</span></span> <span data-ttu-id="bf610-121">この場合、トランスポート プロバイダーがスプーラーNotify への別の呼び出しでクリティカル セクション処理を終了するまで、トランスポート プロバイダーによる明示的なスプーラー **Yield** 呼び出しでのみ CPU **が解放されます**。</span><span class="sxs-lookup"><span data-stu-id="bf610-121">In this case, the CPU is released only on explicit **SpoolerYield** calls by the transport provider until the transport provider ends critical section processing with another call to **SpoolerNotify**.</span></span>
  
> [!NOTE]
> <span data-ttu-id="bf610-122">これは、Win32 の重要なセクションと同じではありません。</span><span class="sxs-lookup"><span data-stu-id="bf610-122">This is not the same as a Win32 critical section.</span></span> <span data-ttu-id="bf610-123">これは、トランスポート プロバイダーが FAX 回線から受信データを読み取るなどの外部リソースをリアルタイムで制御する必要がある場合にのみ行う必要があります。</span><span class="sxs-lookup"><span data-stu-id="bf610-123">This should only be done when the transport provider needs real-time control of external resources such as reading incoming data from a fax line.</span></span> <span data-ttu-id="bf610-124">これにより、MAPI スプーラー プロセスの優先度が上がり、操作中にワークステーションが応答しなくなる可能性があるので、潜在的に長いアクションが進行中であるユーザーに通知し、可能であれば進行状況インジケーターを提供すると良い考えです。</span><span class="sxs-lookup"><span data-stu-id="bf610-124">Since this raises the priority of the MAPI spooler process and can cause the workstation to be unresponsive for the duration of the operation, it is a good idea to notify the user that a potentially long action is underway and provide a progress indicator if possible.</span></span> 
  

