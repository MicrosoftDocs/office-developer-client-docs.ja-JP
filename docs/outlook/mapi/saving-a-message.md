---
title: メッセージの保存
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 97bff16b-dc7c-4eed-8834-d0c076d83ca3
description: '最終更新日: 2011 年 7 月 23 日'
ms.openlocfilehash: d5ceeb46bded101700aec696a17d690bde80ce6d
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/28/2019
ms.locfileid: "33420933"
---
# <a name="saving-a-message"></a><span data-ttu-id="9de40-103">メッセージの保存</span><span class="sxs-lookup"><span data-stu-id="9de40-103">Saving a Message</span></span>

  
  
<span data-ttu-id="9de40-104">**適用対象**: Outlook 2013 | Outlook 2016</span><span class="sxs-lookup"><span data-stu-id="9de40-104">**Applies to**: Outlook 2013 | Outlook 2016</span></span> 
  
<span data-ttu-id="9de40-105">メッセージを保存する前に、クライアントは通常、メッセージの[IMAPIProp::SetProps](imapiprop-setprops.md)メソッドを呼び出して、メッセージ テキストプロパティ、添付ファイルプロパティ、PR_SUBJECT[(PidTagSubject)、](pidtagsubject-canonical-property.md)および受信者リストに関連付けられたプロパティに加えていくつかのプロパティを設定します。 </span><span class="sxs-lookup"><span data-stu-id="9de40-105">Before a message is saved, clients typically call the message's [IMAPIProp::SetProps](imapiprop-setprops.md) method to set a few properties in addition to the message text properties, attachment properties, **PR_SUBJECT** ([PidTagSubject](pidtagsubject-canonical-property.md)), and properties associated with the recipient list.</span></span>
  
<span data-ttu-id="9de40-106">プロパティ **PR_MESSAGE_CLASS** ([PidTagMessageClass](pidtagmessageclass-canonical-property.md)) プロパティを IPM などの文字列に設定します。送信メッセージのクラスについて説明します。</span><span class="sxs-lookup"><span data-stu-id="9de40-106">Set the **PR_MESSAGE_CLASS** ([PidTagMessageClass](pidtagmessageclass-canonical-property.md)) property to a character string such as IPM.Note that describes the class of the outgoing message.</span></span> <span data-ttu-id="9de40-107">クライアントは、すべての送信 **メッセージPR_MESSAGE_CLASS** を設定する必要があります。設定しない場合、既定値はメッセージ ストア プロバイダーによって提供されます。</span><span class="sxs-lookup"><span data-stu-id="9de40-107">Although clients should set **PR_MESSAGE_CLASS** on all outgoing messages, a default value is supplied by the message store provider if you do not set it.</span></span> <span data-ttu-id="9de40-108">送信メッセージの既定のメッセージ クラスは IPM です。</span><span class="sxs-lookup"><span data-stu-id="9de40-108">The default message class for outgoing messages is IPM.</span></span> 
  
<span data-ttu-id="9de40-109">プロパティ ([PidTagMessageFlags](pidtagmessageflags-canonical-property.md) **)** MSGFLAG_UNSENTで、PR_MESSAGE_FLAGSフラグを設定します。</span><span class="sxs-lookup"><span data-stu-id="9de40-109">Set the MSGFLAG_UNSENT flag in the **PR_MESSAGE_FLAGS** ([PidTagMessageFlags](pidtagmessageflags-canonical-property.md)) property.</span></span> <span data-ttu-id="9de40-110">必要に応じて、MSGFLAG_READフラグMSGFLAG_UNMODIFIEDします。</span><span class="sxs-lookup"><span data-stu-id="9de40-110">If desired, also set the MSGFLAG_READ and MSGFLAG_UNMODIFIED flags.</span></span> <span data-ttu-id="9de40-111">メッセージを設定MSGFLAG_UNMODIFIED構成下のメッセージが配信されたメッセージをシミュレートできます。</span><span class="sxs-lookup"><span data-stu-id="9de40-111">Setting the MSGFLAG_UNMODIFIED allows a message under composition to simulate a delivered message.</span></span> <span data-ttu-id="9de40-112">MSGFLAG_UNMODIFIEDは、メッセージが初めて保存される前にクライアントによってのみ設定できます。</span><span class="sxs-lookup"><span data-stu-id="9de40-112">MSGFLAG_UNMODIFIED can only be set by clients before a message has been saved for the first time.</span></span> 
  
<span data-ttu-id="9de40-113">送信されていないメッセージの永続的なコピーを作成する準備ができたら、メッセージとその添付ファイルの [IMAPIProp::SaveChanges](imapiprop-savechanges.md) を呼び出します。</span><span class="sxs-lookup"><span data-stu-id="9de40-113">When you are ready to make a permanent copy of an unsent message, call [IMAPIProp::SaveChanges](imapiprop-savechanges.md) on the message and all of its attachments.</span></span> <span data-ttu-id="9de40-114">メッセージをすぐ送信する場合は **、SaveChanges** を呼び出す必要があります。</span><span class="sxs-lookup"><span data-stu-id="9de40-114">If you intend to send the message right away, you do not need to call **SaveChanges**.</span></span> <span data-ttu-id="9de40-115">**SubmitMessage の呼び出しは**、メッセージを処理の一部として内部的に保存します。</span><span class="sxs-lookup"><span data-stu-id="9de40-115">The call to **SubmitMessage** internally saves the message as part of its processing.</span></span> 
  
<span data-ttu-id="9de40-116">**SaveChanges** を呼び出す場合は、メッセージを後で変更できる KEEP_OPEN_READWRITE フラグを指定すると良い考えです。</span><span class="sxs-lookup"><span data-stu-id="9de40-116">When calling **SaveChanges**, it is a good idea to specify the KEEP_OPEN_READWRITE flag, which allows the message to be modified at a later time.</span></span> <span data-ttu-id="9de40-117">その他の設定可能なフラグには、FORCE_SAVE が含まれます。これは、変更がコミットされた後にメッセージまたは添付ファイルを閉じるべきであり、KEEP_OPEN_READONLY は、これ以上変更を加えなくる必要がない、およびメッセージ ストア プロバイダーがクライアント要求をバッチ処理できるフラグ MAPI_DEFERRED_ERRORS です。</span><span class="sxs-lookup"><span data-stu-id="9de40-117">Other settable flags include FORCE_SAVE, which indicates that the message or attachment should be closed after changes are committed, KEEP_OPEN_READONLY, which indicates that no further changes will be made, and the flag to allow the message store provider to batch client requests, MAPI_DEFERRED_ERRORS.</span></span>
  
<span data-ttu-id="9de40-118">メッセージの **SaveChanges** を呼び出す前に、メッセージ内のすべての添付ファイルに対して **SaveChanges** を呼び出す必要があります。</span><span class="sxs-lookup"><span data-stu-id="9de40-118">It is essential that you call **SaveChanges** for every attachment in the message before you call **SaveChanges** for the message.</span></span> <span data-ttu-id="9de40-119">添付ファイルを保存できない場合、添付ファイルは送信時にメッセージに含まれません。メッセージの添付ファイルテーブルには表示されません。</span><span class="sxs-lookup"><span data-stu-id="9de40-119">If you fail to save an attachment, the attachment will not be included with the message when it is sent and it will not appear in the message's attachment table.</span></span> <span data-ttu-id="9de40-120">すべての添付ファイルを保存した後にメッセージを保存できなかった場合、メッセージと添付ファイルの両方が失われます。</span><span class="sxs-lookup"><span data-stu-id="9de40-120">If you fail to save the message after saving all of the attachments, both the message and the attachments will be lost.</span></span> 
  
<span data-ttu-id="9de40-121">**SaveChanges が呼** び出された場合、メッセージ ストア プロバイダーは次のプロパティを更新します。</span><span class="sxs-lookup"><span data-stu-id="9de40-121">When **SaveChanges** is called, the message store provider updates the following properties:</span></span> 
  
- <span data-ttu-id="9de40-122">**PR_DISPLAY_TO** ([PidTagDisplayTo](pidtagdisplayto-canonical-property.md)) は、すべてのプライマリ受信者を一覧表示します。</span><span class="sxs-lookup"><span data-stu-id="9de40-122">**PR_DISPLAY_TO** ([PidTagDisplayTo](pidtagdisplayto-canonical-property.md)) lists all primary recipients.</span></span>
    
- <span data-ttu-id="9de40-123">**PR_DISPLAY_TO** カーボン コピー受信者の一覧を表示します。</span><span class="sxs-lookup"><span data-stu-id="9de40-123">**PR_DISPLAY_TO** lists all carbon copy recipients.</span></span> 
    
- <span data-ttu-id="9de40-124">**PR_DISPLAY_BCC** ([PidTagDisplayBcc](pidtagdisplaybcc-canonical-property.md)) には、すべてのブラインド カーボン コピー受信者が一覧表示されます。</span><span class="sxs-lookup"><span data-stu-id="9de40-124">**PR_DISPLAY_BCC** ([PidTagDisplayBcc](pidtagdisplaybcc-canonical-property.md)) lists all blind carbon copy recipients.</span></span>
    
- <span data-ttu-id="9de40-125">**PR_LAST_MODIFICATION_TIME** ([PidTagLastModificationTime](pidtaglastmodificationtime-canonical-property.md))</span><span class="sxs-lookup"><span data-stu-id="9de40-125">**PR_LAST_MODIFICATION_TIME** ([PidTagLastModificationTime](pidtaglastmodificationtime-canonical-property.md))</span></span>
    
- <span data-ttu-id="9de40-126">**PR_MESSAGE_FLAGS** 1 つMSGFLAG_HASATTACH添付ファイルが保存されている場合に、メッセージが変更されたMSGFLAG_UNMODIFIEDをクリアする場合に設定します。</span><span class="sxs-lookup"><span data-stu-id="9de40-126">**PR_MESSAGE_FLAGS** sets MSGFLAG_HASATTACH if one or more attachments have been saved and clears MSGFLAG_UNMODIFIED to show the message has changed.</span></span> 
    
- <span data-ttu-id="9de40-127">**PR_MESSAGE_SIZE** ([PidTagMessageSize](pidtagmessagesize-canonical-property.md)) には、メッセージの最新サイズが含まれる。</span><span class="sxs-lookup"><span data-stu-id="9de40-127">**PR_MESSAGE_SIZE** ([PidTagMessageSize](pidtagmessagesize-canonical-property.md)) contains the most current size of the message.</span></span>
    
- <span data-ttu-id="9de40-128">**PR_MESSAGE_ATTACHMENTS** ([PidTagMessageAttachments](pidtagmessageattachments-canonical-property.md)) は、添付ファイル テーブルへのアクセスを提供します。</span><span class="sxs-lookup"><span data-stu-id="9de40-128">**PR_MESSAGE_ATTACHMENTS** ([PidTagMessageAttachments](pidtagmessageattachments-canonical-property.md)) provides access to the attachment table.</span></span>
    
- <span data-ttu-id="9de40-129">**PR_MESSAGE_RECIPIENTS** ([PidTagMessageRecipients](pidtagmessagerecipients-canonical-property.md)) は、受信者テーブルへのアクセスを提供します。</span><span class="sxs-lookup"><span data-stu-id="9de40-129">**PR_MESSAGE_RECIPIENTS** ([PidTagMessageRecipients](pidtagmessagerecipients-canonical-property.md)) provides access to the recipient table.</span></span>
    
<span data-ttu-id="9de40-130">一部のメッセージ プロパティは、通常、メッセージの作成時にクライアントまたはサービス プロバイダーによって提供されます。</span><span class="sxs-lookup"><span data-stu-id="9de40-130">Some message properties are typically supplied by clients or service providers when a message is created.</span></span> <span data-ttu-id="9de40-131">クライアントが設定を無視した場合 **、SaveChanges** が呼び出された時点でメッセージ ストア プロバイダーが更新を行う必要があります。</span><span class="sxs-lookup"><span data-stu-id="9de40-131">If a client neglects to set them, it is up to the message store provider to update them at the time **SaveChanges** is called.</span></span> <span data-ttu-id="9de40-132">たとえば、メッセージの作成時にメッセージの **PR_ENTRYID** ([PidTagEntryId](pidtagentryid-canonical-property.md)) プロパティと **PR_RECORD_KEY** ([PidTagRecordKey](pidtagrecordkey-canonical-property.md)) プロパティが設定されている場合、保存時に変更する必要があります。</span><span class="sxs-lookup"><span data-stu-id="9de40-132">For example, if a message's **PR_ENTRYID** ([PidTagEntryId](pidtagentryid-canonical-property.md)) and **PR_RECORD_KEY** ([PidTagRecordKey](pidtagrecordkey-canonical-property.md)) properties were set when the message was created, they need not be modified at save time.</span></span> <span data-ttu-id="9de40-133">ただし、メッセージの作成時に設定を無視するメッセージ ストア プロバイダーは **、SaveChanges** が初めて呼び出された時点で設定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="9de40-133">However, message store providers that neglect to set them at message creation must set them the first time that **SaveChanges** is called.</span></span> 
  
<span data-ttu-id="9de40-134">**SaveChanges が** データ を返MAPI_E_CORRUPT_DATA、保存されているデータが失われたと仮定します。</span><span class="sxs-lookup"><span data-stu-id="9de40-134">If **SaveChanges** returns MAPI_E_CORRUPT_DATA, assume that the data being saved is now lost.</span></span> <span data-ttu-id="9de40-135">クライアント サーバー モデルを実装に使用するメッセージ ストア プロバイダーは、ネットワーク接続が失われたり、サーバーが実行されていない場合に、この値を返す可能性があります。</span><span class="sxs-lookup"><span data-stu-id="9de40-135">Message store providers that use a client-server model for their implementation might return this value when a network connection is lost or the server is not running.</span></span> <span data-ttu-id="9de40-136">ユーザーにエラーを返す前に **、SetProps** を呼び出し、続いて **SaveChanges** を別の呼び出しでデータを書き込み、もう一度保存してみてください。</span><span class="sxs-lookup"><span data-stu-id="9de40-136">Before returning an error to the user, try to write and save the data a second time by making a call to **SetProps** followed by another call to **SaveChanges**.</span></span> <span data-ttu-id="9de40-137">データがローカルにキャッシュされている場合、これは問題ではありません。</span><span class="sxs-lookup"><span data-stu-id="9de40-137">If the data is cached locally, this should not be a problem.</span></span> <span data-ttu-id="9de40-138">ただし、ローカル キャッシュがない場合、または 2 番目の **SaveChanges** 呼び出しが失敗した場合は、エラーを表示してユーザーに問題を通知します。</span><span class="sxs-lookup"><span data-stu-id="9de40-138">However, if there is no local cache or the second **SaveChanges** call fails, display an error to alert the user to the problem.</span></span> 
  

