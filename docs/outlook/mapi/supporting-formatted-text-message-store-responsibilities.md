---
title: 書式付きのテキスト ・ メッセージ ・ ストアの役割をサポートしています。
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: a97993c2-52e4-4b71-ac03-2c02d82447d8
description: '最終更新日時: 2015 年 3 月 9 日'
ms.openlocfilehash: d5f4be5a8593cfc483dfed1cffbb59f596e2e408
ms.sourcegitcommit: 0cf39e5382b8c6f236c8a63c6036849ed3527ded
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/23/2018
ms.locfileid: "22567651"
---
# <a name="supporting-formatted-text-message-store-responsibilities"></a><span data-ttu-id="5d6b5-103">書式付きテキストのサポート: メッセージ ストアの責任</span><span class="sxs-lookup"><span data-stu-id="5d6b5-103">Supporting Formatted Text: Message Store Responsibilities</span></span>

  
  
<span data-ttu-id="5d6b5-104">**適用されます**: Outlook 2013 |Outlook 2016</span><span class="sxs-lookup"><span data-stu-id="5d6b5-104">**Applies to**: Outlook 2013 | Outlook 2016</span></span> 
  
<span data-ttu-id="5d6b5-105">メッセージ ストア プロバイダーで書式設定されたテキストを格納するかどうかは、RTF を認識されている場合、リッチ テキスト形式式 (RTF)、HTML テキストを処理できるかどうかを公開する**PR_STORE_SUPPORT_MASK** ([PidTagStoreSupportMask](pidtagstoresupportmask-canonical-property.md)) プロパティを使用して、圧縮または非圧縮形式です。</span><span class="sxs-lookup"><span data-stu-id="5d6b5-105">Message store providers use the **PR_STORE_SUPPORT_MASK** ([PidTagStoreSupportMask](pidtagstoresupportmask-canonical-property.md)) property to publish whether or not they can handle Rich Text Format (RTF), HTML text and, if they are RTF-aware, whether they store the formatted text in a compressed or uncompressed format.</span></span> <span data-ttu-id="5d6b5-106">メッセージ ストア プロバイダーは、ある RTF に対応して、STORE_RTF_OK ビットを設定することによって、格納していること、書式設定されたテキスト、未圧縮の形式で STORE_UNCOMPRESSED_RTF ビットを設定することによってを示します。</span><span class="sxs-lookup"><span data-stu-id="5d6b5-106">Message store providers indicate that they are RTF-aware by setting the STORE_RTF_OK bit and that they store the formatted text in an uncompressed form by setting the STORE_UNCOMPRESSED_RTF bit.</span></span> <span data-ttu-id="5d6b5-107">メッセージ ストア プロバイダーは、STORE_HTML_OK ビットを設定することによって HTML に対応していることを示します。</span><span class="sxs-lookup"><span data-stu-id="5d6b5-107">Message store providers indicate they are HTML-aware by setting the STORE_HTML_OK bit.</span></span>
  
<span data-ttu-id="5d6b5-108">Rtf 形式に対応していないクライアントがメッセージ ・ ストアが RTF をサポートしているかどうかを決定するビットの STORE_RTF_OK をチェックするのに重要なは、クライアントに rtf 形式に対応していない店舗の書式設定されたテキストの書式と注意を払う必要はありません。</span><span class="sxs-lookup"><span data-stu-id="5d6b5-108">While it is important for an RTF-aware client to check for the STORE_RTF_OK bit to determine whether or not a message store supports RTF, it is not necessary for a client to be concerned with the format of an RTF-aware store's formatted text.</span></span> 
  
<span data-ttu-id="5d6b5-109">すべてのメッセージ ストアには、RTF に対応していないクライアントをサポートする必要があります。</span><span class="sxs-lookup"><span data-stu-id="5d6b5-109">All message stores must support non-RTF-aware clients.</span></span> <span data-ttu-id="5d6b5-110">RTF に対応していないメッセージ ストアは、せずにクライアントが**PR_BODY** ([PidTagBody](pidtagbody-canonical-property.md)) に変更された場合に、メッセージの[IMAPIProp::SaveChanges](imapiprop-savechanges.md)メソッドの呼び出し中の**PR_RTF_IN_SYNC** ([PidTagRtfInSync](pidtagrtfinsync-canonical-property.md)) プロパティを削除する必要があります。**PR_RTF_COMPRESSED** ([PidTagRtfCompressed](pidtagrtfcompressed-canonical-property.md)) または**PR_RTF_IN_SYNC**のいずれかを更新しています。</span><span class="sxs-lookup"><span data-stu-id="5d6b5-110">A non-RTF-aware message store must delete the **PR_RTF_IN_SYNC** ([PidTagRtfInSync](pidtagrtfinsync-canonical-property.md)) property during a call to the message's [IMAPIProp::SaveChanges](imapiprop-savechanges.md) method if a client has changed **PR_BODY** ([PidTagBody](pidtagbody-canonical-property.md)) without updating either **PR_RTF_IN_SYNC** or **PR_RTF_COMPRESSED** ([PidTagRtfCompressed](pidtagrtfcompressed-canonical-property.md)).</span></span> <span data-ttu-id="5d6b5-111">**PR_RTF_IN_SYNC**を削除すると、 **PR_RTF_COMPRESSED**プロパティは、次に、rtf 形式に対応したクライアント[へ](rtfsync.md)の呼び出しに**PR_BODY**プロパティの再計算が発生します。</span><span class="sxs-lookup"><span data-stu-id="5d6b5-111">Deleting **PR_RTF_IN_SYNC** causes the **PR_RTF_COMPRESSED** property to be recomputed from the **PR_BODY** property the next time an RTF-aware client calls [RTFSync](rtfsync.md).</span></span> 
  
<span data-ttu-id="5d6b5-112">RTF に対応していないメッセージ ストアがほとんどないによって与えられます。 メッセージ テキスト クライアントです。要求を計算する必要があります。</span><span class="sxs-lookup"><span data-stu-id="5d6b5-112">Most RTF-aware message stores are not given the message text by clients; it must be computed on request.</span></span> <span data-ttu-id="5d6b5-113">この計算で時間とコストがあるため、クライアントは、可能な限り**PR_RTF_COMPRESSED**を使用してください。</span><span class="sxs-lookup"><span data-stu-id="5d6b5-113">Because this computation is time consuming and expensive, clients should use **PR_RTF_COMPRESSED** whenever possible.</span></span> <span data-ttu-id="5d6b5-114">**PR_BODY**プロパティを計算するには、メッセージ ストア プロバイダーする必要があります**PR_RTF_COMPRESSED**プロパティの内容を圧縮解除をリッチ テキストの書式設定を削除できます。</span><span class="sxs-lookup"><span data-stu-id="5d6b5-114">To compute the **PR_BODY** property, the message store provider must uncompress the contents of the **PR_RTF_COMPRESSED** property and remove the rich text formatting.</span></span> <span data-ttu-id="5d6b5-115">**PR_RTF_COMPRESSED**プロパティをサポートしていないクライアントは、すべてのメッセージに対して実行するには、この計算を必要とします。</span><span class="sxs-lookup"><span data-stu-id="5d6b5-115">Clients that do not support the **PR_RTF_COMPRESSED** property require this computation to take place for every message.</span></span> 
  
<span data-ttu-id="5d6b5-116">メッセージ ・ ストア プロバイダーの実装に**PR_BODY**が除外されている場合は、内容のないメッセージを作成するリスクを実行する**IMAPISupport::DoCopyProps**または**IMAPISupport::DoCopyTo**メソッドを使用してメッセージをコピーする場合プロパティ**PR_RTF_COMPRESSED**に依存しているとします。</span><span class="sxs-lookup"><span data-stu-id="5d6b5-116">When copying messages, message store providers that do not use the **IMAPISupport::DoCopyProps** or **IMAPISupport::DoCopyTo** methods run the risk of creating a message with no content if their implementation excludes the **PR_BODY** property and relies on **PR_RTF_COMPRESSED**.</span></span> <span data-ttu-id="5d6b5-117">破損していること、 **PR_RTF_COMPRESSED**プロパティ内のデータのことができます。</span><span class="sxs-lookup"><span data-stu-id="5d6b5-117">It is possible for the data in the **PR_RTF_COMPRESSED** property to be corrupt.</span></span> <span data-ttu-id="5d6b5-118">コピー操作でこれらのメッセージ コンテンツ プロパティのいずれかを除外するには、前に、破損のとおり確認します。</span><span class="sxs-lookup"><span data-stu-id="5d6b5-118">Before excluding either of these message content properties in the copy operation, check for corruption as follows:</span></span> 
  
1. <span data-ttu-id="5d6b5-119">**PR_RTF_COMPRESSED**の値が圧縮された RTF を超えていない場合、プロパティが壊れています。</span><span class="sxs-lookup"><span data-stu-id="5d6b5-119">If the value of **PR_RTF_COMPRESSED** is not larger than the compressed RTF, the property is corrupt.</span></span> 
    
2. <span data-ttu-id="5d6b5-120">Rtf 形式のヘッダー内の魔法の値が、 _dwMagicCompressedRTF_または_dwMagicUncompressedRTF_プロパティではない場合は、壊れています。</span><span class="sxs-lookup"><span data-stu-id="5d6b5-120">If the magic value in the RTF header is not  _dwMagicCompressedRTF_ or  _dwMagicUncompressedRTF_, the property is corrupt.</span></span>
    
<span data-ttu-id="5d6b5-121">メッセージは、 **PR_RTF_COMPRESSED**破損のチェックを実装することを心配する必要はありませんメソッドが必要なサポートを使用して、プロバイダーを格納します。MAPI では、適切なプロパティが存在し、有効なことを保証します。</span><span class="sxs-lookup"><span data-stu-id="5d6b5-121">Message store providers using the support methods need not be concerned with implementing a check for **PR_RTF_COMPRESSED** corruption; MAPI ensures that the appropriate properties exist and are valid.</span></span> 
  
<span data-ttu-id="5d6b5-122">メッセージ ストア プロバイダーを実装できます。 RTF のサポートの 3 つの異なるレベルします。MAPI では、rtf 形式に対応したメッセージ ストア プロバイダーが中間または高いレベルでのサポートを実装することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="5d6b5-122">There are three different levels of RTF support that message store providers can implement; MAPI recommends that RTF-aware message store providers implement their support at the middle or highest level.</span></span> <span data-ttu-id="5d6b5-123">すべて RTF に対応していないメッセージ ストア プロバイダー **PR_BODY**を生成する送信メッセージに、 **PR_RTF_COMPRESSED**に含まれるデータを処理し、テキストおよび受信メッセージの書式設定を同期する呼び出しを**行う**。</span><span class="sxs-lookup"><span data-stu-id="5d6b5-123">All RTF-aware message store providers take care of generating **PR_BODY** from the data included in **PR_RTF_COMPRESSED** on outgoing messages and make a call to **RTFSync** to synchronize text and formatting on incoming messages.</span></span> 
  
<span data-ttu-id="5d6b5-124">これら 3 つのレベル間の相違点については、次の表で説明します。</span><span class="sxs-lookup"><span data-stu-id="5d6b5-124">The differences between these three levels are described in the following table.</span></span> 
  
|<span data-ttu-id="5d6b5-125">**レベルのサポート**</span><span class="sxs-lookup"><span data-stu-id="5d6b5-125">**Level of support**</span></span>|<span data-ttu-id="5d6b5-126">**説明**</span><span class="sxs-lookup"><span data-stu-id="5d6b5-126">**Description**</span></span>|
|:-----|:-----|
|<span data-ttu-id="5d6b5-127">低</span><span class="sxs-lookup"><span data-stu-id="5d6b5-127">Low</span></span>  <br/> |<span data-ttu-id="5d6b5-128">メッセージでは、メッセージに変更を保存するたびに、プロバイダー**へ**の呼び出しを格納し、それを設定するのには、必要とするクライアントの代わりに**PR_RTF_COMPRESSED**から**PR_BODY**プロパティのデータを抽出します。</span><span class="sxs-lookup"><span data-stu-id="5d6b5-128">Message store provider calls **RTFSync** whenever changes are saved to a message and extracts the data for the **PR_BODY** property from **PR_RTF_COMPRESSED** rather than requiring clients to set it.</span></span> <span data-ttu-id="5d6b5-129">**PR_BODY**と**PR_RTF_COMPRESSED**の両方が格納されます。</span><span class="sxs-lookup"><span data-stu-id="5d6b5-129">Both **PR_BODY** and **PR_RTF_COMPRESSED** are stored.</span></span>  <br/> |
|<span data-ttu-id="5d6b5-130">中央揃え</span><span class="sxs-lookup"><span data-stu-id="5d6b5-130">Middle</span></span>  <br/> |<span data-ttu-id="5d6b5-131">メッセージは、 **PR_RTF_COMPRESSED**プロパティのみ、コンピューティングの**PR_BODY**と必要なプロバイダーのストアを格納します。</span><span class="sxs-lookup"><span data-stu-id="5d6b5-131">Message store provider stores only the **PR_RTF_COMPRESSED** property, computing **PR_BODY** when necessary.</span></span>  <br/> |
|<span data-ttu-id="5d6b5-132">高</span><span class="sxs-lookup"><span data-stu-id="5d6b5-132">High</span></span>  <br/> |<span data-ttu-id="5d6b5-133">**PR_BODY**または補助の rtf 形式のプロパティのどちらも、メッセージはストアのプロバイダーを格納します。</span><span class="sxs-lookup"><span data-stu-id="5d6b5-133">Message store provider stores neither **PR_BODY** or the auxiliary RTF properties.</span></span> <span data-ttu-id="5d6b5-134">**** メッセージのテキストが変更され、書式設定は変更されない場合、または新しいメッセージがダウンロードされると、トランスポート プロバイダーによって呼び出されます。</span><span class="sxs-lookup"><span data-stu-id="5d6b5-134">**RTFSync** is called when the message text has changed and the formatting remains unchanged or when a new message is downloaded by a transport provider.</span></span>  <br/> |
   

