---
title: 書式設定されたテキスト メッセージ ストアの責任をサポートする
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: a97993c2-52e4-4b71-ac03-2c02d82447d8
description: '最終更新日: 2015 年 3 月 9 日'
ms.openlocfilehash: 502ba82279664638c8e7e4ae68f74df74758918d
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/28/2019
ms.locfileid: "33435517"
---
# <a name="supporting-formatted-text-message-store-responsibilities"></a><span data-ttu-id="e647a-103">書式設定されたテキストのサポート: メッセージ ストアの責任</span><span class="sxs-lookup"><span data-stu-id="e647a-103">Supporting Formatted Text: Message Store Responsibilities</span></span>

  
  
<span data-ttu-id="e647a-104">**適用対象**: Outlook 2013 | Outlook 2016</span><span class="sxs-lookup"><span data-stu-id="e647a-104">**Applies to**: Outlook 2013 | Outlook 2016</span></span> 
  
<span data-ttu-id="e647a-105">メッセージ ストア プロバイダーは **、PR_STORE_SUPPORT_MASK** ([PidTagStoreSupportMask](pidtagstoresupportmask-canonical-property.md)) プロパティを使用して、リッチ テキスト形式 (RTF)、HTML テキスト、および RTF 対応の場合は、書式設定されたテキストを圧縮形式または非圧縮形式で保存できるかどうかを発行します。</span><span class="sxs-lookup"><span data-stu-id="e647a-105">Message store providers use the **PR_STORE_SUPPORT_MASK** ([PidTagStoreSupportMask](pidtagstoresupportmask-canonical-property.md)) property to publish whether or not they can handle Rich Text Format (RTF), HTML text and, if they are RTF-aware, whether they store the formatted text in a compressed or uncompressed format.</span></span> <span data-ttu-id="e647a-106">メッセージ ストア プロバイダーは、STORE_RTF_OK ビットを設定して RTF に対応し、STORE_UNCOMPRESSED_RTF ビットを設定して、書式設定されたテキストを圧縮されていない形式で格納STORE_UNCOMPRESSED_RTFします。</span><span class="sxs-lookup"><span data-stu-id="e647a-106">Message store providers indicate that they are RTF-aware by setting the STORE_RTF_OK bit and that they store the formatted text in an uncompressed form by setting the STORE_UNCOMPRESSED_RTF bit.</span></span> <span data-ttu-id="e647a-107">メッセージ ストア プロバイダーは、ビットを設定して HTML に対応STORE_HTML_OKします。</span><span class="sxs-lookup"><span data-stu-id="e647a-107">Message store providers indicate they are HTML-aware by setting the STORE_HTML_OK bit.</span></span>
  
<span data-ttu-id="e647a-108">メッセージ ストアが RTF をサポートするかどうかを判断するには、RTF 対応クライアントが STORE_RTF_OK ビットを確認することが重要ですが、クライアントが RTF 対応ストアの書式設定されたテキストの形式を気にしている必要はありません。</span><span class="sxs-lookup"><span data-stu-id="e647a-108">While it is important for an RTF-aware client to check for the STORE_RTF_OK bit to determine whether or not a message store supports RTF, it is not necessary for a client to be concerned with the format of an RTF-aware store's formatted text.</span></span> 
  
<span data-ttu-id="e647a-109">すべてのメッセージ ストアは、RTF 対応以外のクライアントをサポートする必要があります。</span><span class="sxs-lookup"><span data-stu-id="e647a-109">All message stores must support non-RTF-aware clients.</span></span> <span data-ttu-id="e647a-110">クライアントが PR_RTF_IN_SYNC または **PR_RTF_COMPRESSED** **(** [PidTagRtfCompressed](pidtagrtfcompressed-canonical-property.md)) を更新せずに **PR_BODY** ([PidTagBody](pidtagbody-canonical-property.md)) を変更した場合、RTF 対応以外のメッセージ ストアは、メッセージの [IMAPIProp::SaveChanges](imapiprop-savechanges.md)メソッドの呼び出し中に PR_RTF_IN_SYNC ([PidTagRtfInSync](pidtagrtfinsync-canonical-property.md)) プロパティを削除する必要があります。</span><span class="sxs-lookup"><span data-stu-id="e647a-110">A non-RTF-aware message store must delete the **PR_RTF_IN_SYNC** ([PidTagRtfInSync](pidtagrtfinsync-canonical-property.md)) property during a call to the message's [IMAPIProp::SaveChanges](imapiprop-savechanges.md) method if a client has changed **PR_BODY** ([PidTagBody](pidtagbody-canonical-property.md)) without updating either **PR_RTF_IN_SYNC** or **PR_RTF_COMPRESSED** ([PidTagRtfCompressed](pidtagrtfcompressed-canonical-property.md)).</span></span> <span data-ttu-id="e647a-111">この **PR_RTF_IN_SYNC** するとPR_RTF_COMPRESSED RTF 対応のクライアントが次回 RTFSync を呼び出すPR_BODY プロパティから PR_BODY プロパティが [再計算されます](rtfsync.md)。</span><span class="sxs-lookup"><span data-stu-id="e647a-111">Deleting **PR_RTF_IN_SYNC** causes the **PR_RTF_COMPRESSED** property to be recomputed from the **PR_BODY** property the next time an RTF-aware client calls [RTFSync](rtfsync.md).</span></span> 
  
<span data-ttu-id="e647a-112">ほとんどの RTF 対応のメッセージ ストアには、クライアントからメッセージ テキストが与えされません。要求に応じて計算する必要があります。</span><span class="sxs-lookup"><span data-stu-id="e647a-112">Most RTF-aware message stores are not given the message text by clients; it must be computed on request.</span></span> <span data-ttu-id="e647a-113">この計算は時間とコストがかかるため、クライアントは可能な限 **りPR_RTF_COMPRESSEDを** 使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="e647a-113">Because this computation is time consuming and expensive, clients should use **PR_RTF_COMPRESSED** whenever possible.</span></span> <span data-ttu-id="e647a-114">PR_BODY プロパティ **を計算するには** 、メッセージ ストア プロバイダーが PR_RTF_COMPRESSED プロパティ **の内容** を圧縮解除し、リッチ テキストの書式設定を削除する必要があります。</span><span class="sxs-lookup"><span data-stu-id="e647a-114">To compute the **PR_BODY** property, the message store provider must uncompress the contents of the **PR_RTF_COMPRESSED** property and remove the rich text formatting.</span></span> <span data-ttu-id="e647a-115">PR_RTF_COMPRESSED プロパティをサポートしていない **クライアントでは、** すべてのメッセージに対してこの計算を実行する必要があります。</span><span class="sxs-lookup"><span data-stu-id="e647a-115">Clients that do not support the **PR_RTF_COMPRESSED** property require this computation to take place for every message.</span></span> 
  
<span data-ttu-id="e647a-116">メッセージをコピーする場合 **、IMAPISupport::D oCopyProps または IMAPISupport::D oCopyTo** メソッドを使用しないメッセージ ストア プロバイダーは、実装が **PR_BODY** プロパティを除外し、PR_RTF_COMPRESSED に依存している場合、コンテンツを含むメッセージを作成する危険性があります。 </span><span class="sxs-lookup"><span data-stu-id="e647a-116">When copying messages, message store providers that do not use the **IMAPISupport::DoCopyProps** or **IMAPISupport::DoCopyTo** methods run the risk of creating a message with no content if their implementation excludes the **PR_BODY** property and relies on **PR_RTF_COMPRESSED**.</span></span> <span data-ttu-id="e647a-117">プロパティ内のデータが **破損** PR_RTF_COMPRESSED可能性があります。</span><span class="sxs-lookup"><span data-stu-id="e647a-117">It is possible for the data in the **PR_RTF_COMPRESSED** property to be corrupt.</span></span> <span data-ttu-id="e647a-118">コピー操作でこれらのメッセージ コンテンツ プロパティのいずれかを除外する前に、次のように破損を確認してください。</span><span class="sxs-lookup"><span data-stu-id="e647a-118">Before excluding either of these message content properties in the copy operation, check for corruption as follows:</span></span> 
  
1. <span data-ttu-id="e647a-119">圧縮された RTF **PR_RTF_COMPRESSED値** が大きい場合、プロパティは壊れています。</span><span class="sxs-lookup"><span data-stu-id="e647a-119">If the value of **PR_RTF_COMPRESSED** is not larger than the compressed RTF, the property is corrupt.</span></span> 
    
2. <span data-ttu-id="e647a-120">RTF ヘッダーのマジック値が  _dwMagicCompressedRTF_ または  _dwMagicUncompressedRTF_ ではない場合、プロパティは壊れています。</span><span class="sxs-lookup"><span data-stu-id="e647a-120">If the magic value in the RTF header is not  _dwMagicCompressedRTF_ or  _dwMagicUncompressedRTF_, the property is corrupt.</span></span>
    
<span data-ttu-id="e647a-121">サポート メソッドを使用するメッセージ ストア プロバイダーは、破損のチェックを実装 **PR_RTF_COMPRESSED** 必要があります。MAPI を使用すると、適切なプロパティが存在し、有効になります。</span><span class="sxs-lookup"><span data-stu-id="e647a-121">Message store providers using the support methods need not be concerned with implementing a check for **PR_RTF_COMPRESSED** corruption; MAPI ensures that the appropriate properties exist and are valid.</span></span> 
  
<span data-ttu-id="e647a-122">メッセージ ストア プロバイダーが実装できる RTF サポートには、3 つの異なるレベルがあります。MAPI では、RTF 対応のメッセージ ストア プロバイダーが中央または最高レベルでサポートを実装する必要があります。</span><span class="sxs-lookup"><span data-stu-id="e647a-122">There are three different levels of RTF support that message store providers can implement; MAPI recommends that RTF-aware message store providers implement their support at the middle or highest level.</span></span> <span data-ttu-id="e647a-123">すべての RTF 対応メッセージ ストア プロバイダーは、送信メッセージの **PR_RTF_COMPRESSED** に含まれるデータから **PR_BODY** を生成し、受信メッセージのテキストと書式設定を同期するために **RTFSync** を呼び出します。</span><span class="sxs-lookup"><span data-stu-id="e647a-123">All RTF-aware message store providers take care of generating **PR_BODY** from the data included in **PR_RTF_COMPRESSED** on outgoing messages and make a call to **RTFSync** to synchronize text and formatting on incoming messages.</span></span> 
  
<span data-ttu-id="e647a-124">これら 3 つのレベルの違いを次の表に示します。</span><span class="sxs-lookup"><span data-stu-id="e647a-124">The differences between these three levels are described in the following table.</span></span> 
  
|<span data-ttu-id="e647a-125">**サポートのレベル**</span><span class="sxs-lookup"><span data-stu-id="e647a-125">**Level of support**</span></span>|<span data-ttu-id="e647a-126">**説明**</span><span class="sxs-lookup"><span data-stu-id="e647a-126">**Description**</span></span>|
|:-----|:-----|
|<span data-ttu-id="e647a-127">低い</span><span class="sxs-lookup"><span data-stu-id="e647a-127">Low</span></span>  <br/> |<span data-ttu-id="e647a-128">メッセージ ストア プロバイダーは、変更がメッセージに保存されるたびに **RTFSync** を呼び出し、PR_RTF_COMPRESSED から **PR_BODY** プロパティのデータを抽出します **。**</span><span class="sxs-lookup"><span data-stu-id="e647a-128">Message store provider calls **RTFSync** whenever changes are saved to a message and extracts the data for the **PR_BODY** property from **PR_RTF_COMPRESSED** rather than requiring clients to set it.</span></span> <span data-ttu-id="e647a-129">データ **PR_BODY** と **PR_RTF_COMPRESSED** が格納されます。</span><span class="sxs-lookup"><span data-stu-id="e647a-129">Both **PR_BODY** and **PR_RTF_COMPRESSED** are stored.</span></span>  <br/> |
|<span data-ttu-id="e647a-130">Middle</span><span class="sxs-lookup"><span data-stu-id="e647a-130">Middle</span></span>  <br/> |<span data-ttu-id="e647a-131">メッセージ ストア プロバイダーは、必要に応 **じてPR_RTF_COMPRESSEDプロパティ** のみをPR_BODY **格納します** 。</span><span class="sxs-lookup"><span data-stu-id="e647a-131">Message store provider stores only the **PR_RTF_COMPRESSED** property, computing **PR_BODY** when necessary.</span></span>  <br/> |
|<span data-ttu-id="e647a-132">高い</span><span class="sxs-lookup"><span data-stu-id="e647a-132">High</span></span>  <br/> |<span data-ttu-id="e647a-133">メッセージ ストア プロバイダーは、PR_BODY **RTF** プロパティも格納されません。</span><span class="sxs-lookup"><span data-stu-id="e647a-133">Message store provider stores neither **PR_BODY** or the auxiliary RTF properties.</span></span> <span data-ttu-id="e647a-134">**RTFSync** は、メッセージ テキストが変更され、書式設定が変更されていない場合、またはトランスポート プロバイダーによって新しいメッセージがダウンロードされた場合に呼び出されます。</span><span class="sxs-lookup"><span data-stu-id="e647a-134">**RTFSync** is called when the message text has changed and the formatting remains unchanged or when a new message is downloaded by a transport provider.</span></span>  <br/> |
   

