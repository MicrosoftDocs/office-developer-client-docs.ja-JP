---
title: メッセージ ストア通知の処理
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 3e0cc2f9-a88d-4cec-bef5-b60f2ec80f1c
description: '最終更新日: 2015 年 3 月 9 日'
ms.openlocfilehash: d370603dc7cfc015fe7b2757d1cf0525b3092c5e
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/28/2019
ms.locfileid: "33428026"
---
# <a name="handling-message-store-notification"></a><span data-ttu-id="aa4ed-103">メッセージ ストア通知の処理</span><span class="sxs-lookup"><span data-stu-id="aa4ed-103">Handling message store notification</span></span>
  
<span data-ttu-id="aa4ed-104">**適用対象**: Outlook 2013 | Outlook 2016</span><span class="sxs-lookup"><span data-stu-id="aa4ed-104">**Applies to**: Outlook 2013 | Outlook 2016</span></span> 
  
<span data-ttu-id="aa4ed-105">メッセージ ストア通知に登録するには [、IMAPISession:::Advise](imapisession-advise.md) メソッドまたは [IMsgStore::Advise](imsgstore-advise.md) メソッドを呼び出し  _、lpEntryID_ パラメーターの内容にメッセージ ストア、フォルダー、またはメッセージ エントリ識別子を指定します。</span><span class="sxs-lookup"><span data-stu-id="aa4ed-105">To register for message store notifications, call either the [IMAPISession::Advise](imapisession-advise.md) or [IMsgStore::Advise](imsgstore-advise.md) method and specify a message store, folder, or message entry identifier in the contents of the  _lpEntryID_ parameter.</span></span> <span data-ttu-id="aa4ed-106">メッセージ ストア プロバイダーは、オブジェクト通知とテーブル通知の両方をサポートします。</span><span class="sxs-lookup"><span data-stu-id="aa4ed-106">Message store providers support both object and table notifications.</span></span> <span data-ttu-id="aa4ed-107">特定のメッセージ ストア オブジェクトに登録するか、これらのオブジェクトを記述するフォルダー階層テーブルとコンテンツ テーブルを使用するか、オブジェクトとテーブルの両方に登録するかは、表示される通知、操作を実行するために行う呼び出し、およびメッセージ ストア プロバイダーが通知をサポートする方法によって異なります。</span><span class="sxs-lookup"><span data-stu-id="aa4ed-107">Whether you register with particular message store objects, with the folder hierarchy and contents tables that describe these objects, or with both objects and tables depends on the notifications you expect to see, the calls you make to perform operations, and how the message store provider supports notification.</span></span> 
  
<span data-ttu-id="aa4ed-108">MAPI を使用すると、プロバイダーが通知をサポートする方法が柔軟に行えるので、すべてのメッセージ ストア プロバイダーから特定のイベントに応答して、常に同じ種類の通知を受け取るとは限りないので注意してください。</span><span class="sxs-lookup"><span data-stu-id="aa4ed-108">Because MAPI allows flexibility in how providers support notifications, be aware that you will not always receive the same type of notification in response to a particular event from all message store providers.</span></span> <span data-ttu-id="aa4ed-109">一部のメッセージ ストア プロバイダーは、通知を全くサポートしていない。</span><span class="sxs-lookup"><span data-stu-id="aa4ed-109">Some message store providers do not support notifications at all.</span></span> <span data-ttu-id="aa4ed-110">使用しているメッセージ ストアが通知をサポートしているかどうかを確認するには、STORE_NOTIFY_OK **(** [PidTagStoreSupportMask](pidtagstoresupportmask-canonical-property.md)) プロパティで PR_STORE_SUPPORT_MASK ビットを探します。</span><span class="sxs-lookup"><span data-stu-id="aa4ed-110">To determine if the message store you are using supports notification, look for the STORE_NOTIFY_OK bit in its **PR_STORE_SUPPORT_MASK** ([PidTagStoreSupportMask](pidtagstoresupportmask-canonical-property.md)) property.</span></span>
  
<span data-ttu-id="aa4ed-111">通知をサポートするメッセージ ストア プロバイダーの一端には、"リッチ" 通知を生成するプロバイダーがあります。これらのプロバイダーは、登録済みのすべてのアドバイス ソースに対して説明的な通知を送信します。</span><span class="sxs-lookup"><span data-stu-id="aa4ed-111">At one end of the spectrum of message store providers that support notification are the providers that generate "rich" notifications; these providers send descriptive notifications for all registered advise sources.</span></span> <span data-ttu-id="aa4ed-112">もう一方の端には、制限付き通知をサポートするメッセージ ストア プロバイダーがあります。これらのプロバイダーは、制限された数のアドバイス ソースに対して一般的な通知を送信します。</span><span class="sxs-lookup"><span data-stu-id="aa4ed-112">At the other end are the message store providers that support limited notifications; these providers send general notifications for a restricted number of advise sources.</span></span> 
  
<span data-ttu-id="aa4ed-113">たとえば、コピーされたオブジェクトと移動したオブジェクトの両方の通知を受信するために登録したフォルダーにメッセージをコピーする場合、オブジェクトコピーされた通知を受信する場合と受信しない場合があります。</span><span class="sxs-lookup"><span data-stu-id="aa4ed-113">For example, if you copy a message to a folder with which you have registered to receive both object copied and object moved notifications, you may or may not receive the object copied notification.</span></span> <span data-ttu-id="aa4ed-114">受け取るかどうかは、次に依存します。</span><span class="sxs-lookup"><span data-stu-id="aa4ed-114">Whether or not you receive it depends on:</span></span>
  
- <span data-ttu-id="aa4ed-115">コピーを実行するために呼び出したメソッド。</span><span class="sxs-lookup"><span data-stu-id="aa4ed-115">The method that you called to perform the copy.</span></span> <span data-ttu-id="aa4ed-116">これは[IMAPIFolder::CopyMessages](imapifolder-copymessages.md) [、IMAPIProp::CopyTo、](imapiprop-copyto.md)[または IMAPIProp::CopyProps です](imapiprop-copyprops.md)。</span><span class="sxs-lookup"><span data-stu-id="aa4ed-116">This could be [IMAPIFolder::CopyMessages](imapifolder-copymessages.md), [IMAPIProp::CopyTo](imapiprop-copyto.md), or [IMAPIProp::CopyProps](imapiprop-copyprops.md).</span></span>
    
- <span data-ttu-id="aa4ed-117">メッセージ ストア プロバイダーが copy メソッドを実装する方法。</span><span class="sxs-lookup"><span data-stu-id="aa4ed-117">How the message store provider implements the copy method.</span></span>
    
- <span data-ttu-id="aa4ed-118">メッセージ ストア プロバイダーがフォルダー上のオブジェクト コピーされた通知をサポートするかどうか。</span><span class="sxs-lookup"><span data-stu-id="aa4ed-118">Whether or not the message store provider supports object copied notifications on folders.</span></span>
    
<span data-ttu-id="aa4ed-119">メッセージ ストア プロバイダーのイベント通知を実装する方法を説明する厳密なガイドラインはないので、クライアントは一貫した動作を期待できません。</span><span class="sxs-lookup"><span data-stu-id="aa4ed-119">Because there are no strict guidelines that describe how to implement event notification for message store providers, clients cannot expect consistent behavior.</span></span> <span data-ttu-id="aa4ed-120">MAPI では、メッセージ ストア プロバイダーがイベント通知を実装する方法について推奨事項を示し、次の表でこれらの推奨事項の概要を示します。</span><span class="sxs-lookup"><span data-stu-id="aa4ed-120">MAPI does make recommendations as to how message store providers implement event notification and the following table outlines these recommendations.</span></span> <span data-ttu-id="aa4ed-121">次のように表を読み取ります。最初の列で操作を実行した後、3 番目の列にリストされているオブジェクトをその型に登録している場合は、2 番目の列にリストされている型の通知を受け取る必要があります。</span><span class="sxs-lookup"><span data-stu-id="aa4ed-121">Read the table as follows: after you perform the operation in the first column, expect to receive a notification of the type listed in the second column if you have registered for that type with the object listed in the third column.</span></span> <span data-ttu-id="aa4ed-122">たとえば、フォルダーを作成した後、メッセージ ストアで  _fnevObjectCreated_ 通知に登録している場合にのみ  _、fnevObjectCreated_ 通知を受け取ります。</span><span class="sxs-lookup"><span data-stu-id="aa4ed-122">For example, after you have created a folder, you will receive an  _fnevObjectCreated_ notification only if you have registered for  _fnevObjectCreated_ notifications with the message store.</span></span> 
  
|<span data-ttu-id="aa4ed-123">**操作**</span><span class="sxs-lookup"><span data-stu-id="aa4ed-123">**Operation**</span></span>|<span data-ttu-id="aa4ed-124">**イベントの種類**</span><span class="sxs-lookup"><span data-stu-id="aa4ed-124">**Event type**</span></span>|<span data-ttu-id="aa4ed-125">**ソースのアドバイス**</span><span class="sxs-lookup"><span data-stu-id="aa4ed-125">**Advise source**</span></span>|
|:-----|:-----|:-----|
|<span data-ttu-id="aa4ed-126">フォルダーの作成</span><span class="sxs-lookup"><span data-stu-id="aa4ed-126">Create a folder</span></span>  <br/> | <span data-ttu-id="aa4ed-127">_fnevObjectCreated_</span><span class="sxs-lookup"><span data-stu-id="aa4ed-127">_fnevObjectCreated_</span></span> <br/> |<span data-ttu-id="aa4ed-128">メッセージ ストア</span><span class="sxs-lookup"><span data-stu-id="aa4ed-128">Message store</span></span>  <br/> |
|<span data-ttu-id="aa4ed-129">フォルダーの削除</span><span class="sxs-lookup"><span data-stu-id="aa4ed-129">Delete a folder</span></span>  <br/> | <span data-ttu-id="aa4ed-130">_fnevObjectDeleted_</span><span class="sxs-lookup"><span data-stu-id="aa4ed-130">_fnevObjectDeleted_</span></span> <br/> |<span data-ttu-id="aa4ed-131">メッセージ ストア 削除済みフォルダー</span><span class="sxs-lookup"><span data-stu-id="aa4ed-131">Message store Deleted folder</span></span>  <br/> |
|<span data-ttu-id="aa4ed-132">フォルダーをあるフォルダーから別のフォルダーに移動する</span><span class="sxs-lookup"><span data-stu-id="aa4ed-132">Move a folder from one folder to another</span></span>  <br/> | <span data-ttu-id="aa4ed-133">_fnevObjectMoved_</span><span class="sxs-lookup"><span data-stu-id="aa4ed-133">_fnevObjectMoved_</span></span> <br/> |<span data-ttu-id="aa4ed-134">メッセージ ストア移動フォルダー</span><span class="sxs-lookup"><span data-stu-id="aa4ed-134">Message store Moved folder</span></span>  <br/> |
|<span data-ttu-id="aa4ed-135">フォルダーを 1 つのフォルダーから別のフォルダーにコピーする</span><span class="sxs-lookup"><span data-stu-id="aa4ed-135">Copy a folder from one folder to another</span></span>  <br/> | <span data-ttu-id="aa4ed-136">_fnevObjectCopied_</span><span class="sxs-lookup"><span data-stu-id="aa4ed-136">_fnevObjectCopied_</span></span> <br/> |<span data-ttu-id="aa4ed-137">メッセージ ストアとコピーされたフォルダー (フォルダーの新しいコピーに対して送信された  _fnevObjectCreated_ 通知なし)</span><span class="sxs-lookup"><span data-stu-id="aa4ed-137">Message store and copied folder (no  _fnevObjectCreated_ notification sent for the new copy of the folder)</span></span>  <br/> |
|<span data-ttu-id="aa4ed-138">計算フォルダー プロパティの変更 (**PR_SUBFOLDERS** ([PidTagSubfolders](pidtagsubfolders-canonical-property.md)) 、 **PR_CONTENT_UNREAD** ([PidTagContentUnreadCount](pidtagcontentunreadcount-canonical-property.md)) 、 **PR_CONTENT_COUNT** ([PidTagContentCount](pidtagcontentcount-canonical-property.md))</span><span class="sxs-lookup"><span data-stu-id="aa4ed-138">Change in a computed folder property (**PR_SUBFOLDERS** ([PidTagSubfolders](pidtagsubfolders-canonical-property.md)), **PR_CONTENT_UNREAD** ([PidTagContentUnreadCount](pidtagcontentunreadcount-canonical-property.md)), **PR_CONTENT_COUNT** ([PidTagContentCount](pidtagcontentcount-canonical-property.md))</span></span>  <br/> | <span data-ttu-id="aa4ed-139">_fnevObjectModified_</span><span class="sxs-lookup"><span data-stu-id="aa4ed-139">_fnevObjectModified_</span></span> <br/> |<span data-ttu-id="aa4ed-140">メッセージ ストア 変更されたフォルダー (親フォルダーへの通知なし)</span><span class="sxs-lookup"><span data-stu-id="aa4ed-140">Message store Changed folder (No notification to parent folder)</span></span>  <br/> |
|<span data-ttu-id="aa4ed-141">メッセージを作成する</span><span class="sxs-lookup"><span data-stu-id="aa4ed-141">Create a message</span></span>  <br/> | <span data-ttu-id="aa4ed-142">_fnevObjectCreated_</span><span class="sxs-lookup"><span data-stu-id="aa4ed-142">_fnevObjectCreated_</span></span> <br/> |<span data-ttu-id="aa4ed-143">メッセージ ストア</span><span class="sxs-lookup"><span data-stu-id="aa4ed-143">Message store</span></span>  <br/> |
|<span data-ttu-id="aa4ed-144">メッセージを削除し、親フォルダーのプロパティ **を変更PR_CONTENT_COUNT** する</span><span class="sxs-lookup"><span data-stu-id="aa4ed-144">Delete a message, causing a change in the parent folder's **PR_CONTENT_COUNT** property</span></span>  <br/> | <span data-ttu-id="aa4ed-145">_fnevObjectDeleted_</span><span class="sxs-lookup"><span data-stu-id="aa4ed-145">_fnevObjectDeleted_</span></span> <br/> |<span data-ttu-id="aa4ed-146">メッセージ ストア 削除済みメッセージ</span><span class="sxs-lookup"><span data-stu-id="aa4ed-146">Message store Deleted message</span></span>  <br/> |
|<span data-ttu-id="aa4ed-147">あるフォルダーから別のフォルダーにメッセージを移動する</span><span class="sxs-lookup"><span data-stu-id="aa4ed-147">Move a message from one folder to another</span></span>  <br/> | <span data-ttu-id="aa4ed-148">_fnevObjectMoved_</span><span class="sxs-lookup"><span data-stu-id="aa4ed-148">_fnevObjectMoved_</span></span> <br/> |<span data-ttu-id="aa4ed-149">メッセージ ストア 移動されたメッセージ</span><span class="sxs-lookup"><span data-stu-id="aa4ed-149">Message store Moved message</span></span>  <br/> |
|<span data-ttu-id="aa4ed-150">あるフォルダーから別のフォルダーにメッセージをコピーする</span><span class="sxs-lookup"><span data-stu-id="aa4ed-150">Copy a message from one folder to another</span></span>  <br/> | <span data-ttu-id="aa4ed-151">_fnevObjectCopied_</span><span class="sxs-lookup"><span data-stu-id="aa4ed-151">_fnevObjectCopied_</span></span> <br/> |<span data-ttu-id="aa4ed-152">メッセージ ストア コピーされたメッセージ (メッセージの新しいコピーに対する  _fnevObjectCreated_ 通知なし)</span><span class="sxs-lookup"><span data-stu-id="aa4ed-152">Message store Copied message (No  _fnevObjectCreated_ notification for new copy of the message)</span></span>  <br/> |
|<span data-ttu-id="aa4ed-153">メッセージを保存し、親フォルダーのプロパティ **に変更を** PR_CONTENT_COUNTする</span><span class="sxs-lookup"><span data-stu-id="aa4ed-153">Save a message, causing a change in the parent folder's **PR_CONTENT_COUNT** property</span></span>  <br/> | <span data-ttu-id="aa4ed-154">_fnevObjectCreated_</span><span class="sxs-lookup"><span data-stu-id="aa4ed-154">_fnevObjectCreated_</span></span> <br/> |<span data-ttu-id="aa4ed-155">最初の保存時のメッセージ ストアのみ</span><span class="sxs-lookup"><span data-stu-id="aa4ed-155">Message store on first save only</span></span>  <br/> |
|<span data-ttu-id="aa4ed-156">メッセージを保存する</span><span class="sxs-lookup"><span data-stu-id="aa4ed-156">Save a message</span></span>  <br/> | <span data-ttu-id="aa4ed-157">_fnevObjectModified_</span><span class="sxs-lookup"><span data-stu-id="aa4ed-157">_fnevObjectModified_</span></span> <br/> |<span data-ttu-id="aa4ed-158">最初の保存後の保存時のメッセージ ストア変更メッセージ (親フォルダーへの通知なし)</span><span class="sxs-lookup"><span data-stu-id="aa4ed-158">Message store on saves after the first save Changed message (No notification to parent folder)</span></span>  <br/> |
|<span data-ttu-id="aa4ed-159">検索操作を完了する</span><span class="sxs-lookup"><span data-stu-id="aa4ed-159">Complete a search operation</span></span>  <br/> | <span data-ttu-id="aa4ed-160">_fnevSearchComplete_</span><span class="sxs-lookup"><span data-stu-id="aa4ed-160">_fnevSearchComplete_</span></span> <br/> |<span data-ttu-id="aa4ed-161">メッセージ ストアの検索フォルダー</span><span class="sxs-lookup"><span data-stu-id="aa4ed-161">Message store Search folder</span></span>  <br/> |
|<span data-ttu-id="aa4ed-162">新しいメッセージ</span><span class="sxs-lookup"><span data-stu-id="aa4ed-162">New message</span></span>  <br/> | <span data-ttu-id="aa4ed-163">_fnevNewMail_</span><span class="sxs-lookup"><span data-stu-id="aa4ed-163">_fnevNewMail_</span></span> <br/> |<span data-ttu-id="aa4ed-164">メッセージ ストア</span><span class="sxs-lookup"><span data-stu-id="aa4ed-164">Message store</span></span>  <br/> |
   
> [!NOTE]
> <span data-ttu-id="aa4ed-165">オブジェクト変更通知を受け取った場合は **、OnNotify** 呼び出しの _lpNotifications_ パラメーターが指す [OBJECT_NOTIFICATION](object_notification.md)構造体のプロパティ タグ配列部分が NULL の場合としない場合があります。</span><span class="sxs-lookup"><span data-stu-id="aa4ed-165">When you receive an object modified notification, remember that the property tag array portion of the [OBJECT_NOTIFICATION](object_notification.md) structure pointed to by the  _lpNotifications_ parameter in the **OnNotify** call may or may not be NULL.</span></span> <span data-ttu-id="aa4ed-166">メッセージ ストア プロバイダーは、この配列にプロパティ情報を挿入する必要はありません。</span><span class="sxs-lookup"><span data-stu-id="aa4ed-166">Message store providers are not required to insert property information in this array and most do not.</span></span> <span data-ttu-id="aa4ed-167">**OnNotify メソッドが** _lpPropTagArray_ ポインターが NULL の場合に対応することを確認します。</span><span class="sxs-lookup"><span data-stu-id="aa4ed-167">Make sure your **OnNotify** method can handle the case where the  _lpPropTagArray_ pointer is NULL.</span></span> 
  
<span data-ttu-id="aa4ed-168">ほとんどの場合、すべてのオブジェクト通知ではない場合は、影響を受けるフォルダーまたはフォルダーのビューを更新します。</span><span class="sxs-lookup"><span data-stu-id="aa4ed-168">For most, if not all object notifications, update the view of the affected folder or folders.</span></span>
  

