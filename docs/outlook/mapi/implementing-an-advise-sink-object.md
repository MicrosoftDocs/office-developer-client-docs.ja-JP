---
title: アドバイズシンクオブジェクトの実装
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 7461c4f6-7030-4ba2-ada4-26ebfbbfa001
description: '最終更新日: 2015 年 3 月 9 日'
ms.openlocfilehash: ecaad65d28f74b843b86ca82dab9a833ade77363
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/28/2019
ms.locfileid: "33412108"
---
# <a name="implementing-an-advise-sink-object"></a>アドバイズシンクオブジェクトの実装

  
  
**適用対象**: Outlook 2013 | Outlook 2016 
  
クライアントは、独自のアドバイズシンクオブジェクトを実装するか、ユーティリティ関数[HrAllocAdviseSink](hrallocadvisesink.md)を使用することができます。 **HrAllocAdviseSink**は、コールバック関数を呼び出す**onnotify**の実装を使用して、アドバイズシンクオブジェクトを作成します。 
  
**HrAllocAdviseSink**を使用することには、長所と短所があります。 作業を節約することはできますが、作成するアドバイズシンクオブジェクトをカウントする参照を制御することはできません。 そのため、アドバイズシンクのリリースを慎重に制御する必要があるクライアント、またはアドバイズシンクの間に相互依存関係があり、別のクライアントオブジェクトが独自の**IMAPIAdviseSink**実装を構築して使用**しないようにする必要があります。HrAllocAdviseSink**全体。 
  
独自のアドバイズシンクを実装するクライアントは、他のオブジェクトに関連していないか、または他のオブジェクトに依存していない独立したオブジェクトにすることにより、参照カウントおよびオブジェクトのリリースに発生する可能性のある問題を排除します。 ただし、別のオブジェクトの一部としてアドバイズシンクを実装する必要がある場合、またはデータメンバーとして別のオブジェクトへの後方ポインターが含まれている場合は、2つの個別の参照カウントを保持することをお勧めします。1つは、アドバイズシンクによって参照されるオブジェクト用、もう1つアドバイズシンク。 
  
参照されるオブジェクトの参照カウントがゼロになると、そのすべてのメソッドが失敗し、その vtable が破棄される可能性がありますが、アドバイズシンクのメモリは、その参照カウントがゼロになるまで、そのまま維持されている必要があります。 これは、アドバイズシンクの**Release**メソッドが、参照カウントをデクリメントして、そのカウントが0に達したときにオブジェクトの破棄を完了する必要があることを意味します。 2つの異なる参照カウントが保持されていない場合、そのアドバイズシンクは、そのオブジェクトの**解放**プロセスの一部として誤って破棄するのが簡単です。 
  
**HrAllocAdviseSink**を使用してアドバイズシンクを実装するクライアントは、別のアドバイズシンクオブジェクトのメソッドとしてコールバック関数を含めないように注意する必要があります。 C++ クライアントでは、これを実行して、_この_ポインターをパラメーターとして渡すことができます。 クライアントは通常、参照カウントが0に達したときにオブジェクトを解放するため、これは危険な戦略です。 アドバイズシンクオブジェクトのメモリを解放すると、_この_ポインターが無効であると表示されます。 
  
イベントの種類とアドバイズソースに応じて、 **onnotify**メソッドはさまざまな方法でイベントを処理できます。 次の表に、いくつかの標準イベントを処理する方法に関する提案を示します。 
  
|**イベントの種類**|**onnotify での処理**|
|:-----|:-----|
|移動されたオブジェクト  <br/> |移動したオブジェクトの元の親が新しい親に関連付けられている場合は、階層の最上位のフォルダーまたはアドレス帳コンテナーから始まるビューを更新します。 2つの親コンテナーが関連付けられていない場合は、両方のビューを更新します。  <br/> |
|新しいメッセージ  <br/> |ユーザーインターフェイスを変更して、1つまたは複数の新しいメッセージが到着したことをユーザーに通知します。 受信フォルダーを現在のビューに配置します。  <br/> |
|Error  <br/> |セッション以外のすべてのオブジェクトについて、必要に応じてエラーをログに記録し、を返します。 session オブジェクトの場合は、可能であればログオフします。  <br/> |
|検索の完了  <br/> |処理は必要ありません。  <br/> |
   
> [!NOTE]
> 通知ハンドラーは再入可能である必要があります。 
  

