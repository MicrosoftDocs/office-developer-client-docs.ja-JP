---
title: IMSProviderLogon
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
ms.topic: reference
ms.prod: office-online-server
localization_priority: Normal
api_name:
- IMSProvider.Logon
api_type:
- COM
ms.assetid: 890d9cbe-3570-4cf0-aeae-667c0e5ba181
description: '最終更新日: 2011 年 7 月 23 日'
ms.openlocfilehash: 9c7f62c69c7a06f7ca0e4bfddcf789cddc536ea6
ms.sourcegitcommit: 8fe462c32b91c87911942c188f3445e85a54137c
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/23/2019
ms.locfileid: "32309668"
---
# <a name="imsproviderlogon"></a><span data-ttu-id="7ece0-103">IMSProvider::Logon</span><span class="sxs-lookup"><span data-stu-id="7ece0-103">IMSProvider::Logon</span></span>

  
  
<span data-ttu-id="7ece0-104">**適用対象**: Outlook 2013 | Outlook 2016</span><span class="sxs-lookup"><span data-stu-id="7ece0-104">**Applies to**: Outlook 2013 | Outlook 2016</span></span> 
  
<span data-ttu-id="7ece0-105">メッセージストアプロバイダーの1つのインスタンスに MAPI を記録します。</span><span class="sxs-lookup"><span data-stu-id="7ece0-105">Logs MAPI on to one instance of a message store provider.</span></span>
  
```cpp
HRESULT Logon(
  LPMAPISUP lpMAPISup,
  ULONG_PTR ulUIParam,
  LPSTR lpszProfileName,
  ULONG cbEntryID,
  LPENTRYID lpEntryID,
  ULONG ulFlags,
  LPCIID lpInterface,
  ULONG FAR * lpcbSpoolSecurity,
  LPBYTE FAR * lppbSpoolSecurity,
  LPMAPIERROR FAR * lppMAPIError,
  LPMSLOGON FAR * lppMSLogon,
  LPMDB FAR * lppMDB
);
```

## <a name="parameters"></a><span data-ttu-id="7ece0-106">パラメーター</span><span class="sxs-lookup"><span data-stu-id="7ece0-106">Parameters</span></span>

 <span data-ttu-id="7ece0-107">_lpMAPISup_</span><span class="sxs-lookup"><span data-stu-id="7ece0-107">_lpMAPISup_</span></span>
  
> <span data-ttu-id="7ece0-108">順番メッセージストアの現在の MAPI サポートオブジェクトへのポインター。</span><span class="sxs-lookup"><span data-stu-id="7ece0-108">[in] A pointer to the current MAPI support object for the message store.</span></span>
    
 <span data-ttu-id="7ece0-109">_uluiparam_</span><span class="sxs-lookup"><span data-stu-id="7ece0-109">_ulUIParam_</span></span>
  
> <span data-ttu-id="7ece0-110">順番このメソッドが表示する任意のダイアログボックスまたはウィンドウの親ウィンドウへのハンドル。</span><span class="sxs-lookup"><span data-stu-id="7ece0-110">[in] A handle to the parent window of any dialog boxes or windows this method displays.</span></span> 
    
 <span data-ttu-id="7ece0-111">_lpszprofilename_</span><span class="sxs-lookup"><span data-stu-id="7ece0-111">_lpszProfileName_</span></span>
  
> <span data-ttu-id="7ece0-112">順番ストアプロバイダーのログオンに使用されているプロファイルの名前を含む文字列へのポインター。</span><span class="sxs-lookup"><span data-stu-id="7ece0-112">[in] A pointer to a string that contains the name of the profile being used for store provider logon.</span></span> <span data-ttu-id="7ece0-113">この文字列は、ダイアログボックスに表示したり、ログファイルに書き込んだたり、単に無視したりできます。</span><span class="sxs-lookup"><span data-stu-id="7ece0-113">This string can be displayed in dialog boxes, written out to a log file, or simply ignored.</span></span> <span data-ttu-id="7ece0-114">MAPI_UNICODE フラグが_ulflags_パラメーターで設定されている場合は、Unicode 形式である必要があります。</span><span class="sxs-lookup"><span data-stu-id="7ece0-114">It must be in Unicode format if the MAPI_UNICODE flag is set in the  _ulFlags_ parameter.</span></span> 
    
 <span data-ttu-id="7ece0-115">_cbEntryID_</span><span class="sxs-lookup"><span data-stu-id="7ece0-115">_cbEntryID_</span></span>
  
> <span data-ttu-id="7ece0-116">順番_lな tryid_パラメーターで指定されたエントリ識別子のサイズ (バイト単位)。</span><span class="sxs-lookup"><span data-stu-id="7ece0-116">[in] The size, in bytes, of the entry identifier pointed to by the  _lpEntryID_ parameter.</span></span> 
    
 <span data-ttu-id="7ece0-117">_lて tryid_</span><span class="sxs-lookup"><span data-stu-id="7ece0-117">_lpEntryID_</span></span>
  
> <span data-ttu-id="7ece0-118">順番メッセージストアのエントリ識別子へのポインター。</span><span class="sxs-lookup"><span data-stu-id="7ece0-118">[in] A pointer to the entry identifier for the message store.</span></span> <span data-ttu-id="7ece0-119">_l記憶 tryid_で**null**を渡すことは、メッセージストアがまだ選択されておらず、ユーザーがメッセージストアを選択できるようにするダイアログボックスが表示されることを示します。</span><span class="sxs-lookup"><span data-stu-id="7ece0-119">Passing **null** in  _lpEntryID_ indicates that a message store has not yet been selected and that dialog boxes that enable the user to select a message store can be presented.</span></span> 
    
 <span data-ttu-id="7ece0-120">_ulFlags_</span><span class="sxs-lookup"><span data-stu-id="7ece0-120">_ulFlags_</span></span>
  
> <span data-ttu-id="7ece0-121">順番ログオンの実行方法を制御するフラグのビットマスク。</span><span class="sxs-lookup"><span data-stu-id="7ece0-121">[in] A bitmask of flags that controls how the logon is performed.</span></span> <span data-ttu-id="7ece0-122">次のフラグを設定できます。</span><span class="sxs-lookup"><span data-stu-id="7ece0-122">The following flags can be set:</span></span>
    
<span data-ttu-id="7ece0-123">MAPI_DEFERRED_ERRORS</span><span class="sxs-lookup"><span data-stu-id="7ece0-123">MAPI_DEFERRED_ERRORS</span></span> 
  
> <span data-ttu-id="7ece0-124">呼び出し元のオブジェクトが呼び出し側の実装で使用できない場合でも、呼び出しを成功させることができます。</span><span class="sxs-lookup"><span data-stu-id="7ece0-124">The call is allowed to succeed even if the underlying object is not available to the calling implementation.</span></span> <span data-ttu-id="7ece0-125">オブジェクトが使用できない場合は、その後のオブジェクトの呼び出しでエラーが発生する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="7ece0-125">If the object is not available, a subsequent call to the object might raise an error.</span></span>
    
<span data-ttu-id="7ece0-126">MAPI_UNICODE</span><span class="sxs-lookup"><span data-stu-id="7ece0-126">MAPI_UNICODE</span></span> 
  
> <span data-ttu-id="7ece0-127">渡された文字列は Unicode 形式です。</span><span class="sxs-lookup"><span data-stu-id="7ece0-127">The passed-in strings are in Unicode format.</span></span> <span data-ttu-id="7ece0-128">MAPI_UNICODE が設定されていない場合、文字列は ANSI 形式になります。</span><span class="sxs-lookup"><span data-stu-id="7ece0-128">If MAPI_UNICODE is not set, the strings are in ANSI format.</span></span>
    
<span data-ttu-id="7ece0-129">MDB_NO_DIALOG</span><span class="sxs-lookup"><span data-stu-id="7ece0-129">MDB_NO_DIALOG</span></span> 
  
> <span data-ttu-id="7ece0-130">ログオンダイアログボックスを表示しないようにします。</span><span class="sxs-lookup"><span data-stu-id="7ece0-130">Prevents the display of logon dialog boxes.</span></span> <span data-ttu-id="7ece0-131">このフラグが設定されている場合は、ログオンが失敗した場合にエラー値 MAPI_E_LOGON_FAILED が返されます。</span><span class="sxs-lookup"><span data-stu-id="7ece0-131">If this flag is set, the error value MAPI_E_LOGON_FAILED is returned if the logon is unsuccessful.</span></span> <span data-ttu-id="7ece0-132">このフラグが設定されていない場合、メッセージストアプロバイダーはユーザーに対して、名前またはパスワードを修正するか、ディスクを挿入するか、またはストアへの接続を確立するために必要なその他の操作を実行するように求めることができます。</span><span class="sxs-lookup"><span data-stu-id="7ece0-132">If this flag is not set, the message store provider can prompt the user to correct a name or password, to insert a disk, or to perform other actions that are necessary to establish connection to the store.</span></span>
    
<span data-ttu-id="7ece0-133">MDB_NO_MAIL</span><span class="sxs-lookup"><span data-stu-id="7ece0-133">MDB_NO_MAIL</span></span> 
  
> <span data-ttu-id="7ece0-134">メールを送受信するためにメッセージストアを使用することはできません。</span><span class="sxs-lookup"><span data-stu-id="7ece0-134">The message store should not be used for sending or receiving mail.</span></span> <span data-ttu-id="7ece0-135">このフラグは、mapi スプーラーにこのメッセージストアが開かれていることを通知しないように mapi に通知します。</span><span class="sxs-lookup"><span data-stu-id="7ece0-135">The flag signals MAPI not to notify the MAPI spooler that this message store is being opened.</span></span> <span data-ttu-id="7ece0-136">このフラグが設定されており、メッセージストアがトランスポートプロバイダーと密接に結合されている場合、プロバイダーは[imapisupport:: SpoolerNotify](imapisupport-spoolernotify.md)メソッドを呼び出す必要はありません。</span><span class="sxs-lookup"><span data-stu-id="7ece0-136">If this flag is set and the message store is tightly coupled with a transport provider, the provider does not need to call the [IMAPISupport::SpoolerNotify](imapisupport-spoolernotify.md) method.</span></span> 
    
<span data-ttu-id="7ece0-137">MDB_TEMPORARY</span><span class="sxs-lookup"><span data-stu-id="7ece0-137">MDB_TEMPORARY</span></span> 
  
> <span data-ttu-id="7ece0-138">ストアにログを記録して、ダイアログボックスを使用せずに、プロファイルセクションからプログラムによって情報を取得できるようにします。</span><span class="sxs-lookup"><span data-stu-id="7ece0-138">Logs on the store so that information can be retrieved programmatically from the profile section, without use of dialog boxes.</span></span> <span data-ttu-id="7ece0-139">このフラグは、ストアがメッセージストアテーブルに追加されず、ストアが永続的に作成できないことを MAPI に指示します。</span><span class="sxs-lookup"><span data-stu-id="7ece0-139">This flag instructs MAPI that the store is not to be added to the message store table and that the store cannot be made permanent.</span></span> <span data-ttu-id="7ece0-140">このフラグが設定されている場合、メッセージストアプロバイダーは[imapisupport:: modifyprofile](imapisupport-modifyprofile.md)メソッドを呼び出す必要はありません。</span><span class="sxs-lookup"><span data-stu-id="7ece0-140">If this flag is set, message store providers do not need to call the [IMAPISupport::ModifyProfile](imapisupport-modifyprofile.md) method.</span></span> 
    
<span data-ttu-id="7ece0-141">MDB_WRITE</span><span class="sxs-lookup"><span data-stu-id="7ece0-141">MDB_WRITE</span></span> 
  
> <span data-ttu-id="7ece0-142">読み取り/書き込みアクセス許可を要求します。</span><span class="sxs-lookup"><span data-stu-id="7ece0-142">Requests read/write permission.</span></span>
    
 <span data-ttu-id="7ece0-143">_lpinterface_</span><span class="sxs-lookup"><span data-stu-id="7ece0-143">_lpInterface_</span></span>
  
> <span data-ttu-id="7ece0-144">順番ログオンするメッセージストアのインターフェイス識別子 (IID) へのポインター。</span><span class="sxs-lookup"><span data-stu-id="7ece0-144">[in] A pointer to the interface identifier (IID) for the message store to log on to.</span></span> <span data-ttu-id="7ece0-145">**null**を渡すと、メッセージストア ( [IMsgStore](imsgstoreimapiprop.md)) の MAPI インターフェイスが返されます。</span><span class="sxs-lookup"><span data-stu-id="7ece0-145">Passing **null** indicates the MAPI interface for the message store ( [IMsgStore](imsgstoreimapiprop.md)) is returned.</span></span> <span data-ttu-id="7ece0-146">_lpinterface_パラメーターは、メッセージストアの適切なインターフェイスの識別子に設定することもできます (たとえば、IID_IUnknown または IID_IMAPIProp)。</span><span class="sxs-lookup"><span data-stu-id="7ece0-146">The  _lpInterface_ parameter can also be set to an identifier for an appropriate interface for the message store (for example, IID_IUnknown or IID_IMAPIProp).</span></span> 
    
 <span data-ttu-id="7ece0-147">_lpcbSpoolSecurity_</span><span class="sxs-lookup"><span data-stu-id="7ece0-147">_lpcbSpoolSecurity_</span></span>
  
> <span data-ttu-id="7ece0-148">読み上げストアプロバイダーが_lppbSpoolSecurity_パラメーターの検証データのサイズ (バイト単位) を返す変数へのポインター。</span><span class="sxs-lookup"><span data-stu-id="7ece0-148">[out] A pointer to the variable in which the store provider returns the size, in bytes, of the validation data in the  _lppbSpoolSecurity_ parameter.</span></span> 
    
 <span data-ttu-id="7ece0-149">_lppbSpoolSecurity_</span><span class="sxs-lookup"><span data-stu-id="7ece0-149">_lppbSpoolSecurity_</span></span>
  
> <span data-ttu-id="7ece0-150">読み上げ返された検証データへのポインターへのポインター。</span><span class="sxs-lookup"><span data-stu-id="7ece0-150">[out] A pointer to the pointer to the returned validation data.</span></span> <span data-ttu-id="7ece0-151">この検証データは、 [IMSProvider:: SpoolerLogon](imsprovider-spoolerlogon.md)メソッドで、メッセージストアプロバイダーと同じストアに MAPI スプーラーを記録できるようにするために用意されています。</span><span class="sxs-lookup"><span data-stu-id="7ece0-151">This validation data is provided so the [IMSProvider::SpoolerLogon](imsprovider-spoolerlogon.md) method can log the MAPI spooler on to the same store as the message store provider.</span></span> 
    
 <span data-ttu-id="7ece0-152">_lppMAPIError_</span><span class="sxs-lookup"><span data-stu-id="7ece0-152">_lppMAPIError_</span></span>
  
> <span data-ttu-id="7ece0-153">読み上げエラーのバージョン、コンポーネント、およびコンテキスト情報を含む返された[MAPIERROR](mapierror.md)構造体へのポインターへのポインター。</span><span class="sxs-lookup"><span data-stu-id="7ece0-153">[out] A pointer to a pointer to the returned [MAPIERROR](mapierror.md) structure, if any, that contains version, component, and context information for an error.</span></span> <span data-ttu-id="7ece0-154">返す**MAPIERROR**構造体がない場合は、 _lppMAPIError_パラメーターを**null**に設定できます。</span><span class="sxs-lookup"><span data-stu-id="7ece0-154">The  _lppMAPIError_ parameter can be set to **null** if there is no **MAPIERROR** structure to return.</span></span> 
    
 <span data-ttu-id="7ece0-155">_lppmslogon_</span><span class="sxs-lookup"><span data-stu-id="7ece0-155">_lppMSLogon_</span></span>
  
> <span data-ttu-id="7ece0-156">読み上げMAPI がログオンするためのメッセージストアログオンオブジェクトへのポインターへのポインター。</span><span class="sxs-lookup"><span data-stu-id="7ece0-156">[out] A pointer to the pointer to the message store logon object for MAPI to log on to.</span></span>
    
 <span data-ttu-id="7ece0-157">_lppmdb_</span><span class="sxs-lookup"><span data-stu-id="7ece0-157">_lppMDB_</span></span>
  
> <span data-ttu-id="7ece0-158">読み上げログオンする MAPI スプーラーおよびクライアントアプリケーションのメッセージストアオブジェクトへのポインターへのポインター。</span><span class="sxs-lookup"><span data-stu-id="7ece0-158">[out] A pointer to the pointer to the message store object for the MAPI spooler and client applications to log on to.</span></span>
    
## <a name="return-value"></a><span data-ttu-id="7ece0-159">戻り値</span><span class="sxs-lookup"><span data-stu-id="7ece0-159">Return value</span></span>

<span data-ttu-id="7ece0-160">S_OK</span><span class="sxs-lookup"><span data-stu-id="7ece0-160">S_OK</span></span> 
  
> <span data-ttu-id="7ece0-161">�ʘb���������A�\�������l�܂��͒l���Ԃ���܂��B</span><span class="sxs-lookup"><span data-stu-id="7ece0-161">The call succeeded and has returned the expected value or values.</span></span>
    
<span data-ttu-id="7ece0-162">MAPI_E_FAILONEPROVIDER</span><span class="sxs-lookup"><span data-stu-id="7ece0-162">MAPI_E_FAILONEPROVIDER</span></span> 
  
> <span data-ttu-id="7ece0-163">このプロバイダーはログオンできませんが、このエラーによってサービスが無効になることはありません。</span><span class="sxs-lookup"><span data-stu-id="7ece0-163">This provider cannot log on, but this error should not disable the service.</span></span> 
    
<span data-ttu-id="7ece0-164">MAPI_E_LOGON_FAILED</span><span class="sxs-lookup"><span data-stu-id="7ece0-164">MAPI_E_LOGON_FAILED</span></span> 
  
> <span data-ttu-id="7ece0-165">ログオンセッションを確立できませんでした。</span><span class="sxs-lookup"><span data-stu-id="7ece0-165">A logon session could not be established.</span></span>
    
<span data-ttu-id="7ece0-166">MAPI_E_UNCONFIGURED</span><span class="sxs-lookup"><span data-stu-id="7ece0-166">MAPI_E_UNCONFIGURED</span></span> 
  
> <span data-ttu-id="7ece0-167">このプロファイルには、ログオンが完了するのに十分な情報が含まれていません。</span><span class="sxs-lookup"><span data-stu-id="7ece0-167">The profile does not contain enough information for the logon to complete.</span></span> <span data-ttu-id="7ece0-168">この値が返されると、MAPI はメッセージストアプロバイダーのメッセージサービスエントリポイント関数を呼び出します。</span><span class="sxs-lookup"><span data-stu-id="7ece0-168">When this value is returned, MAPI calls the message store provider's message-service entry point function.</span></span>
    
<span data-ttu-id="7ece0-169">MAPI_E_USER_CANCEL</span><span class="sxs-lookup"><span data-stu-id="7ece0-169">MAPI_E_USER_CANCEL</span></span> 
  
> <span data-ttu-id="7ece0-170">ユーザーが操作をキャンセルしました。通常は、ダイアログボックスの **[キャンセル**] ボタンをクリックします。</span><span class="sxs-lookup"><span data-stu-id="7ece0-170">The user canceled the operation, typically by clicking the **Cancel** button in a dialog box.</span></span> 
    
<span data-ttu-id="7ece0-171">MAPI_E_UNKNOWN_CPID</span><span class="sxs-lookup"><span data-stu-id="7ece0-171">MAPI_E_UNKNOWN_CPID</span></span> 
  
> <span data-ttu-id="7ece0-172">サーバーは、クライアントのコードページをサポートするように構成されていません。</span><span class="sxs-lookup"><span data-stu-id="7ece0-172">The server is not configured to support the client's code page.</span></span>
    
<span data-ttu-id="7ece0-173">MAPI_E_UNKNOWN_LCID</span><span class="sxs-lookup"><span data-stu-id="7ece0-173">MAPI_E_UNKNOWN_LCID</span></span> 
  
> <span data-ttu-id="7ece0-174">サーバーは、クライアントのロケール情報をサポートするように構成されていません。</span><span class="sxs-lookup"><span data-stu-id="7ece0-174">The server is not configured to support the client's locale information.</span></span>
    
<span data-ttu-id="7ece0-175">MAPI_W_ERRORS_RETURNED</span><span class="sxs-lookup"><span data-stu-id="7ece0-175">MAPI_W_ERRORS_RETURNED</span></span> 
  
> <span data-ttu-id="7ece0-176">呼び出しは成功しましたが、メッセージストアプロバイダーにエラー情報があります。</span><span class="sxs-lookup"><span data-stu-id="7ece0-176">The call succeeded, but the message store provider has error information available.</span></span> <span data-ttu-id="7ece0-177">この警告が返された場合、呼び出しは正常に処理されます。</span><span class="sxs-lookup"><span data-stu-id="7ece0-177">When this warning is returned, the call should be handled as successful.</span></span> <span data-ttu-id="7ece0-178">この警告をテストするには、 **HR_FAILED**マクロを使用します。</span><span class="sxs-lookup"><span data-stu-id="7ece0-178">To test for this warning, use the **HR_FAILED** macro.</span></span> <span data-ttu-id="7ece0-179">詳細については、「[エラー処理にマクロを使用する](using-macros-for-error-handling.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="7ece0-179">For more information, see [Using Macros for Error Handling](using-macros-for-error-handling.md).</span></span> <span data-ttu-id="7ece0-180">プロバイダーからエラー情報を取得するには、 [imapisession:: GetLastError](imapisession-getlasterror.md)メソッドを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="7ece0-180">To get the error information from the provider, call the [IMAPISession::GetLastError](imapisession-getlasterror.md) method.</span></span> 
    
## <a name="remarks"></a><span data-ttu-id="7ece0-181">解説</span><span class="sxs-lookup"><span data-stu-id="7ece0-181">Remarks</span></span>

<span data-ttu-id="7ece0-182">MAPI は**IMSProvider:: Logon**メソッドを呼び出して、メッセージストアへのアクセスを取得するために必要な処理の大部分を行います。</span><span class="sxs-lookup"><span data-stu-id="7ece0-182">MAPI calls the **IMSProvider::Logon** method to do the majority of processing necessary to obtain access to a message store.</span></span> <span data-ttu-id="7ece0-183">メッセージストアプロバイダーは、特定のストアにアクセスするために必要なユーザー資格情報を検証し、MAPI スプーラーおよびクライアントアプリケーションがログオンできる_lppmdb_パラメーターでメッセージストアオブジェクトを返します。</span><span class="sxs-lookup"><span data-stu-id="7ece0-183">Message store providers validate any user credentials necessary to access a particular store and return a message store object in the  _lppMDB_ parameter that the MAPI spooler and client applications can log on to.</span></span> 
  
<span data-ttu-id="7ece0-184">クライアントと mapi スプーラーが使用するために返されるメッセージストアオブジェクトに加えて、プロバイダーは、開いているストアを制御するために mapi が使用するメッセージストアログオンオブジェクトも返します。</span><span class="sxs-lookup"><span data-stu-id="7ece0-184">In addition to the returned message store object for client and MAPI spooler use, the provider also returns a message store logon object for MAPI to use in controlling the opened store.</span></span> <span data-ttu-id="7ece0-185">メッセージストアのログオンオブジェクトとメッセージストアオブジェクトは、それぞれが他方に影響を与えることができるように、メッセージストアプロバイダーの内部に密接にリンクされている必要があります。</span><span class="sxs-lookup"><span data-stu-id="7ece0-185">The message store logon object and the message store object should be tightly linked inside the message store provider so each can affect the other.</span></span> <span data-ttu-id="7ece0-186">store オブジェクトと logon オブジェクトの使用は同一である必要があります。これらのオブジェクトは、2つのインターフェイスを公開する1つのオブジェクトとして機能するように、ログオンオブジェクトと store オブジェクトの間に1対1で対応する必要があります。</span><span class="sxs-lookup"><span data-stu-id="7ece0-186">The use of the store object and the logon object should be identical; there should be a one-to-one correspondence between the logon object and the store object such that the objects act as if they are one object that exposes two interfaces.</span></span> <span data-ttu-id="7ece0-187">2つのオブジェクトは一緒に作成して、一緒に解放する必要があります。</span><span class="sxs-lookup"><span data-stu-id="7ece0-187">The two objects should also be created together and freed together.</span></span> 
  
<span data-ttu-id="7ece0-188">mapi によって作成され、 _lpMAPISup_パラメーターでプロバイダーに渡される mapi サポートオブジェクトは、プロバイダーが必要とする mapi の関数へのアクセスを提供します。</span><span class="sxs-lookup"><span data-stu-id="7ece0-188">The MAPI support object, created by MAPI and passed to the provider in the  _lpMAPISup_ parameter, provides access to functions in MAPI that the provider requires.</span></span> <span data-ttu-id="7ece0-189">これらの機能には、プロファイル情報の保存と取得、アドレス帳へのアクセスなどが含まれます。</span><span class="sxs-lookup"><span data-stu-id="7ece0-189">These include functions that save and retrieve profile information, access address books, and so on.</span></span> <span data-ttu-id="7ece0-190">_lpMAPISup_ポインターは、開いているストアごとに異なる場合があります。</span><span class="sxs-lookup"><span data-stu-id="7ece0-190">The  _lpMAPISup_ pointer can be different for each store that is opened.</span></span> <span data-ttu-id="7ece0-191">ログイン後にメッセージストアの呼び出しを処理する際に、ストアプロバイダーはそのストアに固有の_lpMAPISup_変数を使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="7ece0-191">While processing calls for a message store after logon, the store provider should use the  _lpMAPISup_ variable that is specific to that store.</span></span> <span data-ttu-id="7ece0-192">メッセージストアを開き、メッセージストアのログオンオブジェクトの作成に成功したすべての**ログオン**呼び出しでは、プロバイダーはストアのログオンオブジェクトに MAPI サポートオブジェクトへのポインターを保存し、次の参照を追加するために[IUnknown:: AddRef](https://msdn.microsoft.com/library/ms691379%28v=VS.85%29.aspx)メソッドを呼び出す必要があります。サポートオブジェクト。</span><span class="sxs-lookup"><span data-stu-id="7ece0-192">For any **Logon** call that opens a message store and succeeds in creating a message store logon object, the provider must save a pointer to the MAPI support object in the store logon object and must call the [IUnknown::AddRef](https://msdn.microsoft.com/library/ms691379%28v=VS.85%29.aspx) method to add a reference for the support object.</span></span> 
  
<span data-ttu-id="7ece0-193">プロバイダーが**ログオン**呼び出し中にダイアログボックスを表示する場合は、 _uluiparam_パラメーターを使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="7ece0-193">The  _ulUIParam_ parameter should be used if the provider presents dialog boxes during the **Logon** call.</span></span> <span data-ttu-id="7ece0-194">ただし、 _ulflags_に MDB_NO_DIALOG フラグが含まれている場合、ダイアログボックスは表示されません。</span><span class="sxs-lookup"><span data-stu-id="7ece0-194">However, dialog boxes should not be presented if  _ulFlags_ contains the MDB_NO_DIALOG flag.</span></span> <span data-ttu-id="7ece0-195">ユーザーインターフェイスを呼び出す必要があり、 _ulflags_では許可されていない場合、またはその他の理由でユーザーインターフェイスを表示できない場合は、プロバイダーは MAPI_E_LOGON_FAILED を返す必要があります。</span><span class="sxs-lookup"><span data-stu-id="7ece0-195">If a user interface needs to be called but  _ulFlags_ does not allow it, or if for some other reason a user interface cannot be displayed, the provider should return MAPI_E_LOGON_FAILED.</span></span> <span data-ttu-id="7ece0-196">**ログオン時**にダイアログボックスが表示され、ユーザーがログオンをキャンセルした場合、通常、ダイアログボックスの **[キャンセル**] ボタンをクリックすると、プロバイダーは MAPI_E_USER_CANCEL を返します。</span><span class="sxs-lookup"><span data-stu-id="7ece0-196">If **Logon** displays a dialog box and the user cancels the logon, typically by clicking the dialog box's **Cancel** button, the provider should return MAPI_E_USER_CANCEL.</span></span> 
  
<span data-ttu-id="7ece0-197">_lな tryid_パラメーターは、このメッセージストアが以前に作成した、ラップされていないストアエントリ識別子を指すことも、 **null**にすることもできます。</span><span class="sxs-lookup"><span data-stu-id="7ece0-197">The  _lpEntryID_ parameter can either be **null** or point to an unwrapped store entry identifier that this message store previously created.</span></span> <span data-ttu-id="7ece0-198">_lな tryid_がラップされていないエントリ識別子を指している場合、そのエントリ識別子は次のいずれかの場所から取得できます。</span><span class="sxs-lookup"><span data-stu-id="7ece0-198">If  _lpEntryID_ points to an unwrapped entry identifier, that entry identifier can come from one of several places:</span></span> 
  
- <span data-ttu-id="7ece0-199">これは、ストアプロバイダーが以前にラップしてプロファイルセクションに**PR_ENTRYID** ([PidTagEntryId](pidtagentryid-canonical-property.md)) プロパティとして書き込んだエントリ識別子にすることができます。</span><span class="sxs-lookup"><span data-stu-id="7ece0-199">It can be an entry identifier that the store provider previously wrapped and wrote to the profile section as a **PR_ENTRYID** ([PidTagEntryId](pidtagentryid-canonical-property.md)) property.</span></span>
    
- <span data-ttu-id="7ece0-200">これは、プロバイダーが以前にラップし、呼び出し元クライアントに**PR_STORE_ENTRYID** ([PidTagStoreEntryId](pidtagstoreentryid-canonical-property.md)) プロパティとして返されたエントリ識別子にすることができます。</span><span class="sxs-lookup"><span data-stu-id="7ece0-200">It can be an entry identifier that the provider previously wrapped and returned to a calling client as a **PR_STORE_ENTRYID** ([PidTagStoreEntryId](pidtagstoreentryid-canonical-property.md)) property.</span></span> 
    
- <span data-ttu-id="7ece0-201">これは、プロバイダーが以前にラップし、呼び出し元クライアントにメッセージストアオブジェクトの**PR_ENTRYID**プロパティとして返されたエントリ識別子にすることができます。</span><span class="sxs-lookup"><span data-stu-id="7ece0-201">It can be an entry identifier that the provider previously wrapped and returned to a calling client as the **PR_ENTRYID** property of a message store object.</span></span> 
    
<span data-ttu-id="7ece0-202">いずれの場合も、エントリ識別子が現在使用されているコンピューターとは別のコンピューターで作成されている可能性があります。</span><span class="sxs-lookup"><span data-stu-id="7ece0-202">In any of these cases, it is possible that the entry identifier was created on a different computer than the one currently being used.</span></span>
  
<span data-ttu-id="7ece0-203">_lな tryid_が**null**ではない場合、メッセージストアを識別して検索するために必要なすべての情報が含まれている必要があります。</span><span class="sxs-lookup"><span data-stu-id="7ece0-203">When  _lpEntryID_ is not **null**, it should contain all of the information needed to identify and locate the message store.</span></span> <span data-ttu-id="7ece0-204">この情報には、ネットワークボリューム名、電話番号、ユーザーアカウント名などを含めることができます。</span><span class="sxs-lookup"><span data-stu-id="7ece0-204">This information can include network volume names, phone numbers, user account names, and so on.</span></span> <span data-ttu-id="7ece0-205">エントリ識別子のデータを使用してストアへの接続を確立できない場合、ストアプロバイダーは、開くダイアログボックスを表示して、ユーザーが開くストアを選択できるようにする必要があります。</span><span class="sxs-lookup"><span data-stu-id="7ece0-205">If the connection to the store cannot be made by using the data in the entry identifier, the store provider should display a dialog box that enables the user to select the store to be opened.</span></span> <span data-ttu-id="7ece0-206">サーバーの名前が変更された場合、アカウント名が変更された場合、またはネットワークの一部が使用できない場合などに、ダイアログボックスが必要になることがあります。</span><span class="sxs-lookup"><span data-stu-id="7ece0-206">A dialog box might be required, for example, if a server has been renamed, an account name has changed, or portions of the network are not available.</span></span>
  
<span data-ttu-id="7ece0-207">_lな tryid_が**null**の場合は、使用するメッセージストアがまだ選択されていません。</span><span class="sxs-lookup"><span data-stu-id="7ece0-207">When  _lpEntryID_ is **null**, the message store to use has not yet been selected.</span></span> <span data-ttu-id="7ece0-208">その他の方法でストアを指定した場合、プロバイダーはダイアログボックスを表示せずにストアにアクセスできます。</span><span class="sxs-lookup"><span data-stu-id="7ece0-208">The provider can still access a store without displaying a dialog box if it supports further methods to specify the store.</span></span> <span data-ttu-id="7ece0-209">たとえば、プロバイダーは、初期化ファイルを確認したり、構成時にそのメッセージサービスのプロファイルセクションに配置された追加のプロパティを探したりすることができます。</span><span class="sxs-lookup"><span data-stu-id="7ece0-209">For example, the provider can check its initialization file, or it can look for additional properties that were placed in its or its message service's profile section at configuration.</span></span>
  
<span data-ttu-id="7ece0-210">必要なすべての情報がプロファイルに含まれていないことがプロバイダーによって検出された場合は、MAPI_E_UNCONFIGURED を返します。</span><span class="sxs-lookup"><span data-stu-id="7ece0-210">If a provider finds that all the required information is not in the profile, it should return MAPI_E_UNCONFIGURED.</span></span> <span data-ttu-id="7ece0-211">その後、MAPI は、プロバイダーのメッセージサービスのエントリポイント関数を呼び出して、ユーザーがストアを選択したり、必要に応じてアカウント名とパスワードを入力したりできるようにします。</span><span class="sxs-lookup"><span data-stu-id="7ece0-211">MAPI will then call the provider's message service entry point function to enable the user to select a store, or even to create one, and to enter an account name and password, as needed.</span></span> <span data-ttu-id="7ece0-212">MAPI は新しいストアに対して新しいプロファイルセクションを自動的に作成します。この新しいプロファイルセクションは、追加方法によって、一時的または永続的なものにすることができます。</span><span class="sxs-lookup"><span data-stu-id="7ece0-212">MAPI automatically creates a new profile section for a new store; this new profile section can be temporary or permanent, depending on how it has been added.</span></span> <span data-ttu-id="7ece0-213">ストアプロバイダーが**imapisupport:: modifyprofile**メソッドを呼び出すと、新しいプロファイルセクションは永続的になり、ストアは[imapisupport:: getmsgstorestable](imapisession-getmsgstorestable.md)メソッドによって返されるメッセージストアの一覧に追加されます。</span><span class="sxs-lookup"><span data-stu-id="7ece0-213">If the store provider calls the **IMAPISupport::ModifyProfile** method, the new profile section becomes permanent and the store is added to the list of message stores returned by the [IMAPISession::GetMsgStoresTable](imapisession-getmsgstorestable.md) method.</span></span> 
  
<span data-ttu-id="7ece0-214">_lpinterface_パラメーターは、新しく開かれた store オブジェクトに必要なインターフェイスの IID を指定します。</span><span class="sxs-lookup"><span data-stu-id="7ece0-214">The  _lpInterface_ parameter specifies the IID of the interface required for the newly opened store object.</span></span> <span data-ttu-id="7ece0-215">_lpinterface_で**null**を渡すことは、MAPI メッセージストアインターフェイス**IMsgStore**が必要であることを指定します。</span><span class="sxs-lookup"><span data-stu-id="7ece0-215">Passing **null** in  _lpInterface_ specifies that the MAPI message store interface, **IMsgStore**, is required.</span></span> <span data-ttu-id="7ece0-216">メッセージストアオブジェクト IID_IMsgStore を渡すと、 **IMsgStore**が必須であることも指定されます。</span><span class="sxs-lookup"><span data-stu-id="7ece0-216">Passing the message store object, IID_IMsgStore, also specifies that **IMsgStore** is required.</span></span> <span data-ttu-id="7ece0-217">IID_IUnknown が_lpinterface_で渡された場合、プロバイダーは、プロバイダーにとって最適な任意[](https://msdn.microsoft.com/library/ms680509%28v=VS.85%29.aspx)のインターフェイスを使用してストアを開く必要があります (通常は**IMsgStore**)。</span><span class="sxs-lookup"><span data-stu-id="7ece0-217">If IID_IUnknown is passed in  _lpInterface_, the provider should open the store by using whatever interface derived from [IUnknown](https://msdn.microsoft.com/library/ms680509%28v=VS.85%29.aspx) is best for the provider (again, this is typically **IMsgStore**).</span></span> <span data-ttu-id="7ece0-218">IID_IUnknown が渡されると、呼び出し側の実装は、ストアのオープン操作が成功した後に、 [IUnknown:: QueryInterface](https://msdn.microsoft.com/library/ms682521%28v=VS.85%29.aspx)メソッドを使用してインターフェイスを選択します。</span><span class="sxs-lookup"><span data-stu-id="7ece0-218">When IID_IUnknown is passed, the calling implementation uses the [IUnknown::QueryInterface](https://msdn.microsoft.com/library/ms682521%28v=VS.85%29.aspx) method to select an interface after the store open operation succeeds.</span></span> 
  
<span data-ttu-id="7ece0-219">**IMSProvider:: ログオン**呼び出しでは、ストアへのパスやストアにアクセスするための資格情報などの十分な情報が返されます。これにより、MAPI スプーラーは、ダイアログボックスを表示せずに、ストアプロバイダーが実行するのと同じストアにログオンすることができます。</span><span class="sxs-lookup"><span data-stu-id="7ece0-219">The **IMSProvider::Logon** call should return sufficient information, such as a path to the store and credentials for accessing the store, to allow the MAPI spooler to log on to the same store that the store provider does without presenting a dialog box.</span></span> <span data-ttu-id="7ece0-220">_lpcbSpoolSecurity_パラメーターと_lppbSpoolSecurity_パラメーターは、この情報を返すために使用されます。</span><span class="sxs-lookup"><span data-stu-id="7ece0-220">The  _lpcbSpoolSecurity_ and  _lppbSpoolSecurity_ parameters are used to return this information.</span></span> <span data-ttu-id="7ece0-221">プロバイダーは、 [msproviderinit](msproviderinit.md)関数の_lpfAllocateBuffer_パラメーターでバッファーへのポインターを渡すことにより、このデータのメモリを割り当てます。プロバイダーは、このバッファーのサイズを_lpcbSpoolSecurity_に配置します。</span><span class="sxs-lookup"><span data-stu-id="7ece0-221">The provider allocates the memory for this data by passing a pointer to a buffer in the [MSProviderInit](msproviderinit.md) function's  _lpfAllocateBuffer_ parameter; the provider places the size of this buffer in  _lpcbSpoolSecurity_.</span></span> 
  
<span data-ttu-id="7ece0-222">MAPI は、必要に応じてこのバッファーを解放します。</span><span class="sxs-lookup"><span data-stu-id="7ece0-222">MAPI frees this buffer when appropriate.</span></span> <span data-ttu-id="7ece0-223">ストアへの MAPI スプーラーのログオンを、プロファイルセクション単独の情報から実行できる場合、プロバイダーは_lppbSpoolSecurity_で null を返すことができ、 _lpcbSpoolSecurity_では情報のサイズが0になります。</span><span class="sxs-lookup"><span data-stu-id="7ece0-223">If the MAPI spooler's logon to the store can be accomplished from the information in the profile section alone, the provider can return null in  _lppbSpoolSecurity_ and 0 for the information's size in  _lpcbSpoolSecurity_.</span></span> <span data-ttu-id="7ece0-224">MAPI スプーラーログオンは、ストアログオンとは別のプロセスの一部として実行されます。渡された情報を格納しているバッファーはプロセス間でコピーされるため、ストアプロバイダープロセスの MAPI スプーラープロセスと同じ場所にメモリ内に存在しない可能性があります。</span><span class="sxs-lookup"><span data-stu-id="7ece0-224">The MAPI spooler logon occurs as part of a different process than the store logon; because the buffer that contains the passed information gets copied between processes, it might not be in memory at the same location for the MAPI spooler process as for the store provider process.</span></span> <span data-ttu-id="7ece0-225">そのため、プロバイダーはこのバッファーにアドレスを入れてはなりません。</span><span class="sxs-lookup"><span data-stu-id="7ece0-225">Therefore, a provider shouldn't put addresses into this buffer.</span></span> <span data-ttu-id="7ece0-226">MAPI スプーラーログオンの詳細については、 [IMSProvider:: SpoolerLogon](imsprovider-spoolerlogon.md)メソッドを参照してください。</span><span class="sxs-lookup"><span data-stu-id="7ece0-226">For more information about MAPI spooler logon, see the [IMSProvider::SpoolerLogon](imsprovider-spoolerlogon.md) method.</span></span> 
  
<span data-ttu-id="7ece0-227">ほとんどのストアプロバイダーでは、ユーザーの資格情報とオプションを保存および取得するために_lpMAPISup_パラメーターで渡される support オブジェクトの[imapisession:: openprofilesection](imapisession-openprofilesection.md)メソッドを使用します。</span><span class="sxs-lookup"><span data-stu-id="7ece0-227">Most store providers use the [IMAPISession::OpenProfileSection](imapisession-openprofilesection.md) method of the support object passed in the  _lpMAPISup_ parameter for saving and retrieving user credentials and options.</span></span> <span data-ttu-id="7ece0-228">\*\*\*\* [openprofile] セクションでは、ストアプロバイダーが追加の任意の情報をプロファイルセクションに保存して、特定のリソースに関連付けることができます。</span><span class="sxs-lookup"><span data-stu-id="7ece0-228">**OpenProfileSection** enables a store provider to save additional arbitrary information in a profile section and associate it with a particular resource.</span></span> <span data-ttu-id="7ece0-229">たとえば、ストアプロバイダーは、リソースに関連付けられたユーザーアカウント名とパスワード、およびそのリソースにアクセスするために必要なパスまたはその他の情報を保存できます。</span><span class="sxs-lookup"><span data-stu-id="7ece0-229">For example, a store provider can save the user account name and password associated with a resource and any paths or other information needed to access that resource.</span></span> 
  
<span data-ttu-id="7ece0-230">プロパティ識別子 0x6600 ~ 0x6600 を持つプロパティは、独自のプロファイルセクションにプライベートデータを格納するために独自に使用できる、セキュリティで保護されたプロパティとして提供されます。</span><span class="sxs-lookup"><span data-stu-id="7ece0-230">Properties with property identifiers 0x6600 through 0x67FF are secure properties available to the provider for its own use to store private data in profile sections.</span></span> <span data-ttu-id="7ece0-231">プロファイルセクションオブジェクトでのプロパティの使用の詳細については、 [IProfSect: imapiprop](iprofsectimapiprop.md)メソッドを参照してください。</span><span class="sxs-lookup"><span data-stu-id="7ece0-231">For more information about the uses of properties in profile section objects, see the [IProfSect : IMAPIProp](iprofsectimapiprop.md) method.</span></span> 
  
<span data-ttu-id="7ece0-232">識別子 0x6600 ~ 0x6600 を持つプロパティのプライベートデータに加えて、ストアプロバイダーは、そのプロファイルセクションに**PR_DISPLAY_NAME** ([PidTagDisplayName](pidtagdisplayname-canonical-property.md)) プロパティに関する情報を提供する必要があります。</span><span class="sxs-lookup"><span data-stu-id="7ece0-232">In addition to any private data in properties with identifiers 0x6600 through 0x67FF, the store provider should provide information for the **PR_DISPLAY_NAME** ([PidTagDisplayName](pidtagdisplayname-canonical-property.md)) property in its profile section.</span></span> <span data-ttu-id="7ece0-233">**PR_DISPLAY_NAME**には、プロバイダー自体の表示名 ("Microsoft Personal Information Store" など) がユーザーに表示されるので、ユーザーがアクセス権を持っている可能性がある場合にこのメッセージストアを識別できるようにする必要があります。宛先。</span><span class="sxs-lookup"><span data-stu-id="7ece0-233">It should put in **PR_DISPLAY_NAME** the display name of the provider itself — an identifying string (for example, "Microsoft Personal Information Store") that is displayed to users so they can distinguish this message store from others they might have access to.</span></span> <span data-ttu-id="7ece0-234">**PR_DISPLAY_NAME**には、通常、サーバー名、ユーザーアカウント名、またはパスが含まれています。</span><span class="sxs-lookup"><span data-stu-id="7ece0-234">**PR_DISPLAY_NAME** commonly contains a server name, user account name, or path.</span></span> 
  
<span data-ttu-id="7ece0-235">一部のプロファイルセクションのプロパティは、メッセージストアテーブルに表示されます。他のユーザーは、セットアップ時、インストール時、MAPI サブシステムの構成中に表示されます。</span><span class="sxs-lookup"><span data-stu-id="7ece0-235">Some profile section properties are visible in the message store table; others are visible during setup, installation, and configuration of the MAPI subsystem.</span></span> <span data-ttu-id="7ece0-236">通常、プロバイダーは、保存された資格情報や個人情報が含まれていない新しいプロファイルセクション、およびプロパティ情報が変更されたことを検出したときに、これらの表示プロパティに関する情報を提供します。</span><span class="sxs-lookup"><span data-stu-id="7ece0-236">The provider typically provides information for these visible properties both for a new profile section, which does not yet include saved credentials or private information, and when it finds that property information has changed.</span></span> <span data-ttu-id="7ece0-237">プロファイルセクションの詳細については、「 [imapisupport:: openプロファイル](imapisupport-openprofilesection.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="7ece0-237">For more information about profile sections, see [IMAPISupport::OpenProfileSection](imapisupport-openprofilesection.md).</span></span>
  
<span data-ttu-id="7ece0-238">ユーザーのログオンが正常に完了した後、MAPI に戻る前に、ストアプロバイダーはリソースの状態行のプロパティの配列を作成し、 [imapisupport:: modifystatusrow](imapisupport-modifystatusrow.md)メソッドを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="7ece0-238">After successfully logging on a user, and before returning to MAPI, the store provider should create the array of properties for the status row for the resource and call the [IMAPISupport::ModifyStatusRow](imapisupport-modifystatusrow.md) method.</span></span> 
  
 <span data-ttu-id="7ece0-239">現在の MAPI セッションで既に開いているメッセージストアを開く**ログオン**呼び出しは、前に説明した処理のほとんどをスキップします。</span><span class="sxs-lookup"><span data-stu-id="7ece0-239">**Logon** calls that open message stores that are already open for the current MAPI session skip much of the processing previously described.</span></span> <span data-ttu-id="7ece0-240">これらの呼び出しでは、ステータス行の作成、メッセージストアのログオンオブジェクトの取得、mapi サポートオブジェクトの**AddRef**の呼び出し、mapi スプーラーログオンのためのデータの取得は行われません。</span><span class="sxs-lookup"><span data-stu-id="7ece0-240">These calls do not create status rows, return message store logon objects, call **AddRef** for the MAPI support object, or return data for MAPI spooler logon.</span></span> <span data-ttu-id="7ece0-241">これらの呼び出しは S_OK を返し、要求されたインターフェイスを持つメッセージストアオブジェクトを返します。</span><span class="sxs-lookup"><span data-stu-id="7ece0-241">These calls do return S_OK and return a message store object with the requested interface.</span></span> 
  
<span data-ttu-id="7ece0-242">このような呼び出しを検出するには、プロバイダーが、このプロバイダーオブジェクトに対して既に開いているストアのメッセージストアプロバイダーオブジェクトのリストを保持する必要があります。</span><span class="sxs-lookup"><span data-stu-id="7ece0-242">To detect such calls, the provider should maintain a list in the message store provider object of stores already open for this provider object.</span></span> <span data-ttu-id="7ece0-243">**ログイン**呼び出しを処理するときに、プロバイダーは、開いているストアの一覧をスキャンし、ログオン先ストアが既に開いているかどうかを判断する必要があります。</span><span class="sxs-lookup"><span data-stu-id="7ece0-243">When processing a **Logon** call, the provider should scan this list of open stores and determine whether the store to be logged on to is already open.</span></span> <span data-ttu-id="7ece0-244">その場合は、ユーザーの資格情報をチェックする必要がなく、可能であればダイアログボックスの表示を回避する必要があります。</span><span class="sxs-lookup"><span data-stu-id="7ece0-244">If it is, user credentials do not need to be checked and the display of a dialog box should be avoided, if possible.</span></span> <span data-ttu-id="7ece0-245">ダイアログボックスを表示する必要がある場合、プロバイダーは返された情報を確認して、ストアが2回目に開かれたかどうかを確認する必要があります。</span><span class="sxs-lookup"><span data-stu-id="7ece0-245">If dialog boxes must be displayed, the provider should check returned information to see whether a store has been opened a second time.</span></span> <span data-ttu-id="7ece0-246">また、プロバイダーは、**ログオン**呼び出し処理の開始時に_lな tryid_を使用して、重複している開口をチェックする必要があります。</span><span class="sxs-lookup"><span data-stu-id="7ece0-246">In addition, the provider should check for duplicate openings by using  _lpEntryID_ at the beginning of **Logon** call processing.</span></span> 
  
<span data-ttu-id="7ece0-247">開いているストアにアクセスする**ログオン**呼び出しの標準処理は次のとおりです。</span><span class="sxs-lookup"><span data-stu-id="7ece0-247">Standard processing for a **Logon** call that accesses an open store is as follows:</span></span> 
  
1. <span data-ttu-id="7ece0-248">要求された新しいインターフェイスが既存のストアのインターフェイスと同じである場合、ストアプロバイダーは既存のストアオブジェクトに対して**AddRef**を呼び出します。</span><span class="sxs-lookup"><span data-stu-id="7ece0-248">The store provider calls **AddRef** for the existing store object if the new interface being requested is the same as the interface for the existing store.</span></span> <span data-ttu-id="7ece0-249">それ以外の場合は、 **QueryInterface**を呼び出して新しいインターフェイスを取得します。</span><span class="sxs-lookup"><span data-stu-id="7ece0-249">Otherwise, it calls **QueryInterface** to get the new interface.</span></span> <span data-ttu-id="7ece0-250">ストアが新しいインターフェイスをサポートしていない場合、プロバイダーはエラー値 MAPI_E_INTERFACE_NOT_SUPPORTED を返します。</span><span class="sxs-lookup"><span data-stu-id="7ece0-250">If the store does not support the new interface, the provider should return the error value MAPI_E_INTERFACE_NOT_SUPPORTED.</span></span> 
    
2. <span data-ttu-id="7ece0-251">プロバイダーは、 _lppmdb_の既存の store オブジェクトの必要なインターフェイスへのポインターを返します。</span><span class="sxs-lookup"><span data-stu-id="7ece0-251">The provider returns a pointer to the required interface of the existing store object in  _lppMDB_.</span></span>
    
3. <span data-ttu-id="7ece0-252">プロバイダーは、 _lppmslogon_で**null**を返します。</span><span class="sxs-lookup"><span data-stu-id="7ece0-252">The provider returns **null** in  _lppMSLogon_.</span></span>
    
4. <span data-ttu-id="7ece0-253">プロバイダーは、呼び出しで渡された support オブジェクトのプロファイルを開かないようにする必要があります。</span><span class="sxs-lookup"><span data-stu-id="7ece0-253">The provider should not open the profile for the support object passed in the call.</span></span> <span data-ttu-id="7ece0-254">また、プロバイダーの一意の識別子を登録したり、ステータス行を登録したり、MAPI スプーラーログオンデータを返したりすることはできません。</span><span class="sxs-lookup"><span data-stu-id="7ece0-254">In addition, it should not register a provider unique identifier, register a status row, or return MAPI spooler logon data.</span></span>
    
5. <span data-ttu-id="7ece0-255">プロバイダーは、オブジェクトへのポインターを必要としないため、サポートオブジェクトに対して**AddRef**を呼び出すことはできません。</span><span class="sxs-lookup"><span data-stu-id="7ece0-255">The provider should not call **AddRef** for the support object, because it does not require a pointer to the object.</span></span> 
    
<span data-ttu-id="7ece0-256">可能であれば、プロバイダーは**ログオン**呼び出しに対して適切なエラーと警告文字列を返す必要があります。これにより、ユーザーが動作しなかった理由を判断する際に、ユーザーの負荷が大幅に軽減されます。</span><span class="sxs-lookup"><span data-stu-id="7ece0-256">Whenever possible, providers should return appropriate error and warning strings for **Logon** calls, because doing so greatly eases the burden of users in determining why something did not work.</span></span> <span data-ttu-id="7ece0-257">これらの文字列を返すには、プロバイダーは**MAPIERROR**構造体のメンバーを設定します。</span><span class="sxs-lookup"><span data-stu-id="7ece0-257">To return these strings, a provider sets the members in the **MAPIERROR** structure.</span></span> <span data-ttu-id="7ece0-258">MAPI は、プロバイダーによって返された場合、 **MAPIERROR**構造を検索、使用、および解放します。</span><span class="sxs-lookup"><span data-stu-id="7ece0-258">MAPI looks for, uses, and releases the **MAPIERROR** structure if it is returned by a provider.</span></span> 
  
<span data-ttu-id="7ece0-259">この**MAPIERROR**構造体のメモリは、 **msproviderinit**呼び出しの_lpfAllocateBuffer_で渡されるバッファーを使用して割り当てる必要があります。</span><span class="sxs-lookup"><span data-stu-id="7ece0-259">Memory for this **MAPIERROR** structure should be allocated by using the buffer passed in  _lpfAllocateBuffer_ on the **MSProviderInit** call.</span></span> <span data-ttu-id="7ece0-260">MAPI_UNICODE が**Logon** _ulflags_に設定されている場合、返される構造体に含まれるエラー文字列は、Unicode 形式である必要があります。それ以外の場合は、ANSI 文字セットである必要があります。</span><span class="sxs-lookup"><span data-stu-id="7ece0-260">Any error strings contained in the returned structure should be in Unicode format if MAPI_UNICODE is set in the **Logon** _ulFlags;_ otherwise, they should be in the ANSI character set.</span></span> 
  
<span data-ttu-id="7ece0-261">**ログオン**から返されるエラー値のほとんどに対して、MAPI は失敗したプロバイダーが属しているメッセージサービスを無効にします。</span><span class="sxs-lookup"><span data-stu-id="7ece0-261">For most error values returned from **Logon**, MAPI disables the message services to which the failing provider belongs.</span></span> <span data-ttu-id="7ece0-262">mapi は、mapi セッションが終了するまで、これらのサービスに属しているプロバイダーを呼び出すことはありません。</span><span class="sxs-lookup"><span data-stu-id="7ece0-262">MAPI will not call any providers that belong to those services for the life of the MAPI session.</span></span> <span data-ttu-id="7ece0-263">これに対して、**ログオン**時に MAPI_E_FAILONEPROVIDER エラー値が返されても、MAPI はプロバイダーが属しているメッセージサービスを無効にしません。</span><span class="sxs-lookup"><span data-stu-id="7ece0-263">In contrast, when **Logon** returns the MAPI_E_FAILONEPROVIDER error value from its logon, MAPI does not disable the message service to which the provider belongs.</span></span> <span data-ttu-id="7ece0-264">セッションが終了するまでサービス全体を無効にすることを保証しないエラーが発生した場合、**ログオン**は MAPI_E_FAILONEPROVIDER を返します。</span><span class="sxs-lookup"><span data-stu-id="7ece0-264">**Logon** should return MAPI_E_FAILONEPROVIDER if it encounters an error that does not warrant disabling the entire service for the life of the session.</span></span> <span data-ttu-id="7ece0-265">たとえば、プロバイダーがユーザーインターフェイスの表示を許可せず、必要なパスワードを使用できない場合に、このエラーが返されることがあります。</span><span class="sxs-lookup"><span data-stu-id="7ece0-265">For example, a provider might return this error when it does not allow the display of a user interface and a required password is unavailable.</span></span> 
  
<span data-ttu-id="7ece0-266">プロバイダーがログオンから MAPI_E_UNCONFIGURED を返した場合、MAPI はプロバイダーのメッセージサービスのエントリ関数を呼び出して、ログオンを再試行します。</span><span class="sxs-lookup"><span data-stu-id="7ece0-266">If a provider returns MAPI_E_UNCONFIGURED from its logon, MAPI will call the provider's message service entry function and then retry the logon.</span></span> <span data-ttu-id="7ece0-267">MAPI は、MSG_SERVICE_CONFIGURE が自身を構成する機会を提供するために、コンテキストとしてを渡します。</span><span class="sxs-lookup"><span data-stu-id="7ece0-267">MAPI passes MSG_SERVICE_CONFIGURE as the context to give the service a chance to configure itself.</span></span> <span data-ttu-id="7ece0-268">クライアントがログオン時にユーザーインターフェイスを許可することを選択した場合、サービスはその構成プロパティシートを表示して、ユーザーが構成情報を入力できるようにすることができます。</span><span class="sxs-lookup"><span data-stu-id="7ece0-268">If the client has chosen to allow a user interface on the logon, the service can present its configuration property sheet so the user can enter configuration information.</span></span>
  
## <a name="see-also"></a><span data-ttu-id="7ece0-269">関連項目</span><span class="sxs-lookup"><span data-stu-id="7ece0-269">See also</span></span>



[<span data-ttu-id="7ece0-270">IMAPISession::GetMsgStoresTable</span><span class="sxs-lookup"><span data-stu-id="7ece0-270">IMAPISession::GetMsgStoresTable</span></span>](imapisession-getmsgstorestable.md)
  
[<span data-ttu-id="7ece0-271">IMAPISession::OpenMsgStore</span><span class="sxs-lookup"><span data-stu-id="7ece0-271">IMAPISession::OpenMsgStore</span></span>](imapisession-openmsgstore.md)
  
[<span data-ttu-id="7ece0-272">IMAPISession::OpenProfileSection</span><span class="sxs-lookup"><span data-stu-id="7ece0-272">IMAPISession::OpenProfileSection</span></span>](imapisession-openprofilesection.md)
  
[<span data-ttu-id="7ece0-273">IMAPISupport::ModifyProfile</span><span class="sxs-lookup"><span data-stu-id="7ece0-273">IMAPISupport::ModifyProfile</span></span>](imapisupport-modifyprofile.md)
  
[<span data-ttu-id="7ece0-274">IMAPISupport::ModifyStatusRow</span><span class="sxs-lookup"><span data-stu-id="7ece0-274">IMAPISupport::ModifyStatusRow</span></span>](imapisupport-modifystatusrow.md)
  
[<span data-ttu-id="7ece0-275">IMsgStore: IMAPIProp</span><span class="sxs-lookup"><span data-stu-id="7ece0-275">IMsgStore : IMAPIProp</span></span>](imsgstoreimapiprop.md)
  
[<span data-ttu-id="7ece0-276">IMSProvider::SpoolerLogon</span><span class="sxs-lookup"><span data-stu-id="7ece0-276">IMSProvider::SpoolerLogon</span></span>](imsprovider-spoolerlogon.md)
  
[<span data-ttu-id="7ece0-277">IProfSect : IMAPIProp</span><span class="sxs-lookup"><span data-stu-id="7ece0-277">IProfSect : IMAPIProp</span></span>](iprofsectimapiprop.md)
  
[<span data-ttu-id="7ece0-278">MAPIERROR</span><span class="sxs-lookup"><span data-stu-id="7ece0-278">MAPIERROR</span></span>](mapierror.md)
  
[<span data-ttu-id="7ece0-279">MSProviderInit</span><span class="sxs-lookup"><span data-stu-id="7ece0-279">MSProviderInit</span></span>](msproviderinit.md)
  
[<span data-ttu-id="7ece0-280">IMSProvider : IUnknown</span><span class="sxs-lookup"><span data-stu-id="7ece0-280">IMSProvider : IUnknown</span></span>](imsprovideriunknown.md)

