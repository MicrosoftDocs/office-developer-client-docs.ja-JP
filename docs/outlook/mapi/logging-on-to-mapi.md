---
title: MAPI へのログオン
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 05bafe43-a78a-4659-92f0-0b4fe444c64f
description: '最終更新日: 2011 年 7 月 23 日'
ms.openlocfilehash: cce43301ac73a5646e263b2ab92700e57804637d
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/28/2019
ms.locfileid: "33419710"
---
# <a name="logging-on-to-mapi"></a>MAPI へのログオン
 
**適用対象**: Outlook 2013 | Outlook 2016 
  
クライアントアプリケーションは、 **MAPILogonEx**関数を呼び出して MAPI サブシステムにログオンします。 詳細については、「 [MAPILogonEx](mapilogonex.md)」を参照してください。 **MAPILogonEx**は、プロファイルの選択と、プロファイル内の各サービスプロバイダーの構成を検証します。 構成が完了すると、MAPI はメッセージストアプロバイダーを開始する前にアドレス帳プロバイダーを開始します。 サービスが最初に必要になると、トランスポートプロバイダーが開始されます。 
  
## <a name="choose-a-profile"></a>プロファイルを選択する
  
- **MAPILogonEx**への_lpszprofilename_パラメーターのプロファイルの名前を表す文字列を渡します。または、...
    
- ユーザーが_lpszprofilename_パラメーターで NULL を渡し、MAPI_LOGON_UI フラグを設定することにより、プロファイルを指定できるようにします。 

- _lpszprofilename_パラメーターに NULL を渡し、MAPI_USE_DEFAULT フラグを設定することによって、既定のプロファイルを選択します。 
    
既定のプロファイル以外の特定のプロファイルが必要な場合は、その名前を独自の構成データベースに保存するか、特定の名前付け規則を使用する必要があります。 MAPI は、プロファイルテーブルの名前と既定のフラグ以外のプロファイル属性を公開しません。また、既定のプロファイルフラグは、メッセージングクライアントおよび関連する IPM アプリケーション用に予約されています。
  
部分的なプロファイルまたはプロバイダーの構成情報を**MAPILogonEx**に提供するクライアントは、ダイアログボックスを表示できるようにすることで、追加のデータをユーザーに確認する必要があります。 情報が不足していて、 **MAPILogonEx**がユーザーに入力を求められない場合、ログオンは失敗します。 ユーザー入力を必要としないクライアントでは、ダイアログボックスの表示が抑制されます。 
  
**MAPILogonEx**がユーザーインターフェイスを有効にするために使用するフラグは相互に排他的です。設定できるのは1つだけです。 これらのフラグを設定しないままにすると、ユーザーインターフェイスの表示が抑制され、必要な情報が見つからない場合は**MAPILogonEx**が失敗します。 つまり、ユーザーインターフェイスを無効にし、 _lpszprofilename_パラメーターに NULL を渡すと、MAPI_USE_DEFAULT フラグを設定しないと、 **MAPILogonEx**はプロファイル名を取得できないため、失敗します。 
  
**MAPILogonEx**が確立するセッションは、個別のメッセージングセッション、共有されたメッセージングセッション、または非メッセージングセッションの場合があります。 個々のメッセージングセッションは、クライアントと MAPI サブシステム間のプライベート接続であり、 **MAPILogonEx**への呼び出しで MAPI_NEW_SESSION フラグを設定することによって確立できます。
  
共有メッセージングセッションは、複数のメッセージングクライアントが使用できる接続です。 通常、共有セッションはクライアントが同じプロファイルを使用するように設定されます。 共有セッションとして新しいセッションを確立するには、MAPI_ALLOW_OTHERS フラグを設定します。 
  
## <a name="use-an-existing-shared-session"></a>既存の共有セッションを使用する
  
- MAPI_NEW_SESSION フラグは設定しません。
    
- MAPI_ALLOW_OTHERS フラグは設定しません。
    
- _lpszprofilename_パラメーターに NULL を渡します。 
    
- _lpszpassword_パラメーターに NULL を渡します。 
    
非メッセージングセッションでは、クライアントは MAPI サブシステムにアクセスできますが、メッセージの送受信は許可されません。 メッセージング以外のセッションを確立する必要があるクライアントの例として、構成または管理アプリケーションが挙げられます。 非メッセージングセッションを要求するには、MAPI_NO_MAIL フラグを設定します。 このフラグを設定すると、MAPI スプーラーに通知されることなくクライアントがログに記録されます。 このフラグを使用して MAPI にログオンするクライアントは、閲覧状態レポートを受信することを期待できません。
  
MAPI_NO_MAIL フラグは、次のように設定する必要があります。
  
- クライアントがセッション中にメッセージを送信または受信しない場合。
    
- クライアントがプロファイルの内容を完全に制御しており、Microsoft Exchange プロバイダーなどの密結合メッセージストアとトランスポートプロバイダーを使用してメッセージが送受信された場合。
    
メッセージングクライアントは、非メッセージングクライアントとのセッションを共有できます。 共有セッションの1つのメンバーの特性は、他のメンバーの特性の影響を受けません。 つまり、MAPI_NO_MAIL および MAPI_ALLOW_OTHERS フラグを設定してログオンした場合、セッションにログオンしたメッセージングクライアントはクライアントの操作に影響を与えず、その逆も同様です。 メッセージングクライアントは依然としてメッセージの送受信を行うことができますが、クライアントは受信できません。
  
**MAPILogonEx**では、設定できる他のいくつかのフラグが定義されています。 
  
- MAPI_FORCE_DOWNLOAD は、 **MAPILogonEx**が戻る前に、受信メッセージをダウンロードする必要があることを示します。 このフラグを設定しないと、後でバックグラウンドでメッセージがダウンロードされます。 
    
- MAPI_SERVICE_UI_ALWAYS は、プロファイル内のすべてのメッセージサービスに構成ダイアログボックスを表示するよう要求します。
    
- MAPI_NT_SERVICE は、クライアントが Windows サービスとして実装されていることを示します。 クライアントがサービスの場合は、このフラグを設定する必要があります。
    
正常にログオンするたびに、 **MAPILogonEx**は MAPI セッションへのポインターを返します。 このポインターを使用して、 **imapisession**インターフェイスのメソッドを呼び出すことができます。 詳細については、「 [imapisession: IUnknown](imapisessioniunknown.md)」を参照してください。 セッションポインターは、セッションの種類に関係なく、それらを受信するクライアントに固有のものであり、タスク間では有効ではありません。
  

