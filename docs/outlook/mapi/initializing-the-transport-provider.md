---
title: トランスポート プロバイダーの初期化
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 977c18ce-ece5-4ad1-ac97-5a680846ab83
description: '最終更新日: 2011 年 7 月 23 日'
ms.openlocfilehash: 474a8085ca8b82d11efd68c9fd4d8719fe239207
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/28/2019
ms.locfileid: "33416602"
---
# <a name="initializing-the-transport-provider"></a><span data-ttu-id="6d1da-103">トランスポート プロバイダーの初期化</span><span class="sxs-lookup"><span data-stu-id="6d1da-103">Initializing the Transport Provider</span></span>

  
  
<span data-ttu-id="6d1da-104">**適用対象**: Outlook 2013 | Outlook 2016</span><span class="sxs-lookup"><span data-stu-id="6d1da-104">**Applies to**: Outlook 2013 | Outlook 2016</span></span> 
  
<span data-ttu-id="6d1da-105">トランスポート スプーラー インターフェイスは、MAPI スプーラーがトランスポート プロバイダーに対して行う呼び出しを定義します。</span><span class="sxs-lookup"><span data-stu-id="6d1da-105">The transport-spooler interface defines calls the MAPI spooler makes to a transport provider.</span></span> <span data-ttu-id="6d1da-106">トランスポート プロバイダーは、これらのルーチンをダイナミック リンク ライブラリ (DLL) に実装します。</span><span class="sxs-lookup"><span data-stu-id="6d1da-106">Transport providers implement these routines in a dynamic-link library (DLL).</span></span> <span data-ttu-id="6d1da-107">MAPI スプーラーで使用される DLL への最初の直接エントリ ポイントは、トランスポート プロバイダーの初期化関数 [XPProviderInit である必要があります](xpproviderinit.md)。</span><span class="sxs-lookup"><span data-stu-id="6d1da-107">The first direct entry point into the DLL used by the MAPI spooler must be the transport provider initialization function [XPProviderInit](xpproviderinit.md).</span></span>
  
<span data-ttu-id="6d1da-108">MAPI は、 **ルーチン GetProcAddress** を使用して、サービス プロバイダーの初期化ルーチンのアドレスを取得し、そのルーチンを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="6d1da-108">MAPI uses the routine **GetProcAddress** to get the address of the service provider's initialization routine and then calls that routine.</span></span> <span data-ttu-id="6d1da-109">初期化ルーチンの名前は、 **トランスポート プロバイダーの XPProviderInit** です。</span><span class="sxs-lookup"><span data-stu-id="6d1da-109">The name of the initialization routine is **XPProviderInit** for transport providers.</span></span> <span data-ttu-id="6d1da-110">他の種類の MAPI サービス プロバイダーでは異なって、1 つの DLL にサービス プロバイダーの種類の任意の組み合わせを含め、特定の種類のサービス プロバイダーは 1 つしか含めないためです。</span><span class="sxs-lookup"><span data-stu-id="6d1da-110">It is different for other types of MAPI service providers so that one DLL can contain any combination of service provider types, but only one service provider of a particular type.</span></span> <span data-ttu-id="6d1da-111">ただし、特定の種類の 1 つのサービス プロバイダーは、その種類の複数のサービスを実装できます。</span><span class="sxs-lookup"><span data-stu-id="6d1da-111">However, one service provider of a given type can implement multiple services of its type.</span></span> <span data-ttu-id="6d1da-112">たとえば、1 つのトランスポート プロバイダーは、複数のメッセージ サービスにメッセージ トランスポート機能を実装できます。</span><span class="sxs-lookup"><span data-stu-id="6d1da-112">For example, one transport provider can implement message transport functionality to multiple message services.</span></span> 
  
<span data-ttu-id="6d1da-113">mapispi.h ヘッダー ファイルには、トランスポート プロバイダー初期化関数の関数プロトタイプの型定義と、その定義済みのプロシージャ名があります。</span><span class="sxs-lookup"><span data-stu-id="6d1da-113">The mapispi.h header file has a type definition for the function prototype of the transport provider initialization function, and a predefined procedure name for it.</span></span> <span data-ttu-id="6d1da-114">**GetProcAddress** で使用されるのと同じ名前で C ファイルと C++ ファイルの初期化ルーチンに名前を付け、DLL.DEF ファイルで簡単なエクスポート宣言を使用すると、初期化ルーチンのパラメーターの型チェックが自動的に取得されます。</span><span class="sxs-lookup"><span data-stu-id="6d1da-114">By naming the initialization routines in your C and C++ files with the same names used by **GetProcAddress** and by using a straightforward export declaration in your DLL.DEF file, you automatically get type checking of the parameters on your initialization routine.</span></span> <span data-ttu-id="6d1da-115">例については、サンプル トランスポート プロバイダーのソース コードを参照してください。</span><span class="sxs-lookup"><span data-stu-id="6d1da-115">See the sample transport provider source code for examples.</span></span> <span data-ttu-id="6d1da-116">詳細については、「トランスポート プロバイダーの [サンプル」を参照してください](transport-provider-sample.md)。</span><span class="sxs-lookup"><span data-stu-id="6d1da-116">For more information, see [Transport Provider Sample](transport-provider-sample.md).</span></span>
  
<span data-ttu-id="6d1da-117">サービス プロバイダーの初期化呼び出しが成功したが、MAPI が処理するには小さすぎるサービス プロバイダー インターフェイスバージョン番号を返す場合、MAPI は直ちにサービス プロバイダー オブジェクトの **Release** メソッドを呼び出し、初期化呼び出しが MAPI_E_VERSION で失敗した場合と同様に続行します。</span><span class="sxs-lookup"><span data-stu-id="6d1da-117">If a service provider's initialization call succeeds but returns a service provider interface version number too small for MAPI to handle, MAPI immediately calls the **Release** method of the service provider object and proceeds as if the initialization call had failed with MAPI_E_VERSION.</span></span> <span data-ttu-id="6d1da-118">この方法で、MAPI とサービス プロバイダーは、処理できるサービス プロバイダー インターフェイスバージョン番号の範囲を共同で定義し、一致しない場合、サービス プロバイダーの読み込みが失敗し、MAPI_E_VERSION戻り値になります。</span><span class="sxs-lookup"><span data-stu-id="6d1da-118">This way MAPI and the service provider jointly define the range of service provider interface version numbers they can handle, and if nothing matches then service provider loading fails with a MAPI_E_VERSION return value.</span></span> 
  
<span data-ttu-id="6d1da-119">サービス プロバイダー リソースへのアクセスを取得する MAPI スプーラーの最後の手順は、トランスポート プロバイダーにログオンします。</span><span class="sxs-lookup"><span data-stu-id="6d1da-119">The last step for the MAPI spooler in getting access to service provider resources is to log on to the transport provider.</span></span> <span data-ttu-id="6d1da-120">MAPI スプーラーは、IXPProvider: **XPProviderInit** から返される IUnknown オブジェクトの [IXPProvider::TransportLogon](ixpprovider-transportlogon.md)メソッドを呼び出します。 [](ixpprovideriunknown.md)</span><span class="sxs-lookup"><span data-stu-id="6d1da-120">The MAPI spooler calls the [IXPProvider::TransportLogon](ixpprovider-transportlogon.md) method of the [IXPProvider : IUnknown](ixpprovideriunknown.md) object returned from **XPProviderInit**.</span></span> <span data-ttu-id="6d1da-121">これは、資格情報を使用する場合にチェックを入れ、ダイアログ ボックスを許可できる呼び出しです。</span><span class="sxs-lookup"><span data-stu-id="6d1da-121">This is the call where credentials, if used, are checked and dialog boxes can be allowed.</span></span>
  
<span data-ttu-id="6d1da-122">プロセスが同じトランスポート プロバイダーと MAPI セッションで 2 つ目のトランスポート セッションを開く場合、トランスポート プロバイダー DLL は 2 つ目のプロバイダー オブジェクトを作成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="6d1da-122">If a process opens a second transport session on the same transport provider and MAPI session, the transport provider DLL should not create a second provider object.</span></span> <span data-ttu-id="6d1da-123">1 つ目のプロバイダー オブジェクトを使用して、2 番目のトランスポート セッションにログオンする必要があります。</span><span class="sxs-lookup"><span data-stu-id="6d1da-123">The first provider object should be used to log on to the second transport session.</span></span> <span data-ttu-id="6d1da-124">トランスポート プロバイダーは、1 つのプロバイダー オブジェクトで複数のトランスポート セッションをサポートするためにプログラムする必要があります。</span><span class="sxs-lookup"><span data-stu-id="6d1da-124">A transport provider should be programmed to support multiple transport sessions in a single provider object.</span></span> <span data-ttu-id="6d1da-125">2 つ目のプロバイダー オブジェクトは、異なる MAPI セッションが同じプロセスで使用されている場合にのみ作成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="6d1da-125">A second provider object should only be created if different MAPI sessions are used in the same process.</span></span>
  

