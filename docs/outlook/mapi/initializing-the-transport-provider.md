---
title: トランスポートプロバイダーの初期化
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 977c18ce-ece5-4ad1-ac97-5a680846ab83
description: '最終更新日: 2011 年 7 月 23 日'
ms.openlocfilehash: 474a8085ca8b82d11efd68c9fd4d8719fe239207
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/28/2019
ms.locfileid: "33416602"
---
# <a name="initializing-the-transport-provider"></a>トランスポートプロバイダーの初期化

  
  
**適用対象**: Outlook 2013 | Outlook 2016 
  
トランスポートスプーラーインターフェイスは、MAPI スプーラーがトランスポートプロバイダーに発信する呼び出しを定義します。 トランスポートプロバイダーは、ダイナミックリンクライブラリ (DLL) にこれらのルーチンを実装します。 MAPI スプーラーによって使用される DLL への最初の直接エントリポイントは、トランスポートプロバイダーの初期化関数である[xp の init](xpproviderinit.md)である必要があります。
  
MAPI は、ルーチン**GetProcAddress**を使用して、サービスプロバイダーの初期化ルーチンのアドレスを取得し、そのルーチンを呼び出します。 初期化ルーチンの名前は、トランスポートプロバイダー用の**xp providerinit**です。 他の種類の MAPI サービスプロバイダーとは異なり、1つの DLL には、サービスプロバイダーの種類の任意の組み合わせを含めることができますが、特定の種類のサービスプロバイダーは1つだけです。 ただし、特定の型の1つのサービスプロバイダーは、その種類の複数のサービスを実装できます。 たとえば、1つのトランスポートプロバイダーは、複数のメッセージサービスに対してメッセージトランスポート機能を実装できます。 
  
mapispi ヘッダーファイルには、トランスポートプロバイダー初期化関数の関数プロトタイプの型定義と、定義済みのプロシージャ名が含まれています。 C および c + + ファイルの初期化ルーチンに、 **GetProcAddress**で使用されているものと同じ名前を付けることにより、DLL で簡単なエクスポート宣言を使用します。DEF ファイルでは、初期化ルーチンのパラメーターの型チェックが自動的に行われます。 例については、サンプルのトランスポートプロバイダーのソースコードを参照してください。 詳細については、「 [Transport Provider Sample](transport-provider-sample.md)」を参照してください。
  
サービスプロバイダーの初期化呼び出しが成功しても、mapi が処理するには小さすぎるサービスプロバイダインターフェイスのバージョン番号を返す場合、mapi はすぐにサービスプロバイダオブジェクトの**Release**メソッドを呼び出し、初期化呼び出しの場合と同様に処理を行います。MAPI_E_VERSION で失敗しました。 この方法を使用すると、MAPI およびサービスプロバイダーは、処理できるサービスプロバイダインターフェイスのバージョン番号の範囲を共同で定義します。一致するものがない場合は、サービスプロバイダーの読み込みが MAPI_E_VERSION の戻り値で失敗します。 
  
サービスプロバイダリソースへのアクセス権を取得する MAPI スプーラーの最後の手順は、トランスポートプロバイダーにログオンすることです。 MAPI スプーラーは、 [ixpprovider](ixpprovideriunknown.md) : [: の transportlogon](ixpprovider-transportlogon.md)メソッドを呼び出します。このメソッドは、 **xps providerinit**から返された IUnknown オブジェクトです。 資格情報が使用されている場合は、この呼び出しによってチェックボックスがオンになり、ダイアログボックスが許可されます。
  
プロセスが同じトランスポートプロバイダーと MAPI セッションで2番目のトランスポートセッションを開いた場合、トランスポートプロバイダー DLL は2番目のプロバイダオブジェクトを作成しないでください。 2番目のトランスポートセッションにログオンするには、最初のプロバイダーオブジェクトを使用する必要があります。 トランスポートプロバイダーは、単一のプロバイダーオブジェクトで複数のトランスポートセッションをサポートするようにプログラムする必要があります。 2番目のプロバイダーオブジェクトは、異なる MAPI セッションを同じプロセスで使用する場合にのみ作成する必要があります。
  

