---
title: MAPI のイベント通知
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 7b3b625b-6dea-4b12-99a9-152935bdfe39
description: '最終更新日: 2011 年 7 月 23 日'
ms.openlocfilehash: 30d4ad5e0fc1ecdc4c8eb06f75d39e38dd481269
ms.sourcegitcommit: 8fe462c32b91c87911942c188f3445e85a54137c
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/23/2019
ms.locfileid: "32321398"
---
# <a name="event-notification-in-mapi"></a>MAPI のイベント通知

**適用対象**: Outlook 2013 | Outlook 2016 
  
イベント通知は、2つの MAPI オブジェクト間の情報の通信です。 オブジェクトの1つを使用すると、クライアントまたはサービスプロバイダーは、イベントと呼ばれる変更またはエラーの通知のために登録を行います。これは、他のオブジェクトで発生する可能性があります。 イベントが発生すると、最初のオブジェクトに変更またはエラーが通知されます。 通知を受け取るオブジェクトは、アドバイズシンクと呼ばれます。通知を行うオブジェクトは、アドバイズ元と呼ばれます。
  
アドバイズシンクオブジェクトには、次の3つの種類があります (すべての種類は標準 MAPI オブジェクトです)。
  
- アドバイズシンクオブジェクトを通知します。   
- Form アドバイズシンクオブジェクト。  
- アドバイズシンクオブジェクトを表示します。
    
アドバイズシンクオブジェクトは、最も一般的な種類です。 アドバイズシンクは、通常、アドレス帳およびメッセージストア通知を受信し、 [IMAPIAdviseSink: IUnknown](imapiadvisesinkiunknown.md)インターフェイスをサポートするためにクライアントアプリケーションによって実装されます。 **IMAPIAdviseSink**には、 [IMAPIAdviseSink:: onnotify](imapiadvisesink-onnotify.md)という1つのメソッドが含まれています。 フォームとビューのアドバイズシンクはあまり一般的ではありません。ユーザー設定フォームへの変更に関する通知を受信するために実装されています。 フォームアドバイズシンクは IMAPIFormAdviseSink をサポートし[ます。 iunknown](imapiformadvisesinkiunknown.md)インターフェイスとビューアドバイズシンクは、 [IMAPIViewAdviseSink: iunknown](imapiviewadvisesinkiunknown.md)インターフェイスをサポートしています。 ほとんどのクライアントは標準的なアドバイズシンクオブジェクトを実装しているため、通知の討議は、フォーム通知ではなく、アドレス帳とメッセージストア通知に関連していると仮定します。 フォーム通知の詳細については、「 [MAPI フォーム通知](mapi-forms-notifications.md)」および「[フォームサーバーコードを作成](writing-form-server-code.md)する」を参照してください。
  
アドバイズソースオブジェクトは、サービスプロバイダーと MAPI によって実装されます。 すべてのサービスプロバイダーがイベント通知をサポートするわけではありません。省略可能ですが、強くお勧めします。 メッセージストアプロバイダーとアドレス帳プロバイダーは、通常、さまざまなオブジェクトのオブジェクト通知と、そのコンテンツおよび階層テーブルでのテーブル通知をサポートしています。 トランスポートプロバイダーは通知を直接サポートしていません。クライアントとの通信の代替方法に依存しています。
  
アドバイズシンクとは異なり、アドバイズソースオブジェクトは MAPI オブジェクトの一意の種類ではありません。 メッセージストアやテーブルなど、多くの MAPI オブジェクトは、アドバイズソースの役割を果たすことができます。 アドバイズソースは、次の処理を実行する MAPI オブジェクトです。
  
- 通知登録を受信するための**アドバイズ**メソッドを実装します。 
    
- 通知の取り消しを受け取る**アドバイズ**中止メソッドを実装します。 
    
- **IMAPIAdviseSink:: onnotify**メソッドを呼び出すことによって登録された適切なアドバイズシンクオブジェクトへの適切な種類の通知を生成します。 
    
アドバイズシンクオブジェクトを実装するクライアント**** は、通知の登録が必要な場合は、登録を行う必要があるオブジェクトのエントリ id をほとんどの場合に渡します**** 。レジスタ. クライアントは、監視する必要があるいくつかの種類のイベントを示すパラメーターを**アドバイズ**に渡します。 **** advise アドバイズシンクとアドバイズソースとの間の接続が成功したことを表す0以外の数値を返します。 
  
通知を**** 呼び出す前に、クライアントは、STORE_NOTIFY_OK フラグがメッセージストアの**PR_STORE_SUPPORT_MASK** ([PidTagStoreSupportMask](pidtagstoresupportmask-canonical-property.md)) に設定されていることを確認することによって、メッセージストアプロバイダーが通知をサポートしているかどうかを判断できます。プロパティ. アドレス帳プロバイダーが通知をサポートしているかどうかについて、クライアントは事前に判断する方法はありません。 クライアントは登録を試行する必要があり、試行に失敗した場合は、通知がサポートされていないと仮定することができます。
  
クライアントが登録したイベントが発生すると、アドバイズソースは、イベントに関する情報を含む通知データ構造で[IMAPIAdviseSink:: onnotify](imapiadvisesink-onnotify.md)メソッドを呼び出して、アドバイズシンクに通知します。 アドバイズシンクの**onnotify**の実装では、通知への応答として、メモリ内のデータの更新や画面表示の更新などのタスクを実行できます。 
  
サービスプロバイダーは、通知のサポートを手動で実装するか、3つの**imapisupport**方法で提供されるヘルプを利用できます。 [imapisupport:: Subscribe](imapisupport-subscribe.md)、 [imapisupport:: 講読解除](imapisupport-unsubscribe.md)、 [imapisupport:: Notify](imapisupport-notify.md). **Subscribe**メソッドと**講読解除**メソッドは、通知の登録とプロバイダーの登録解除を処理します。**Notify**メソッドは、必要に応じて通知の送信を処理します。 
  
通知登録に対して support オブジェクトのメソッドを使用するには、サービスプロバイダーが[imapisupport::](imapisupport-subscribe.md) **アドバイズ**メソッドをサブスクライブし、クライアントが**アドバイズ**を渡すアドバイズシンクポインターを**サブスクライブ**するように渡します。 エントリ id が入力パラメーターとして渡され、アドバイズソースが指定される場合、サービスプロバイダーはそれをバイナリキーに変換します。 **購読**では、一意の接続番号が作成されます。この番号は、サービスプロバイダーがクライアントに返します。 サービスプロバイダーは、**アドバイズ**呼び出しが完了した後、いつでもクライアントのアドバイズシンクオブジェクトポインターを解放できます。 
  
クライアントがアドバイズを取り消すために**アドバイズ**を呼び出すと、サービスプロバイダーはクライアントのアドバイズシンクポインターの参照カウントをデクリメントするか、または**サブスクリプション**の呼び出しを行います。 
  
通知を生成する時間になると、サービスプロバイダーは、通知に関連するすべての内部処理を実行し、使用されていないすべてのメンバーを0に設定することで[通知](notification.md)構造を初期化します。 **通知**構造を初期化する手法を使用すると、クライアントは、より小さく、短時間、エラーが発生しやすい**onnotify**実装を作成できます。 
  
次の図は、アドバイズシンクオブジェクト間の通信、アドバイズソースオブジェクト、MAPI を示しています。 MAPI は、アドバイズソースが通知をサポートするために**imapisupport**メソッドを呼び出す場合にのみ関連します。 
  
**イベント通知呼び出し**
  
![イベント通知の呼び出し](media/amapi_51.gif "イベント通知の呼び出し")
  
mfcmapi の**CAdviseSink**クラス (AdviseSink ファイルと AdviseSink ファイルを使用) は、**アドバイズ**対象のすべての呼び出しに対してアドバイズシンクオブジェクトを実装します。 mfcmapi の詳細については、「[コードサンプルとしての mfcmapi](mfcmapi-as-a-code-sample.md) 」および「 [mfcmapi](https://go.microsoft.com/fwlink/?LinkId=124154)」を参照してください。
  

