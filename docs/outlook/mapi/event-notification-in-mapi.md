---
title: MAPI のイベント通知
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 7b3b625b-6dea-4b12-99a9-152935bdfe39
description: '最終更新日: 2011 年 7 月 23 日'
ms.openlocfilehash: 30d4ad5e0fc1ecdc4c8eb06f75d39e38dd481269
ms.sourcegitcommit: 8fe462c32b91c87911942c188f3445e85a54137c
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/23/2019
ms.locfileid: "32321398"
---
# <a name="event-notification-in-mapi"></a><span data-ttu-id="efb13-103">MAPI のイベント通知</span><span class="sxs-lookup"><span data-stu-id="efb13-103">Event notification in MAPI</span></span>

<span data-ttu-id="efb13-104">**適用対象**: Outlook 2013 | Outlook 2016</span><span class="sxs-lookup"><span data-stu-id="efb13-104">**Applies to**: Outlook 2013 | Outlook 2016</span></span> 
  
<span data-ttu-id="efb13-105">イベント通知は、2つの MAPI オブジェクト間の情報の通信です。</span><span class="sxs-lookup"><span data-stu-id="efb13-105">Event notification is the communication of information between two MAPI objects.</span></span> <span data-ttu-id="efb13-106">オブジェクトの1つを使用すると、クライアントまたはサービスプロバイダーは、イベントと呼ばれる変更またはエラーの通知のために登録を行います。これは、他のオブジェクトで発生する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="efb13-106">Through one of the objects, a client or service provider registers for notification of a change or error, called an event, which may take place in the other object.</span></span> <span data-ttu-id="efb13-107">イベントが発生すると、最初のオブジェクトに変更またはエラーが通知されます。</span><span class="sxs-lookup"><span data-stu-id="efb13-107">After the event occurs, the first object is notified of the change or error.</span></span> <span data-ttu-id="efb13-108">通知を受け取るオブジェクトは、アドバイズシンクと呼ばれます。通知を行うオブジェクトは、アドバイズ元と呼ばれます。</span><span class="sxs-lookup"><span data-stu-id="efb13-108">The object receiving the notification is called the advise sink; the object responsible for the notification is called the advise source.</span></span>
  
<span data-ttu-id="efb13-109">アドバイズシンクオブジェクトには、次の3つの種類があります (すべての種類は標準 MAPI オブジェクトです)。</span><span class="sxs-lookup"><span data-stu-id="efb13-109">There are three types of advise sink objects (all types are standard MAPI objects):</span></span>
  
- <span data-ttu-id="efb13-110">アドバイズシンクオブジェクトを通知します。</span><span class="sxs-lookup"><span data-stu-id="efb13-110">Advise sink objects.</span></span>   
- <span data-ttu-id="efb13-111">Form アドバイズシンクオブジェクト。</span><span class="sxs-lookup"><span data-stu-id="efb13-111">Form advise sink objects.</span></span>  
- <span data-ttu-id="efb13-112">アドバイズシンクオブジェクトを表示します。</span><span class="sxs-lookup"><span data-stu-id="efb13-112">View advise sink objects.</span></span>
    
<span data-ttu-id="efb13-113">アドバイズシンクオブジェクトは、最も一般的な種類です。</span><span class="sxs-lookup"><span data-stu-id="efb13-113">Advise sink objects are the most common type.</span></span> <span data-ttu-id="efb13-114">アドバイズシンクは、通常、アドレス帳およびメッセージストア通知を受信し、 [IMAPIAdviseSink: IUnknown](imapiadvisesinkiunknown.md)インターフェイスをサポートするためにクライアントアプリケーションによって実装されます。</span><span class="sxs-lookup"><span data-stu-id="efb13-114">Advise sinks are typically implemented by client applications to receive address book and message store notifications and support the [IMAPIAdviseSink : IUnknown](imapiadvisesinkiunknown.md) interface.</span></span> <span data-ttu-id="efb13-115">**IMAPIAdviseSink**には、 [IMAPIAdviseSink:: onnotify](imapiadvisesink-onnotify.md)という1つのメソッドが含まれています。</span><span class="sxs-lookup"><span data-stu-id="efb13-115">**IMAPIAdviseSink** contains a single method, [IMAPIAdviseSink::OnNotify](imapiadvisesink-onnotify.md).</span></span> <span data-ttu-id="efb13-116">フォームとビューのアドバイズシンクはあまり一般的ではありません。ユーザー設定フォームへの変更に関する通知を受信するために実装されています。</span><span class="sxs-lookup"><span data-stu-id="efb13-116">Form and view advise sinks are less common; they are implemented to receive notifications about changes to custom forms.</span></span> <span data-ttu-id="efb13-117">フォームアドバイズシンクは IMAPIFormAdviseSink をサポートし[ます。 iunknown](imapiformadvisesinkiunknown.md)インターフェイスとビューアドバイズシンクは、 [IMAPIViewAdviseSink: iunknown](imapiviewadvisesinkiunknown.md)インターフェイスをサポートしています。</span><span class="sxs-lookup"><span data-stu-id="efb13-117">Form advise sinks support the [IMAPIFormAdviseSink : IUnknown](imapiformadvisesinkiunknown.md) interface and view advise sinks support the [IMAPIViewAdviseSink : IUnknown](imapiviewadvisesinkiunknown.md) interface.</span></span> <span data-ttu-id="efb13-118">ほとんどのクライアントは標準的なアドバイズシンクオブジェクトを実装しているため、通知の討議は、フォーム通知ではなく、アドレス帳とメッセージストア通知に関連していると仮定します。</span><span class="sxs-lookup"><span data-stu-id="efb13-118">Because most clients implement standard advise sink objects, assume that discussions of notifications relate to address book and message store notifications rather than forms notifications.</span></span> <span data-ttu-id="efb13-119">フォーム通知の詳細については、「 [MAPI フォーム通知](mapi-forms-notifications.md)」および「[フォームサーバーコードを作成](writing-form-server-code.md)する」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="efb13-119">For more information about forms notifications, see [MAPI Forms Notifications](mapi-forms-notifications.md) and [Writing Form Server Code](writing-form-server-code.md).</span></span>
  
<span data-ttu-id="efb13-120">アドバイズソースオブジェクトは、サービスプロバイダーと MAPI によって実装されます。</span><span class="sxs-lookup"><span data-stu-id="efb13-120">Advise source objects are implemented by service providers and by MAPI.</span></span> <span data-ttu-id="efb13-121">すべてのサービスプロバイダーがイベント通知をサポートするわけではありません。省略可能ですが、強くお勧めします。</span><span class="sxs-lookup"><span data-stu-id="efb13-121">Not all service providers support event notification; it is optional, but strongly recommended.</span></span> <span data-ttu-id="efb13-122">メッセージストアプロバイダーとアドレス帳プロバイダーは、通常、さまざまなオブジェクトのオブジェクト通知と、そのコンテンツおよび階層テーブルでのテーブル通知をサポートしています。</span><span class="sxs-lookup"><span data-stu-id="efb13-122">Message store and address book providers usually support object notifications on several of their objects and table notifications on their contents and hierarchy tables.</span></span> <span data-ttu-id="efb13-123">トランスポートプロバイダーは通知を直接サポートしていません。クライアントとの通信の代替方法に依存しています。</span><span class="sxs-lookup"><span data-stu-id="efb13-123">Transport providers do not support notifications directly; they rely on alternative methods of communication with clients.</span></span>
  
<span data-ttu-id="efb13-124">アドバイズシンクとは異なり、アドバイズソースオブジェクトは MAPI オブジェクトの一意の種類ではありません。</span><span class="sxs-lookup"><span data-stu-id="efb13-124">Unlike advise sinks, advise source objects are not a unique type of MAPI object.</span></span> <span data-ttu-id="efb13-125">メッセージストアやテーブルなど、多くの MAPI オブジェクトは、アドバイズソースの役割を果たすことができます。</span><span class="sxs-lookup"><span data-stu-id="efb13-125">Many MAPI objects, such as message stores and tables, can take on the role of advise source.</span></span> <span data-ttu-id="efb13-126">アドバイズソースは、次の処理を実行する MAPI オブジェクトです。</span><span class="sxs-lookup"><span data-stu-id="efb13-126">An advise source is any MAPI object that does the following:</span></span>
  
- <span data-ttu-id="efb13-127">通知登録を受信するための**アドバイズ**メソッドを実装します。</span><span class="sxs-lookup"><span data-stu-id="efb13-127">Implements an **Advise** method to receive notification registrations.</span></span> 
    
- <span data-ttu-id="efb13-128">通知の取り消しを受け取る**アドバイズ**中止メソッドを実装します。</span><span class="sxs-lookup"><span data-stu-id="efb13-128">Implements an **Unadvise** method to receive notification cancellations.</span></span> 
    
- <span data-ttu-id="efb13-129">**IMAPIAdviseSink:: onnotify**メソッドを呼び出すことによって登録された適切なアドバイズシンクオブジェクトへの適切な種類の通知を生成します。</span><span class="sxs-lookup"><span data-stu-id="efb13-129">Generates notifications of the appropriate type to the appropriate advise sink objects that have registered by calling their **IMAPIAdviseSink::OnNotify** methods.</span></span> 
    
<span data-ttu-id="efb13-130">アドバイズシンクオブジェクトを実装するクライアント\*\*\*\* は、通知の登録が必要な場合は、登録を行う必要があるオブジェクトのエントリ id をほとんどの場合に渡します\*\*\*\* 。レジスタ.</span><span class="sxs-lookup"><span data-stu-id="efb13-130">Clients that implement advise sink objects call **Advise** when they want to register for a notification, in most cases passing in the entry identifier of the object with which registration should occur, and **Unadvise** when they want to cancel the registration.</span></span> <span data-ttu-id="efb13-131">クライアントは、監視する必要があるいくつかの種類のイベントを示すパラメーターを**アドバイズ**に渡します。</span><span class="sxs-lookup"><span data-stu-id="efb13-131">Clients pass a parameter to **Advise** that indicates which of the several types of events they want to monitor.</span></span> <span data-ttu-id="efb13-132">\*\*\*\* advise アドバイズシンクとアドバイズソースとの間の接続が成功したことを表す0以外の数値を返します。</span><span class="sxs-lookup"><span data-stu-id="efb13-132">**Advise** returns a nonzero number that represents a successful connection between the advise sink and advise source.</span></span> 
  
<span data-ttu-id="efb13-133">通知を\*\*\*\* 呼び出す前に、クライアントは、STORE_NOTIFY_OK フラグがメッセージストアの**PR_STORE_SUPPORT_MASK** ([PidTagStoreSupportMask](pidtagstoresupportmask-canonical-property.md)) に設定されていることを確認することによって、メッセージストアプロバイダーが通知をサポートしているかどうかを判断できます。プロパティ.</span><span class="sxs-lookup"><span data-stu-id="efb13-133">Before calling **Advise**, clients can determine whether a message store provider supports notification by checking that the STORE_NOTIFY_OK flag is set in the message store's **PR_STORE_SUPPORT_MASK** ([PidTagStoreSupportMask](pidtagstoresupportmask-canonical-property.md)) property.</span></span> <span data-ttu-id="efb13-134">アドレス帳プロバイダーが通知をサポートしているかどうかについて、クライアントは事前に判断する方法はありません。</span><span class="sxs-lookup"><span data-stu-id="efb13-134">There is no way for clients to determine ahead of time whether or not an address book provider supports notifications.</span></span> <span data-ttu-id="efb13-135">クライアントは登録を試行する必要があり、試行に失敗した場合は、通知がサポートされていないと仮定することができます。</span><span class="sxs-lookup"><span data-stu-id="efb13-135">Clients must attempt to register and if the attempt fails, they can assume notifications are unsupported.</span></span>
  
<span data-ttu-id="efb13-136">クライアントが登録したイベントが発生すると、アドバイズソースは、イベントに関する情報を含む通知データ構造で[IMAPIAdviseSink:: onnotify](imapiadvisesink-onnotify.md)メソッドを呼び出して、アドバイズシンクに通知します。</span><span class="sxs-lookup"><span data-stu-id="efb13-136">When an event for which a client has registered occurs, the advise source notifies the advise sink by calling its [IMAPIAdviseSink::OnNotify](imapiadvisesink-onnotify.md) method with a notification data structure that contains information about the event.</span></span> <span data-ttu-id="efb13-137">アドバイズシンクの**onnotify**の実装では、通知への応答として、メモリ内のデータの更新や画面表示の更新などのタスクを実行できます。</span><span class="sxs-lookup"><span data-stu-id="efb13-137">An advise sink's implementation of **OnNotify** can perform tasks in response to the notification, such as updating data in memory or refreshing a screen display.</span></span> 
  
<span data-ttu-id="efb13-138">サービスプロバイダーは、通知のサポートを手動で実装するか、3つの**imapisupport**方法で提供されるヘルプを利用できます。 [imapisupport:: Subscribe](imapisupport-subscribe.md)、 [imapisupport:: 講読解除](imapisupport-unsubscribe.md)、 [imapisupport:: Notify](imapisupport-notify.md).</span><span class="sxs-lookup"><span data-stu-id="efb13-138">Service providers can implement support for notifications manually or take advantage of the help provided in three **IMAPISupport** methods: [IMAPISupport::Subscribe](imapisupport-subscribe.md), [IMAPISupport::Unsubscribe](imapisupport-unsubscribe.md), and [IMAPISupport::Notify](imapisupport-notify.md).</span></span> <span data-ttu-id="efb13-139">**Subscribe**メソッドと**講読解除**メソッドは、通知の登録とプロバイダーの登録解除を処理します。**Notify**メソッドは、必要に応じて通知の送信を処理します。</span><span class="sxs-lookup"><span data-stu-id="efb13-139">The **Subscribe** and **Unsubscribe** methods handle notification registration and deregistration for providers; the **Notify** method handles sending notifications when appropriate.</span></span> 
  
<span data-ttu-id="efb13-140">通知登録に対して support オブジェクトのメソッドを使用するには、サービスプロバイダーが[imapisupport::](imapisupport-subscribe.md) **アドバイズ**メソッドをサブスクライブし、クライアントが**アドバイズ**を渡すアドバイズシンクポインターを**サブスクライブ**するように渡します。</span><span class="sxs-lookup"><span data-stu-id="efb13-140">To use the support object methods for notification registration, service providers call [IMAPISupport::Subscribe](imapisupport-subscribe.md) in their **Advise** methods and pass to **Subscribe** the advise sink pointer that clients pass to **Advise**.</span></span> <span data-ttu-id="efb13-141">エントリ id が入力パラメーターとして渡され、アドバイズソースが指定される場合、サービスプロバイダーはそれをバイナリキーに変換します。</span><span class="sxs-lookup"><span data-stu-id="efb13-141">If an entry identifier is passed as an input parameter to specify an advise source, service providers convert it to a binary key.</span></span> <span data-ttu-id="efb13-142">**購読**では、一意の接続番号が作成されます。この番号は、サービスプロバイダーがクライアントに返します。</span><span class="sxs-lookup"><span data-stu-id="efb13-142">**Subscribe** creates a unique connection number and it is this number that service providers return to clients.</span></span> <span data-ttu-id="efb13-143">サービスプロバイダーは、**アドバイズ**呼び出しが完了した後、いつでもクライアントのアドバイズシンクオブジェクトポインターを解放できます。</span><span class="sxs-lookup"><span data-stu-id="efb13-143">Service providers can release the client's advise sink object pointer at any time after the **Advise** call has completed.</span></span> 
  
<span data-ttu-id="efb13-144">クライアントがアドバイズを取り消すために**アドバイズ**を呼び出すと、サービスプロバイダーはクライアントのアドバイズシンクポインターの参照カウントをデクリメントするか、または**サブスクリプション**の呼び出しを行います。</span><span class="sxs-lookup"><span data-stu-id="efb13-144">When clients call **Unadvise** to cancel a registration, service providers either decrement the reference count on the client's advise sink pointer or call **Unsubscribe** to do the same.</span></span> 
  
<span data-ttu-id="efb13-145">通知を生成する時間になると、サービスプロバイダーは、通知に関連するすべての内部処理を実行し、使用されていないすべてのメンバーを0に設定することで[通知](notification.md)構造を初期化します。</span><span class="sxs-lookup"><span data-stu-id="efb13-145">When it is time to generate a notification, service providers perform any internal processing that relates to the notification and initializes a [NOTIFICATION](notification.md) structure by setting all of its unused members to zero.</span></span> <span data-ttu-id="efb13-146">**通知**構造を初期化する手法を使用すると、クライアントは、より小さく、短時間、エラーが発生しやすい**onnotify**実装を作成できます。</span><span class="sxs-lookup"><span data-stu-id="efb13-146">This technique for initializing the **NOTIFICATION** structure can help clients create smaller, faster, and less error-prone **OnNotify** implementations.</span></span> 
  
<span data-ttu-id="efb13-147">次の図は、アドバイズシンクオブジェクト間の通信、アドバイズソースオブジェクト、MAPI を示しています。</span><span class="sxs-lookup"><span data-stu-id="efb13-147">The following illustration shows the communication between advise sink objects, advise source objects, and MAPI.</span></span> <span data-ttu-id="efb13-148">MAPI は、アドバイズソースが通知をサポートするために**imapisupport**メソッドを呼び出す場合にのみ関連します。</span><span class="sxs-lookup"><span data-stu-id="efb13-148">MAPI is involved only when the advise source calls the **IMAPISupport** methods for notification support.</span></span> 
  
<span data-ttu-id="efb13-149">**イベント通知呼び出し**</span><span class="sxs-lookup"><span data-stu-id="efb13-149">**Event notification calls**</span></span>
  
<span data-ttu-id="efb13-150">![イベント通知の呼び出し](media/amapi_51.gif "イベント通知の呼び出し")</span><span class="sxs-lookup"><span data-stu-id="efb13-150">![Event notification calls](media/amapi_51.gif "Event notification calls")</span></span>
  
<span data-ttu-id="efb13-151">mfcmapi の**CAdviseSink**クラス (AdviseSink ファイルと AdviseSink ファイルを使用) は、**アドバイズ**対象のすべての呼び出しに対してアドバイズシンクオブジェクトを実装します。</span><span class="sxs-lookup"><span data-stu-id="efb13-151">The MFCMAPI **CAdviseSink** class (using the AdviseSink.h and AdviseSink.cpp files) implements the advise sink object for all calls to **Advise**.</span></span> <span data-ttu-id="efb13-152">mfcmapi の詳細については、「[コードサンプルとしての mfcmapi](mfcmapi-as-a-code-sample.md) 」および「 [mfcmapi](https://go.microsoft.com/fwlink/?LinkId=124154)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="efb13-152">For more information about MFCMAPI, see [MFCMAPI as a Code Sample](mfcmapi-as-a-code-sample.md) and [MFCMAPI](https://go.microsoft.com/fwlink/?LinkId=124154).</span></span>
  

