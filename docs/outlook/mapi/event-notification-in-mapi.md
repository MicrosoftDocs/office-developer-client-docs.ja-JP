---
title: MAPI でのイベントの通知
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 7b3b625b-6dea-4b12-99a9-152935bdfe39
description: '�ŏI�X�V��: 2011�N7��23��'
ms.openlocfilehash: 9c1fd58a31481d8666ca931408c16bd73aaba660
ms.sourcegitcommit: 9d60cd82b5413446e5bc8ace2cd689f683fb41a7
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/11/2018
ms.locfileid: "19800033"
---
# <a name="event-notification-in-mapi"></a><span data-ttu-id="9e975-103">MAPI でのイベントの通知</span><span class="sxs-lookup"><span data-stu-id="9e975-103">Event notification in MAPI</span></span>

<span data-ttu-id="9e975-104">**適用対象**: Outlook</span><span class="sxs-lookup"><span data-stu-id="9e975-104">**Applies to**: Outlook</span></span> 
  
<span data-ttu-id="9e975-105">イベント通知は、2 つの MAPI オブジェクト間で情報の通信です。</span><span class="sxs-lookup"><span data-stu-id="9e975-105">Event notification is the communication of information between two MAPI objects.</span></span> <span data-ttu-id="9e975-106">を通じて、オブジェクトのいずれか、クライアントまたはサービス プロバイダーを変更または他のオブジェクトで発生する可能性があります、イベントと呼ばれる、エラーの通知を登録します。</span><span class="sxs-lookup"><span data-stu-id="9e975-106">Through one of the objects, a client or service provider registers for notification of a change or error, called an event, which may take place in the other object.</span></span> <span data-ttu-id="9e975-107">イベントが発生すると、最初のオブジェクトが変更またはエラーの通知されます。</span><span class="sxs-lookup"><span data-stu-id="9e975-107">After the event occurs, the first object is notified of the change or error.</span></span> <span data-ttu-id="9e975-108">アドバイズ シンクに通知を受信するオブジェクトと呼びます通知用に使用するオブジェクトは、アドバイズ ソースと呼ばれます。</span><span class="sxs-lookup"><span data-stu-id="9e975-108">The object receiving the notification is called the advise sink; the object responsible for the notification is called the advise source.</span></span>
  
<span data-ttu-id="9e975-109">3 種類ありますのアドバイズ シンク オブジェクト (すべての種類の標準的な MAPI オブジェクト)。</span><span class="sxs-lookup"><span data-stu-id="9e975-109">There are three types of advise sink objects (all types are standard MAPI objects):</span></span>
  
- <span data-ttu-id="9e975-110">シンク オブジェクトに通知します。</span><span class="sxs-lookup"><span data-stu-id="9e975-110">Advise sink objects.</span></span>   
- <span data-ttu-id="9e975-111">フォームでは、シンク オブジェクトを案内します。</span><span class="sxs-lookup"><span data-stu-id="9e975-111">Form advise sink objects.</span></span>  
- <span data-ttu-id="9e975-112">ビューでは、シンク オブジェクトを案内します。</span><span class="sxs-lookup"><span data-stu-id="9e975-112">View advise sink objects.</span></span>
    
<span data-ttu-id="9e975-113">シンク オブジェクトは、最も一般的な種類を案内します。</span><span class="sxs-lookup"><span data-stu-id="9e975-113">Advise sink objects are the most common type.</span></span> <span data-ttu-id="9e975-114">通常、シンクは、アドレス帳とメッセージ ストアの通知およびサポートを受信するクライアント アプリケーションで実装をアドバイス、 [IMAPIAdviseSink: IUnknown](imapiadvisesinkiunknown.md)インタ フェースです。</span><span class="sxs-lookup"><span data-stu-id="9e975-114">Advise sinks are typically implemented by client applications to receive address book and message store notifications and support the [IMAPIAdviseSink : IUnknown](imapiadvisesinkiunknown.md) interface.</span></span> <span data-ttu-id="9e975-115">**IMAPIAdviseSink**には、 [IMAPIAdviseSink::OnNotify](imapiadvisesink-onnotify.md)、1 つのメソッドが含まれています。</span><span class="sxs-lookup"><span data-stu-id="9e975-115">**IMAPIAdviseSink** contains a single method, [IMAPIAdviseSink::OnNotify](imapiadvisesink-onnotify.md).</span></span> <span data-ttu-id="9e975-116">フォームとビューの通知シンクは、あまり一般的です。ユーザー設定フォームへの変更に関する通知を受信することが実装されています。</span><span class="sxs-lookup"><span data-stu-id="9e975-116">Form and view advise sinks are less common; they are implemented to receive notifications about changes to custom forms.</span></span> <span data-ttu-id="9e975-117">フォームのアドバイズ シンクのサポート、 [IMAPIFormAdviseSink: IUnknown](imapiformadvisesinkiunknown.md)インタ フェースとビューの通知シンク サポート、 [IMAPIViewAdviseSink: IUnknown](imapiviewadvisesinkiunknown.md)インタ フェースです。</span><span class="sxs-lookup"><span data-stu-id="9e975-117">Form advise sinks support the [IMAPIFormAdviseSink : IUnknown](imapiformadvisesinkiunknown.md) interface and view advise sinks support the [IMAPIViewAdviseSink : IUnknown](imapiviewadvisesinkiunknown.md) interface.</span></span> <span data-ttu-id="9e975-118">クライアント実装のほとんどの標準では、シンク オブジェクトをアドバイス、ためには、通知のディスカッションがフォームの通知ではなく、アドレス帳とメッセージ ストアの通知に関連するいると仮定します。</span><span class="sxs-lookup"><span data-stu-id="9e975-118">Because most clients implement standard advise sink objects, assume that discussions of notifications relate to address book and message store notifications rather than forms notifications.</span></span> <span data-ttu-id="9e975-119">フォームの通知の詳細については、 [MAPI フォームの通知](mapi-forms-notifications.md)および[フォームのサーバー コードの記述](writing-form-server-code.md)を参照してください。</span><span class="sxs-lookup"><span data-stu-id="9e975-119">For more information about forms notifications, see [MAPI Forms Notifications](mapi-forms-notifications.md) and [Writing Form Server Code](writing-form-server-code.md).</span></span>
  
<span data-ttu-id="9e975-120">ソースのサービス ・ プロバイダー、および MAPI オブジェクトの実装を推奨します。</span><span class="sxs-lookup"><span data-stu-id="9e975-120">Advise source objects are implemented by service providers and by MAPI.</span></span> <span data-ttu-id="9e975-121">イベントの通知をサポートしていないすべてのサービス プロバイダーオプションですが、強くお勧めします。</span><span class="sxs-lookup"><span data-stu-id="9e975-121">Not all service providers support event notification; it is optional, but strongly recommended.</span></span> <span data-ttu-id="9e975-122">メッセージ ストアとアドレス帳プロバイダー通常サポート オブジェクトの通知のそれぞれのオブジェクトとテーブルの通知の内容および階層テーブルにいくつかの。</span><span class="sxs-lookup"><span data-stu-id="9e975-122">Message store and address book providers usually support object notifications on several of their objects and table notifications on their contents and hierarchy tables.</span></span> <span data-ttu-id="9e975-123">トランスポート プロバイダーは通知をサポートします。他の方法でクライアントとの通信に依存しています。</span><span class="sxs-lookup"><span data-stu-id="9e975-123">Transport providers do not support notifications directly; they rely on alternative methods of communication with clients.</span></span>
  
<span data-ttu-id="9e975-124">アドバイズ シンクとは異なり、ソース オブジェクトは、MAPI オブジェクトの一意の型ではありませんを案内します。</span><span class="sxs-lookup"><span data-stu-id="9e975-124">Unlike advise sinks, advise source objects are not a unique type of MAPI object.</span></span> <span data-ttu-id="9e975-125">メッセージ ストアやテーブルなど、多くの MAPI オブジェクトは、ソースのアドバイズの役割に対して実行できます。</span><span class="sxs-lookup"><span data-stu-id="9e975-125">Many MAPI objects, such as message stores and tables, can take on the role of advise source.</span></span> <span data-ttu-id="9e975-126">アドバイズ ソースの MAPI する任意のオブジェクトは、次のとおりです。</span><span class="sxs-lookup"><span data-stu-id="9e975-126">An advise source is any MAPI object that does the following:</span></span>
  
- <span data-ttu-id="9e975-127">登録の通知を受信する**アドバイズ**メソッドを実装します。</span><span class="sxs-lookup"><span data-stu-id="9e975-127">Implements an **Advise** method to receive notification registrations.</span></span> 
    
- <span data-ttu-id="9e975-128">キャンセルの通知を受信するのには**Unadvise**メソッドを実装します。</span><span class="sxs-lookup"><span data-stu-id="9e975-128">Implements an **Unadvise** method to receive notification cancellations.</span></span> 
    
- <span data-ttu-id="9e975-129">**IMAPIAdviseSink::OnNotify**メソッドを呼び出すことによって登録されている適切なアドバイズ シンク オブジェクトに適切な種類の通知を生成します。</span><span class="sxs-lookup"><span data-stu-id="9e975-129">Generates notifications of the appropriate type to the appropriate advise sink objects that have registered by calling their **IMAPIAdviseSink::OnNotify** methods.</span></span> 
    
<span data-ttu-id="9e975-130">実装するクライアントの通知をキャンセルするときに登録する必要がありますが実行される、オブジェクトと**Unadvise**のエントリの識別子を渡すことのほとんどの場合、通知を登録するときに、シンク オブジェクトが**アドバイズ**を呼び出す、登録します。</span><span class="sxs-lookup"><span data-stu-id="9e975-130">Clients that implement advise sink objects call **Advise** when they want to register for a notification, in most cases passing in the entry identifier of the object with which registration should occur, and **Unadvise** when they want to cancel the registration.</span></span> <span data-ttu-id="9e975-131">クライアントでは、**アドバイズ**を監視するイベントのいくつかの種類を示すにパラメーターを渡します。</span><span class="sxs-lookup"><span data-stu-id="9e975-131">Clients pass a parameter to **Advise** that indicates which of the several types of events they want to monitor.</span></span> <span data-ttu-id="9e975-132">**アドバイズ**は、ソースのアドバイズとアドバイズ シンク間の接続が成功を表す数値を 0 以外の値を返します。</span><span class="sxs-lookup"><span data-stu-id="9e975-132">**Advise** returns a nonzero number that represents a successful connection between the advise sink and advise source.</span></span> 
  
<span data-ttu-id="9e975-133">メッセージ ストア プロバイダーがメッセージ ストアの**PR_STORE_SUPPORT_MASK** ([PidTagStoreSupportMask](pidtagstoresupportmask-canonical-property.md)) で、STORE_NOTIFY_OK フラグが設定されている確認することによって通知をサポートしているかどうか、**アドバイズ**を呼び出す前にクライアントを決定できます。プロパティです。</span><span class="sxs-lookup"><span data-stu-id="9e975-133">Before calling **Advise**, clients can determine whether a message store provider supports notification by checking that the STORE_NOTIFY_OK flag is set in the message store's **PR_STORE_SUPPORT_MASK** ([PidTagStoreSupportMask](pidtagstoresupportmask-canonical-property.md)) property.</span></span> <span data-ttu-id="9e975-134">アドレス帳プロバイダーが通知をサポートしているかどうかというクライアントが事前に決定することがあります。</span><span class="sxs-lookup"><span data-stu-id="9e975-134">There is no way for clients to determine ahead of time whether or not an address book provider supports notifications.</span></span> <span data-ttu-id="9e975-135">クライアントを登録しようとする必要があり、試行が失敗した場合、それらと見なすことが通知はサポートされていません。</span><span class="sxs-lookup"><span data-stu-id="9e975-135">Clients must attempt to register and if the attempt fails, they can assume notifications are unsupported.</span></span>
  
<span data-ttu-id="9e975-136">クライアントが登録されているイベントが発生するとアドバイスのソース イベントに関する情報を含む通知データ構造を持つ場合は、その[IMAPIAdviseSink::OnNotify](imapiadvisesink-onnotify.md)メソッドを呼び出して、アドバイズ シンクに通知します。</span><span class="sxs-lookup"><span data-stu-id="9e975-136">When an event for which a client has registered occurs, the advise source notifies the advise sink by calling its [IMAPIAdviseSink::OnNotify](imapiadvisesink-onnotify.md) method with a notification data structure that contains information about the event.</span></span> <span data-ttu-id="9e975-137">**OnNotify**のアドバイズ シンクの実装では、メモリ内のデータを更新し、画面表示を更新するなど、通知への応答としてタスクを実行できます。</span><span class="sxs-lookup"><span data-stu-id="9e975-137">An advise sink's implementation of **OnNotify** can perform tasks in response to the notification, such as updating data in memory or refreshing a screen display.</span></span> 
  
<span data-ttu-id="9e975-138">サービス ・ プロバイダーは通知のサポートを手動で実装したり、 **IMAPISupport**の 3 つの方法で提供されているヘルプの利用: [IMAPISupport::Subscribe](imapisupport-subscribe.md)、 [IMAPISupport::Unsubscribe](imapisupport-unsubscribe.md)、および[IMAPISupport::Notify](imapisupport-notify.md).</span><span class="sxs-lookup"><span data-stu-id="9e975-138">Service providers can implement support for notifications manually or take advantage of the help provided in three **IMAPISupport** methods: [IMAPISupport::Subscribe](imapisupport-subscribe.md), [IMAPISupport::Unsubscribe](imapisupport-unsubscribe.md), and [IMAPISupport::Notify](imapisupport-notify.md).</span></span> <span data-ttu-id="9e975-139">**購読**および**購読解除**の方法は、通知の登録を処理し、プロバイダーの登録解除**通知**メソッドは、該当する場合の通知の送信を処理します。</span><span class="sxs-lookup"><span data-stu-id="9e975-139">The **Subscribe** and **Unsubscribe** methods handle notification registration and deregistration for providers; the **Notify** method handles sending notifications when appropriate.</span></span> 
  
<span data-ttu-id="9e975-140">通知の登録のサポート オブジェクトのメソッドを使用するには、サービス プロバイダーは、**アドバイズ**メソッドで[IMAPISupport::Subscribe](imapisupport-subscribe.md)を呼び出すし、**購読**するクライアントが**アドバイズ**を通過するアドバイズ シンク ポインターを渡します。</span><span class="sxs-lookup"><span data-stu-id="9e975-140">To use the support object methods for notification registration, service providers call [IMAPISupport::Subscribe](imapisupport-subscribe.md) in their **Advise** methods and pass to **Subscribe** the advise sink pointer that clients pass to **Advise**.</span></span> <span data-ttu-id="9e975-141">エントリ識別子が渡された場合、アドバイスのソースを指定する入力パラメーターとして、サービス ・ プロバイダーに変換するバイナリのキー。</span><span class="sxs-lookup"><span data-stu-id="9e975-141">If an entry identifier is passed as an input parameter to specify an advise source, service providers convert it to a binary key.</span></span> <span data-ttu-id="9e975-142">**購読**は、一意の接続数を作成しはこのサービス プロバイダーをクライアントに返す値です。</span><span class="sxs-lookup"><span data-stu-id="9e975-142">**Subscribe** creates a unique connection number and it is this number that service providers return to clients.</span></span> <span data-ttu-id="9e975-143">サービス プロバイダーは、クライアントのリリースできます**アドバイス**の呼び出しが完了した後は、いつでもシンク オブジェクトのポインターを案内します。</span><span class="sxs-lookup"><span data-stu-id="9e975-143">Service providers can release the client's advise sink object pointer at any time after the **Advise** call has completed.</span></span> 
  
<span data-ttu-id="9e975-144">クライアントは、サービス プロバイダーの登録をキャンセルするのには**Unadvise**のクライアントの参照カウント、デクリメントを呼び出すときに、シンク ポインターを勧めるか、同じように**購読中止**を呼び出します。</span><span class="sxs-lookup"><span data-stu-id="9e975-144">When clients call **Unadvise** to cancel a registration, service providers either decrement the reference count on the client's advise sink pointer or call **Unsubscribe** to do the same.</span></span> 
  
<span data-ttu-id="9e975-145">通知を生成する時間は、サービス プロバイダーは、通知に関連し、すべての使用されていないメンバーを 0 に設定して、[通知](notification.md)の構造体を初期化する内部処理を実行します。</span><span class="sxs-lookup"><span data-stu-id="9e975-145">When it is time to generate a notification, service providers perform any internal processing that relates to the notification and initializes a [NOTIFICATION](notification.md) structure by setting all of its unused members to zero.</span></span> <span data-ttu-id="9e975-146">**通知**の構造体を初期化するためには、この手法は、クライアントが高速で、エラーが発生しやすい**OnNotify**実装のサイズを小さくすると、作成に役立ちます。</span><span class="sxs-lookup"><span data-stu-id="9e975-146">This technique for initializing the **NOTIFICATION** structure can help clients create smaller, faster, and less error-prone **OnNotify** implementations.</span></span> 
  
<span data-ttu-id="9e975-147">通知シンク オブジェクトを次の図がの間の通信には、ソース オブジェクト、および MAPI に案内します。</span><span class="sxs-lookup"><span data-stu-id="9e975-147">The following illustration shows the communication between advise sink objects, advise source objects, and MAPI.</span></span> <span data-ttu-id="9e975-148">MAPI が関係しているは、アドバイスのソースでは、 **IMAPISupport**メソッドを呼び出して通知をサポートするためにのみです。</span><span class="sxs-lookup"><span data-stu-id="9e975-148">MAPI is involved only when the advise source calls the **IMAPISupport** methods for notification support.</span></span> 
  
<span data-ttu-id="9e975-149">**イベント通知呼び出し**</span><span class="sxs-lookup"><span data-stu-id="9e975-149">**Event notification calls**</span></span>
  
<span data-ttu-id="9e975-150">![イベント通知の呼び出し](media/amapi_51.gif "イベント通知の呼び出し")</span><span class="sxs-lookup"><span data-stu-id="9e975-150">![Event notification calls](media/amapi_51.gif "Event notification calls")</span></span>
  
<span data-ttu-id="9e975-151">(AdviseSink.h および AdviseSink.cpp ファイルを使用して) MFCMAPI **CAdviseSink**クラスでは、**アドバイズ**するすべての呼び出しに対してアドバイズ シンク オブジェクトを実装します。</span><span class="sxs-lookup"><span data-stu-id="9e975-151">The MFCMAPI **CAdviseSink** class (using the AdviseSink.h and AdviseSink.cpp files) implements the advise sink object for all calls to **Advise**.</span></span> <span data-ttu-id="9e975-152">MFCMAPI の詳細については、[コード サンプルとして MFCMAPI](mfcmapi-as-a-code-sample.md)と[MFCMAPI](http://go.microsoft.com/fwlink/?LinkId=124154)を参照してください。</span><span class="sxs-lookup"><span data-stu-id="9e975-152">For more information about MFCMAPI, see [MFCMAPI as a Code Sample](mfcmapi-as-a-code-sample.md) and [MFCMAPI](http://go.microsoft.com/fwlink/?LinkId=124154).</span></span>
  

