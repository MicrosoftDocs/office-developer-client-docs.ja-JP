---
title: MAPI でのイベントの通知
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 7b3b625b-6dea-4b12-99a9-152935bdfe39
description: '�ŏI�X�V��: 2011�N7��23��'
ms.openlocfilehash: 9c1fd58a31481d8666ca931408c16bd73aaba660
ms.sourcegitcommit: 9d60cd82b5413446e5bc8ace2cd689f683fb41a7
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/11/2018
ms.locfileid: "19800033"
---
# <a name="event-notification-in-mapi"></a>MAPI でのイベントの通知

**適用されます**: Outlook 
  
イベント通知は、2 つの MAPI オブジェクト間で情報の通信です。 を通じて、オブジェクトのいずれか、クライアントまたはサービス プロバイダーを変更または他のオブジェクトで発生する可能性があります、イベントと呼ばれる、エラーの通知を登録します。 イベントが発生すると、最初のオブジェクトが変更またはエラーの通知されます。 アドバイズ シンクに通知を受信するオブジェクトと呼びます通知用に使用するオブジェクトは、アドバイズ ソースと呼ばれます。
  
3 種類ありますのアドバイズ シンク オブジェクト (すべての種類の標準的な MAPI オブジェクト)。
  
- シンク オブジェクトに通知します。   
- フォームでは、シンク オブジェクトを案内します。  
- ビューでは、シンク オブジェクトを案内します。
    
シンク オブジェクトは、最も一般的な種類を案内します。 通常、シンクは、アドレス帳とメッセージ ストアの通知およびサポートを受信するクライアント アプリケーションで実装をアドバイス、 [IMAPIAdviseSink: IUnknown](imapiadvisesinkiunknown.md)インタ フェースです。 **IMAPIAdviseSink**には、 [IMAPIAdviseSink::OnNotify](imapiadvisesink-onnotify.md)、1 つのメソッドが含まれています。 フォームとビューの通知シンクは、あまり一般的です。ユーザー設定フォームへの変更に関する通知を受信することが実装されています。 フォームのアドバイズ シンクのサポート、 [IMAPIFormAdviseSink: IUnknown](imapiformadvisesinkiunknown.md)インタ フェースとビューの通知シンク サポート、 [IMAPIViewAdviseSink: IUnknown](imapiviewadvisesinkiunknown.md)インタ フェースです。 クライアント実装のほとんどの標準では、シンク オブジェクトをアドバイス、ためには、通知のディスカッションがフォームの通知ではなく、アドレス帳とメッセージ ストアの通知に関連するいると仮定します。 フォームの通知の詳細については、 [MAPI フォームの通知](mapi-forms-notifications.md)および[フォームのサーバー コードの記述](writing-form-server-code.md)を参照してください。
  
ソースのサービス ・ プロバイダー、および MAPI オブジェクトの実装を推奨します。 イベントの通知をサポートしていないすべてのサービス プロバイダーオプションですが、強くお勧めします。 メッセージ ストアとアドレス帳プロバイダー通常サポート オブジェクトの通知のそれぞれのオブジェクトとテーブルの通知の内容および階層テーブルにいくつかの。 トランスポート プロバイダーは通知をサポートします。他の方法でクライアントとの通信に依存しています。
  
アドバイズ シンクとは異なり、ソース オブジェクトは、MAPI オブジェクトの一意の型ではありませんを案内します。 メッセージ ストアやテーブルなど、多くの MAPI オブジェクトは、ソースのアドバイズの役割に対して実行できます。 アドバイズ ソースの MAPI する任意のオブジェクトは、次のとおりです。
  
- 登録の通知を受信する**アドバイズ**メソッドを実装します。 
    
- キャンセルの通知を受信するのには**Unadvise**メソッドを実装します。 
    
- **IMAPIAdviseSink::OnNotify**メソッドを呼び出すことによって登録されている適切なアドバイズ シンク オブジェクトに適切な種類の通知を生成します。 
    
実装するクライアントの通知をキャンセルするときに登録する必要がありますが実行される、オブジェクトと**Unadvise**のエントリの識別子を渡すことのほとんどの場合、通知を登録するときに、シンク オブジェクトが**アドバイズ**を呼び出す、登録します。 クライアントでは、**アドバイズ**を監視するイベントのいくつかの種類を示すにパラメーターを渡します。 **アドバイズ**は、ソースのアドバイズとアドバイズ シンク間の接続が成功を表す数値を 0 以外の値を返します。 
  
メッセージ ストア プロバイダーがメッセージ ストアの**PR_STORE_SUPPORT_MASK** ([PidTagStoreSupportMask](pidtagstoresupportmask-canonical-property.md)) で、STORE_NOTIFY_OK フラグが設定されている確認することによって通知をサポートしているかどうか、**アドバイズ**を呼び出す前にクライアントを決定できます。プロパティです。 アドレス帳プロバイダーが通知をサポートしているかどうかというクライアントが事前に決定することがあります。 クライアントを登録しようとする必要があり、試行が失敗した場合、それらと見なすことが通知はサポートされていません。
  
クライアントが登録されているイベントが発生するとアドバイスのソース イベントに関する情報を含む通知データ構造を持つ場合は、その[IMAPIAdviseSink::OnNotify](imapiadvisesink-onnotify.md)メソッドを呼び出して、アドバイズ シンクに通知します。 **OnNotify**のアドバイズ シンクの実装では、メモリ内のデータを更新し、画面表示を更新するなど、通知への応答としてタスクを実行できます。 
  
サービス ・ プロバイダーは通知のサポートを手動で実装したり、 **IMAPISupport**の 3 つの方法で提供されているヘルプの利用: [IMAPISupport::Subscribe](imapisupport-subscribe.md)、 [IMAPISupport::Unsubscribe](imapisupport-unsubscribe.md)、および[IMAPISupport::Notify](imapisupport-notify.md). **購読**および**購読解除**の方法は、通知の登録を処理し、プロバイダーの登録解除**通知**メソッドは、該当する場合の通知の送信を処理します。 
  
通知の登録のサポート オブジェクトのメソッドを使用するには、サービス プロバイダーは、**アドバイズ**メソッドで[IMAPISupport::Subscribe](imapisupport-subscribe.md)を呼び出すし、**購読**するクライアントが**アドバイズ**を通過するアドバイズ シンク ポインターを渡します。 エントリ識別子が渡された場合、アドバイスのソースを指定する入力パラメーターとして、サービス ・ プロバイダーに変換するバイナリのキー。 **購読**は、一意の接続数を作成しはこのサービス プロバイダーをクライアントに返す値です。 サービス プロバイダーは、クライアントのリリースできます**アドバイス**の呼び出しが完了した後は、いつでもシンク オブジェクトのポインターを案内します。 
  
クライアントは、サービス プロバイダーの登録をキャンセルするのには**Unadvise**のクライアントの参照カウント、デクリメントを呼び出すときに、シンク ポインターを勧めるか、同じように**購読中止**を呼び出します。 
  
通知を生成する時間は、サービス プロバイダーは、通知に関連し、すべての使用されていないメンバーを 0 に設定して、[通知](notification.md)の構造体を初期化する内部処理を実行します。 **通知**の構造体を初期化するためには、この手法は、クライアントが高速で、エラーが発生しやすい**OnNotify**実装のサイズを小さくすると、作成に役立ちます。 
  
通知シンク オブジェクトを次の図がの間の通信には、ソース オブジェクト、および MAPI に案内します。 MAPI が関係しているは、アドバイスのソースでは、 **IMAPISupport**メソッドを呼び出して通知をサポートするためにのみです。 
  
**イベント通知の呼び出し**
  
![イベント通知の呼び出し](media/amapi_51.gif "イベント通知の呼び出し")
  
(AdviseSink.h および AdviseSink.cpp ファイルを使用して) MFCMAPI **CAdviseSink**クラスでは、**アドバイズ**するすべての呼び出しに対してアドバイズ シンク オブジェクトを実装します。 MFCMAPI の詳細については、[コード サンプルとして MFCMAPI](mfcmapi-as-a-code-sample.md)と[MFCMAPI](http://go.microsoft.com/fwlink/?LinkId=124154)を参照してください。
  

