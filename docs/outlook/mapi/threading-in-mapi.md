---
title: MAPI のスレッド処理
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 259297d2-acd7-4bc5-9a77-0df92cbfa33e
description: '最終更新日: 2015 年 3 月 9 日'
ms.openlocfilehash: 5d94aeaa75ede85983a678f448b05ad90c1e458a
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/28/2019
ms.locfileid: "33405542"
---
# <a name="threading-in-mapi"></a>MAPI のスレッド処理

  
  
**適用対象**: Outlook 2013 | Outlook 2016 
  
スレッドとは、オペレーティングシステムが CPU 時間を割り当てる基本的なエンティティです。 スレッドには、独自のレジスタ、スタック、優先度、および記憶域がありますが、アドレス空間を共有し、アクセストークンなどのリソースを処理します。 スレッドはメモリを共有し、1つのスレッドが別のスレッドが書き込んだ内容を読み取ります。
  
MAPI クライアントでは、次の汎用スレッドモデルが使用されます。
  
|**スレッドモデル**|**説明**|
|:-----|:-----|
|単一スレッドモデル  <br/> |すべてのオブジェクトは、1つのスレッドで使用されます。  <br/> |
|アパートメントスレッドモデル  <br/> |オブジェクトは、それを作成したスレッドでのみ使用できます。  <br/> |
|フリースレッドまたはスレッドパーティ、モデル  <br/> |オブジェクトは任意のスレッドで使用できます。  <br/> |
   
MAPI では、任意のスレッドでいつでも使用できるスレッドセーフなオブジェクトをサポートする、フリースレッドモデルが使用されます。 OLE はアパートメントスレッドモデルを使用します。 アパートメントスレッドモデルでは、オブジェクトを作成したスレッド以外のスレッドがそのオブジェクトを使用する必要がある場合に、明示的に転送する必要があるオブジェクトをサポートしています。
  
OLE がオブジェクトを別のスレッドに転送する際に使用するメカニズムを、マーシャリングと呼びます。 マーシャリングには、スタブオブジェクトとプロキシオブジェクトが含まれます。 これらの特別なオブジェクトによって、マーシャリングするオブジェクトのインターフェイスのパラメーターがパッケージ化され、これらのパラメーターが他のスレッドに転送されて、到着時にアンパッケージ化されます。 2つのマルチスレッドモデル間の競合は、OLE "ライトウェイト" リモートプロシージャコールまたは LRPC を使用して、別のプロセスに、フリースレッドの MAPI オブジェクトが送信されるときに発生します。 LRPC は、オブジェクトとその呼び出し元との間のアパートメントスレッド動作を使用して、オブジェクトのセマンティクスを解放スレッドからアパートメントスレッドに変更します。 この競合につながる MAPI の状況を認識することは、クライアントとサービスプロバイダーが問題の発生を防ぐのに役立ちます。
  
MAPI オブジェクトにアクセスするには、次のようにします。
  
- [MAPILogonEx](mapilogonex.md)から返されるセッションオブジェクトなど、クライアントのプロセスにリンクされているサービスプロバイダーまたは MAPI によって返されるインターフェイスポインターを使用して、そのメソッドへの直接呼び出しを実行します。
    
- 任意のサービスプロバイダーから返されるインターフェイスポインター ( [imapifolder:: copyfolder](imapifolder-copyfolder.md)内の別のフォルダーからコピーされた folder オブジェクトなど) を使用して、そのメソッドを間接的に呼び出します。
    
- コールバック関数 ( [IMAPIAdviseSink:: onnotify](imapiadvisesink-onnotify.md)メソッドなど) を使用して、サービスプロバイダーに渡されるか、**アドバイズ**呼び出しの MAPI に渡されるか、または時間のかかる操作の進行状況を示すことができるメソッドを使用します。 
    

