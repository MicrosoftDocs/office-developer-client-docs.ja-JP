---
title: 受信メッセージの処理
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: d45d5ed9-41cd-4aaf-91d2-1e4a27bb16d4
description: '最終更新日: 2011 年 7 月 23 日'
ms.openlocfilehash: f3fbe34793e3520b26b984f4bd6b14fbcab7a951
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/28/2019
ms.locfileid: "33438982"
---
# <a name="handling-an-incoming-message"></a><span data-ttu-id="a3b4b-103">受信メッセージの処理</span><span class="sxs-lookup"><span data-stu-id="a3b4b-103">Handling an incoming message</span></span>

<span data-ttu-id="a3b4b-104">**適用対象**: Outlook 2013 | Outlook 2016</span><span class="sxs-lookup"><span data-stu-id="a3b4b-104">**Applies to**: Outlook 2013 | Outlook 2016</span></span> 
  
<span data-ttu-id="a3b4b-105">受信メッセージは、1 つ以上のメッセージング システムで送信されたメッセージです。</span><span class="sxs-lookup"><span data-stu-id="a3b4b-105">An incoming message is a message that has been sent across one or more messaging systems.</span></span> <span data-ttu-id="a3b4b-106">ユーザーまたは他の多くの受信者にのみ送信されている可能性があります。</span><span class="sxs-lookup"><span data-stu-id="a3b4b-106">It may have been sent only to you or to many other recipients.</span></span> <span data-ttu-id="a3b4b-107">受信メッセージは、特定のクラスのメッセージを保持するために指定された受信フォルダーに配置されます。</span><span class="sxs-lookup"><span data-stu-id="a3b4b-107">Incoming messages are placed in a receive folder designated to hold messages of a particular class.</span></span> <span data-ttu-id="a3b4b-108">処理するメッセージ クラスごとに異なる受信フォルダーを設定するか、すべてのクラスに 1 つのフォルダーを使用できます。</span><span class="sxs-lookup"><span data-stu-id="a3b4b-108">You can set up a different receive folder for each message class that you handle or use one folder for all of the classes.</span></span>
  
<span data-ttu-id="a3b4b-109">メッセージ ストアに新しいメール通知を登録している場合は、メッセージが受信フォルダーに配置されるたびに通知されます。</span><span class="sxs-lookup"><span data-stu-id="a3b4b-109">If you have registered for new mail notifications with the message store, you will be notified whenever a message is placed in a receive folder.</span></span> <span data-ttu-id="a3b4b-110">新しいメール通知に登録していない場合は、適切な受信フォルダーを定期的に開き、新しいメッセージの到着を手動で確認する必要があります。</span><span class="sxs-lookup"><span data-stu-id="a3b4b-110">If you have not registered for new mail notifications, you must open the appropriate receive folder periodically to manually check for the arrival of new messages.</span></span>
  
<span data-ttu-id="a3b4b-111">クライアントは、パラメーターを [IMsgStore::Advise](imsgstore-advise.md) に次のように設定して、新しいメール通知に登録します。</span><span class="sxs-lookup"><span data-stu-id="a3b4b-111">Clients register for new mail notifications by setting the parameters to [IMsgStore::Advise](imsgstore-advise.md) as follows:</span></span> 
  
- <span data-ttu-id="a3b4b-112">_cbEntryID を_ 0 に設定します。</span><span class="sxs-lookup"><span data-stu-id="a3b4b-112">Set  _cbEntryID_ to 0.</span></span> 
    
- <span data-ttu-id="a3b4b-113">_lpEntryID を_ NULL に設定します。</span><span class="sxs-lookup"><span data-stu-id="a3b4b-113">Set  _lpEntryID_ to NULL.</span></span> 
    
- <span data-ttu-id="a3b4b-114">_ulEventMask を_ fnevNewMail に設定します。</span><span class="sxs-lookup"><span data-stu-id="a3b4b-114">Set  _ulEventMask_ to fnevNewMail.</span></span> 
    
<span data-ttu-id="a3b4b-115">**IMAPIAdviseSink::OnNotify** メソッドの呼び出しの _lpNotifications_ パラメーターは、メッセージ クラス、エントリ識別子、親フォルダーのエントリ識別子、および PR_MESSAGE_FLAGS プロパティの内容など、受信メッセージに関する情報を含む **NEWMAIL** **\_ NOTIFICATION** 構造体をポイントします。</span><span class="sxs-lookup"><span data-stu-id="a3b4b-115">The  _lpNotifications_ parameter in the call to your **IMAPIAdviseSink::OnNotify** method points to a **NEWMAIL\_NOTIFICATION** structure that contains information about the incoming message, such as its message class, its entry identifier, the entry identifier of its parent folder, and the contents of its **PR_MESSAGE_FLAGS** property.</span></span> <span data-ttu-id="a3b4b-116">通知の登録と処理の詳細[](handling-notifications.md)については[、「IMAPIAdviseSink::OnNotify](imapiadvisesink-onnotify.md)」、NEWMAIL_NOTIFICATION [、PR_MESSAGE_FLAGS](newmail_notification.md)[(PidTagMessageFlags)、](pidtagmessageflags-canonical-property.md)および通知の処理を参照してください。 </span><span class="sxs-lookup"><span data-stu-id="a3b4b-116">For more information about registering for and handling notifications, see [IMAPIAdviseSink::OnNotify](imapiadvisesink-onnotify.md), [NEWMAIL_NOTIFICATION](newmail_notification.md), **PR_MESSAGE_FLAGS** ([PidTagMessageFlags](pidtagmessageflags-canonical-property.md)), and [Handling Notifications](handling-notifications.md).</span></span> 
  
<span data-ttu-id="a3b4b-117">ユーザーに受信メッセージを表示する前に、そのメッセージ クラスがクライアントがサポートするクラスかどうかを確認します。</span><span class="sxs-lookup"><span data-stu-id="a3b4b-117">Before displaying an incoming message to a user, determine if its message class is a class that your client supports.</span></span> <span data-ttu-id="a3b4b-118">メッセージが表示されない場合は、メッセージを無視します。</span><span class="sxs-lookup"><span data-stu-id="a3b4b-118">If not, ignore the message.</span></span> <span data-ttu-id="a3b4b-119">クラスがサポートするクラスの場合は、メッセージのメッセージ クラスに適したフォームでメッセージを開いて表示できます。</span><span class="sxs-lookup"><span data-stu-id="a3b4b-119">If the class is one that you support, you can open and display the message with a form that is appropriate for the message class of the message.</span></span> <span data-ttu-id="a3b4b-120">フォームの選択は、メッセージ クラスに基づいて行います。</span><span class="sxs-lookup"><span data-stu-id="a3b4b-120">The choice of forms is based on message class.</span></span> <span data-ttu-id="a3b4b-121">IPM クラスに属するメッセージは、MAPI によって実装された既定のフォームを使用します。</span><span class="sxs-lookup"><span data-stu-id="a3b4b-121">Messages that belong to the IPM class use a default form implemented by MAPI.</span></span> <span data-ttu-id="a3b4b-122">クライアントによって定義されたカスタム クラスに属するメッセージは、クライアント定義の特殊なフォームまたは MAPI 既定のフォームを使用できます。</span><span class="sxs-lookup"><span data-stu-id="a3b4b-122">Messages that belong to custom classes defined by clients can use either client-defined specialized forms or the MAPI default form.</span></span>
  
## <a name="open-and-display-an-incoming-message"></a><span data-ttu-id="a3b4b-123">受信メッセージを開いて表示する</span><span class="sxs-lookup"><span data-stu-id="a3b4b-123">Open and display an incoming message</span></span>
  
1. <span data-ttu-id="a3b4b-124">**IMsgStore::GetReceiveFolder** を呼び出して、メッセージのメッセージ クラスの受信フォルダーのエントリ識別子を取得し、このエントリ識別子を **IMsgStore::OpenEntry** に渡してフォルダーを開きます。</span><span class="sxs-lookup"><span data-stu-id="a3b4b-124">Call **IMsgStore::GetReceiveFolder** to retrieve the entry identifier of the receive folder for the message class of the message and pass this entry identifier to **IMsgStore::OpenEntry** to open the folder.</span></span> <span data-ttu-id="a3b4b-125">詳細については [、「IMsgStore::GetReceiveFolder](imsgstore-getreceivefolder.md) [、IMsgStore::OpenEntry」、](imsgstore-openentry.md)および「メッセージ ストア フォルダーを開く」 [を参照してください](opening-a-message-store-folder.md)。</span><span class="sxs-lookup"><span data-stu-id="a3b4b-125">For more information, see [IMsgStore::GetReceiveFolder](imsgstore-getreceivefolder.md), [IMsgStore::OpenEntry](imsgstore-openentry.md), and [Opening a Message Store Folder](opening-a-message-store-folder.md).</span></span>
    
2. <span data-ttu-id="a3b4b-126">受信フォルダーの **IMAPIContainer::GetContentsTable** メソッドを呼び出して、そのコンテンツ テーブルを取得します。</span><span class="sxs-lookup"><span data-stu-id="a3b4b-126">Call the receive folder's **IMAPIContainer::GetContentsTable** method to retrieve its contents table.</span></span> <span data-ttu-id="a3b4b-127">詳細については [、「IMAPIContainer::GetContentsTable」を参照してください](imapicontainer-getcontentstable.md)。</span><span class="sxs-lookup"><span data-stu-id="a3b4b-127">For more information, see [IMAPIContainer::GetContentsTable](imapicontainer-getcontentstable.md).</span></span> <span data-ttu-id="a3b4b-128">テーブルのすべての行を取得するには、テーブル **の IMAPITable::QueryRows** メソッドを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="a3b4b-128">Call the table's **IMAPITable::QueryRows** method to retrieve all the rows in the table.</span></span> <span data-ttu-id="a3b4b-129">詳細については [、「IMAPITable::QueryRows and Contents](imapitable-queryrows.md) [Tables」を参照してください](contents-tables.md)。</span><span class="sxs-lookup"><span data-stu-id="a3b4b-129">For more information see [IMAPITable::QueryRows](imapitable-queryrows.md) and [Contents Tables](contents-tables.md).</span></span> <span data-ttu-id="a3b4b-130">コンテンツ テーブルの表示の詳細については、「フォルダー [コンテンツ テーブルの表示」を参照してください](displaying-a-folder-contents-table.md)。</span><span class="sxs-lookup"><span data-stu-id="a3b4b-130">For more information about displaying a contents table, see [Displaying a Folder Contents Table](displaying-a-folder-contents-table.md).</span></span>
    
3. <span data-ttu-id="a3b4b-131">クライアントが対話型の場合は、ユーザーがテーブルからメッセージを選択し、そのメッセージの表示に使用するフォームを決定できます。</span><span class="sxs-lookup"><span data-stu-id="a3b4b-131">If your client is interactive, allow the user to select a message from the table and determine the form to be used to display that message.</span></span> <span data-ttu-id="a3b4b-132">クライアントは、MAPI またはカスタム フォームによって提供される既定のフォームを使用できます。</span><span class="sxs-lookup"><span data-stu-id="a3b4b-132">Clients can use the default form provided by MAPI or a custom form.</span></span> <span data-ttu-id="a3b4b-133">詳細については、「MAPI フォームの [処理」を参照してください](handling-mapi-forms.md)。</span><span class="sxs-lookup"><span data-stu-id="a3b4b-133">For more information, see [Handling MAPI Forms](handling-mapi-forms.md).</span></span>
    
4. <span data-ttu-id="a3b4b-134">**メッセージを開く IMsgStore::OpenEntry** を呼び出します。</span><span class="sxs-lookup"><span data-stu-id="a3b4b-134">Call **IMsgStore::OpenEntry** to open the message.</span></span> <span data-ttu-id="a3b4b-135">詳細については、「メッセージを開 [く」を参照してください](opening-a-message.md)。</span><span class="sxs-lookup"><span data-stu-id="a3b4b-135">For more information, see [Opening a Message](opening-a-message.md).</span></span>
    
5. <span data-ttu-id="a3b4b-136">メッセージ テキストを処理します。</span><span class="sxs-lookup"><span data-stu-id="a3b4b-136">Process the message text.</span></span> <span data-ttu-id="a3b4b-137">詳細については、「メッセージ テキストを開 [く」を参照してください](opening-message-text.md)。</span><span class="sxs-lookup"><span data-stu-id="a3b4b-137">For more information, see [Opening Message Text](opening-message-text.md).</span></span>
    
6. <span data-ttu-id="a3b4b-138">各メッセージ添付ファイルをレンダリングします。</span><span class="sxs-lookup"><span data-stu-id="a3b4b-138">Render each of the message attachments.</span></span> <span data-ttu-id="a3b4b-139">詳細については、「プレーン テキストで [添付ファイルをレンダリング](rendering-an-attachment-in-plain-text.md) する」または [「RTF テキストで添付ファイルをレンダリングする」を参照してください](rendering-an-attachment-in-rtf-text.md)。</span><span class="sxs-lookup"><span data-stu-id="a3b4b-139">For more information, see [Rendering an Attachment in Plain Text](rendering-an-attachment-in-plain-text.md) or [Rendering an Attachment in RTF Text](rendering-an-attachment-in-rtf-text.md).</span></span>
    
7. <span data-ttu-id="a3b4b-140">必要に応じて添付ファイルを開きます。</span><span class="sxs-lookup"><span data-stu-id="a3b4b-140">Open an attachment if desired.</span></span> <span data-ttu-id="a3b4b-141">詳細については、「添付ファイルを [開く」を参照してください](opening-an-attachment.md)。</span><span class="sxs-lookup"><span data-stu-id="a3b4b-141">For more information see [Opening an Attachment](opening-an-attachment.md).</span></span>
    
## <a name="in-this-section"></a><span data-ttu-id="a3b4b-142">このセクションの内容</span><span class="sxs-lookup"><span data-stu-id="a3b4b-142">In this section</span></span>

- <span data-ttu-id="a3b4b-143">[メッセージ テキストを開](opening-message-text.md)く : メッセージ テキストを開く方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="a3b4b-143">[Opening Message Text](opening-message-text.md): Describes how to open the message text.</span></span>
    
- <span data-ttu-id="a3b4b-144">[プレーン テキストで添付ファイルをレンダリング](rendering-an-attachment-in-plain-text.md)する : プレーン テキストで添付ファイルをレンダリングする方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="a3b4b-144">[Rendering an Attachment in Plain Text](rendering-an-attachment-in-plain-text.md): Describes how to render an attachment in plain text.</span></span>
    
- <span data-ttu-id="a3b4b-145">[RTF テキストで添付ファイルをレンダリング](rendering-an-attachment-in-rtf-text.md)する : 書式設定されたテキストで添付ファイルをレンダリングする方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="a3b4b-145">[Rendering an Attachment in RTF Text](rendering-an-attachment-in-rtf-text.md): Describes how to render an attachment in formatted text.</span></span>
    
- <span data-ttu-id="a3b4b-146">[添付ファイルを開く](opening-an-attachment.md): 添付ファイルを開く方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="a3b4b-146">[Opening an Attachment](opening-an-attachment.md): Describes how to open an attachment.</span></span>
    

