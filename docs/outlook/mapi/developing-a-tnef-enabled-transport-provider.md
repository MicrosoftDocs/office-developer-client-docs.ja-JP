---
title: トランスポート プロバイダーTNEF-Enabled開発する
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 7525eee1-4016-49b8-9509-5ebbe1db819f
description: '最終更新日: 2011 年 7 月 23 日'
ms.openlocfilehash: 282b1866699b695c647caedd130ce5abc1bcbc2c
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/28/2019
ms.locfileid: "33439003"
---
# <a name="developing-a-tnef-enabled-transport-provider"></a><span data-ttu-id="60571-103">トランスポート プロバイダーTNEF-Enabled開発する</span><span class="sxs-lookup"><span data-stu-id="60571-103">Developing a TNEF-Enabled Transport Provider</span></span>

  
  
<span data-ttu-id="60571-104">**適用対象**: Outlook 2013 | Outlook 2016</span><span class="sxs-lookup"><span data-stu-id="60571-104">**Applies to**: Outlook 2013 | Outlook 2016</span></span> 
  
<span data-ttu-id="60571-105">MAPI 機能の異なるセットをサポートするメッセージング システム間の相互運用性を促進するために、MAPI はデータを転送する標準的な方法としてトランスポート ニュートラル カプセル化形式 (TNEF) を提供します。</span><span class="sxs-lookup"><span data-stu-id="60571-105">To promote interoperability between messaging systems that support different sets of MAPI features, MAPI provides the Transport Neutral Encapsulation Format (TNEF) as a standard way to transfer data.</span></span> <span data-ttu-id="60571-106">この形式は、基になるメッセージング システムでサポートされていない MAPI プロパティをバイナリ ストリームにカプセル化し、トランスポート プロバイダーがメッセージを送信するときにメッセージと共に転送できます。</span><span class="sxs-lookup"><span data-stu-id="60571-106">This format encapsulates MAPI properties not supported by an underlying messaging system into a binary stream that can be transferred along with the message when a transport provider sends it.</span></span> <span data-ttu-id="60571-107">メッセージを受信するトランスポート プロバイダーは、バイナリ ストリームをデコードして、元のメッセージのすべてのプロパティを取得し、それらをクライアント アプリケーションで使用できます。</span><span class="sxs-lookup"><span data-stu-id="60571-107">The transport provider that receives the message can then decode the binary stream to retrieve all the properties of the original message and make them available to client applications.</span></span> <span data-ttu-id="60571-108">TNEF の運用モデルは次の操作モデルです。</span><span class="sxs-lookup"><span data-stu-id="60571-108">The operational model for TNEF is:</span></span>
  
- <span data-ttu-id="60571-109">メッセージング クライアントは、通常通り TNEF トランスポートにメッセージを送信および受信します。</span><span class="sxs-lookup"><span data-stu-id="60571-109">Messaging clients submit and receive messages to a TNEF transport as normal.</span></span>
    
- <span data-ttu-id="60571-110">トランスポートは、送信メッセージのプロパティを、基になるメッセージ システムがサポートするカテゴリとサポートしないカテゴリの 2 つのカテゴリに分けられます。</span><span class="sxs-lookup"><span data-stu-id="60571-110">The transport separates the properties on outgoing messages into two categories: those that the underlying message system supports and those that it does not.</span></span> <span data-ttu-id="60571-111">基になるメッセージング システムでサポートされているプロパティの値は、必要な形式に変換されます。</span><span class="sxs-lookup"><span data-stu-id="60571-111">The values of the properties that are supported by the underlying messaging system are translated into the required format.</span></span>
    
- <span data-ttu-id="60571-112">トランスポートでは、MAPI TNEF メソッドを使用して、サポートされていないプロパティを 1 つのデータ ストリームにエンコードします。</span><span class="sxs-lookup"><span data-stu-id="60571-112">The transport uses the MAPI TNEF methods to encode any unsupported properties into a single data stream.</span></span> <span data-ttu-id="60571-113">トランスポートは、メッセージを送信する前に、基になるメッセージング システムの添付ファイル モデルを使用して、そのデータ ストリームを送信メッセージの特別な添付ファイルに変換します。</span><span class="sxs-lookup"><span data-stu-id="60571-113">The transport then turns that data stream into a special attachment on the outgoing message, using the underlying messaging system's attachment model, before sending the message.</span></span>
    
- <span data-ttu-id="60571-114">このようなメッセージを受信する TNEF が有効なトランスポートでは、2 つの処理が行います。</span><span class="sxs-lookup"><span data-stu-id="60571-114">A TNEF enabled transport that receives such a message does two things.</span></span> <span data-ttu-id="60571-115">最初に、受信メッセージのプロパティ (基になるメッセージ システムでサポートされているプロパティ) を MAPI プロパティに変換します。</span><span class="sxs-lookup"><span data-stu-id="60571-115">First, it translates the incoming message's properties — the ones supported by the underlying message system — into MAPI properties.</span></span> <span data-ttu-id="60571-116">次に、特別な添付ファイルが存在する場合は、MAPI TNEF メソッドを使用して添付ファイルから追加の MAPI プロパティを取得してから、メッセージをクライアント アプリケーションに配信します。</span><span class="sxs-lookup"><span data-stu-id="60571-116">Second, if the special attachment is present, it uses the MAPI TNEF methods to retrieve additional MAPI properties from the attachment before delivering the message to a client application.</span></span>
    
<span data-ttu-id="60571-117">MAPI は、TNEF オブジェクトを操作するときに MAPI トランスポート プロバイダーが使用する **ITnef** インターフェイスの実装を提供します。</span><span class="sxs-lookup"><span data-stu-id="60571-117">MAPI supplies an implementation of the **ITnef** interface for use by MAPI transport providers when working with TNEF objects.</span></span> <span data-ttu-id="60571-118">[OpenTnefStreamEx](opentnefstreamex.md)関数は、TNEF オブジェクトを作成し、それらをメッセージに関連付ける場合に使用します。</span><span class="sxs-lookup"><span data-stu-id="60571-118">The [OpenTnefStreamEx](opentnefstreamex.md) function is used to create TNEF objects and associate them with a message.</span></span> <span data-ttu-id="60571-119">TNEF ストリームは、OLE IStream インターフェイスの上 **に構築** されます。</span><span class="sxs-lookup"><span data-stu-id="60571-119">TNEF streams are built on top of the OLE **IStream** interface</span></span> 
  
> [!NOTE]
> <span data-ttu-id="60571-120">**OpenTnefStreamEx を使用して** TNEF オブジェクトを作成します。</span><span class="sxs-lookup"><span data-stu-id="60571-120">You use **OpenTnefStreamEx** to create TNEF objects.</span></span> <span data-ttu-id="60571-121">古い **OpenTnefStream** 関数は、古いソース コードとの互換性のためにまだ存在し、新しいソース コードでは使用できません。</span><span class="sxs-lookup"><span data-stu-id="60571-121">The old **OpenTnefStream** function still exists for compatibility with old source code and should not be used in anything new.</span></span> 
  
<span data-ttu-id="60571-122">**ITnef インターフェイスには**、次のメソッドがあります。</span><span class="sxs-lookup"><span data-stu-id="60571-122">The **ITnef** interface provides the following methods:</span></span> 
  
- [<span data-ttu-id="60571-123">AddProps</span><span class="sxs-lookup"><span data-stu-id="60571-123">AddProps</span></span>](itnef-addprops.md)
    
- [<span data-ttu-id="60571-124">EncodeRecips</span><span class="sxs-lookup"><span data-stu-id="60571-124">EncodeRecips</span></span>](itnef-encoderecips.md)
    
- [<span data-ttu-id="60571-125">ExtractProps</span><span class="sxs-lookup"><span data-stu-id="60571-125">ExtractProps</span></span>](itnef-extractprops.md)
    
- [<span data-ttu-id="60571-126">Finish</span><span class="sxs-lookup"><span data-stu-id="60571-126">Finish</span></span>](itnef-finish.md)
    
- [<span data-ttu-id="60571-127">FinishComponent</span><span class="sxs-lookup"><span data-stu-id="60571-127">FinishComponent</span></span>](itnef-finishcomponent.md)
    
- [<span data-ttu-id="60571-128">OpenTaggedBody</span><span class="sxs-lookup"><span data-stu-id="60571-128">OpenTaggedBody</span></span>](itnef-opentaggedbody.md)
    
- [<span data-ttu-id="60571-129">SetProps</span><span class="sxs-lookup"><span data-stu-id="60571-129">SetProps</span></span>](itnef-setprops.md)
    
<span data-ttu-id="60571-130">MAPI TNEF 実装モデルでは、次の機能がサポートされています。</span><span class="sxs-lookup"><span data-stu-id="60571-130">The MAPI TNEF implementation model supports:</span></span>
  
- <span data-ttu-id="60571-131">他のメッセージ プロパティに影響を与えることなく、すべての MAPI プロパティ。</span><span class="sxs-lookup"><span data-stu-id="60571-131">All MAPI properties without affecting other message properties.</span></span> <span data-ttu-id="60571-132">MAPI メッセージがメッセージング システムを介したトランスポートを存続するには、メッセージング システムのプロパティとしてエンコードできないすべてのプロパティをカプセル化する必要があります。</span><span class="sxs-lookup"><span data-stu-id="60571-132">In order for MAPI messages to survive transport through a messaging system, all properties that cannot be encoded as properties of the messaging system must be encapsulated.</span></span> <span data-ttu-id="60571-133">MAPI 準拠のクライアントがメッセージを受信するかどうかは、メッセージが送信された時点ではほとんど分かっていないので、カプセル化スキームを使用すると、トランスポート プロバイダーはメッセージング システムがネイティブにサポートしていない MAPI メッセージ プロパティのみをエンコードできます。</span><span class="sxs-lookup"><span data-stu-id="60571-133">Because it is almost never known at the time a message is sent whether or not a MAPI-compliant client will receive the message, the encapsulation scheme allows a transport provider to encode only those MAPI message properties that the messaging system does not natively support.</span></span> <span data-ttu-id="60571-134">つまり、TNEF を使用するメッセージは、SMTP ベースのメッセージング システムなどの MAPI に基づいておらないメッセージング システムUNIX意味します。</span><span class="sxs-lookup"><span data-stu-id="60571-134">This means that messages which use TNEF are not "opaque" to messaging systems that are not based on MAPI such as SMTP-based UNIX messaging systems.</span></span> <span data-ttu-id="60571-135">これらのシステムは、サポートするプロパティを通常の方法で受け取り、他のプロパティはエンコードされた TNEF データ ストリームとして受信されます。</span><span class="sxs-lookup"><span data-stu-id="60571-135">These systems receive the properties they support in whatever manner is typical for them, and other properties are received as an encoded TNEF data stream.</span></span> <span data-ttu-id="60571-136">TNEF トランスポート プロバイダーは、これら 2 つのプロパティ セットを区別し、メッセージング システムに対して適切な方法でサポートされているセットを送信する責任があります。</span><span class="sxs-lookup"><span data-stu-id="60571-136">The TNEF transport provider is responsible for differentiating between these two sets of properties and sending the supported set in the proper manner for the messaging system.</span></span> <span data-ttu-id="60571-137">TNEF は、メッセージング システムによって提供されるサポートのレベルを前提とします。</span><span class="sxs-lookup"><span data-stu-id="60571-137">TNEF makes no assumptions as to the level of support provided by a messaging system.</span></span> <span data-ttu-id="60571-138">ただし、このセクションに含まれる TNEF 使用法の例では、メッセージング システムがメッセージ以外に少なくとも 1 つの添付ファイルをサポートすると仮定されています。</span><span class="sxs-lookup"><span data-stu-id="60571-138">However, in the examples of TNEF usage included in this section, the assumption is made that the messaging system supports at least one single attachment aside from the message.</span></span> <span data-ttu-id="60571-139">場合によっては、添付ファイルは uuencoded ストリームを介してのみサポートされ、メッセージ テキストの一部として送信できます。</span><span class="sxs-lookup"><span data-stu-id="60571-139">In some cases, the attachment can only be supported through a uuencoded stream and transmitted as part of the message text.</span></span> <span data-ttu-id="60571-140">非常にまれな状況でのみ、メッセージング システムはメッセージ プロパティをほとんどサポートしないので、すべてのプロパティの完全な TNEF エンコードが必要になります。</span><span class="sxs-lookup"><span data-stu-id="60571-140">Only in very rare circumstances will the messaging system have so little support for message properties that full TNEF encoding of all properties is necessary.</span></span>
    
- <span data-ttu-id="60571-141">受信メッセージの TNEF ストリームが、MAPI プロパティ PR_TNEF_CORRELATION_KEY ([PidTagTnefCorrelationKey)](pidtagtnefcorrelationkey-canonical-property.md)に基づいてメッセージに属するかどうかを判断するメカニズム。 </span><span class="sxs-lookup"><span data-stu-id="60571-141">A mechanism for determining whether a TNEF stream on an incoming message belongs to the message, based on the MAPI property **PR_TNEF_CORRELATION_KEY** ([PidTagTnefCorrelationKey](pidtagtnefcorrelationkey-canonical-property.md)).</span></span> <span data-ttu-id="60571-142">このプロパティは、TNEF ストリームと適切なメッセージ ヘッダーの両方にあります。</span><span class="sxs-lookup"><span data-stu-id="60571-142">This property should be found both in the TNEF stream and in an appropriate message header.</span></span> <span data-ttu-id="60571-143">プロパティが両方の場所で同じ値を持っている場合、またはいずれかの場所に存在しない場合、TNEF ストリームはメッセージに属すると見なされます。</span><span class="sxs-lookup"><span data-stu-id="60571-143">If the property has the same value in both places, or is missing in either place, the TNEF stream is assumed to belong to the message.</span></span> <span data-ttu-id="60571-144">それ以外の場合、TNEF ストリームは無視されます。</span><span class="sxs-lookup"><span data-stu-id="60571-144">Otherwise, the TNEF stream is ignored.</span></span> <span data-ttu-id="60571-145">TNEF が有効なトランスポートは、送信メッセージでこのプロパティの値を選択し、適切なメッセージ ヘッダー (たとえば、SMTP メッセージの Message-ID: ヘッダー) と TNEF ストリームでエンコードします。</span><span class="sxs-lookup"><span data-stu-id="60571-145">TNEF enabled transports are responsible for choosing a value for this property on outbound messages and encoding it in an appropriate message header (for example, the Message-ID: header for SMTP messages) and in the TNEF stream.</span></span>
    

