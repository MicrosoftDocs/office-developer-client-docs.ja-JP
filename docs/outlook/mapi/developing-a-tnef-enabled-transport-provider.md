---
title: TNEF 対応のトランスポートプロバイダーの開発
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 7525eee1-4016-49b8-9509-5ebbe1db819f
description: '最終更新日: 2011 年 7 月 23 日'
ms.openlocfilehash: 282b1866699b695c647caedd130ce5abc1bcbc2c
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/28/2019
ms.locfileid: "33439003"
---
# <a name="developing-a-tnef-enabled-transport-provider"></a>TNEF 対応のトランスポートプロバイダーの開発

  
  
**適用対象**: Outlook 2013 | Outlook 2016 
  
mapi 機能の異なるセットをサポートするメッセージングシステム間での相互運用性を促進するために、mapi はトランスポートニュートラルカプセル化形式 (TNEF) をデータ転送の標準的な方法として提供します。 この形式では、基になるメッセージングシステムでサポートされていない MAPI プロパティが、トランスポートプロバイダーから送信されたときにメッセージと共に転送できるバイナリストリームにカプセル化されます。 メッセージを受け取るトランスポートプロバイダーは、元のメッセージのすべてのプロパティを取得して、クライアントアプリケーションで使用できるようにするために、バイナリストリームをデコードできます。 TNEF の運用モデルは次のとおりです。
  
- メッセージングクライアントは、TNEF トランスポートへのメッセージを通常どおりに送信して受信します。
    
- トランスポートは、送信メッセージのプロパティを2つのカテゴリに分けます。これは、基礎となるメッセージシステムがサポートしているものとないものです。 基になるメッセージングシステムでサポートされているプロパティの値は、必要な形式に変換されます。
    
- トランスポートは MAPI TNEF メソッドを使用して、サポートされていないプロパティを1つのデータストリームにエンコードします。 その後、トランスポートは、メッセージを送信する前に、基になるメッセージングシステムの添付モデルを使用して、そのデータストリームを送信メッセージの特殊な添付ファイルに変換します。
    
- このようなメッセージを受信する TNEF が有効なトランスポートでは、2つの処理が行われます。 最初に、受信メッセージのプロパティ (基礎となるメッセージシステムでサポートされているもの) を MAPI プロパティに変換します。 2番目に、特殊な添付ファイルが存在する場合は、mapi TNEF メソッドを使用して、添付ファイルからその他の mapi プロパティを取得してから、メッセージをクライアントアプリケーションに配信します。
    
mapi には、TNEF オブジェクトを処理するときに mapi トランスポートプロバイダーが使用する**ITnef**インターフェイスの実装が用意されています。 [OpenTnefStreamEx](opentnefstreamex.md)関数を使用して、TNEF オブジェクトを作成し、それをメッセージに関連付けます。 TNEF ストリームは、OLE **IStream**インターフェイスの上に構築されます。 
  
> [!NOTE]
> TNEF オブジェクトを作成するには、 **OpenTnefStreamEx**を使用します。 古い**OpenTnefStream**関数は、古いソースコードとの互換性を維持するために存在し、新しい内容では使用できません。 
  
**ITnef**インターフェイスには、次のメソッドが用意されています。 
  
- [addprops](itnef-addprops.md)
    
- [EncodeRecips](itnef-encoderecips.md)
    
- [ExtractProps](itnef-extractprops.md)
    
- [Finish](itnef-finish.md)
    
- [finish コンポーネント](itnef-finishcomponent.md)
    
- [OpenTaggedBody](itnef-opentaggedbody.md)
    
- [setprops による](itnef-setprops.md)
    
MAPI TNEF 実装モデルは次の機能をサポートしています。
  
- 他のメッセージプロパティに影響を与えることなく、すべての MAPI プロパティ。 メッセージングシステムを介してトランスポートが送信されないようにするためには、メッセージングシステムのプロパティとしてエンコードできないすべてのプロパティをカプセル化する必要があります。 mapi 準拠のクライアントがメッセージを受信するかどうかにかかわらずメッセージが送信されるときにはほとんど知られていないため、カプセル化スキームを使用すると、メッセージングシステムが提供していない mapi メッセージのプロパティのみをエンコードすることができます。ネイティブサポート。 これは、TNEF を使用するメッセージが、SMTP ベースの UNIX メッセージングシステムなどの MAPI に基づいていないメッセージングシステムに対して "不明瞭" ではないことを意味します。 これらのシステムは、一般的な方法でサポートされているプロパティを受け取ります。その他のプロパティは、エンコードされた TNEF データストリームとして受け取ることができます。 TNEF トランスポートプロバイダーは、これら2つのプロパティセットを区別し、メッセージングシステムに対して適切な方法でサポートされているセットを送信する役割を担います。 TNEF は、メッセージングシステムによって提供されるサポートのレベルについての仮定を行いません。 ただし、このセクションに記載されている TNEF 使用法の例では、メッセージングシステムがメッセージから1つ以上の添付ファイルをサポートしていることを前提としています。 場合によっては、添付ファイルは、uuencode ストリームを介してのみサポートされ、メッセージテキストの一部として送信できます。 非常にまれな状況でのみ、メッセージングシステムでは、すべてのプロパティの完全な TNEF エンコードを必要とするメッセージプロパティのサポートがほとんど行われません。
    
- MAPI プロパティの**PR_TNEF_CORRELATION_KEY** ([PidTagTnefCorrelationKey](pidtagtnefcorrelationkey-canonical-property.md)) に基づいて、受信メッセージの TNEF ストリームがメッセージに属するかどうかを判断するメカニズム。 このプロパティは、TNEF ストリームおよび適切なメッセージヘッダーの両方で見つける必要があります。 プロパティが両方の場所で同じ値を持つ場合、またはいずれかの場所に存在しない場合は、TNEF ストリームはメッセージに属していると見なされます。 それ以外の場合、TNEF ストリームは無視されます。 tnef 対応トランスポートは、送信メッセージでこのプロパティの値を選択し、それを適切なメッセージヘッダー (たとえば、SMTP メッセージのメッセージ ID: ヘッダー) および TNEF ストリームでエンコードすることを担当します。
    

