---
title: TNEF 対応のトランスポート プロバイダーの開発
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 7525eee1-4016-49b8-9509-5ebbe1db819f
description: '�ŏI�X�V��: 2011�N7��23��'
ms.openlocfilehash: 4d4f7ed75bb1144b7cd4a813b0d093246a30cca5
ms.sourcegitcommit: 0cf39e5382b8c6f236c8a63c6036849ed3527ded
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/23/2018
ms.locfileid: "22588350"
---
# <a name="developing-a-tnef-enabled-transport-provider"></a><span data-ttu-id="6a2d2-103">TNEF 対応のトランスポート プロバイダーの開発</span><span class="sxs-lookup"><span data-stu-id="6a2d2-103">Developing a TNEF-Enabled Transport Provider</span></span>

  
  
<span data-ttu-id="6a2d2-104">**適用されます**: Outlook 2013 |Outlook 2016</span><span class="sxs-lookup"><span data-stu-id="6a2d2-104">**Applies to**: Outlook 2013 | Outlook 2016</span></span> 
  
<span data-ttu-id="6a2d2-105">MAPI の機能の別のセットをサポートするためのメッセージング システム間の相互運用性を昇格させるには、MAPI は、データを転送する標準の方法としてトランスポート ニュートラル カプセル化形式 (TNEF) を提供します。</span><span class="sxs-lookup"><span data-stu-id="6a2d2-105">To promote interoperability between messaging systems that support different sets of MAPI features, MAPI provides the Transport Neutral Encapsulation Format (TNEF) as a standard way to transfer data.</span></span> <span data-ttu-id="6a2d2-106">この形式は、トランスポート プロバイダーは、それを送信するときのメッセージと共に転送されるバイナリ ストリームに、基になるメッセージング システムでサポートされていない MAPI プロパティをカプセル化します。</span><span class="sxs-lookup"><span data-stu-id="6a2d2-106">This format encapsulates MAPI properties not supported by an underlying messaging system into a binary stream that can be transferred along with the message when a transport provider sends it.</span></span> <span data-ttu-id="6a2d2-107">トランスポート プロバイダーは、メッセージを受信するは、元のメッセージのすべてのプロパティを取得し、クライアント アプリケーションに使用できるようにするバイナリ ストリームをデコードし、ことができます。</span><span class="sxs-lookup"><span data-stu-id="6a2d2-107">The transport provider that receives the message can then decode the binary stream to retrieve all the properties of the original message and make them available to client applications.</span></span> <span data-ttu-id="6a2d2-108">TNEF の運用モデルは、次のとおりです。</span><span class="sxs-lookup"><span data-stu-id="6a2d2-108">The operational model for TNEF is:</span></span>
  
- <span data-ttu-id="6a2d2-109">メッセージング クライアントは、送信し、通常の方法で TNEF のトランスポートにメッセージを受信します。</span><span class="sxs-lookup"><span data-stu-id="6a2d2-109">Messaging clients submit and receive messages to a TNEF transport as normal.</span></span>
    
- <span data-ttu-id="6a2d2-110">トランスポートの送信メッセージのプロパティを 2 つのカテゴリに分割する: 基になるメッセージ ・ システムをサポートしているとしていません。</span><span class="sxs-lookup"><span data-stu-id="6a2d2-110">The transport separates the properties on outgoing messages into two categories: those that the underlying message system supports and those that it does not.</span></span> <span data-ttu-id="6a2d2-111">基になるメッセージング システムでサポートされているプロパティの値は、必要な形式に変換されます。</span><span class="sxs-lookup"><span data-stu-id="6a2d2-111">The values of the properties that are supported by the underlying messaging system are translated into the required format.</span></span>
    
- <span data-ttu-id="6a2d2-112">トランスポートでは、MAPI の TNEF メソッドを使用して、サポートされていないプロパティを単一のデータ ストリームにエンコードします。</span><span class="sxs-lookup"><span data-stu-id="6a2d2-112">The transport uses the MAPI TNEF methods to encode any unsupported properties into a single data stream.</span></span> <span data-ttu-id="6a2d2-113">次に、トランスポートは、メッセージを送信する前に、基になるメッセージング システムの添付ファイルのモデルを使用して、送信メッセージでの特別な添付ファイルにそのデータ ストリームをオンにします。</span><span class="sxs-lookup"><span data-stu-id="6a2d2-113">The transport then turns that data stream into a special attachment on the outgoing message, using the underlying messaging system's attachment model, before sending the message.</span></span>
    
- <span data-ttu-id="6a2d2-114">このようなメッセージを受信する TNEF を有効になっているトランスポートは、2 つのことです。</span><span class="sxs-lookup"><span data-stu-id="6a2d2-114">A TNEF enabled transport that receives such a message does two things.</span></span> <span data-ttu-id="6a2d2-115">最初に、受信メッセージのプロパティを変換-基になるメッセージ ・ システムでサポートされているもの: MAPI のプロパティにします。</span><span class="sxs-lookup"><span data-stu-id="6a2d2-115">First, it translates the incoming message's properties — the ones supported by the underlying message system — into MAPI properties.</span></span> <span data-ttu-id="6a2d2-116">2 つ目は、特別な添付ファイルが存在する場合は、メソッドを使って、TNEF の MAPI クライアント アプリケーションにメッセージを配信する前に添付ファイルから追加の MAPI プロパティを取得します。</span><span class="sxs-lookup"><span data-stu-id="6a2d2-116">Second, if the special attachment is present, it uses the MAPI TNEF methods to retrieve additional MAPI properties from the attachment before delivering the message to a client application.</span></span>
    
<span data-ttu-id="6a2d2-117">TNEF のオブジェクトを操作する場合、MAPI は MAPI トランスポート プロバイダーが使用する**ITnef**インターフェイスの実装を提供します。</span><span class="sxs-lookup"><span data-stu-id="6a2d2-117">MAPI supplies an implementation of the **ITnef** interface for use by MAPI transport providers when working with TNEF objects.</span></span> <span data-ttu-id="6a2d2-118">[OpenTnefStreamEx](opentnefstreamex.md)関数を使用して、TNEF のオブジェクトを作成し、メッセージに関連付けます。</span><span class="sxs-lookup"><span data-stu-id="6a2d2-118">The [OpenTnefStreamEx](opentnefstreamex.md) function is used to create TNEF objects and associate them with a message.</span></span> <span data-ttu-id="6a2d2-119">TNEF ストリームは、OLE の**IStream**インターフェイスの上に構築されます。</span><span class="sxs-lookup"><span data-stu-id="6a2d2-119">TNEF streams are built on top of the OLE **IStream** interface</span></span> 
  
> [!NOTE]
> <span data-ttu-id="6a2d2-120">TNEF のオブジェクトを作成するのにには、 **OpenTnefStreamEx**を使用します。</span><span class="sxs-lookup"><span data-stu-id="6a2d2-120">You use **OpenTnefStreamEx** to create TNEF objects.</span></span> <span data-ttu-id="6a2d2-121">古い**OpenTnefStream**関数は古いソース コードとの互換性のために存在しは推奨されていないすべての新しい。</span><span class="sxs-lookup"><span data-stu-id="6a2d2-121">The old **OpenTnefStream** function still exists for compatibility with old source code and should not be used in anything new.</span></span> 
  
<span data-ttu-id="6a2d2-122">**ITnef**インターフェイスは、次のメソッドを提供します。</span><span class="sxs-lookup"><span data-stu-id="6a2d2-122">The **ITnef** interface provides the following methods:</span></span> 
  
- [<span data-ttu-id="6a2d2-123">AddProps</span><span class="sxs-lookup"><span data-stu-id="6a2d2-123">AddProps</span></span>](itnef-addprops.md)
    
- [<span data-ttu-id="6a2d2-124">EncodeRecips</span><span class="sxs-lookup"><span data-stu-id="6a2d2-124">EncodeRecips</span></span>](itnef-encoderecips.md)
    
- [<span data-ttu-id="6a2d2-125">ExtractProps</span><span class="sxs-lookup"><span data-stu-id="6a2d2-125">ExtractProps</span></span>](itnef-extractprops.md)
    
- [<span data-ttu-id="6a2d2-126">Finish</span><span class="sxs-lookup"><span data-stu-id="6a2d2-126">Finish</span></span>](itnef-finish.md)
    
- [<span data-ttu-id="6a2d2-127">FinishComponent</span><span class="sxs-lookup"><span data-stu-id="6a2d2-127">FinishComponent</span></span>](itnef-finishcomponent.md)
    
- [<span data-ttu-id="6a2d2-128">OpenTaggedBody</span><span class="sxs-lookup"><span data-stu-id="6a2d2-128">OpenTaggedBody</span></span>](itnef-opentaggedbody.md)
    
- [<span data-ttu-id="6a2d2-129">SetProps</span><span class="sxs-lookup"><span data-stu-id="6a2d2-129">SetProps</span></span>](itnef-setprops.md)
    
<span data-ttu-id="6a2d2-130">MAPI TNEF の実装モデルをサポートしています。</span><span class="sxs-lookup"><span data-stu-id="6a2d2-130">The MAPI TNEF implementation model supports:</span></span>
  
- <span data-ttu-id="6a2d2-131">その他のメッセージのプロパティに影響を与えずにすべての MAPI プロパティです。</span><span class="sxs-lookup"><span data-stu-id="6a2d2-131">All MAPI properties without affecting other message properties.</span></span> <span data-ttu-id="6a2d2-132">MAPI メッセージをメッセージング システムを介して転送を維持するためには、メッセージング システムのプロパティとしてエンコードすることはできませんのすべてのプロパティをカプセル化する必要があります。</span><span class="sxs-lookup"><span data-stu-id="6a2d2-132">In order for MAPI messages to survive transport through a messaging system, all properties that cannot be encoded as properties of the messaging system must be encapsulated.</span></span> <span data-ttu-id="6a2d2-133">カプセル化のスキームでメッセージング システムは MAPI メッセージ プロパティのみをエンコードするためにトランスポート プロバイダーは、そのほとんどありませんがわかっている時に、MAPI 準拠のクライアントにメッセージが表示されるかどうかにメッセージが送信されるためネイティブにサポートします。</span><span class="sxs-lookup"><span data-stu-id="6a2d2-133">Because it is almost never known at the time a message is sent whether or not a MAPI-compliant client will receive the message, the encapsulation scheme allows a transport provider to encode only those MAPI message properties that the messaging system does not natively support.</span></span> <span data-ttu-id="6a2d2-134">つまり、TNEF を使用してメッセージが MAPI SMTP ベースの UNIX のように基づいていないメッセージング システムには「不透明」ではないこと、メッセージング システムです。</span><span class="sxs-lookup"><span data-stu-id="6a2d2-134">This means that messages which use TNEF are not "opaque" to messaging systems that are not based on MAPI such as SMTP-based UNIX messaging systems.</span></span> <span data-ttu-id="6a2d2-135">これらのシステムでは、何らかの方法で一般的な TNEF エンコードされたデータ ストリームとして受信、およびその他のプロパティをサポートしているプロパティが表示されます。</span><span class="sxs-lookup"><span data-stu-id="6a2d2-135">These systems receive the properties they support in whatever manner is typical for them, and other properties are received as an encoded TNEF data stream.</span></span> <span data-ttu-id="6a2d2-136">TNEF のトランスポート プロバイダーは、これら 2 つのプロパティ セットの違いを知ると、メッセージング システムの適切な方法でサポートされているセットを送信します。</span><span class="sxs-lookup"><span data-stu-id="6a2d2-136">The TNEF transport provider is responsible for differentiating between these two sets of properties and sending the supported set in the proper manner for the messaging system.</span></span> <span data-ttu-id="6a2d2-137">TNEF には、メッセージング システムが提供するサポートのレベルについての前提条件はありません。</span><span class="sxs-lookup"><span data-stu-id="6a2d2-137">TNEF makes no assumptions as to the level of support provided by a messaging system.</span></span> <span data-ttu-id="6a2d2-138">ただし、例では、TNEF の使用率がこのセクションに含まれている、ことを前提として行われるメッセージング システムがメッセージは別の単一の添付ファイルを 1 つ以上をサポートしています。</span><span class="sxs-lookup"><span data-stu-id="6a2d2-138">However, in the examples of TNEF usage included in this section, the assumption is made that the messaging system supports at least one single attachment aside from the message.</span></span> <span data-ttu-id="6a2d2-139">場合によっては、添付ファイルのみするエンコードされていないストリームをサポートできメッセージ テキストの一部として送信できます。</span><span class="sxs-lookup"><span data-stu-id="6a2d2-139">In some cases, the attachment can only be supported through a uuencoded stream and transmitted as part of the message text.</span></span> <span data-ttu-id="6a2d2-140">非常にまれな状況でのみ、メッセージング システムがメッセージのプロパティのほとんどのサポートが必要なその完全 TNEF エンコーディングのすべてのプロパティは。</span><span class="sxs-lookup"><span data-stu-id="6a2d2-140">Only in very rare circumstances will the messaging system have so little support for message properties that full TNEF encoding of all properties is necessary.</span></span>
    
- <span data-ttu-id="6a2d2-141">メカニズムを決定するため、メッセージを受信したメッセージで TNEF ストリームが属しているかどうかは、MAPI プロパティの**PR_TNEF_CORRELATION_KEY** ([PidTagTnefCorrelationKey](pidtagtnefcorrelationkey-canonical-property.md)) に基づいています。</span><span class="sxs-lookup"><span data-stu-id="6a2d2-141">A mechanism for determining whether a TNEF stream on an incoming message belongs to the message, based on the MAPI property **PR_TNEF_CORRELATION_KEY** ([PidTagTnefCorrelationKey](pidtagtnefcorrelationkey-canonical-property.md)).</span></span> <span data-ttu-id="6a2d2-142">TNEF ストリームと、適切なメッセージ ヘッダーの両方は、このプロパティを探す必要があります。</span><span class="sxs-lookup"><span data-stu-id="6a2d2-142">This property should be found both in the TNEF stream and in an appropriate message header.</span></span> <span data-ttu-id="6a2d2-143">プロパティ、両方に同じ値を持つまたは見つからない場合にどちらの方法でも、TNEF ストリームは、メッセージに属していると見なされます。</span><span class="sxs-lookup"><span data-stu-id="6a2d2-143">If the property has the same value in both places, or is missing in either place, the TNEF stream is assumed to belong to the message.</span></span> <span data-ttu-id="6a2d2-144">それ以外の場合、TNEF ストリームは無視されます。</span><span class="sxs-lookup"><span data-stu-id="6a2d2-144">Otherwise, the TNEF stream is ignored.</span></span> <span data-ttu-id="6a2d2-145">TNEF を有効になっているトランスポートは、送信メッセージにこのプロパティの値を選択して、適切なメッセージ ヘッダーにエンコードして (たとえば、メッセージの ID: SMTP メッセージのヘッダー) と TNEF ストリームで。</span><span class="sxs-lookup"><span data-stu-id="6a2d2-145">TNEF enabled transports are responsible for choosing a value for this property on outbound messages and encoding it in an appropriate message header (for example, the Message-ID: header for SMTP messages) and in the TNEF stream.</span></span>
    

