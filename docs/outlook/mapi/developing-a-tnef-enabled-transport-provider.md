---
title: TNEF 対応のトランスポートプロバイダーの開発
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 7525eee1-4016-49b8-9509-5ebbe1db819f
description: '最終更新日: 2011 年 7 月 23 日'
ms.openlocfilehash: 282b1866699b695c647caedd130ce5abc1bcbc2c
ms.sourcegitcommit: 8fe462c32b91c87911942c188f3445e85a54137c
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/23/2019
ms.locfileid: "32316696"
---
# <a name="developing-a-tnef-enabled-transport-provider"></a><span data-ttu-id="ce5c6-103">TNEF 対応のトランスポートプロバイダーの開発</span><span class="sxs-lookup"><span data-stu-id="ce5c6-103">Developing a TNEF-Enabled Transport Provider</span></span>

  
  
<span data-ttu-id="ce5c6-104">**適用対象**: Outlook 2013 | Outlook 2016</span><span class="sxs-lookup"><span data-stu-id="ce5c6-104">**Applies to**: Outlook 2013 | Outlook 2016</span></span> 
  
<span data-ttu-id="ce5c6-105">mapi 機能の異なるセットをサポートするメッセージングシステム間での相互運用性を促進するために、mapi はトランスポートニュートラルカプセル化形式 (TNEF) をデータ転送の標準的な方法として提供します。</span><span class="sxs-lookup"><span data-stu-id="ce5c6-105">To promote interoperability between messaging systems that support different sets of MAPI features, MAPI provides the Transport Neutral Encapsulation Format (TNEF) as a standard way to transfer data.</span></span> <span data-ttu-id="ce5c6-106">この形式では、基になるメッセージングシステムでサポートされていない MAPI プロパティが、トランスポートプロバイダーから送信されたときにメッセージと共に転送できるバイナリストリームにカプセル化されます。</span><span class="sxs-lookup"><span data-stu-id="ce5c6-106">This format encapsulates MAPI properties not supported by an underlying messaging system into a binary stream that can be transferred along with the message when a transport provider sends it.</span></span> <span data-ttu-id="ce5c6-107">メッセージを受け取るトランスポートプロバイダーは、元のメッセージのすべてのプロパティを取得して、クライアントアプリケーションで使用できるようにするために、バイナリストリームをデコードできます。</span><span class="sxs-lookup"><span data-stu-id="ce5c6-107">The transport provider that receives the message can then decode the binary stream to retrieve all the properties of the original message and make them available to client applications.</span></span> <span data-ttu-id="ce5c6-108">TNEF の運用モデルは次のとおりです。</span><span class="sxs-lookup"><span data-stu-id="ce5c6-108">The operational model for TNEF is:</span></span>
  
- <span data-ttu-id="ce5c6-109">メッセージングクライアントは、TNEF トランスポートへのメッセージを通常どおりに送信して受信します。</span><span class="sxs-lookup"><span data-stu-id="ce5c6-109">Messaging clients submit and receive messages to a TNEF transport as normal.</span></span>
    
- <span data-ttu-id="ce5c6-110">トランスポートは、送信メッセージのプロパティを2つのカテゴリに分けます。これは、基礎となるメッセージシステムがサポートしているものとないものです。</span><span class="sxs-lookup"><span data-stu-id="ce5c6-110">The transport separates the properties on outgoing messages into two categories: those that the underlying message system supports and those that it does not.</span></span> <span data-ttu-id="ce5c6-111">基になるメッセージングシステムでサポートされているプロパティの値は、必要な形式に変換されます。</span><span class="sxs-lookup"><span data-stu-id="ce5c6-111">The values of the properties that are supported by the underlying messaging system are translated into the required format.</span></span>
    
- <span data-ttu-id="ce5c6-112">トランスポートは MAPI TNEF メソッドを使用して、サポートされていないプロパティを1つのデータストリームにエンコードします。</span><span class="sxs-lookup"><span data-stu-id="ce5c6-112">The transport uses the MAPI TNEF methods to encode any unsupported properties into a single data stream.</span></span> <span data-ttu-id="ce5c6-113">その後、トランスポートは、メッセージを送信する前に、基になるメッセージングシステムの添付モデルを使用して、そのデータストリームを送信メッセージの特殊な添付ファイルに変換します。</span><span class="sxs-lookup"><span data-stu-id="ce5c6-113">The transport then turns that data stream into a special attachment on the outgoing message, using the underlying messaging system's attachment model, before sending the message.</span></span>
    
- <span data-ttu-id="ce5c6-114">このようなメッセージを受信する TNEF が有効なトランスポートでは、2つの処理が行われます。</span><span class="sxs-lookup"><span data-stu-id="ce5c6-114">A TNEF enabled transport that receives such a message does two things.</span></span> <span data-ttu-id="ce5c6-115">最初に、受信メッセージのプロパティ (基礎となるメッセージシステムでサポートされているもの) を MAPI プロパティに変換します。</span><span class="sxs-lookup"><span data-stu-id="ce5c6-115">First, it translates the incoming message's properties — the ones supported by the underlying message system — into MAPI properties.</span></span> <span data-ttu-id="ce5c6-116">2番目に、特殊な添付ファイルが存在する場合は、mapi TNEF メソッドを使用して、添付ファイルからその他の mapi プロパティを取得してから、メッセージをクライアントアプリケーションに配信します。</span><span class="sxs-lookup"><span data-stu-id="ce5c6-116">Second, if the special attachment is present, it uses the MAPI TNEF methods to retrieve additional MAPI properties from the attachment before delivering the message to a client application.</span></span>
    
<span data-ttu-id="ce5c6-117">mapi には、TNEF オブジェクトを処理するときに mapi トランスポートプロバイダーが使用する**ITnef**インターフェイスの実装が用意されています。</span><span class="sxs-lookup"><span data-stu-id="ce5c6-117">MAPI supplies an implementation of the **ITnef** interface for use by MAPI transport providers when working with TNEF objects.</span></span> <span data-ttu-id="ce5c6-118">[OpenTnefStreamEx](opentnefstreamex.md)関数を使用して、TNEF オブジェクトを作成し、それをメッセージに関連付けます。</span><span class="sxs-lookup"><span data-stu-id="ce5c6-118">The [OpenTnefStreamEx](opentnefstreamex.md) function is used to create TNEF objects and associate them with a message.</span></span> <span data-ttu-id="ce5c6-119">TNEF ストリームは、OLE **IStream**インターフェイスの上に構築されます。</span><span class="sxs-lookup"><span data-stu-id="ce5c6-119">TNEF streams are built on top of the OLE **IStream** interface</span></span> 
  
> [!NOTE]
> <span data-ttu-id="ce5c6-120">TNEF オブジェクトを作成するには、 **OpenTnefStreamEx**を使用します。</span><span class="sxs-lookup"><span data-stu-id="ce5c6-120">You use **OpenTnefStreamEx** to create TNEF objects.</span></span> <span data-ttu-id="ce5c6-121">古い**OpenTnefStream**関数は、古いソースコードとの互換性を維持するために存在し、新しい内容では使用できません。</span><span class="sxs-lookup"><span data-stu-id="ce5c6-121">The old **OpenTnefStream** function still exists for compatibility with old source code and should not be used in anything new.</span></span> 
  
<span data-ttu-id="ce5c6-122">**ITnef**インターフェイスには、次のメソッドが用意されています。</span><span class="sxs-lookup"><span data-stu-id="ce5c6-122">The **ITnef** interface provides the following methods:</span></span> 
  
- [<span data-ttu-id="ce5c6-123">addprops</span><span class="sxs-lookup"><span data-stu-id="ce5c6-123">AddProps</span></span>](itnef-addprops.md)
    
- [<span data-ttu-id="ce5c6-124">EncodeRecips</span><span class="sxs-lookup"><span data-stu-id="ce5c6-124">EncodeRecips</span></span>](itnef-encoderecips.md)
    
- [<span data-ttu-id="ce5c6-125">ExtractProps</span><span class="sxs-lookup"><span data-stu-id="ce5c6-125">ExtractProps</span></span>](itnef-extractprops.md)
    
- [<span data-ttu-id="ce5c6-126">Finish</span><span class="sxs-lookup"><span data-stu-id="ce5c6-126">Finish</span></span>](itnef-finish.md)
    
- [<span data-ttu-id="ce5c6-127">finish コンポーネント</span><span class="sxs-lookup"><span data-stu-id="ce5c6-127">FinishComponent</span></span>](itnef-finishcomponent.md)
    
- [<span data-ttu-id="ce5c6-128">OpenTaggedBody</span><span class="sxs-lookup"><span data-stu-id="ce5c6-128">OpenTaggedBody</span></span>](itnef-opentaggedbody.md)
    
- [<span data-ttu-id="ce5c6-129">setprops による</span><span class="sxs-lookup"><span data-stu-id="ce5c6-129">SetProps</span></span>](itnef-setprops.md)
    
<span data-ttu-id="ce5c6-130">MAPI TNEF 実装モデルは次の機能をサポートしています。</span><span class="sxs-lookup"><span data-stu-id="ce5c6-130">The MAPI TNEF implementation model supports:</span></span>
  
- <span data-ttu-id="ce5c6-131">他のメッセージプロパティに影響を与えることなく、すべての MAPI プロパティ。</span><span class="sxs-lookup"><span data-stu-id="ce5c6-131">All MAPI properties without affecting other message properties.</span></span> <span data-ttu-id="ce5c6-132">メッセージングシステムを介してトランスポートが送信されないようにするためには、メッセージングシステムのプロパティとしてエンコードできないすべてのプロパティをカプセル化する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ce5c6-132">In order for MAPI messages to survive transport through a messaging system, all properties that cannot be encoded as properties of the messaging system must be encapsulated.</span></span> <span data-ttu-id="ce5c6-133">mapi 準拠のクライアントがメッセージを受信するかどうかにかかわらずメッセージが送信されるときにはほとんど知られていないため、カプセル化スキームを使用すると、メッセージングシステムが提供していない mapi メッセージのプロパティのみをエンコードすることができます。ネイティブサポート。</span><span class="sxs-lookup"><span data-stu-id="ce5c6-133">Because it is almost never known at the time a message is sent whether or not a MAPI-compliant client will receive the message, the encapsulation scheme allows a transport provider to encode only those MAPI message properties that the messaging system does not natively support.</span></span> <span data-ttu-id="ce5c6-134">これは、TNEF を使用するメッセージが、SMTP ベースの UNIX メッセージングシステムなどの MAPI に基づいていないメッセージングシステムに対して "不明瞭" ではないことを意味します。</span><span class="sxs-lookup"><span data-stu-id="ce5c6-134">This means that messages which use TNEF are not "opaque" to messaging systems that are not based on MAPI such as SMTP-based UNIX messaging systems.</span></span> <span data-ttu-id="ce5c6-135">これらのシステムは、一般的な方法でサポートされているプロパティを受け取ります。その他のプロパティは、エンコードされた TNEF データストリームとして受け取ることができます。</span><span class="sxs-lookup"><span data-stu-id="ce5c6-135">These systems receive the properties they support in whatever manner is typical for them, and other properties are received as an encoded TNEF data stream.</span></span> <span data-ttu-id="ce5c6-136">TNEF トランスポートプロバイダーは、これら2つのプロパティセットを区別し、メッセージングシステムに対して適切な方法でサポートされているセットを送信する役割を担います。</span><span class="sxs-lookup"><span data-stu-id="ce5c6-136">The TNEF transport provider is responsible for differentiating between these two sets of properties and sending the supported set in the proper manner for the messaging system.</span></span> <span data-ttu-id="ce5c6-137">TNEF は、メッセージングシステムによって提供されるサポートのレベルについての仮定を行いません。</span><span class="sxs-lookup"><span data-stu-id="ce5c6-137">TNEF makes no assumptions as to the level of support provided by a messaging system.</span></span> <span data-ttu-id="ce5c6-138">ただし、このセクションに記載されている TNEF 使用法の例では、メッセージングシステムがメッセージから1つ以上の添付ファイルをサポートしていることを前提としています。</span><span class="sxs-lookup"><span data-stu-id="ce5c6-138">However, in the examples of TNEF usage included in this section, the assumption is made that the messaging system supports at least one single attachment aside from the message.</span></span> <span data-ttu-id="ce5c6-139">場合によっては、添付ファイルは、uuencode ストリームを介してのみサポートされ、メッセージテキストの一部として送信できます。</span><span class="sxs-lookup"><span data-stu-id="ce5c6-139">In some cases, the attachment can only be supported through a uuencoded stream and transmitted as part of the message text.</span></span> <span data-ttu-id="ce5c6-140">非常にまれな状況でのみ、メッセージングシステムでは、すべてのプロパティの完全な TNEF エンコードを必要とするメッセージプロパティのサポートがほとんど行われません。</span><span class="sxs-lookup"><span data-stu-id="ce5c6-140">Only in very rare circumstances will the messaging system have so little support for message properties that full TNEF encoding of all properties is necessary.</span></span>
    
- <span data-ttu-id="ce5c6-141">MAPI プロパティの**PR_TNEF_CORRELATION_KEY** ([PidTagTnefCorrelationKey](pidtagtnefcorrelationkey-canonical-property.md)) に基づいて、受信メッセージの TNEF ストリームがメッセージに属するかどうかを判断するメカニズム。</span><span class="sxs-lookup"><span data-stu-id="ce5c6-141">A mechanism for determining whether a TNEF stream on an incoming message belongs to the message, based on the MAPI property **PR_TNEF_CORRELATION_KEY** ([PidTagTnefCorrelationKey](pidtagtnefcorrelationkey-canonical-property.md)).</span></span> <span data-ttu-id="ce5c6-142">このプロパティは、TNEF ストリームおよび適切なメッセージヘッダーの両方で見つける必要があります。</span><span class="sxs-lookup"><span data-stu-id="ce5c6-142">This property should be found both in the TNEF stream and in an appropriate message header.</span></span> <span data-ttu-id="ce5c6-143">プロパティが両方の場所で同じ値を持つ場合、またはいずれかの場所に存在しない場合は、TNEF ストリームはメッセージに属していると見なされます。</span><span class="sxs-lookup"><span data-stu-id="ce5c6-143">If the property has the same value in both places, or is missing in either place, the TNEF stream is assumed to belong to the message.</span></span> <span data-ttu-id="ce5c6-144">それ以外の場合、TNEF ストリームは無視されます。</span><span class="sxs-lookup"><span data-stu-id="ce5c6-144">Otherwise, the TNEF stream is ignored.</span></span> <span data-ttu-id="ce5c6-145">tnef 対応トランスポートは、送信メッセージでこのプロパティの値を選択し、それを適切なメッセージヘッダー (たとえば、SMTP メッセージのメッセージ ID: ヘッダー) および TNEF ストリームでエンコードすることを担当します。</span><span class="sxs-lookup"><span data-stu-id="ce5c6-145">TNEF enabled transports are responsible for choosing a value for this property on outbound messages and encoding it in an appropriate message header (for example, the Message-ID: header for SMTP messages) and in the TNEF stream.</span></span>
    

