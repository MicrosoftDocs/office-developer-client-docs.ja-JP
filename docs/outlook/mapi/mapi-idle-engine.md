---
title: MAPI アイドルエンジン
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 755d096a-2a61-44d2-a765-5d464a857756
description: '最終更新日: 2015 年 3 月 9 日'
ms.openlocfilehash: d8d591c02bb621c16a1d1b46272b19573ea79785
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/28/2019
ms.locfileid: "33428453"
---
# <a name="mapi-idle-engine"></a>MAPI アイドルエンジン

  
  
**適用対象**: Outlook 2013 | Outlook 2016 
  
MAPI には、「idle engine」と総称されるいくつかの機能があります。 これらの関数を使用すると、クライアント、アドレス帳プロバイダー、およびメッセージストアプロバイダーは、セッションの遅延時間にさまざまなタスクを実行したり、時間がかかりすぎたりすることができます。 たとえば、クライアントとサービスプロバイダーは低速な操作を延期したり、使用されなくなったファイルを長期間閉じたりすることができます。 通常、トランスポートプロバイダーは、 **IXPLogon:: idle**メソッドによって実行されるので、アイドルエンジンを使用しません。 詳細については、「 [IXPLogon:: Idle](ixplogon-idle.md)」を参照してください。
  
アイドル状態のエンジンを使用するために、クライアントとサービスプロバイダーは、MAPI サブシステムがアイドル状態のときに実行する必要のあるタスクを含むコールバック関数を作成します。 MAPI がアイドル時間を検出すると、このコールバック関数が呼び出されます。 callback 関数は、次のように定義された**FNIDLE**プロトタイプに従います。 
  
 `BOOL (STDAPICALLTYPE FNIDLE) (LPVOID lpvContext)`
  
詳細については、「 [FNIDLE](fnidle.md)」を参照してください。
  
アイドル状態のエンジンを構成する関数は次のとおりです。
  
[ChangeIdleRoutine](changeidleroutine.md)
  
[DeregisterIdleRoutine](deregisteridleroutine.md)
  
[EnableIdleRoutine](enableidleroutine.md)
  
[FtgRegisterIdleRoutine](ftgregisteridleroutine.md)
  
[MAPIDeInitIdle](mapideinitidle.md)
  
[MAPIInitIdle](mapiinitidle.md)
  
コールバック関数を登録するには、クライアントとサービスプロバイダーが**FtgRegisterIdleRoutine**関数を呼び出します。 入力パラメーターには、オプションの優先度、入力としてコールバック関数に渡されるメモリブロック、任意の方法で使用される時間、およびオプションフラグのセットが含まれます。 
  
クライアントおよびサービスプロバイダーは、アイドル_状態_の関数の実行方法を制御する優先度を指定するか、優先度が問題でない場合は0を指定することができます。 負の数値は正の数または0より高い優先度を表しているため、圧縮と検索の操作には負の数を割り当てる必要があります。 1回発生するタスクには、正の数を割り当てる必要があります。 
  
アクティブなコールバック関数を登録解除するために、クライアントとサービスプロバイダーは**DeregisterIdleRoutine**関数を呼び出します。 **DeregisterIdleRoutine**は非同期的に動作するため、登録解除の呼び出し中にコールバック関数を呼び出すことができます。 **DeregisterIdleRoutine**が返された後でも、いつでも呼び出すことができます。 
  
コールバック関数の一部またはすべての特性を変更するには、クライアントおよびサービスプロバイダーが**changeidleroutine**関数を呼び出します。 **changeidleroutine**は、フラグパラメーターが_ircidle_に設定されている方法に従って変更を行います。**changeidleroutine**は、関数自体、その priority、time 設定、および入力パラメーターを変更することができます。 
  
オペレーティングシステムに定義がある場合、MAPI はオペレーティングシステムと同じアイドル状態を定義します。 Win32 では、アイドル状態のタスクをスケジュールするために、MAPI がアイドルクラスの優先順位を持つスレッドを作成します。 このスレッドは、時間の追跡を行い、実行時間が到来したときにアイドルタスクを実行するために、スレッドにメッセージを投稿します。 Win32 は、プロセスではなく、スレッドをスケジュールします。 優先度の高いタスクがワークステーション上で実行されている場合は、タスクが完了するまで、アイドルタスクがスケジュールされないようにする必要があります。 
  
すべてのアイドルタスクは、 **MAPIInitIdle**を呼び出したスレッドで実行されます。 MAPI は、スケジュール設定に別のスレッドを持っていますが、アイドルタスクが対象となる場合は、初期化スレッドにメッセージをポストバックし、そこでアイドルタスクを実行します。 クライアントの種類によって、次のような影響があります。
  
|**スレッドモデル**|**暗黙**|
|:-----|:-----|
|シングルスレッド  <br/> |大丈夫。 Idle 関数は、クライアントのメインスレッドで実行され、メッセージループを介してシリアル化されます。  <br/> |
|フリースレッド  <br/> |アイドル関数はスレッドセーフである必要がありますが、クライアントには既に必要なインフラストラクチャがあります。 クライアントでは、MAPI アイドルエンジンがまったく必要ない場合があります。  <br/> |
|アパートメントスレッド  <br/> |アイドル関数は、MAPI、OLE、またはその他の COM インターフェイスを使用する場合に、それを登録したのと同じスレッドで実行する必要があります。 最も簡単な方法は、メッセージを右のスレッドに投稿して、そのスレッドのメッセージループから直接 "real" idle 関数をディスパッチする、MAPI を使用して idle 関数を登録する方法です。  <br/> |
   

