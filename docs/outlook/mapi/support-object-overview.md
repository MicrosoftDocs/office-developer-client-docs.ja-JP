---
title: サポート オブジェクトの概要
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 5b062891-39ab-4334-9706-5b376719d5e4
description: '最終更新日: 2011 年 7 月 23 日'
ms.openlocfilehash: 55d8a9c78ae5132eaa8cf0f0aec5b252ef83b926
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/28/2019
ms.locfileid: "33433613"
---
# <a name="support-object-overview"></a><span data-ttu-id="f2bf4-103">サポート オブジェクトの概要</span><span class="sxs-lookup"><span data-stu-id="f2bf4-103">Support Object Overview</span></span>

  
  
<span data-ttu-id="f2bf4-104">**適用対象**: Outlook 2013 | Outlook 2016</span><span class="sxs-lookup"><span data-stu-id="f2bf4-104">**Applies to**: Outlook 2013 | Outlook 2016</span></span> 
  
<span data-ttu-id="f2bf4-105">MAPI は [、IMAPISupport : IUnknown](imapisupportiunknown.md) インターフェイスを実装するオブジェクトであるサポート オブジェクトを、ログオン中のすべてのサービス プロバイダーと構成中のすべてのメッセージ サービスに提供します。</span><span class="sxs-lookup"><span data-stu-id="f2bf4-105">MAPI furnishes a support object, an object that implements the [IMAPISupport : IUnknown](imapisupportiunknown.md) interface, for all service providers during logon and for all message services during configuration.</span></span> 
  
<span data-ttu-id="f2bf4-106">サポート オブジェクトはクライアントからアクセスできない。MAPI によって実装され、サービス プロバイダーによってのみ呼び出されます。</span><span class="sxs-lookup"><span data-stu-id="f2bf4-106">Support objects are not accessible by clients; they are implemented by MAPI and called only by service providers.</span></span> <span data-ttu-id="f2bf4-107">**IMAPISupport インターフェイス** は Mapispi.h ヘッダー ファイルで指定されます。</span><span class="sxs-lookup"><span data-stu-id="f2bf4-107">The **IMAPISupport** interface is specified in the Mapispi.h header file.</span></span> <span data-ttu-id="f2bf4-108">その識別子はIID_IMAPISup、ポインターの種類は LPMAPISUP です。</span><span class="sxs-lookup"><span data-stu-id="f2bf4-108">Its identifier is IID_IMAPISup and its pointer type is LPMAPISUP.</span></span> <span data-ttu-id="f2bf4-109">MAPI プロパティはサポート オブジェクトによって公開されません。</span><span class="sxs-lookup"><span data-stu-id="f2bf4-109">No MAPI properties are exposed by support objects.</span></span> 
  
<span data-ttu-id="f2bf4-110">プロバイダーには、MAPI がプロバイダーをログオンする回数、またはプロバイダーのメッセージ サービス エントリ関数が呼び出された回数に応じて、1 つ以上のサポート オブジェクトを指定できます。</span><span class="sxs-lookup"><span data-stu-id="f2bf4-110">A provider can be given one or more support objects, depending on the number of times MAPI logs the provider on or the number of times the provider's message service entry function is called.</span></span> <span data-ttu-id="f2bf4-111">通常、プロバイダーはセッションごとに少なくとも 1 回ログオンします。</span><span class="sxs-lookup"><span data-stu-id="f2bf4-111">Typically, a provider will be logged on at least once per session.</span></span> <span data-ttu-id="f2bf4-112">アドレス帳とトランスポート プロバイダーは、クライアントが要求するプロファイル エントリでセッションを開始する度にログオンします。</span><span class="sxs-lookup"><span data-stu-id="f2bf4-112">Address book and transport providers are logged on every time a client starts a session with a profile entry that requests them.</span></span> <span data-ttu-id="f2bf4-113">メッセージ ストア プロバイダーは、クライアントが [IMAPISession::OpenMsgStore](imapisession-openmsgstore.md) メソッドを呼び出す度にログオンします。</span><span class="sxs-lookup"><span data-stu-id="f2bf4-113">Message store providers are logged on every time a client calls the [IMAPISession::OpenMsgStore](imapisession-openmsgstore.md) method.</span></span> 
  
<span data-ttu-id="f2bf4-114">セッション内の複数のログオンの場合は、各サポート オブジェクトを個別に保持して使用するか、1 つ目のサポート オブジェクトのみを保持して使用するかのどちらかを選択し、後続の各サポート オブジェクトを破棄します。</span><span class="sxs-lookup"><span data-stu-id="f2bf4-114">In the case of multiple logons in a session, you can choose either to retain and use each support object separately or to retain and use only the first, discarding each subsequent support object.</span></span> <span data-ttu-id="f2bf4-115">サポート オブジェクトを保持するには、 **その IUnknown::AddRef メソッドを呼び出** します。</span><span class="sxs-lookup"><span data-stu-id="f2bf4-115">To retain a support object, call its **IUnknown::AddRef** method.</span></span> <span data-ttu-id="f2bf4-116">セッション **全体で保持** するサポート オブジェクトで AddRef を呼び出すのは非常に重要です。呼び出しが行われた場合、MAPI はサポート オブジェクトを解放し、そのメモリを解放します。</span><span class="sxs-lookup"><span data-stu-id="f2bf4-116">Calling **AddRef** on a support object that you want to retain throughout a session is extremely important; if the call is not made, MAPI releases the support object and frees its memory.</span></span> 
  
<span data-ttu-id="f2bf4-117">サポート オブジェクトの目的は、プロバイダーが一般的に使用するメソッドの数がかなり多い場合に実装を提供します。</span><span class="sxs-lookup"><span data-stu-id="f2bf4-117">The purpose of the support object is to provide implementations for a fairly large number of methods commonly used by the providers.</span></span> <span data-ttu-id="f2bf4-118">各サポート オブジェクトには、プロバイダーが実行しているセッション、プロバイダーが使用しているプロファイル セクション、セッションのエラー情報など、独自のインスタンスに固有のコンテキスト データも含まれる。</span><span class="sxs-lookup"><span data-stu-id="f2bf4-118">Each support object also contains contextual data specific to its own instance, such as the session the provider is running in, the profile section the provider is using, and error information for the session.</span></span> 
  
<span data-ttu-id="f2bf4-119">サポート オブジェクトには、主要なプロバイダーの種類 (アドレス帳、メッセージ ストア、トランスポート) ごとに 1 つ、構成サポート用の 4 種類があります。</span><span class="sxs-lookup"><span data-stu-id="f2bf4-119">There are four different types of support objects: one for each major provider type (address book, message store, and transport) and one for configuration support.</span></span> 
  
<span data-ttu-id="f2bf4-120">MAPI では、使用に関連するメソッドの実装を含めて、各サポート オブジェクトをカスタマイズします。</span><span class="sxs-lookup"><span data-stu-id="f2bf4-120">MAPI customizes each support object by including implementations of methods that are relevant for its usage.</span></span> <span data-ttu-id="f2bf4-121">[IMAPISupport::OpenProfileSection](imapisupport-openprofilesection.md)などの一部のメソッドの実装は、すべてのサポート オブジェクトに含まれています。</span><span class="sxs-lookup"><span data-stu-id="f2bf4-121">Implementations of some methods, such as [IMAPISupport::OpenProfileSection](imapisupport-openprofilesection.md), are included in all support objects.</span></span> <span data-ttu-id="f2bf4-122">[IMAPISupport::SpoolerNotify](imapisupport-spoolernotify.md)などの他のメソッドの実装は、特定のサポート オブジェクトにのみ適用されます。</span><span class="sxs-lookup"><span data-stu-id="f2bf4-122">Implementations of other methods, such as [IMAPISupport::SpoolerNotify](imapisupport-spoolernotify.md), apply only to particular support objects.</span></span> <span data-ttu-id="f2bf4-123">このメソッドを使用できるのは、メッセージ ストアとトランスポート プロバイダーのみです。アドレス帳プロバイダーまたはメッセージ サービスが呼び出しを試みた場合、MAPI はアドレス帳プロバイダーをMAPI_E_NO_SUPPORT。</span><span class="sxs-lookup"><span data-stu-id="f2bf4-123">Only message store and transport providers can use this method; when an address book provider or a message service try to call it, MAPI returns MAPI_E_NO_SUPPORT.</span></span>
  
<span data-ttu-id="f2bf4-124">サポート オブジェクトは、次のような多くのタスクを実行するために使用できます。</span><span class="sxs-lookup"><span data-stu-id="f2bf4-124">Support objects can be used to accomplish many tasks, such as the following:</span></span>
  
- <span data-ttu-id="f2bf4-125">プロファイル セクションへのアクセス。</span><span class="sxs-lookup"><span data-stu-id="f2bf4-125">Accessing a profile section.</span></span>
    
- <span data-ttu-id="f2bf4-126">フォルダーまたはメッセージのコピー。</span><span class="sxs-lookup"><span data-stu-id="f2bf4-126">Copying folders or messages.</span></span> <span data-ttu-id="f2bf4-127">詳細については、「メッセージまたは [フォルダーのコピーまたは移動」を参照してください](copying-or-moving-a-message-or-a-folder.md)。</span><span class="sxs-lookup"><span data-stu-id="f2bf4-127">For more information, see [Copying or Moving a Message or a Folder](copying-or-moving-a-message-or-a-folder.md).</span></span>
    
- <span data-ttu-id="f2bf4-128">他のプロバイダーに属するオブジェクトへのアクセス。</span><span class="sxs-lookup"><span data-stu-id="f2bf4-128">Accessing objects that belong to other providers.</span></span> <span data-ttu-id="f2bf4-129">詳細については、「Supporting [Object Access and Comparison」を参照してください](supporting-object-access-and-comparison.md)。</span><span class="sxs-lookup"><span data-stu-id="f2bf4-129">For more information, see [Supporting Object Access and Comparison](supporting-object-access-and-comparison.md).</span></span> 
    
- <span data-ttu-id="f2bf4-130">イベント通知の処理。</span><span class="sxs-lookup"><span data-stu-id="f2bf4-130">Handling event notification.</span></span> <span data-ttu-id="f2bf4-131">詳細については、「サポート イベント通知 [」を参照してください](supporting-event-notification.md)。</span><span class="sxs-lookup"><span data-stu-id="f2bf4-131">For more information, see [Supporting Event Notification](supporting-event-notification.md).</span></span>
    
- <span data-ttu-id="f2bf4-132">メモリの割り当てと解放。</span><span class="sxs-lookup"><span data-stu-id="f2bf4-132">Allocating and freeing memory.</span></span>
    
- <span data-ttu-id="f2bf4-133">一意の識別子を取得します。</span><span class="sxs-lookup"><span data-stu-id="f2bf4-133">Obtaining a unique identifier.</span></span>
    
- <span data-ttu-id="f2bf4-134">オブジェクトの無効化。</span><span class="sxs-lookup"><span data-stu-id="f2bf4-134">Invalidating objects.</span></span>
    
- <span data-ttu-id="f2bf4-135">エラーの処理。</span><span class="sxs-lookup"><span data-stu-id="f2bf4-135">Handling errors.</span></span>
    
- <span data-ttu-id="f2bf4-136">メッセージ プリプロセッサの登録。</span><span class="sxs-lookup"><span data-stu-id="f2bf4-136">Registering message preprocessors.</span></span> 
    
- <span data-ttu-id="f2bf4-137">メッセージ配信レポートの準備。</span><span class="sxs-lookup"><span data-stu-id="f2bf4-137">Preparing message delivery reports.</span></span> 
    
<span data-ttu-id="f2bf4-138">ログオン時に、MAPI は各サービス プロバイダーのプロバイダー オブジェクトのログオン メソッドを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="f2bf4-138">At logon time, MAPI calls the logon method of each service provider's provider object.</span></span> <span data-ttu-id="f2bf4-139">アドレス帳プロバイダーの場合、MAPI は [IABProvider::Logon を呼び出します](iabprovider-logon.md)。</span><span class="sxs-lookup"><span data-stu-id="f2bf4-139">For address book providers, MAPI calls [IABProvider::Logon](iabprovider-logon.md).</span></span> <span data-ttu-id="f2bf4-140">メッセージ ストア プロバイダーの場合、MAPI は [IMSProvider::Logon を呼び出します](imsprovider-logon.md)。</span><span class="sxs-lookup"><span data-stu-id="f2bf4-140">For message store providers, MAPI calls [IMSProvider::Logon](imsprovider-logon.md).</span></span> <span data-ttu-id="f2bf4-141">トランスポート プロバイダーの場合、MAPI は [IXPProvider::TransportLogon を呼び出します](ixpprovider-transportlogon.md)。</span><span class="sxs-lookup"><span data-stu-id="f2bf4-141">For transport providers, MAPI calls [IXPProvider::TransportLogon](ixpprovider-transportlogon.md).</span></span> <span data-ttu-id="f2bf4-142">MAPI は、パラメーターの 1 つで適切なサポート オブジェクトへのポインターをこのメソッドに渡します。</span><span class="sxs-lookup"><span data-stu-id="f2bf4-142">MAPI passes a pointer to the appropriate support object in one of the parameters to this method.</span></span> <span data-ttu-id="f2bf4-143">ログオン メソッドは、ログオン オブジェクトをインスタンス化し、サポート オブジェクト ポインターを渡します。</span><span class="sxs-lookup"><span data-stu-id="f2bf4-143">The logon method in turn instantiates a logon object, passing it the support object pointer.</span></span> <span data-ttu-id="f2bf4-144">ログオン オブジェクトは、必要に応じてサポート オブジェクト **の IUnknown::AddRef** メソッドを呼び出して保持します。</span><span class="sxs-lookup"><span data-stu-id="f2bf4-144">The logon object calls the support object's **IUnknown::AddRef** method to retain it, if necessary.</span></span> <span data-ttu-id="f2bf4-145">サービス プロバイダーのログオン プロセスの詳細については、「サービス プロバイダーの開始 [」を参照してください](starting-a-service-provider.md)。</span><span class="sxs-lookup"><span data-stu-id="f2bf4-145">For more information about the logon process for service providers, see [Starting a Service Provider](starting-a-service-provider.md).</span></span>
  
<span data-ttu-id="f2bf4-146">クライアントがログオフすると、MAPI はログオン オブジェクトの logoff メソッドを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="f2bf4-146">When a client logs off, MAPI calls the logon object's logoff method.</span></span> <span data-ttu-id="f2bf4-147">logoff メソッドは、サポート オブジェクトの **IUnknown::Release** メソッドを呼び出して、プロバイダーがサポート メソッドを呼び出す予定がなくなったかどうかを示します。</span><span class="sxs-lookup"><span data-stu-id="f2bf4-147">The logoff method calls the support object's **IUnknown::Release** method to indicate that the provider no longer intends to call any of the support methods.</span></span> <span data-ttu-id="f2bf4-148">ログオンと同様に、logoff メソッドの名前は若干異なります。</span><span class="sxs-lookup"><span data-stu-id="f2bf4-148">As with logon, the logoff methods have slightly different names.</span></span> <span data-ttu-id="f2bf4-149">[IABLogon インターフェイスと](iablogoniunknown.md) [IMSLogon](imslogoniunknown.md)インターフェイスには **Logoff メソッド** があります。[IXPLogon インターフェイス](ixplogoniunknown.md)には [TransportLogoff メソッド](ixplogon-transportlogoff.md)があります。</span><span class="sxs-lookup"><span data-stu-id="f2bf4-149">The [IABLogon](iablogoniunknown.md) and [IMSLogon](imslogoniunknown.md) interfaces have **Logoff** methods; the [IXPLogon](ixplogoniunknown.md) interface has a [TransportLogoff](ixplogon-transportlogoff.md) method.</span></span> 
  
<span data-ttu-id="f2bf4-150">メッセージ サービスエントリ ポイント関数は、ログオン試行が失敗した場合、またはクライアントが構成要求を開始MAPI_E_UNCONFIGUREDエラーが発生した場合に呼び出されます。</span><span class="sxs-lookup"><span data-stu-id="f2bf4-150">Message service entry point functions are called when a logon attempt fails with the error MAPI_E_UNCONFIGURED or when a client initiates a configuration request.</span></span> <span data-ttu-id="f2bf4-151">MAPI は、構成サポート オブジェクトをインスタンス化し、構成が変更されるプロバイダーまたは構成が変更されるプロバイダーのいずれかのメッセージ サービス エントリ ポイント関数を呼び出します。</span><span class="sxs-lookup"><span data-stu-id="f2bf4-151">MAPI instantiates a configuration support object and calls the message service entry point function for either the unconfigured provider or the provider whose configuration is about to change.</span></span> <span data-ttu-id="f2bf4-152">他のサポート オブジェクトとは異なり、構成サポート オブジェクトは、エントリ ポイント関数が返されるまで有効です。メッセージ サービスは、これらのオブジェクトを保持するために **これらのオブジェクトの AddRef** メソッドを呼び出しません。</span><span class="sxs-lookup"><span data-stu-id="f2bf4-152">Unlike the other support objects, configuration support objects are valid only until the entry point function returns; message services do not call these objects' **AddRef** methods to retain them.</span></span> 
  
<span data-ttu-id="f2bf4-153">通常、MAPI はプロバイダーのメッセージ サービス エントリ ポイント関数を呼び出しますが、プロバイダーに呼び出しを求めらる場合があります。</span><span class="sxs-lookup"><span data-stu-id="f2bf4-153">Typically, MAPI makes calls to a provider's message service entry point function, but sometimes a provider is asked to make the call.</span></span> <span data-ttu-id="f2bf4-154">これは、クライアントがプロバイダーの [IMAPIStatus::SettingsDialog](imapistatus-settingsdialog.md) メソッドを呼び出して、プロバイダーに構成プロパティ シートの表示を求めるメッセージを表示するときに発生することがあります。</span><span class="sxs-lookup"><span data-stu-id="f2bf4-154">This can occur when a client calls a provider's [IMAPIStatus::SettingsDialog](imapistatus-settingsdialog.md) method to prompt the provider to display its configuration property sheet.</span></span> <span data-ttu-id="f2bf4-155">**SettingsDialog は** [IMAPISupport::GetSvcConfigSupportObj](imapisupport-getsvcconfigsupportobj.md) を呼び出して、メッセージ サービス エントリ ポイント関数に渡す構成サポート オブジェクトを取得する必要があります。</span><span class="sxs-lookup"><span data-stu-id="f2bf4-155">**SettingsDialog** should call [IMAPISupport::GetSvcConfigSupportObj](imapisupport-getsvcconfigsupportobj.md) to obtain a configuration support object that it can pass to the message service entry point function.</span></span> 
  
<span data-ttu-id="f2bf4-156">[IMAPISupport::GetMemAllocRoutines](imapisupport-getmemallocroutines.md)メソッドは、MAPI とリンクすることなく、メモリ割り当ておよび割り当て解除関数のアドレスを決定するために使用できます。</span><span class="sxs-lookup"><span data-stu-id="f2bf4-156">The [IMAPISupport::GetMemAllocRoutines](imapisupport-getmemallocroutines.md) method is available for determining the addresses of the memory allocation and deallocation functions without having to link with MAPI.</span></span> <span data-ttu-id="f2bf4-157">**GetMemAllocRoutines** を使用すると、割り当て関数呼び出しをデバッグ コードで囲み、メモリ リークの追跡も容易になります。</span><span class="sxs-lookup"><span data-stu-id="f2bf4-157">Using **GetMemAllocRoutines** also makes it easier to trace memory leaks by surrounding the allocation function calls with debugging code.</span></span> <span data-ttu-id="f2bf4-158">**GetMemAllocRoutines** を呼び出す場合は、パラメーターとして割り当て関数のアドレスを必要とする [CreateIProp](createiprop.md)関数を呼び出す前に呼び出してください。</span><span class="sxs-lookup"><span data-stu-id="f2bf4-158">If you call **GetMemAllocRoutines**, as is recommended, do so before calling the [CreateIProp](createiprop.md) function, which requires the allocation function addresses as parameters.</span></span> 
  
<span data-ttu-id="f2bf4-159">新しいアドレス帳またはメッセージ ストア オブジェクトを作成する必要がある場合は、オブジェクトの検索キーを作成して、そのオブジェクトのプロパティ [(PidTagSearchKey)](pidtagsearchkey-canonical-property.md) **PR_SEARCH_KEY設定します**。</span><span class="sxs-lookup"><span data-stu-id="f2bf4-159">When you need to create a new address book or message store object, create and set a search key for the object in its **PR_SEARCH_KEY** ([PidTagSearchKey](pidtagsearchkey-canonical-property.md)) property.</span></span> <span data-ttu-id="f2bf4-160">[IMAPISupport::NewUID](imapisupport-newuid.md)を呼び出して、検索キーの作成に使用する一意の識別子を取得します。</span><span class="sxs-lookup"><span data-stu-id="f2bf4-160">Call [IMAPISupport::NewUID](imapisupport-newuid.md) to obtain a unique identifier to use in building a search key.</span></span> <span data-ttu-id="f2bf4-161">独自のハードコードされた [MAPIUID を使用しない](mapiuid.md)。</span><span class="sxs-lookup"><span data-stu-id="f2bf4-161">Do not use your own hard-coded [MAPIUID](mapiuid.md).</span></span> <span data-ttu-id="f2bf4-162">プロバイダーの **MAPIUID は** 、エントリ識別子にのみ使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="f2bf4-162">A provider's **MAPIUID** should be used only for entry identifiers.</span></span> <span data-ttu-id="f2bf4-163">検索キーの作成の詳細については、「MAPI レコードと [検索キー」を参照してください](mapi-record-and-search-keys.md)。</span><span class="sxs-lookup"><span data-stu-id="f2bf4-163">For more information about constructing search keys, see [MAPI Record and Search Keys](mapi-record-and-search-keys.md).</span></span>
  
<span data-ttu-id="f2bf4-164">クライアント アプリケーションは、1 つ以上の関連オブジェクトを解放せずにオブジェクトを解放できる場合があります。</span><span class="sxs-lookup"><span data-stu-id="f2bf4-164">A client application can sometimes release an object without releasing one or more of its affiliated objects.</span></span> <span data-ttu-id="f2bf4-165">このような場合、プロバイダーは、使用できない未発表のオブジェクトをレンダリングする必要があります。</span><span class="sxs-lookup"><span data-stu-id="f2bf4-165">In such a case, a provider may need to render an unreleased object unusable.</span></span> <span data-ttu-id="f2bf4-166">これを行うには、プロバイダーはオブジェクトに接続されているリソースをすべて解放し [、IMAPISupport::MakeInvalid](imapisupport-makeinvalid.md) を呼び出してオブジェクトの vtable を無効にします。</span><span class="sxs-lookup"><span data-stu-id="f2bf4-166">To do this, the provider frees all of the resources connected with the object and then calls [IMAPISupport::MakeInvalid](imapisupport-makeinvalid.md) to invalidate the object's vtable.</span></span> <span data-ttu-id="f2bf4-167">**MakeInvalid** は、vtable の **IUnknown** メソッド **(QueryInterface、AddRef、** および **Release)** を標準の MAPI 実装に置き換え、他のすべてのメソッドが MAPI_E_INVALID_OBJECT を返します。 </span><span class="sxs-lookup"><span data-stu-id="f2bf4-167">**MakeInvalid** replaces the vtable's **IUnknown** methods (**QueryInterface**, **AddRef**, and **Release**) with standard MAPI implementations and causes all other methods to return MAPI_E_INVALID_OBJECT.</span></span> <span data-ttu-id="f2bf4-168">**MakeInvalid は** 、vtable 以外のすべてのオブジェクトのメモリも解放します。</span><span class="sxs-lookup"><span data-stu-id="f2bf4-168">**MakeInvalid** also frees all the object's memory other than the vtable.</span></span> 
  
## <a name="see-also"></a><span data-ttu-id="f2bf4-169">関連項目</span><span class="sxs-lookup"><span data-stu-id="f2bf4-169">See also</span></span>



[<span data-ttu-id="f2bf4-170">MAPI サービス プロバイダー</span><span class="sxs-lookup"><span data-stu-id="f2bf4-170">MAPI Service Providers</span></span>](mapi-service-providers.md)

