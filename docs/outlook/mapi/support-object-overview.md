---
title: サポート オブジェクトの概要
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 5b062891-39ab-4334-9706-5b376719d5e4
description: '�ŏI�X�V��: 2011�N7��23��'
ms.openlocfilehash: ecc5439b4abbbfd920fba5456db7462f7967388f
ms.sourcegitcommit: 9d60cd82b5413446e5bc8ace2cd689f683fb41a7
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/11/2018
ms.locfileid: "19804022"
---
# <a name="support-object-overview"></a><span data-ttu-id="51082-103">サポート オブジェクトの概要</span><span class="sxs-lookup"><span data-stu-id="51082-103">Support Object Overview</span></span>

  
  
<span data-ttu-id="51082-104">**適用されます**: Outlook</span><span class="sxs-lookup"><span data-stu-id="51082-104">**Applies to**: Outlook</span></span> 
  
<span data-ttu-id="51082-105">MAPI をサポート オブジェクトを実装するオブジェクトを提供する、 [IMAPISupport: IUnknown](imapisupportiunknown.md)インタ フェースは、ログオン時にすべてのサービス プロバイダーとすべてのメッセージ サービスの構成中にします。</span><span class="sxs-lookup"><span data-stu-id="51082-105">MAPI furnishes a support object, an object that implements the [IMAPISupport : IUnknown](imapisupportiunknown.md) interface, for all service providers during logon and for all message services during configuration.</span></span> 
  
<span data-ttu-id="51082-106">サポート オブジェクトは、クライアントによってアクセスできません。MAPI によって実装されており、サービス ・ プロバイダーによってのみ呼び出されます。</span><span class="sxs-lookup"><span data-stu-id="51082-106">Support objects are not accessible by clients; they are implemented by MAPI and called only by service providers.</span></span> <span data-ttu-id="51082-107">**IMAPISupport**インターフェイスは、Mapispi.h ヘッダー ファイルで指定します。</span><span class="sxs-lookup"><span data-stu-id="51082-107">The **IMAPISupport** interface is specified in the Mapispi.h header file.</span></span> <span data-ttu-id="51082-108">その識別子は IID_IMAPISup で、そのポインター型は LPMAPISUP です。</span><span class="sxs-lookup"><span data-stu-id="51082-108">Its identifier is IID_IMAPISup and its pointer type is LPMAPISUP.</span></span> <span data-ttu-id="51082-109">サポート オブジェクトによって MAPI プロパティが公開されることはありません。</span><span class="sxs-lookup"><span data-stu-id="51082-109">No MAPI properties are exposed by support objects.</span></span> 
  
<span data-ttu-id="51082-110">プロバイダーは、プロバイダーのメッセージ サービスのエントリ関数が呼び出される回数または時間の MAPI ログオン プロバイダーの数に応じて、1 つ以上のサポート オブジェクトを得ることができます。</span><span class="sxs-lookup"><span data-stu-id="51082-110">A provider can be given one or more support objects, depending on the number of times MAPI logs the provider on or the number of times the provider's message service entry function is called.</span></span> <span data-ttu-id="51082-111">通常、プロバイダーは、セッションごとに少なくとも 1 回記録されます。</span><span class="sxs-lookup"><span data-stu-id="51082-111">Typically, a provider will be logged on at least once per session.</span></span> <span data-ttu-id="51082-112">アドレス帳およびトランスポート プロバイダーは、クライアントがそれらを要求するプロファイル エントリを持つセッションを起動するたびにログオンします。</span><span class="sxs-lookup"><span data-stu-id="51082-112">Address book and transport providers are logged on every time a client starts a session with a profile entry that requests them.</span></span> <span data-ttu-id="51082-113">メッセージ ストア プロバイダーは、クライアントが、 [IMAPISession::OpenMsgStore](imapisession-openmsgstore.md)メソッドを呼び出すたびにログオンします。</span><span class="sxs-lookup"><span data-stu-id="51082-113">Message store providers are logged on every time a client calls the [IMAPISession::OpenMsgStore](imapisession-openmsgstore.md) method.</span></span> 
  
<span data-ttu-id="51082-114">場合は複数のログオン セッションでは、ことができますいずれかを保持し、サポートの各オブジェクトを個別に使用するを保持し、最初のものだけを使用して、各後続のサポート オブジェクトを破棄すること。</span><span class="sxs-lookup"><span data-stu-id="51082-114">In the case of multiple logons in a session, you can choose either to retain and use each support object separately or to retain and use only the first, discarding each subsequent support object.</span></span> <span data-ttu-id="51082-115">サポート オブジェクトを保持するには、 **IUnknown::AddRef**メソッドを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="51082-115">To retain a support object, call its **IUnknown::AddRef** method.</span></span> <span data-ttu-id="51082-116">セッション全体で保持する必要があるサポート オブジェクトで**AddRef**を呼び出すことは、非常に重要です。呼び出しが行われない限り、MAPI はサポート オブジェクトを解放し、そのメモリを解放します。</span><span class="sxs-lookup"><span data-stu-id="51082-116">Calling **AddRef** on a support object that you want to retain throughout a session is extremely important; if the call is not made, MAPI releases the support object and frees its memory.</span></span> 
  
<span data-ttu-id="51082-117">サポート オブジェクトの目的は、かなり多数のプロバイダーで一般的に使用するメソッドの実装を提供すること。</span><span class="sxs-lookup"><span data-stu-id="51082-117">The purpose of the support object is to provide implementations for a fairly large number of methods commonly used by the providers.</span></span> <span data-ttu-id="51082-118">サポートの各オブジェクトには、プロバイダーは、プロバイダーを使用しているプロファイル] セクションで実行中のセッションなどの独自のインスタンスとセッションのエラー情報を特定のコンテキストのデータも含まれています。</span><span class="sxs-lookup"><span data-stu-id="51082-118">Each support object also contains contextual data specific to its own instance, such as the session the provider is running in, the profile section the provider is using, and error information for the session.</span></span> 
  
<span data-ttu-id="51082-119">サポート オブジェクトの 4 つの種類があります: 各 (アドレス帳、メッセージ ・ ストア、およびトランスポート) は、主なプロバイダーの種類と構成のサポートのいずれかのいずれかです。</span><span class="sxs-lookup"><span data-stu-id="51082-119">There are four different types of support objects: one for each major provider type (address book, message store, and transport) and one for configuration support.</span></span> 
  
<span data-ttu-id="51082-120">MAPI は、その使用法に関連付けられているメソッドの実装を含めることによって、サポートの各オブジェクトをカスタマイズします。</span><span class="sxs-lookup"><span data-stu-id="51082-120">MAPI customizes each support object by including implementations of methods that are relevant for its usage.</span></span> <span data-ttu-id="51082-121">サポートのすべてのオブジェクトには、 [IMAPISupport::OpenProfileSection](imapisupport-openprofilesection.md)などのいくつかのメソッドの実装が含まれます。</span><span class="sxs-lookup"><span data-stu-id="51082-121">Implementations of some methods, such as [IMAPISupport::OpenProfileSection](imapisupport-openprofilesection.md), are included in all support objects.</span></span> <span data-ttu-id="51082-122">[IMAPISupport::SpoolerNotify](imapisupport-spoolernotify.md)などの他のメソッドの実装は、特定のサポートのオブジェクトにのみ適用されます。</span><span class="sxs-lookup"><span data-stu-id="51082-122">Implementations of other methods, such as [IMAPISupport::SpoolerNotify](imapisupport-spoolernotify.md), apply only to particular support objects.</span></span> <span data-ttu-id="51082-123">のみメッセージ ストアと、トランスポート プロバイダーは、このメソッドを使用できます。アドレス帳プロバイダーまたはメッセージ サービスを呼び出すことと、MAPI は、MAPI_E_NO_SUPPORT を返します。</span><span class="sxs-lookup"><span data-stu-id="51082-123">Only message store and transport providers can use this method; when an address book provider or a message service try to call it, MAPI returns MAPI_E_NO_SUPPORT.</span></span>
  
<span data-ttu-id="51082-124">サポート オブジェクトは、次のような多くのタスクを実行する使用できます。</span><span class="sxs-lookup"><span data-stu-id="51082-124">Support objects can be used to accomplish many tasks, such as the following:</span></span>
  
- <span data-ttu-id="51082-125">プロファイル セクションへのアクセス。</span><span class="sxs-lookup"><span data-stu-id="51082-125">Accessing a profile section.</span></span>
    
- <span data-ttu-id="51082-126">フォルダーまたはメッセージをコピーしています。</span><span class="sxs-lookup"><span data-stu-id="51082-126">Copying folders or messages.</span></span> <span data-ttu-id="51082-127">詳細については、[コピーまたは移動するメッセージまたはフォルダー](copying-or-moving-a-message-or-a-folder.md)を参照してください。</span><span class="sxs-lookup"><span data-stu-id="51082-127">For more information, see [Copying or Moving a Message or a Folder](copying-or-moving-a-message-or-a-folder.md).</span></span>
    
- <span data-ttu-id="51082-128">他のプロバイダーに属しているオブジェクトにアクセスします。</span><span class="sxs-lookup"><span data-stu-id="51082-128">Accessing objects that belong to other providers.</span></span> <span data-ttu-id="51082-129">詳細については、[オブジェクトへのアクセスをサポートしているとの比較](supporting-object-access-and-comparison.md)を参照してください。</span><span class="sxs-lookup"><span data-stu-id="51082-129">For more information, see [Supporting Object Access and Comparison](supporting-object-access-and-comparison.md).</span></span> 
    
- <span data-ttu-id="51082-130">イベント通知を処理します。</span><span class="sxs-lookup"><span data-stu-id="51082-130">Handling event notification.</span></span> <span data-ttu-id="51082-131">詳細については、[イベント通知のサポート](supporting-event-notification.md)を参照してください。</span><span class="sxs-lookup"><span data-stu-id="51082-131">For more information, see [Supporting Event Notification](supporting-event-notification.md).</span></span>
    
- <span data-ttu-id="51082-132">割り当てとメモリを解放します。</span><span class="sxs-lookup"><span data-stu-id="51082-132">Allocating and freeing memory.</span></span>
    
- <span data-ttu-id="51082-133">一意の識別子を取得します。</span><span class="sxs-lookup"><span data-stu-id="51082-133">Obtaining a unique identifier.</span></span>
    
- <span data-ttu-id="51082-134">オブジェクトを無効にします。</span><span class="sxs-lookup"><span data-stu-id="51082-134">Invalidating objects.</span></span>
    
- <span data-ttu-id="51082-135">エラーを処理します。</span><span class="sxs-lookup"><span data-stu-id="51082-135">Handling errors.</span></span>
    
- <span data-ttu-id="51082-136">プリプロセッサのメッセージを登録しています。</span><span class="sxs-lookup"><span data-stu-id="51082-136">Registering message preprocessors.</span></span> 
    
- <span data-ttu-id="51082-137">メッセージの配信レポートを準備しています。</span><span class="sxs-lookup"><span data-stu-id="51082-137">Preparing message delivery reports.</span></span> 
    
<span data-ttu-id="51082-138">ログオン時に、MAPI は、各サービス プロバイダーのプロバイダー オブジェクトのログオン メソッドを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="51082-138">At logon time, MAPI calls the logon method of each service provider's provider object.</span></span> <span data-ttu-id="51082-139">アドレス帳プロバイダーでは、MAPI は、 [IABProvider::Logon](iabprovider-logon.md)を呼び出します。</span><span class="sxs-lookup"><span data-stu-id="51082-139">For address book providers, MAPI calls [IABProvider::Logon](iabprovider-logon.md).</span></span> <span data-ttu-id="51082-140">メッセージ ストア プロバイダーでは、MAPI は、 [IMSProvider::Logon](imsprovider-logon.md)を呼び出します。</span><span class="sxs-lookup"><span data-stu-id="51082-140">For message store providers, MAPI calls [IMSProvider::Logon](imsprovider-logon.md).</span></span> <span data-ttu-id="51082-141">トランスポート プロバイダーでは、MAPI は、 [IXPProvider::TransportLogon](ixpprovider-transportlogon.md)を呼び出します。</span><span class="sxs-lookup"><span data-stu-id="51082-141">For transport providers, MAPI calls [IXPProvider::TransportLogon](ixpprovider-transportlogon.md).</span></span> <span data-ttu-id="51082-142">MAPI は、このメソッドのパラメーターのいずれかで適切なサポート オブジェクトへのポインターを渡します。</span><span class="sxs-lookup"><span data-stu-id="51082-142">MAPI passes a pointer to the appropriate support object in one of the parameters to this method.</span></span> <span data-ttu-id="51082-143">ログオン方法には、サポート オブジェクトへのポインターを渡すこと、ログオン オブジェクトがインスタンス化します。</span><span class="sxs-lookup"><span data-stu-id="51082-143">The logon method in turn instantiates a logon object, passing it the support object pointer.</span></span> <span data-ttu-id="51082-144">ログオン オブジェクトは、必要な場合に、その維持のサポート オブジェクトの**IUnknown::AddRef**メソッドを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="51082-144">The logon object calls the support object's **IUnknown::AddRef** method to retain it, if necessary.</span></span> <span data-ttu-id="51082-145">サービス プロバイダーの詳細については、ログオン プロセスは、[サービス プロバイダーの起動](starting-a-service-provider.md)を参照してください。</span><span class="sxs-lookup"><span data-stu-id="51082-145">For more information about the logon process for service providers, see [Starting a Service Provider](starting-a-service-provider.md).</span></span>
  
<span data-ttu-id="51082-146">クライアントがログオフすると、MAPI は、ログオン オブジェクトのログオフのメソッドを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="51082-146">When a client logs off, MAPI calls the logon object's logoff method.</span></span> <span data-ttu-id="51082-147">ログオフ メソッドでは、プロバイダーがサポートされている方法のいずれかを呼び出すため不要になった意図を示すためにサポート オブジェクトの**リ ス**のメソッドを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="51082-147">The logoff method calls the support object's **IUnknown::Release** method to indicate that the provider no longer intends to call any of the support methods.</span></span> <span data-ttu-id="51082-148">同様に、ログオンは、ログオフの方法は、わずかに異なる名前を持ちます。</span><span class="sxs-lookup"><span data-stu-id="51082-148">As with logon, the logoff methods have slightly different names.</span></span> <span data-ttu-id="51082-149">[IABLogon](iablogoniunknown.md)および[IMSLogon](imslogoniunknown.md)インタ フェースがある**ログオフ**の方法です。[IXPLogon](ixplogoniunknown.md)インターフェイスには、 [TransportLogoff](ixplogon-transportlogoff.md)メソッドがあります。</span><span class="sxs-lookup"><span data-stu-id="51082-149">The [IABLogon](iablogoniunknown.md) and [IMSLogon](imslogoniunknown.md) interfaces have **Logoff** methods; the [IXPLogon](ixplogoniunknown.md) interface has a [TransportLogoff](ixplogon-transportlogoff.md) method.</span></span> 
  
<span data-ttu-id="51082-150">メッセージ サービスのエントリ ポイント関数は、MAPI_E_UNCONFIGURED エラーが発生したか、クライアント構成要求を開始すると、ログオンの試行が失敗したときに呼び出されます。</span><span class="sxs-lookup"><span data-stu-id="51082-150">Message service entry point functions are called when a logon attempt fails with the error MAPI_E_UNCONFIGURED or when a client initiates a configuration request.</span></span> <span data-ttu-id="51082-151">MAPI では、構成のサポート オブジェクトをインスタンス化し、未構成のプロバイダーまたはプロバイダーの構成は変更するのいずれかのメッセージ サービスのエントリ ポイント関数を呼び出します。</span><span class="sxs-lookup"><span data-stu-id="51082-151">MAPI instantiates a configuration support object and calls the message service entry point function for either the unconfigured provider or the provider whose configuration is about to change.</span></span> <span data-ttu-id="51082-152">オブジェクトと異なり、その他のサポート、構成のサポート オブジェクトは、有効なエントリ ポイントの関数の戻り値までの間だけメッセージ サービスは、それらを保持するのには、これらのオブジェクトの**AddRef**メソッドを呼び出さないようにします。</span><span class="sxs-lookup"><span data-stu-id="51082-152">Unlike the other support objects, configuration support objects are valid only until the entry point function returns; message services do not call these objects' **AddRef** methods to retain them.</span></span> 
  
<span data-ttu-id="51082-153">通常、MAPI プロバイダーのメッセージ サービスのエントリ ポイント関数を呼び出すは、呼び出しを行うプロバイダーが要求する場合があります。</span><span class="sxs-lookup"><span data-stu-id="51082-153">Typically, MAPI makes calls to a provider's message service entry point function, but sometimes a provider is asked to make the call.</span></span> <span data-ttu-id="51082-154">これは、クライアントが、構成のプロパティ シートを表示するのにはプロバイダーに確認する、プロバイダーの[IMAPIStatus::SettingsDialog](imapistatus-settingsdialog.md)メソッドを呼び出すときに発生します。</span><span class="sxs-lookup"><span data-stu-id="51082-154">This can occur when a client calls a provider's [IMAPIStatus::SettingsDialog](imapistatus-settingsdialog.md) method to prompt the provider to display its configuration property sheet.</span></span> <span data-ttu-id="51082-155">**SettingsDialog**は、メッセージ サービスのエントリ ポイント関数に渡すことができる、構成のサポート オブジェクトを取得する[IMAPISupport::GetSvcConfigSupportObj](imapisupport-getsvcconfigsupportobj.md)を呼び出す必要があります。</span><span class="sxs-lookup"><span data-stu-id="51082-155">**SettingsDialog** should call [IMAPISupport::GetSvcConfigSupportObj](imapisupport-getsvcconfigsupportobj.md) to obtain a configuration support object that it can pass to the message service entry point function.</span></span> 
  
<span data-ttu-id="51082-156">[IMAPISupport::GetMemAllocRoutines](imapisupport-getmemallocroutines.md)メソッドは、MAPI を使用してリンクすることがなくメモリの割り当ておよび割り当て解除関数のアドレスを決定するために使用します。</span><span class="sxs-lookup"><span data-stu-id="51082-156">The [IMAPISupport::GetMemAllocRoutines](imapisupport-getmemallocroutines.md) method is available for determining the addresses of the memory allocation and deallocation functions without having to link with MAPI.</span></span> <span data-ttu-id="51082-157">**GetMemAllocRoutines**を使用しても簡単にコードのデバッグの割り当て関数の呼び出しを囲むと、メモリ リークを追跡します。</span><span class="sxs-lookup"><span data-stu-id="51082-157">Using **GetMemAllocRoutines** also makes it easier to trace memory leaks by surrounding the allocation function calls with debugging code.</span></span> <span data-ttu-id="51082-158">呼び出す場合は**GetMemAllocRoutines**を勧め、パラメーターとして割り当て関数のアドレスを必要とする、 [CreateIProp](createiprop.md)関数を呼び出す前にするようにします。</span><span class="sxs-lookup"><span data-stu-id="51082-158">If you call **GetMemAllocRoutines**, as is recommended, do so before calling the [CreateIProp](createiprop.md) function, which requires the allocation function addresses as parameters.</span></span> 
  
<span data-ttu-id="51082-159">作成する必要がある場合、新しいアドレス帳やメッセージ ストア オブジェクトを作成した、 **PR_SEARCH_KEY** ([PidTagSearchKey](pidtagsearchkey-canonical-property.md)) のプロパティで、オブジェクトの検索キーを設定します。</span><span class="sxs-lookup"><span data-stu-id="51082-159">When you need to create a new address book or message store object, create and set a search key for the object in its **PR_SEARCH_KEY** ([PidTagSearchKey](pidtagsearchkey-canonical-property.md)) property.</span></span> <span data-ttu-id="51082-160">検索キーの作成に使用する一意の識別子を取得するのには[IMAPISupport::NewUID](imapisupport-newuid.md)を呼び出します。</span><span class="sxs-lookup"><span data-stu-id="51082-160">Call [IMAPISupport::NewUID](imapisupport-newuid.md) to obtain a unique identifier to use in building a search key.</span></span> <span data-ttu-id="51082-161">独自ハード コードされた[MAPIUID](mapiuid.md)を使用しません。</span><span class="sxs-lookup"><span data-stu-id="51082-161">Do not use your own hard-coded [MAPIUID](mapiuid.md).</span></span> <span data-ttu-id="51082-162">プロバイダーの**MAPIUID**は、エントリの識別子にのみ使用してください。</span><span class="sxs-lookup"><span data-stu-id="51082-162">A provider's **MAPIUID** should be used only for entry identifiers.</span></span> <span data-ttu-id="51082-163">検索キーを作成することに関する詳細については、 [MAPI の記録と検索キー](mapi-record-and-search-keys.md)を参照してください。</span><span class="sxs-lookup"><span data-stu-id="51082-163">For more information about constructing search keys, see [MAPI Record and Search Keys](mapi-record-and-search-keys.md).</span></span>
  
<span data-ttu-id="51082-164">クライアント アプリケーションは、1 つまたは複数の関連オブジェクトのボタンを押したままオブジェクトを解放することができる場合があります。</span><span class="sxs-lookup"><span data-stu-id="51082-164">A client application can sometimes release an object without releasing one or more of its affiliated objects.</span></span> <span data-ttu-id="51082-165">このような場合、プロバイダーは、解放されていないオブジェクトが使用できなく必要があります。</span><span class="sxs-lookup"><span data-stu-id="51082-165">In such a case, a provider may need to render an unreleased object unusable.</span></span> <span data-ttu-id="51082-166">これを行うには、プロバイダーはすべてのオブジェクトに接続されているリソースを解放し、オブジェクトの vtable を無効にする[IMAPISupport::MakeInvalid](imapisupport-makeinvalid.md)を呼び出して、します。</span><span class="sxs-lookup"><span data-stu-id="51082-166">To do this, the provider frees all of the resources connected with the object and then calls [IMAPISupport::MakeInvalid](imapisupport-makeinvalid.md) to invalidate the object's vtable.</span></span> <span data-ttu-id="51082-167">**MakeInvalid**は、vtable の**IUnknown**のメソッド (**QueryInterface**、 **AddRef**、および**Release**) を標準的な MAPI 実装に置き換えます、MAPI_E_INVALID_OBJECT を取得する他のすべての方法は、します。</span><span class="sxs-lookup"><span data-stu-id="51082-167">**MakeInvalid** replaces the vtable's **IUnknown** methods (**QueryInterface**, **AddRef**, and **Release**) with standard MAPI implementations and causes all other methods to return MAPI_E_INVALID_OBJECT.</span></span> <span data-ttu-id="51082-168">**MakeInvalid**は、vtable 以外のすべてのオブジェクトのメモリも解放されます。</span><span class="sxs-lookup"><span data-stu-id="51082-168">**MakeInvalid** also frees all the object's memory other than the vtable.</span></span> 
  
## <a name="see-also"></a><span data-ttu-id="51082-169">関連項目</span><span class="sxs-lookup"><span data-stu-id="51082-169">See also</span></span>



[<span data-ttu-id="51082-170">MAPI サービス プロバイダー</span><span class="sxs-lookup"><span data-stu-id="51082-170">MAPI Service Providers</span></span>](mapi-service-providers.md)

