---
title: 需要管理用の Project Server ワークフローの作成
manager: soliver
ms.date: 08/10/2016
ms.audience: Developer
localization_priority: Normal
ms.assetid: b0e4a3b3-d1df-454d-b74c-b980b0b456f6
description: この記事では、SharePoint Designer 2013 を使用して簡単なワークフローを作成する方法について説明します。
ms.openlocfilehash: bbefc5d30ccb508a24c32fe41e733e6e8187ecd9
ms.sourcegitcommit: 8fe462c32b91c87911942c188f3445e85a54137c
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/23/2019
ms.locfileid: "32355563"
---
# <a name="create-a-project-server-workflow-for-demand-management"></a>需要管理用の Project Server ワークフローの作成

この記事では、SharePoint Designer 2013 を使用して簡単なワークフローを作成する方法について説明します。 visio 2013 にワークフローをエクスポートして視覚化と編集を行うことができます。または、visio 2013 を使用して project Server の2013ワークフローを設計し、その設計を SharePoint Designer 2013 を使用して project Web App にインポートすることができます。 sharepoint ワークフロープラットフォームの詳細と、Visio 2013 および sharepoint Designer 2013 を使用したワークフローの作成の詳細については、sharepoint 2013 開発者向けドキュメントの「 [sharepoint 2013」](https://msdn.microsoft.com/library/jj163986%28office.15%29.aspx)の記事を参照してください。 
  
ワークフロー用の Project Server の準備の詳細については、「 [Start: Set up and configure SharePoint 2013 Workflow Manager](https://msdn.microsoft.com/library/jj163276%28office.15%29.aspx)」を参照してください。

<a name="pj15_CreateWorkflowSPD_General"> </a>

## <a name="creating-a-general-workflow"></a>一般的なワークフローを作成する

SharePoint Designer 2013 を使用して Project Server 2013 ワークフローを作成するには、以下の手順を使用します。 ワークフローは、プロジェクト提案の需要管理を目的として設計されています。
  
詳細な手順については、「[分岐ワークフローを作成](#pj15_CreateWorkflowSPD_Detailed)する」セクションを参照してください。 
  
### <a name="to-create-a-project-server-workflow-general-procedure"></a>Project Server ワークフローを作成するには (一般的な手順)

1. 要件を決定し、ワークフローを設計します。フェーズおよびステージとして整理し、ワークフローが使用するユーザー設定フィールドを決定します。
    
2. Project Web App で、ワークフローが必要とするエンティティを作成します。
    
    1. ワークフローの既存のフェーズを確認し、必要に応じてフェーズを作成します。
        
    2. ワークフローが使用するエンタープライズ ユーザー設定フィールドを作成します。ワークフローのステージで使用できるようにするには、ユーザー設定フィールドをワークフローで制御する必要があります。
        
    3. プロジェクトに関する情報を収集するためにワークフロー ステージが使用するプロジェクト詳細ページ (PDP) を編集または作成します。この例のステージでは、既定の PDP を編集して新しいユーザー設定フィールドを組み込みます。
        
    4. 必要なワークフロー ステージを作成し、各ワークフロー ステージを正しいフェーズと関連付けます。
    
3. SharePoint Designer 2013 で、**テキストベースのデザイナー**で宣言ステートメントを使用してワークフローを構築します。
    
    > [!NOTE]
    > また、SharePoint designer 2013 で**ビジュアルデザイナー**に切り替えたり、既存のワークフローを Visio 2013 からインポートしたりすることもできます。 **テキストベース デザイナー**を使用する場合は以下の手順に従ってください。 
    > 
    > 1. project Web App サイトを開き、 **SharePoint 2013 ワークフロー-project Server**ワークフロープラットフォームを使用するサイトワークフローを作成します。 
    > 2. ワークフローが使用するステージを追加します。
    > 3. 各ステージで必要なワークフローのステップ、条件、アクション、およびループを挿入します。
    > 4. ワークフローのエラーを調べて、ある場合は修正します。
    > 5. オプション**ビジュアルデザイナー**にビューを切り替えるか、ワークフローを Visio 2013 ファイルにエクスポートします。 Visio の表示を変更し、現在のワークフローに対する変更を保存できます。 Visio ファイルを編集して SharePoint Designer 2013 にインポートすると、他のワークフローを作成できます。
    > 6. ワークフローを発行します。 公開されたワークフローは、Project Web App サイトのワークフローの一覧に表示されます。
    
4. project Web App で、ワークフローを使用してプロジェクト提案の需要管理を行います。
    
    1. ワークフローを使用するエンタープライズ プロジェクト テンプレート (EPT) を作成します。
        
    2. [プロジェクト センター] ページで、ワークフローの EPT を使用するプロジェクトを作成し、ワークフローのステージに従います。
        
    3. ワークフローを詳細にテストします。
        
    4. 運用サーバーにワークフローを展開します。

<a name="pj15_CreateWorkflowSPD_Detailed"> </a>

## <a name="creating-a-branching-workflow"></a>分岐ワークフローを作成する

SharePoint Designer 2013 を使用して project server ワークフローを作成するには、workflow Manager Client 1.0 service を、project server の2013ワークフローアクティビティを使用するように構成する必要があります。 Workflow Manager クライアント1.0 を構成する方法については、sharepoint Server 2013 開発者向けドキュメントの「 [sharepoint 2013](https://msdn.microsoft.com/library/jj163986%28office.15%29.aspx)の記事」を参照してください。 
  
次の詳細な手順には、「一般的な[ワークフローを作成](#pj15_CreateWorkflowSPD_General)する」セクションと同じ手順が含まれています。 
  
### <a name="to-create-a-project-server-branching-workflow-detailed-procedure"></a>Project Server 分岐ワークフローを作成するには (詳細な手順)

#### <a name="1-plan-and-design-the-workflow"></a>1. ワークフローを計画および設計します。

Project Server ワークフローは、需要管理プロセスの複数のステージおよびフェーズと統合できます。 ワークフローは複雑な場合があるので、ビジネス要件を理解し、注意深くワークフローを計画する必要があります。 簡単な例として、プロジェクト提案の予想コストを使用して、提案を受け入れるかどうかを決定する分岐ワークフローを設計します。 予想コストが 25,000 USD を超える場合は提案を拒否し、それ以外の場合は提案を受け入れてプロジェクトを作成します。
    
Visio 2013 および SharePoint Designer 2013 を使用して project server 2013 のワークフローを設計および作成できるため、project server 2010 では実行可能なワークフローをより簡単に試すことができます。 この記事のサンプルワークフローデザインは、「Project 2010 SDK の[分岐ワークフローを作成する](https://msdn.microsoft.com/library/a02cafdc-d881-4271-b446-d8b2cd456a52%28Office.15%29.aspx)」の記事と同じです。 project Web App のテストインスタンスを使用して、リモートコンピューターでテストワークフローを設計および作成することができます。 project Server 2013 コンピューター上で直接ワークフローを作成する必要はありません。 
    
#### <a name="2-create-the-entities-that-your-workflow-requires"></a>2. ワークフローで必要なエンティティを作成します。

Project Web App で、使用可能なワークフローのフェーズとステージ、および使用可能なエンタープライズユーザー設定フィールドを確認します。 必要に応じて、次に示す手順で、ワークフローに必要なエンティティを作成します。
    
1. **ワークフローフェーズ**Project Web App の既定のインストールには、作成、選択、計画、管理、完了の各フェーズが含まれます。 分岐ワークフローの例では、他のフェーズを作成する必要はありません。 
        
2. **エンタープライズユーザー設定フィールド**分岐ワークフローには、ワークフローによって制御されるプロジェクトコストのユーザー設定フィールドが必要です。 ワークフローで制御されるユーザー設定フィールドの値は、ワークフローが使用する PDP で設定されます。 たとえば、Project Web App ページの右上にある [**設定**] アイコンを選択し、[ **PWA 設定**] を選択してから、[**エンタープライズユーザー設定フィールドと参照テーブル**] を選択します。
        
   [プロジェクト] エンティティに対する「**提案のコスト**」という名前のユーザー設定フィールドを作成し、種類として [**コスト**] を選択します。 説明には「プロジェクト提案の見積もられたコスト」と入力します。 [**基本動作**] セクションでは、[**ワークフローによって制御される動作**] を選択します。
        
3. **プロジェクト詳細ページ**ワークフローステージが使用する pdp を編集または作成します。 たとえば、次の手順を実行します。 
        
    1. [サーバー設定] ページで [**プロジェクト詳細ページ**] を選択し、PDP として [**ProjectInformation**] を選択します。 
            
    2. リボンの [**ページ**] タブで、[**編集**] グループの [**ページの編集**] を選択します。
            
    3. **基本情報**web パーツの右上隅にある下矢印を選択し、[ **web パーツの編集**] を選択します。 または、リボンの [ **web パーツ**] タブの [**プロパティ**] グループで、[ **web パーツのプロパティ**] を選択してエディターパーツを表示します。 
            
    4. エディター パーツの [**表示されているプロジェクトのフィールド**] セクション (図 1 を参照) で、[**変更**] を選択します。
            
    5. [**提案コスト**] ユーザー設定フィールドを追加し、[**選択したプロジェクトフィールド**] リストの**所有者**フィールドの上に移動して、[ **OK]** を選択します (図1を参照)。
      
    6. エディター パーツで [**OK**] をクリックし、リボンの [**ページ**] タブで [**編集**] グループの [**編集の終了**] を選択します。 図 2 では、プロジェクトの情報 PDP に追加された **Proposal Cost** ユーザー設定フィールドを示します。 

    **図1。PDP でのプロジェクトフィールド web パーツの編集**

    ![PDP でのプロジェクトフィールド web パーツの編集](media/pj15_CreateWorkflowSPD_EditPDP.gif "PDP でのプロジェクトフィールド web パーツの編集")

    **図 2. 提案のコスト ユーザー設定フィールドを含む編集後の PDP**

    ![編集済みの PDP に [提案のコスト] フィールドが含ま]れる(media/pj15_CreateWorkflowSPD_EditedPDP.gif "編集済みの PDP に [提案のコスト] フィールドが含ま")れる
  
4. **ワークフローステージ**ワークフローの各フェーズに必要なステージを作成します。 [サーバーの設定] ページで [**ワークフロー ステージ**] を選択し、[**新しいワークフロー ステージ**] を選択します。 図 3 では、[ワークフロー ステージの追加] ページの一部を示します。
    
    **図 3. Project Web App でのワークフロー ステージの追加**

    ![Project Web App でのワークフローステージの追加](media/pj15_CreateWorkflowSPD_AddWorkflowStage.gif "Project Web App でのワークフローステージの追加")
  
    分岐ワークフローの例では、表1に示す4つのステージを使用します。 [ワークフローステージの追加] ページ (図3には示されていません) の [**表示可能なプロジェクト詳細ページ] セクションの追加設定**では、値はオプションです。[ワークフローの状態] ページに詳細情報が記載されています。 たとえば、最初の提案の詳細 PDP にはユーザー入力が必要であるため、[**プロジェクト詳細ページに注意が必要**] チェックボックスをオンにしてから、この pdp のプロジェクト名とコストの設定など、特定の説明を追加することができます。
    
    図 4 では、[ワークフロー ステージ] ページで完成した 4 つのステージを示します。
    
    **表 1. 分岐ワークフローのステージ**

    |名前|説明|提出の説明|フェーズ|表示される PDP|ユーザー設定フィールド|
    |:-----|:-----|:-----|:-----|:-----|:-----|
    |初期段階の提案の詳細  <br/> |プロジェクト名とコストを設定します。  <br/> |提案としてプロジェクトを提出します。  <br/> |作成  <br/> |プロジェクト情報  <br/> プロジェクトの詳細  <br/> |提案のコスト (必須)  <br/> |
    |プロジェクトの詳細  <br/> |提案されるプロジェクトの詳細を提供します。  <br/> |詳細を提出してプロジェクトを続行します。  <br/> |作成  <br/> |プロジェクト情報  <br/> プロジェクトの詳細  <br/> |提案のコスト (読み取り専用)  <br/> |
    |自動的に却下  <br/> |提供された情報に基づいて提案を拒否します。  <br/> | <br/> |作成  <br/> |プロジェクト情報  <br/> |提案のコスト (読み取り専用)  <br/> |
    |Execution  <br/> |提案を受け入れ、プロジェクト管理できる状態にします。  <br/> | <br/> |管理  <br/> |プロジェクト情報  <br/> プロジェクトの詳細  <br/> |提案のコスト (読み取り専用)  <br/> |
   
    **図 4. Project Web App でのワークフロー ステージの一覧**

    ![Project Web App でのワークフローステージのリスト](media/pj15_CreateWorkflowSPD_WorkflowStages.gif "Project Web App でのワークフローステージのリスト")
  
#### <a name="3-construct-the-workflow-in-the-text-based-designer"></a>3. テキストベースのデザイナーでワークフローを構築します。

SharePoint Designer 2013 で、テキストベースのデザイナーで宣言ステートメントを使用してワークフローを構築します。 オレンジ色の挿入行から入力を開始して、ワークフローロジックとステップのコンテキストに応じた自動完了ステートメントを取得するか、リボンの [**ワークフロー** ] タブの [**挿入**] グループでコントロールを使用してロジックと手順を挿入することができます。 
    
1. SharePoint Designer 2013 の Backstage ビューで、[**サイトを開く**] を選択します。 たとえば、を開き`https://ServerName/pwa`ます。 **ナビゲーション** ウィンドウで [**ワークフロー**] を選択します。 次に、リボンの [**ワークフロー**] タブで、[**新規**] グループの [**サイト ワークフロー**] を選択します。 この例では、ワークフローを「Branching Workflow」という名前にします。 [**プラットフォームの種類**] ドロップダウンリストで、[ **SharePoint 2013 ワークフロー-Project Server** ] が選択されていることを確認します (図5を参照)。 
    
    **図 5. Project Server サイト ワークフローの作成**

    ![Project Server サイトワークフローを作成]する(media/pj15_CreateWorkflowSPD_CreateSiteWorkflow.gif "Project Server サイトワークフローを作成")する
  
2. [**分岐ワークフロー**] タブを選択します。次に、リボンの [**ワークフロー**] タブで、[**管理**] グループの [**ビュー**] ドロップダウン リストの [**テキストベース デザイナー**] を選択します。点滅するオレンジ色の挿入行をビューに表示するには (図 6 を参照)、ビューの内部をクリックします。
    
    **図 6. ワークフロー用のテキストベース デザイナー ビューの使用**

    ![テキストベースのデザイナービューを使用する](media/pj15_CreateWorkflowSPD_TextBasedDesigner.gif "テキストベースのデザイナービューを使用する")
  
3. **テキストベース デザイナー** ビューで、ワークフローが使用するステージを追加します。リボンの [**ワークフロー**] タブで、[**挿入**] グループの  [**ステージ**] ドロップダウン リストにある [**作成**] の [**初期段階の提案の詳細**] を選択します。
    
    同様に、[**ステージ: 初期段階の提案の詳細**] ボックスの下にオレンジ色の挿入行を配置し、ワークフローが使用する他のステージとして [**プロジェクトの詳細**]、[**自動的に却下**]、および [**実行**] を追加します (図 7 を参照)。 
    
    **図 7. SharePoint デザイナーでのワークフローへのステージの追加**

    ![SPD でワークフローにステージを追加する](media/pj15_CreateWorkflowSPD_AddStageInSPD.gif "SPD でワークフローにステージを追加する")
  
4. 各ステージにワークフローのステップとロジックを追加します。 
    
    1. [**初期段階の提案の詳細**] ステージで、ステージ本体の先頭にオレンジ色の挿入行を配置します。リボンの [**挿入**] グループで [**アクション**] を選択し、[**Project Web App のアクション**] までスクロール ダウンして、[**プロジェクト イベントを待機**] を選択します。[**このプロジェクト イベント**] を選択し、ドロップダウン リストで [**イベント: プロジェクトが提出されるとき**] を選択します。 
    
    2. [**初期段階の提案の詳細**] ステージの [**ステージに移動**] セクションで、[**ある値と値が等しいかどうか**] を挿入します。ステートメントを入力するか、またはリボンの [**挿入**] グループの [**条件**] コントロールを使用します。 
    
    3. 最初の [**値**] コントロールを選択してから、[**fx**] を選択して、[**ワークフロー参照の定義**] ダイアログ ボックスを表示します (図 8 を参照)。[**データ ソース**] ドロップダウン リストで [**プロジェクト データ**] を選択します。[**ソースのフィールド**] ドロップダウン リストで、[**提案のコスト**] を選択します。
    
       **図 8. ワークフローでの参照値の定義**

       ![ワークフローでの参照値の定義](media/pj15_CreateWorkflowSPD_DefineWorkflowLookup.gif "ワークフローでの参照値の定義")
  
    4. 以下を`If`示すように、ステートメントを完了します。**プロジェクトデータ: 提案のコストが25000を超える場合**
    
       > [!NOTE]
       > または、ワークフロー変数を作成して、その変数にユーザー設定フィールドの値を設定してから、変数と値を比較します。 たとえば、リボンの [**ローカル変数**] ドロップダウン リストから、型が **Number** の **TotalCost** (スペースなし) という名前の変数を作成します。 [**ワークフロー参照の定義**] ダイアログ ボックスで、データ ソースの [**ワークフローの変数とパラメーター**] を選択してから、フィールドとして [**Variable: TotalCost**] を選択します。 **If** ステートメントが「**If Variable: TotalCost is greater than 25000**」になります。
  
    5. オレンジ色の挿入行を分岐`If`の内側に置き、**アクション**コントロールを使用して、[**ステージに移動**] を挿入します。そのためには、リボンの [**挿入**] グループを使用します。 **ステージ** ドロップダウン コントロールを選択し、[**自動的に却下**] ステージを選択します。 
    
       同様に、 `Else`分岐で、 **[プロジェクトの詳細を**表示] ステートメントを挿入します。 図 9 では、完成した**初期段階の提案の詳細**ステージを示します。 
    
       **図 9. 初期段階の提案の詳細ステージの完成したロジック**

       ![最初の提案の詳細についての完了したロジック](media/pj15_CreateWorkflowSPD_InitialStageLogic.gif "最初の提案の詳細についての完了したロジック")
  
    6. [**自動却下**] ステージでは、ワークフローを一時停止して、PDP のデータを表示する場合以外は、最初のセクションを空のままにします。 [**ステージへの遷移**] セクションには、遷移を含める必要があります。却下の後のステージが他にないため、文の「ワークフローの最後」と入力します。 
    
    7. **プロジェクトの詳細**ステージでは、[ステージに移動] セクションに「**実行に進む**」を追加します。 データを追加したり、ワークフローを一時停止したりする必要がない限り、提出イベントを待つ必要はありません。 
    
    8. [**実行**] ステージでは、ワークフローを一時停止する必要がない限り、ステージのアクションのセクションは空のままにします。[**ステージに移動**] セクションで、[**ワークフローの末尾に進む**] を追加します。
    
5. リボンの [**保存**] グループで [**エラーの確認**] を選択して、ワークフローのエラーを調べます (図 10 を参照)。エラーを修正して [**保存**] を選択します。
    
    **図 10. SharePoint デザイナーでのワークフローのエラーの確認**

    ![ワークフローのエラーをチェックする](media/pj15_CreateWorkflowSPD_SPDCheckForErrors.gif "ワークフローのエラーをチェックする")
  
6. (オプション) リボンの [**管理**] グループで、[**ビュー**] ドロップダウン メニューの [**ビジュアル デザイナー**] を選択します。図 11 では、ビューを 50% に縮小表示しています。
    
    ビジュアル デザイナーを使用してワークフロー内のアイテムを編集できます。たとえば、[**ある値と値が等しいかどうか**] 条件を選択し、条件の左下にあるツール アイコンを選択して [**値**] を選択すると、[**プロパティ**] ダイアログ ボックスに比較条件が表示されます。 
    
    **図 11. ワークフロー用のビジュアル デザイナーの使用**

    ![ワークフローの Visio デザインビューを使用する](media/pj15_CreateWorkflowSPD_SwitchView.gif "ワークフローの Visio デザインビューを使用する")
  
    ワークフローがビジュアルデザイナービューにある場合、ワークフローを visio 2013 (.vsdx) ファイルにバックアップとして保存したり、後で使用したりするには、[ **visio にエクスポート**] を選択します。
    
7. ワークフローを発行します。 sharepoint Designer 2013 を使用してワークフローをアクティブな Project Web App サイトに発行すると、ワークフローが sharepoint サイトまたは Azure に登録され、Project Web app for new ept で使用できるようになります。

#### <a name="4-create-an-ept-for-the-workflow-and-then-test-the-workflow"></a>4. ワークフローの EPT を作成してから、ワークフローをテストします。

project Web App で、ワークフローの EPT を作成し、プロジェクト提案を作成してワークフローをテストします。
    
1. [PWA 設定] ページで、[**エンタープライズプロジェクトの種類**] を選択してから、Test 分岐ワークフローという名前の EPT を作成します。 [**新しいプロジェクトを SharePoint タスク リスト プロジェクトとして作成します**] チェック ボックスをオフにして、EPT によって作成されたプロジェクトのフル コントロールを Project Server が維持するようにします。 [**サイト ワークフローの関連付け**] ドロップダウン リストで [**分岐ワークフロー**] を選択し、ワークフローで表示される最初のページとして [**新しいプロジェクト ページ**] ドロップダウン リストで [**プロジェクト情報**] PDP を選択します。 
    
    **図 12. ワークフローへの EPT の追加**

    ![ワークフローの EPT の追加](media/pj15_CreateWorkflowSPD_EPTs.gif "ワークフローの EPT の追加")
  
    > [!NOTE]
    > エンタープライズプロジェクトの種類の表の「 **sharepoint タスクリストプロジェクト**」列にある **[はい]** の値は、sharepoint タスクリストを作成する EPT を示しています。これは、タスクリストが project Web App で表示されますが、sharepoint はプロジェクトの管理を保持します。. SharePoint タスクリストとしてのプロジェクトの管理の詳細については、「 [Project Server 2013 architecture](project-server-2013-architecture.md)」を参照してください。 
  
2. project Web App で [プロジェクト] ページを開き、新しい EPT を使用してプロジェクトを作成します (図13を参照)。 [**分岐ワークフローのテスト**] は [**分岐ワークフロー**] と関連付けられているので、ワークフローの制御下でプロジェクトの作成が開始します。
    
    **図 13. 分岐ワークフローのテスト EPT でのプロジェクトの作成**

    ![EPT を使用してプロジェクトを作成]する(media/pj15_CreateWorkflowSPD_NewProject.gif "EPT を使用してプロジェクトを作成")する
  
3. ワークフローで [**プロジェクトの情報**] PDP が表示されたら、プロジェクトのフィールドにデータを追加します。 たとえば、**提案コスト**の値を3万にします。 U.S. 英語バージョンの Project Server では、フィールドの表示が $30,000 に変わります (図 14 を参照)。
    
    **図 14. 編集後のプロジェクトの情報 PDP の使用**

    ![編集済みのプロジェクト情報 PDP の使用](media/pj15_CreateWorkflowSPD_NewProjectStage1.gif "編集済みのプロジェクト情報 PDP の使用")
  
4. リボンの [**プロジェクト**] タブの [**プロジェクト**] グループで、[**保存**] を選択します。 Project Server は PDP 内のデータをプロジェクトに追加してから、[ワークフローの状態] ページを表示します (図 15 を参照)。ワークフローの状態図で初期段階の提案の詳細ステージの完全な説明を表示するには、ワークフロー ビジュアライゼーション ダイアグラム内のステージの上にポインターを移動します。
    
    [**すべてのワークフロー ステージ**] グリッドの緑色の矢印 は、初期段階の提案の詳細ステージが入力待ちであることを示しています。これは、初期段階の提案の詳細ステージでの提出イベントをワークフローが待っているためです。ワークフローが提出イベントを待っていない場合は、[**ページ**] グループの [**次へ**] を選択して次の PDP に進むことができます。 
    
    **図 15. 初期段階の提案の詳細ステージでの [ワークフローの状態] ページの使用**

    ![最初のステージの後の [ワークフローの状態] ページ](media/pj15_CreateWorkflowSPD_NewProjectStage1Status.gif "最初のステージの後の [ワークフローの状態] ページ")
  
    ワークフロー ビジュアライゼーション ダイアグラムに現在のステージが緑色で示されます。 [**作成**] フェーズで、初期段階の提案の詳細ステージが現在のステージです。 
    
5. リボンで [**ワークフロー**] グループの [**提出**] を選択します。
    
    > [!TIP]
    > [**提出**] コントロールが無効な場合は、ページを最新表示に更新します。 
  
    [**提案のコスト**] の値が $25,000 USD より大きい場合、ワークフローは自動的に却下ステージに移動します。図 16 では、[**提出**] をもう一度選択したときの自動却下ステージの状態を示しています。[**提案のコスト**] が $25,000 USD 以下の場合は、ワークフローはプロジェクトの詳細ステージに移動します (図 17 を参照)。 
    
    **図 16. 自動却下ステージでワークフローが完了**

    ![ワークフローが自動却下で完了する](media/pj15_CreateWorkflowSPD_AutomatedRejectionCompleted.gif "ワークフローが自動却下で完了する")
  
    図17は、「 **test 2-分岐**」という名前のプロジェクト提案を使用した別のテストを示しています。これは、作成段階でプロジェクトの詳細ステージが最新の状態になっています。 管理フェーズは明るい青色で表示され、フェーズがまだアクティブでないことを示します。
    
    **図 17. コストが $25,000 より少ない場合はワークフローはプロジェクトの詳細ステージへ続行**

    ![プロジェクトの詳細ステージでのワークフローの状態](media/pj15_CreateWorkflowSPD_ProjectDetailsStage.gif "プロジェクトの詳細ステージでのワークフローの状態")
  
6. プロジェクトの詳細ステージに進む場合、既定ページに追加する追加はありません。[**提出**] を再度選択して実行ステージに進みます (図 18 を参照)。 
    
    **図 18. ワークフローは実行ステージで管理の準備完了**

    ![実行段階のワークフローの状態](media/pj15_CreateWorkflowSPD_ExecutionStage.gif "実行段階のワークフローの状態")
  
プロジェクトの詳細ステージではワークフローは提出イベントを待機しません。[プロジェクトの詳細] PDP に追加の必須フィールドがある場合は、Project Server はフィールドにデータが追加されるのを待ってから、実行ステージに進みます。分岐ワークフローで定義されているように、実行ステージも提出イベントを待機しません。実行ステージでは、プロジェクト マネージャーとしてプロジェクトを編集する、またはリボンの [**プロジェクト**] タブで [**閉じる**] を選択することができます。[**閉じる**] を選択した場合は、プロジェクトにチェックイン して、それを後で編集することも、プロジェクトをチェックアウトしたままにすることもできます。

[**分岐ワークフロー**] プロジェクトは比較テストが 1 つだけの簡単な例です。このワークフローには、需要管理の作成フェーズの 3 つのステージと、管理フェーズの 1 つのステージが含まれます。ワークフローを詳細にテストするには、ワークフローのすべての分岐をテストし、極端な値と標準的な値を使用して動作が意図したとおりかどうかを確認する必要があります。 

<a name="pj15_CreateWorkflowSPD_ImportingVromVisio"> </a>

## <a name="importing-a-workflow-from-visio"></a>Visio からワークフローをインポートする

ワークフローを変更するには、ワークフローで制御されるユーザー設定フィールドを作成または変更し、ワークフローのフェーズとステージを作成または変更します。 SharePoint Designer 2013 を使用して、条件、アクション、ループ、およびステージを追加し、ワークフローを保存して再発行することができます。 ワークフローのバックアップを再利用または保存するには、それを Visio 2013 ファイルにエクスポートできます。 
  
また、Visio 2013 でワークフローを作成または編集し、Project Web App で使用するためにファイルを SharePoint Designer 2013 にインポートすることもできます。 変更されていないワークフローを使用するには、project web app インスタンスに、元の project web app インスタンスと同じワークフローステージプロパティを含める必要があります。 visio を使用してワークフローを作成する方法の詳細については、「 [SharePoint Designer 2013 および visio 2013 のワークフロー開発](https://msdn.microsoft.com/library/jj163272%28office.15%29.aspx)」を参照してください。
  
> [!NOTE]
> Visio 2013 ファイルを Project Web App の別のインスタンスにインポートすると、ステージ名が同じであっても、ステージ guid は異なります。 ワークフローをインポートした後、Project Web App インスタンスに固有の値を使用するようにステージおよびアクションプロパティを構成する必要があります。 
> 
> visio 2013 でワークフローを作成した場合、visio が project web app に接続されていないため、このステージおよびアクションには project web app インスタンスに固有のプロパティはありません。 SharePoint Designer 2013 を Project Web App に接続し、ワークフローを作成してから、.vsdx ファイルをインポートすると、アクティブなワークフローが上書きされます。 その後、ステージおよびアクションのプロパティを構成して、SharePoint Designer 2013 が Project Web App から取得する値と一致するようにする必要があります。 
  
### <a name="to-import-a-workflow-from-visio-to-sharepoint-designer"></a>Visio から SharePoint Designer にワークフローをインポートするには

1. Visio 2013 で、簡単なワークフローを作成します。 たとえば、次の手順を実行します。
    
   1. Visio を開いてから、ワークフローを作成します。新しいワークフローの [**カテゴリ**] ウィンドウを選択して、[**フローチャート**] を選択し、[**新規作成** ] ウィンドウで [**Microsoft SharePoint 2013 ワークフロー**] テンプレートを選択してから、[**作成**] を選択します。ワークフローが **Stage 1** という名前のステージ図形と一緒に表示されます。ワークフローには、開始コンポーネントと、ステージ図形の一部として入口図形と出口図形が含まれています。
    
      ポインターをステージ図形の上に移動して [**プロパティ**] アイコンを選択すると、選択肢が無効になります。 ワークフローダイアグラムを SharePoint Designer 2013 にインポートした後に、stage および action プロパティを設定できます。 
    
      > [!NOTE]
      >  使用すべき図形ステンシルは、フローチャート図形の一覧に含まれている次のものだけです。 
      > - **アクション-SharePoint 2013 ワークフロー**
      > - **コンポーネント-SharePoint 2013 ワークフロー**
      > - **条件-SharePoint 2013 ワークフロー**
  
   2. [**図形**] ウィンドウで、[**クイック図形**] を選択してから、[**値の中に同じものがある場合**] という名前の条件図形をステージ図形の右側にドラッグします。 
    
   3. リボンの [**ホーム**] タブで、[**コネクタ**] ツールを選択してから、ステージ上の出口図形と条件図形を接続します (図 19 を参照)。 
    
      **図 19. Visio ワークフロー図でのステージ図形と条件図形の接続**

      ![Visio でのワークフローダイアグラムの作成](media/pj15_CreateWorkflowSPD_NewVisioWorkflow.gif "Visio でのワークフローダイアグラムの作成")
  
   4. 2 つのステージ図形をさらに条件図形の右側にドラッグします。 これらの図形に **Stage 2** と **Stage 3** という名前が付けられます。
    
   5. [**コネクタ**] ツールを使用して、条件図形の右側と **Stage 2** の入口図形を接続します。 [**ポインター** ] ツールを選択し、接続をダブルクリックして名前のテキストボックスを表示し、[はい] という名前を指定します。
    
   6. 条件図形の下側と **Stage 3** の入口図形を接続します。[**ポインター**] ツールを使用して、接続を右クリックしてから、[**No**] を選択します。どちらの方法も接続に **Yes** または **No** という名前を付けるように機能します。
    
   7. [**図形**] ウィンドウで、[**アクション-SharePoint 2013 ワークフロー**] を選択し、[**プロジェクトイベントの待機**] アクションを**ステージ 1**の図形の中央にドラッグします (図20を参照)。 
    
      **図 20. Visio でのワークフローの完了**

      ![Visio でのワークフローの完了](media/pj15_CreateWorkflowSPD_CompletedVisioWorkflow.gif "Visio でのワークフローの完了")
  
   8. リボンの [**プロセス**] タブの [**図の検証**] グループで、[**図面のチェック**] を選択します。 すべてのエラーを修正してから、図面を保存します。 たとえば、ファイルに Test workflow from Visio.vsdx という名前を付けます。
    
      ワークフローエラーを修正する方法については、「 [Visio 2013 での SharePoint Server 2013 のワークフロー検証エラーのトラブルシューティング](https://msdn.microsoft.com/library/jj163971%28v=office.15%29.aspx)」を参照してください。
    
2. SharePoint Designer 2013 を開き、**分岐ワークフロー**の例として使用したものと同じ Project Web App サイトを開きます。 
    
3. [**ナビゲーション**] ウィンドウで、[**ワークフロー**] を選択してから、サイト ワークフローを作成します (リボンの [**ワークフロー**] タブで [**サイト ワークフロー**] を選択します)。 たとえば、ワークフローに Simple workflow from Visio という名前を付けます。
    
   [**サイトワークフローの作成**] ダイアログボックスで、プラットフォームの種類が**SharePoint 2013 ワークフロー-Project Server**であることを確認します。 [**作成**] を選択すると、SharePoint Designer で新しいワークフローの**テキストベースのデザイナー**ウィンドウが開きます。 
    
4. リボンの [**ワークフロー**] タブの [**管理**] グループで、[**ワークフロー設定**] を選択します。
    
5. リボンの [**ワークフロー設定**] タブの [**管理**] グループで、[ **visio からインポート**] を選択し、以前に保存した **.vsdx ファイルからテストワークフロー**をインポートします。 **Microsoft SharePoint Designer**ダイアログボックスでは、インポートしているダイアグラムにワークフロープロパティが含まれていないことを示す警告が表示され、現在のワークフローを上書きするかどうかを確認します。 [**はい]** を選択します。SharePoint Designer によってワークフローダイアグラムがインポートされ、図形のステンシルが生成され、インポートされたワークフローを含む**ビジュアルデザイナー**ウィンドウが表示されます。 
    
6. ワークフロー内の各ステージ図形のプロパティを設定します。 たとえば、最初のステージ図形は、接続された Project Web App インスタンスの有効なステージを表していないため、 **stage 1 (無効)** という名前になります。 ステージ上で選択またはカーソルを移動すると、ステージ図形の左下にある [**プロパティ**] アイコンを選択して、[**ステージのプロパティ**] ダイアログボックスを表示できます (図21を参照)。 **プロジェクトステージ**のドロップダウンリストで、**最初の提案の詳細**ステージを選択し、[ **OK]** を選択します。 SharePoint Designer がステージの名前を変更します。
    
   **図 21. SharePoint Designer でのステージ プロパティの設定**

   ![インポートされたワークフローでのプロパティの設定](media/pj15_CreateWorkflowSPD_ImportFromVisio1.gif "インポートされたワークフローでのプロパティの設定")
  
   2 つ目のステージに対して、[**プロジェクト ステージ**] プロパティを [**自動的に却下**] に設定します。 3 つ目のステージに対して、[**プロジェクト ステージ**] プロパティを [**実行**] に設定します。
    
7. 同様に、[**プロジェクト イベントの待機**] アクションに対して、[**イベント名**] プロパティを [**イベント: プロジェクトの提出時**] に設定します。
    
8. 同様に、[**値の中に同じものがある場合**] 条件のプロパティを設定します。 たとえば、最初の [**値**] プロパティを [**プロジェクト データ: 提案のコスト**] に設定します。 [**演算子**] プロパティを [**次の値より小さい**] に設定します。 2番目の**Value**プロパティを5000に設定します。
    
9. ワークフローのエラーをチェックしてから、ワークフローを保存します。エラーがなければ、表示を [**テキストベース デザイナー**] に切り替えることができます (図 22 を参照)。 
    
   **図 22. テキストベース デザイナーでのインポートしたワークフローの表示**

   ![インポートされたワークフローの表示](media/pj15_CreateWorkflowSPD_WorkflowFromVisio.gif "インポートされたワークフローの表示")
  
10. ワークフローを発行します。ワークフローを保存しても発行しなければ、エンタープライズ プロジェクトの種類を作成するときに使用できません。
    
11. Project Web App で Visio からインポートされた**単純なワークフロー**をテストするには、ワークフローを使用する EPT を作成し、**分岐ワークフロー**の例のように新しい EPT を使用するプロジェクトを作成します。 ただし、この場合は、コストが 5,000 ドル未満のプロジェクトが拒否されます。 
    
この記事の処理では、SharePoint Designer 2013 を使用して簡単な分岐ワークフローを作成およびテストし、ワークフローが使用するステージ、条件、およびアクションを直接設定しています。 また、Visio 2013 を使用して、さらに単純な分岐ワークフロー用の図も作成しました。 Visio ワークフローダイアグラムを SharePoint Designer 2013 にインポートしたので、各ステージ、条件、アクションのプロパティを Project Web App との接続から設定します。
  
Visio 2013 と SharePoint Designer の両方を使用すると、project Server 2013 および project Online のさまざまなインストールについて、ワークフローデザインを作成、共有、およびカスタマイズするための便利な方法が、設計者、プロジェクトマネージャー、ワークフロー開発者、およびテスト担当者に提供されます。 SharePoint Designer では提供されていない Project Server にプログラムによってアクセスする必要があるワークフローでは、Visual Studio 2012 をクライアント側オブジェクトモデル (csom) と共に使用できます。
  
## <a name="see-also"></a>関連項目

- [Project Server 2013 のアーキテクチャ](project-server-2013-architecture.md)
- [開始: SharePoint 2013 ワークフローマネージャーをセットアップおよび構成する](https://msdn.microsoft.com/library/jj163276%28office.15%29.aspx)
- [SharePoint 2013 でワークフローをパッケージ化して展開する方法の概要](https://msdn.microsoft.com/library/jj819316%28office.15%29.aspx)
- [SharePoint 2013 のワークフロー](https://msdn.microsoft.com/library/jj163986%28office.15%29.aspx)
- [SharePoint Designer 2013 および Visio 2013 でのワークフロー開発](https://msdn.microsoft.com/library/jj163272%28office.15%29.aspx)
- [Visio 2013 での SharePoint Server 2013 のワークフロー検証エラーのトラブルシューティング](https://msdn.microsoft.com/library/jj163971%28v=office.15%29.aspx)
- [ワークフローおよび需要管理](https://msdn.microsoft.com/library/cf7433a3-a531-4467-ac0c-df0c5d6881ae%28Office.15%29.aspx)

