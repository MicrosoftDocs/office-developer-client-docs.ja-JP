---
title: 無人の RPA 環境での Microsoft 365 での Office の無人自動化に関する考慮事項
ms.date: 03/30/2020
ms.audience: Developer
localization_priority: Normal
description: 無人の RPA 環境での Microsoft 365 での Office の無人自動化に関する考慮事項。
ms.openlocfilehash: 576217fc85f2980a6d2451e3f930296ea4c11a56
ms.sourcegitcommit: 007aa2ceb4f569201c3f4372de5c83b6c61f8875
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/02/2020
ms.locfileid: "43103051"
---
# <a name="considerations-for-unattended-automation-of-office-in-the-microsoft-365-for-unattended-rpa-environment"></a><span data-ttu-id="7d3c4-103">無人の RPA 環境での Microsoft 365 での Office の無人自動化に関する考慮事項</span><span class="sxs-lookup"><span data-stu-id="7d3c4-103">Considerations for unattended automation of Office in the Microsoft 365 for unattended RPA environment</span></span>

<span data-ttu-id="7d3c4-104">Microsoft 365 for 無人 RPA にはユーザーがいない状態で Office の自動化を有効にするライセンスが用意されていますが、現在のすべてのバージョンの Office は、ユーザーが存在し、アプリケーションのインターフェイスを操作するユーザーが存在するクライアントワークステーション上のエンドユーザー製品として実行されるように設計およびテストされています。</span><span class="sxs-lookup"><span data-stu-id="7d3c4-104">Although Microsoft 365 for unattended RPA provides a license that enables the automation of Office with no user present, all current versions of Office were designed and tested to run as end-user products on a client workstation with a user present to interact with the application’s interface.</span></span> <span data-ttu-id="7d3c4-105">ユーザーが存在しないアプリケーションを使用した結果として生じる予期しない動作は、欠陥ではありません。</span><span class="sxs-lookup"><span data-stu-id="7d3c4-105">Unexpected behaviors resulting from the use of applications without a user present are not defects.</span></span> <span data-ttu-id="7d3c4-106">この構成で Office を実行するには、アプリケーションロジックでこれらの予期しない動作を考慮する準備が整っている必要があります。</span><span class="sxs-lookup"><span data-stu-id="7d3c4-106">If you want to run Office in this configuration, you must be prepared to account for these unexpected behaviors in your application logic.</span></span>

<span data-ttu-id="7d3c4-107">この記事では、この方法を使用する場合に役立つ Office の無人自動化の考慮事項について概説します。</span><span class="sxs-lookup"><span data-stu-id="7d3c4-107">This article outlines some of the considerations for unattended automation of Office to help you if you use this approach.</span></span> <span data-ttu-id="7d3c4-108">ただし、この構成での Office の使用は厳密に "その他" であり、これらの予期しない動作を考慮する必要があることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="7d3c4-108">However, note that usage of Office in this configuration is strictly “AS IS” and must account for these unexpected behaviors.</span></span> <span data-ttu-id="7d3c4-109">ここで提供されている情報は網羅的ではないため、すべてのクライアントのすべての問題を解決することは保証されません。</span><span class="sxs-lookup"><span data-stu-id="7d3c4-109">The information provided here is not exhaustive and is not guaranteed to resolve all issues for all clients.</span></span> <span data-ttu-id="7d3c4-110">を展開する前に、ソリューションを徹底的にテストすることをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="7d3c4-110">We encourage you to test your solution thoroughly before you deploy.</span></span>

## <a name="common-problems-in-unattended-automation"></a><span data-ttu-id="7d3c4-111">無人オートメーションでの一般的な問題</span><span class="sxs-lookup"><span data-stu-id="7d3c4-111">Common problems in unattended automation</span></span>

<span data-ttu-id="7d3c4-112">ユーザーが存在しない Office を使用する場合は、Office が想定どおりに動作しない以下の点に注意してください。</span><span class="sxs-lookup"><span data-stu-id="7d3c4-112">If you want to use Office without a user present, be aware of the following areas in which Office can behave differently than expected.</span></span> <span data-ttu-id="7d3c4-113">ソリューションを正常に実行するには、これらの問題に対処し、可能な限りその影響を最小限に抑える必要があります。</span><span class="sxs-lookup"><span data-stu-id="7d3c4-113">For your solution to run successfully, it must address these issues and minimize their effects as much as possible.</span></span> <span data-ttu-id="7d3c4-114">アプリケーションをビルドするときは、これらの問題を慎重に検討してください。</span><span class="sxs-lookup"><span data-stu-id="7d3c4-114">Consider these issues carefully when you build your application.</span></span>

### <a name="interactive-ui-elements"></a><span data-ttu-id="7d3c4-115">対話型 UI 要素</span><span class="sxs-lookup"><span data-stu-id="7d3c4-115">Interactive UI elements</span></span>

<span data-ttu-id="7d3c4-116">Office アプリケーションは、対話型で実行されることを前提としています。</span><span class="sxs-lookup"><span data-stu-id="7d3c4-116">Office applications assume that they are being run interactively.</span></span> <span data-ttu-id="7d3c4-117">予期しないエラーが発生した場合、または、関数の実行に必要なパラメーターが指定されていない場合、Office はユーザーに操作方法の確認を求めるダイアログボックスを表示するように設計されています。</span><span class="sxs-lookup"><span data-stu-id="7d3c4-117">If an unexpected error occurs, or if an unspecified parameter is needed to complete a function, Office is designed to prompt the user with a dialog box that asks the user how they want to proceed.</span></span> <span data-ttu-id="7d3c4-118">無人オートメーションで、アプリケーションがこの入力を受け取るまで停止すると、アプリケーションが "ハング" したように表示されることがあります。</span><span class="sxs-lookup"><span data-stu-id="7d3c4-118">In unattended automation, this might result in the application appearing to “hang” as the application stops until it receives this input.</span></span> <span data-ttu-id="7d3c4-119">公開 Api を使用して Office を自動化している場合は、 [DisplayAlerts](https://docs.microsoft.com/office/vba/api/word.application.displayalerts)および[AutomationSecurity](https://docs.microsoft.com/office/vba/api/word.application.automationsecurity)などのプロパティを適切に構成することで、これらの通知の多くを抑制することができます。</span><span class="sxs-lookup"><span data-stu-id="7d3c4-119">If you’re automating Office via its public APIs, you can suppress many of these alerts by configuring properties like [Application.DisplayAlerts](https://docs.microsoft.com/office/vba/api/word.application.displayalerts) and [Application.AutomationSecurity](https://docs.microsoft.com/office/vba/api/word.application.automationsecurity) appropriately.</span></span> <span data-ttu-id="7d3c4-120">コードは、いつでもブロックされる通知を識別して処理するように設計する必要があります。</span><span class="sxs-lookup"><span data-stu-id="7d3c4-120">Your code should be designed to identify and process blocking alerts at any time.</span></span>

### <a name="user-identity"></a><span data-ttu-id="7d3c4-121">ユーザー id</span><span class="sxs-lookup"><span data-stu-id="7d3c4-121">User identity</span></span>

<span data-ttu-id="7d3c4-122">Office アプリケーションは、オートメーション経由でアプリケーションが起動された場合でも、アプリケーションの実行時にユーザー id を必要とします。</span><span class="sxs-lookup"><span data-stu-id="7d3c4-122">Office applications require a user identity when the applications are run, even when the application is started via automation.</span></span> <span data-ttu-id="7d3c4-123">このユーザー id は、次のいずれかまたはすべてを発生させることができます。</span><span class="sxs-lookup"><span data-stu-id="7d3c4-123">This user identity can cause any or all of the following:</span></span>

- <span data-ttu-id="7d3c4-124">処理が必要な追加のサインイン UI があるかどうか。</span><span class="sxs-lookup"><span data-stu-id="7d3c4-124">The presence of additional sign-in UI that must be handled.</span></span>
- <span data-ttu-id="7d3c4-125">ユーザーごとのアクセス許可に基づいて開いたり、編集したりできないファイル。</span><span class="sxs-lookup"><span data-stu-id="7d3c4-125">Files that cannot be opened and/or edited based on per-user access permissions.</span></span>
- <span data-ttu-id="7d3c4-126">ファイルのメタデータに予期しない変更があります (たとえば、特定のファイルのプロパティは、自動アプリケーションインスタンスのユーザー id の id に基づいて更新されます)。</span><span class="sxs-lookup"><span data-stu-id="7d3c4-126">Unexpected changes to the metadata of the file (for example, certain file properties will be updated based on the identity of the user identity of the automated application instance).</span></span>

<span data-ttu-id="7d3c4-127">これらの問題を軽減するには、さまざまな方法が役立ちます。たとえば、[ドキュメント検査](https://docs.microsoft.com/office/vba/library-reference/concepts/using-the-document-inspector)を実行してメタデータを削除します。</span><span class="sxs-lookup"><span data-stu-id="7d3c4-127">Various approaches can help to mitigate these issues; for example, running the [Document Inspector](https://docs.microsoft.com/office/vba/library-reference/concepts/using-the-document-inspector) to remove metadata.</span></span> <span data-ttu-id="7d3c4-128">これらの方法がシナリオに基づいて適切かどうかを検討します。</span><span class="sxs-lookup"><span data-stu-id="7d3c4-128">Consider whether these approaches are appropriate based on your scenario.</span></span>

### <a name="server-side-security"></a><span data-ttu-id="7d3c4-129">サーバー側のセキュリティ</span><span class="sxs-lookup"><span data-stu-id="7d3c4-129">Server-side security</span></span>

<span data-ttu-id="7d3c4-130">Office を無人で実行して、任意のファイルコンテンツを処理する場合、そのような環境では、そのようなファイルに格納されているマクロの読み込みと実行が行われないようにするための、その環境での追加の保護は</span><span class="sxs-lookup"><span data-stu-id="7d3c4-130">When running Office unattended and processing arbitrary file content, no additional protections specific in that environment are available to prevent macros stored in those files from loading and running.</span></span> <span data-ttu-id="7d3c4-131">Office では、コードから故意にマクロを実行したり、マクロを実行する別のサーバーを起動したりすることはできません。</span><span class="sxs-lookup"><span data-stu-id="7d3c4-131">Office does not protect you from unintentionally running macros from your code, or from starting another server that might run macros.</span></span> <span data-ttu-id="7d3c4-132">[AutomationSecurity](https://docs.microsoft.com/office/vba/api/word.application.automationsecurity)のようなプロパティを使用してこのリスクを軽減できますが、必ず信頼できるコンテンツのみを読み込むようにする必要があります。</span><span class="sxs-lookup"><span data-stu-id="7d3c4-132">You can use properties like [Application.AutomationSecurity](https://docs.microsoft.com/office/vba/api/word.application.automationsecurity) to mitigate this risk, but you should ensure that you are only loading trusted content.</span></span>

<span data-ttu-id="7d3c4-133">さらに、Office では、クライアント認証情報をキャッシュして処理を高速化できる、多くのコンポーネント (簡易 MAPI、WinInet、MSDAIPP など) を使用しています。</span><span class="sxs-lookup"><span data-stu-id="7d3c4-133">Additionally, Office uses many components (such as Simple MAPI, WinInet, and MSDAIPP) that can cache client authentication information to speed processing.</span></span> <span data-ttu-id="7d3c4-134">Office が自動サーバー側で、複数のファイルを処理している場合、そのセッションに対して認証情報がキャッシュされていると、1つのクライアントは別のクライアントのキャッシュされた資格情報を使用できます。</span><span class="sxs-lookup"><span data-stu-id="7d3c4-134">When Office is being automated server-side and processing multiple files, if authentication information has been cached for that session, one client can use the cached credentials of another client.</span></span> <span data-ttu-id="7d3c4-135">そのため、クライアントは他のユーザーを偽装することによって、付与されていないアクセス許可を取得できます。</span><span class="sxs-lookup"><span data-stu-id="7d3c4-135">Therefore, the client can gain non-granted access permissions by impersonating other users.</span></span>

### <a name="ui-changes"></a><span data-ttu-id="7d3c4-136">UI の変更</span><span class="sxs-lookup"><span data-stu-id="7d3c4-136">UI changes</span></span>

<span data-ttu-id="7d3c4-137">Office の UI 要素は基本的に安定していますが、UI 要素の特定の場所は保証されず、ユーザーフィードバックを組み込んでユーザーのニーズを満たすために製品設計が発展するにつれて変わる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="7d3c4-137">The UI elements in Office are largely stable, but the specific location of any UI element is not guaranteed and might change as the product design evolves to incorporate user feedback and meet customer needs.</span></span> <span data-ttu-id="7d3c4-138">自動化のロジックでは、このことを考慮する必要があります。</span><span class="sxs-lookup"><span data-stu-id="7d3c4-138">The logic of any automation must account for this.</span></span> <span data-ttu-id="7d3c4-139">これらの変更により、ボタンまたはグループタブの名前変更、タブ間のコマンドの移動、新しいタブの追加、または機能が廃止された機能に合わせたコマンドの削除が行われることがあります。</span><span class="sxs-lookup"><span data-stu-id="7d3c4-139">These changes might result in button or group tab naming changes, movement of commands between tabs, the addition of new tabs, or the removal of commands in alignment with our feature deprecation policies.</span></span> <span data-ttu-id="7d3c4-140">これらの変更は、アプリケーションによって提供されるアクセシビリティ情報に加えて、その情報が変更されて、ユーザーからの継続的なフィードバックの利便性が向上し、さまざまなユーザーに対して異なる時間に展開される可能性があります。</span><span class="sxs-lookup"><span data-stu-id="7d3c4-140">These changes can take place in the UI as well as within the accessibility information provided by the application, as that information is modified to improve usability and account for ongoing customer feedback, and might be rolled out for different users at different times.</span></span>

<span data-ttu-id="7d3c4-141">製品の変更がなくても、システム環境 (画面のサイズ/解像度/DPI など) の違いによって、画面上のアイテムの位置が変更されることがあります。</span><span class="sxs-lookup"><span data-stu-id="7d3c4-141">Even without product changes, differences between system environments (such as screen size/resolution/DPI) can result in changes in the location of items on screen.</span></span> <span data-ttu-id="7d3c4-142">画面座標に依存してユーザー入力をシミュレートする方法では、これらの変更を考慮し、それに応じて適応する必要があります。</span><span class="sxs-lookup"><span data-stu-id="7d3c4-142">Any approach that relies on screen coordinates to simulate user input must consider these changes and adapt accordingly.</span></span>

### <a name="single-threading"></a><span data-ttu-id="7d3c4-143">シングルスレッド</span><span class="sxs-lookup"><span data-stu-id="7d3c4-143">Single-threading</span></span>

<span data-ttu-id="7d3c4-144">Office アプリケーションは、単一のクライアントに対して、リソースを多用するさまざまな機能を提供するように設計された、再入可能ではない STA ベースのアプリケーションです。</span><span class="sxs-lookup"><span data-stu-id="7d3c4-144">Office applications are non-reentrant, STA-based applications that are designed to provide diverse but resource-intensive functionality for a single client.</span></span> <span data-ttu-id="7d3c4-145">このアプリケーションでは、メモリマップトファイル、グローバルアドイン、テンプレート、共有されたオートメーションサーバーなどのグローバルリソースを使用します。</span><span class="sxs-lookup"><span data-stu-id="7d3c4-145">The applications use global resources such as memory mapped files, global add-ins or templates, and shared automation servers.</span></span> <span data-ttu-id="7d3c4-146">これにより、同時に実行できるインスタンスの数を制限したり、multiclient 環境でアプリケーションが構成されている場合に競合状態を発生させることができます。</span><span class="sxs-lookup"><span data-stu-id="7d3c4-146">This can limit the number of instances that can run concurrently and can lead to race conditions if the applications are configured in a multiclient environment.</span></span> <span data-ttu-id="7d3c4-147">Office アプリケーションの複数のインスタンスを実行することを計画している場合は、それらを仮想マシンレベルで分離して、結果として得られるソリューションの安定性を確保するように計画する必要があります。</span><span class="sxs-lookup"><span data-stu-id="7d3c4-147">If you plan to run more than one instance of any Office application, you should plan to isolate them at the virtual machine level to ensure the stability of the resulting solution.</span></span>

### <a name="resiliency-and-stability"></a><span data-ttu-id="7d3c4-148">復元性と安定性</span><span class="sxs-lookup"><span data-stu-id="7d3c4-148">Resiliency and stability</span></span>

<span data-ttu-id="7d3c4-149">前述の考慮事項を使用している場合でも、アプリケーションが自動化されている場合は、ユーザー入力をシミュレートする方法、または対話的な使用率を大幅に超えたセッションの長さが必要になる場合がありますが、対話的に実行した場合には発生しません。</span><span class="sxs-lookup"><span data-stu-id="7d3c4-149">Even with the considerations above, if the applications are automated in ways that simulate user input or for session lengths that dramatically exceed interactive usage, they might encounter issues that are not present when run interactively.</span></span> <span data-ttu-id="7d3c4-150">このコンテキストで Office を使用するソリューションでは、必要に応じて、アプリケーションの状態を監視し、それらを (またはその両方を実行している仮想マシンを) 再起動するメカニズムを事前に構築する必要があります。</span><span class="sxs-lookup"><span data-stu-id="7d3c4-150">Solutions that utilize Office in this context should proactively build mechanisms to monitor the state of the application and restart them (and/or the virtual machine on which they are running) if/as needed.</span></span>

## <a name="suggested-alternatives"></a><span data-ttu-id="7d3c4-151">推奨候補</span><span class="sxs-lookup"><span data-stu-id="7d3c4-151">Suggested Alternatives</span></span>

<span data-ttu-id="7d3c4-152">Microsoft では、Office をインストールしてサーバー側を実行する必要がないいくつかの方法をお勧めします。これにより、この構成の自動化よりも、一般的なタスクをより効率的かつ迅速に実行できます。</span><span class="sxs-lookup"><span data-stu-id="7d3c4-152">Microsoft strongly recommends a few alternatives that do not require Office to be installed and run server-side, and that can perform common tasks more efficiently and more quickly than automation in this configuration.</span></span> <span data-ttu-id="7d3c4-153">Office をプロジェクトのサーバー側コンポーネントとして使用する前に、代替手段を検討してください。</span><span class="sxs-lookup"><span data-stu-id="7d3c4-153">Before you involve Office as a server-side component in your project, consider alternatives.</span></span>

### <a name="microsoft-graph"></a><span data-ttu-id="7d3c4-154">Microsoft Graph</span><span class="sxs-lookup"><span data-stu-id="7d3c4-154">Microsoft Graph</span></span>

<span data-ttu-id="7d3c4-155">Microsoft Graph API は、Microsoft クラウドの一部として提供されるサービス、データ、およびインテリジェンスへのアクセスを提供します。これには、無人自動化のニーズをサポートする多くのサービス (ユーザーのメール/予定表/連絡先/ファイルへのアクセス、ドキュメント変換、Excel ブックの計算など) があります。</span><span class="sxs-lookup"><span data-stu-id="7d3c4-155">The Microsoft Graph API provides access to the services, data, and intelligence that are available to users and solutions as part of the Microsoft cloud, including many services supporting the needs of unattended automation: access to users’ mail / calendar / contacts / files, document conversion, Excel workbook calculation, and more.</span></span> <span data-ttu-id="7d3c4-156">これらのサービスは、無人使用および大規模なアクセスのために設計されており、標準の RESTful API 構文を使用します。</span><span class="sxs-lookup"><span data-stu-id="7d3c4-156">These services are designed for unattended use and high-scale access, and utilize a standard RESTful API syntax.</span></span> <span data-ttu-id="7d3c4-157">Microsoft Graph の詳細と、これを使用してユーザーのデータを操作する方法については、次を参照してください。</span><span class="sxs-lookup"><span data-stu-id="7d3c4-157">For more information on Microsoft Graph and how to use it to work with users’ data, visit the following:</span></span>

- [<span data-ttu-id="7d3c4-158">Microsoft Graph の概要</span><span class="sxs-lookup"><span data-stu-id="7d3c4-158">Overview of Microsoft Graph</span></span>](https://docs.microsoft.com/graph/overview) 
- [<span data-ttu-id="7d3c4-159">Microsoft Graph の概要</span><span class="sxs-lookup"><span data-stu-id="7d3c4-159">Get started with Microsoft Graph</span></span>](https://developer.microsoft.com/graph/get-started)
- <span data-ttu-id="7d3c4-160">[別の形式でファイルをダウンロードする](https://docs.microsoft.com/graph/api/driveitem-get-content-format?view=graph-rest-1.0&tabs=http)(ファイルの変換)</span><span class="sxs-lookup"><span data-stu-id="7d3c4-160">[Download a file in another format](https://docs.microsoft.com/graph/api/driveitem-get-content-format?view=graph-rest-1.0&tabs=http) (file conversion)</span></span>
- <span data-ttu-id="7d3c4-161">[Microsoft Graph での Excel](https://docs.microsoft.com/graph/api/resources/excel?view=graph-rest-1.0)の使用 (ブックの詳細)</span><span class="sxs-lookup"><span data-stu-id="7d3c4-161">[Working with Excel in Microsoft Graph](https://docs.microsoft.com/graph/api/resources/excel?view=graph-rest-1.0) (workbook details)</span></span>

### <a name="open-xml-file-formats"></a><span data-ttu-id="7d3c4-162">Open XML ファイル形式</span><span class="sxs-lookup"><span data-stu-id="7d3c4-162">Open XML file formats</span></span>

<span data-ttu-id="7d3c4-163">多くの自動化タスクには、ドキュメントの作成や編集が含まれます。</span><span class="sxs-lookup"><span data-stu-id="7d3c4-163">Many automation tasks involve document creation or editing.</span></span> <span data-ttu-id="7d3c4-164">Office は Open XML ファイル形式をサポートしており、開発者は、ISO 29500 International 標準で定義されている標準 XML および ZIP テクノロジを使用して、ファイルコンテンツを作成、編集、読み取り、および変換できます。</span><span class="sxs-lookup"><span data-stu-id="7d3c4-164">Office supports Open XML file formats that let developers create, edit, read, and transform file content using standard XML and ZIP technologies, defined in the ISO 29500 International Standard.</span></span> <span data-ttu-id="7d3c4-165">これらのファイル形式は、Microsoft .NET 3 .x フレームワークの System.IO.Package.IO 名前空間を含む、任意の ZIP/XML ツールを使用して操作できます。</span><span class="sxs-lookup"><span data-stu-id="7d3c4-165">These file formats can be manipulated via any ZIP/XML tools, including the System.IO.Package.IO namespace in the Microsoft .NET 3.x Framework.</span></span> <span data-ttu-id="7d3c4-166">サービスから Office ファイルへの変更を処理するには、ファイル形式を直接編集することをお勧めし、サポートされている方法を使用することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="7d3c4-166">Direct editing of the file formats is the recommended and supported method for handling changes to Office files from a service.</span></span>

<span data-ttu-id="7d3c4-167">Microsoft では、.NET 3.x フレームワークから Open XML ファイル形式を操作するための SDK を提供しています。</span><span class="sxs-lookup"><span data-stu-id="7d3c4-167">Microsoft provides an SDK for manipulating Open XML file formats from the .NET 3.x Framework.</span></span> <span data-ttu-id="7d3c4-168">SDK の詳細と、SDK を使用して Open XML ファイルを作成または編集する方法については、次を参照してください。</span><span class="sxs-lookup"><span data-stu-id="7d3c4-168">For more information about the SDK and how to use the SDK to create or edit Open XML files, visit the following:</span></span>

- [<span data-ttu-id="7d3c4-169">Open XML ファイル形式について</span><span class="sxs-lookup"><span data-stu-id="7d3c4-169">Understanding the Open XML file formats</span></span>](https://docs.microsoft.com/office/open-xml/understanding-the-open-xml-file-formats)
- [<span data-ttu-id="7d3c4-170">Open XML SDK 2.5 for Office へようこそ</span><span class="sxs-lookup"><span data-stu-id="7d3c4-170">Welcome to the Open XML SDK 2.5 for Office</span></span>](https://docs.microsoft.com/office/open-xml/open-xml-sdk)
