---
title: 無人 RPA 環境での自動OfficeのMicrosoft 365に関する考慮事項
ms.date: 03/30/2020
ms.audience: Developer
localization_priority: Normal
description: 無人 RPA 環境OfficeのMicrosoft 365自動化に関する考慮事項。
ms.openlocfilehash: 576217fc85f2980a6d2451e3f930296ea4c11a56
ms.sourcegitcommit: 007aa2ceb4f569201c3f4372de5c83b6c61f8875
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/02/2020
ms.locfileid: "43103051"
---
# <a name="considerations-for-unattended-automation-of-office-in-the-microsoft-365-for-unattended-rpa-environment"></a><span data-ttu-id="9e30f-103">無人 RPA 環境での自動OfficeのMicrosoft 365に関する考慮事項</span><span class="sxs-lookup"><span data-stu-id="9e30f-103">Considerations for unattended automation of Office in the Microsoft 365 for unattended RPA environment</span></span>

<span data-ttu-id="9e30f-104">無人 RPA の Microsoft 365 には、ユーザーが存在しない Office の自動化を可能にするライセンスが提供されています。Office のすべての現在のバージョンは、アプリケーションのインターフェイスを操作するために存在するユーザーが存在するクライアント ワークステーション上でエンド ユーザー製品として実行するように設計され、テストされました。</span><span class="sxs-lookup"><span data-stu-id="9e30f-104">Although Microsoft 365 for unattended RPA provides a license that enables the automation of Office with no user present, all current versions of Office were designed and tested to run as end-user products on a client workstation with a user present to interact with the application’s interface.</span></span> <span data-ttu-id="9e30f-105">ユーザーが存在しないアプリケーションの使用に起因する予期しない動作は、欠陥ではありません。</span><span class="sxs-lookup"><span data-stu-id="9e30f-105">Unexpected behaviors resulting from the use of applications without a user present are not defects.</span></span> <span data-ttu-id="9e30f-106">この構成でOfficeする場合は、アプリケーション ロジックでこれらの予期しない動作を考慮する準備が必要です。</span><span class="sxs-lookup"><span data-stu-id="9e30f-106">If you want to run Office in this configuration, you must be prepared to account for these unexpected behaviors in your application logic.</span></span>

<span data-ttu-id="9e30f-107">この記事では、この方法を使用する場合に役立つ、Office自動化に関する考慮事項の一部について説明します。</span><span class="sxs-lookup"><span data-stu-id="9e30f-107">This article outlines some of the considerations for unattended automation of Office to help you if you use this approach.</span></span> <span data-ttu-id="9e30f-108">ただし、この構成でのOfficeは厳密に "AS IS" であり、これらの予期しない動作を考慮する必要があります。</span><span class="sxs-lookup"><span data-stu-id="9e30f-108">However, note that usage of Office in this configuration is strictly “AS IS” and must account for these unexpected behaviors.</span></span> <span data-ttu-id="9e30f-109">ここで提供される情報は網羅的な情報ではなく、すべてのクライアントのすべての問題を解決する保証はありません。</span><span class="sxs-lookup"><span data-stu-id="9e30f-109">The information provided here is not exhaustive and is not guaranteed to resolve all issues for all clients.</span></span> <span data-ttu-id="9e30f-110">展開する前に、ソリューションを徹底的にテストしてください。</span><span class="sxs-lookup"><span data-stu-id="9e30f-110">We encourage you to test your solution thoroughly before you deploy.</span></span>

## <a name="common-problems-in-unattended-automation"></a><span data-ttu-id="9e30f-111">無人オートメーションの一般的な問題</span><span class="sxs-lookup"><span data-stu-id="9e30f-111">Common problems in unattended automation</span></span>

<span data-ttu-id="9e30f-112">ユーザーが存在しない場合Officeを使用する場合は、ユーザーが想定とは異なる動作をOffice領域に注意してください。</span><span class="sxs-lookup"><span data-stu-id="9e30f-112">If you want to use Office without a user present, be aware of the following areas in which Office can behave differently than expected.</span></span> <span data-ttu-id="9e30f-113">ソリューションを正常に実行するには、これらの問題に対処し、可能な限り効果を最小限に抑える必要があります。</span><span class="sxs-lookup"><span data-stu-id="9e30f-113">For your solution to run successfully, it must address these issues and minimize their effects as much as possible.</span></span> <span data-ttu-id="9e30f-114">アプリケーションをビルドする際には、これらの問題を慎重に検討してください。</span><span class="sxs-lookup"><span data-stu-id="9e30f-114">Consider these issues carefully when you build your application.</span></span>

### <a name="interactive-ui-elements"></a><span data-ttu-id="9e30f-115">対話型 UI 要素</span><span class="sxs-lookup"><span data-stu-id="9e30f-115">Interactive UI elements</span></span>

<span data-ttu-id="9e30f-116">Officeアプリケーションは、対話的に実行されている必要があります。</span><span class="sxs-lookup"><span data-stu-id="9e30f-116">Office applications assume that they are being run interactively.</span></span> <span data-ttu-id="9e30f-117">予期しないエラーが発生した場合、または関数を完了するために指定されていないパラメーターが必要な場合は、Office は、続行方法をユーザーに求めるダイアログ ボックスをユーザーに表示するように設計されています。</span><span class="sxs-lookup"><span data-stu-id="9e30f-117">If an unexpected error occurs, or if an unspecified parameter is needed to complete a function, Office is designed to prompt the user with a dialog box that asks the user how they want to proceed.</span></span> <span data-ttu-id="9e30f-118">無人オートメーションでは、この入力を受け取るまでアプリケーションが停止すると、アプリケーションが "ハング" する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="9e30f-118">In unattended automation, this might result in the application appearing to “hang” as the application stops until it receives this input.</span></span> <span data-ttu-id="9e30f-119">パブリック API を使用して Officeを自動化する場合は[、Application.DisplayAlerts](https://docs.microsoft.com/office/vba/api/word.application.displayalerts)や[Application.AutomationSecurity](https://docs.microsoft.com/office/vba/api/word.application.automationsecurity)のようなプロパティを適切に構成することで、これらのアラートの多くを抑制できます。</span><span class="sxs-lookup"><span data-stu-id="9e30f-119">If you’re automating Office via its public APIs, you can suppress many of these alerts by configuring properties like [Application.DisplayAlerts](https://docs.microsoft.com/office/vba/api/word.application.displayalerts) and [Application.AutomationSecurity](https://docs.microsoft.com/office/vba/api/word.application.automationsecurity) appropriately.</span></span> <span data-ttu-id="9e30f-120">コードは、ブロック通知をいつでも識別して処理するように設計する必要があります。</span><span class="sxs-lookup"><span data-stu-id="9e30f-120">Your code should be designed to identify and process blocking alerts at any time.</span></span>

### <a name="user-identity"></a><span data-ttu-id="9e30f-121">ユーザー ID</span><span class="sxs-lookup"><span data-stu-id="9e30f-121">User identity</span></span>

<span data-ttu-id="9e30f-122">Officeオートメーションを使用してアプリケーションを開始する場合でも、アプリケーションの実行時にユーザー ID が必要です。</span><span class="sxs-lookup"><span data-stu-id="9e30f-122">Office applications require a user identity when the applications are run, even when the application is started via automation.</span></span> <span data-ttu-id="9e30f-123">このユーザー ID によって、以下の一部またはすべてが発生する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="9e30f-123">This user identity can cause any or all of the following:</span></span>

- <span data-ttu-id="9e30f-124">処理する必要がある追加のサインイン UI の存在。</span><span class="sxs-lookup"><span data-stu-id="9e30f-124">The presence of additional sign-in UI that must be handled.</span></span>
- <span data-ttu-id="9e30f-125">ユーザーごとのアクセス許可に基づいて開く、または編集できないファイル。</span><span class="sxs-lookup"><span data-stu-id="9e30f-125">Files that cannot be opened and/or edited based on per-user access permissions.</span></span>
- <span data-ttu-id="9e30f-126">ファイルのメタデータに対する予期しない変更 (たとえば、自動アプリケーション インスタンスのユーザー ID に基づいて特定のファイル プロパティが更新されます)。</span><span class="sxs-lookup"><span data-stu-id="9e30f-126">Unexpected changes to the metadata of the file (for example, certain file properties will be updated based on the identity of the user identity of the automated application instance).</span></span>

<span data-ttu-id="9e30f-127">さまざまなアプローチは、これらの問題を軽減するのに役立ちます。たとえば、ドキュメント インスペクターを [実行してメタデータ](https://docs.microsoft.com/office/vba/library-reference/concepts/using-the-document-inspector) を削除します。</span><span class="sxs-lookup"><span data-stu-id="9e30f-127">Various approaches can help to mitigate these issues; for example, running the [Document Inspector](https://docs.microsoft.com/office/vba/library-reference/concepts/using-the-document-inspector) to remove metadata.</span></span> <span data-ttu-id="9e30f-128">これらのアプローチがシナリオに基づいて適切かどうかを検討します。</span><span class="sxs-lookup"><span data-stu-id="9e30f-128">Consider whether these approaches are appropriate based on your scenario.</span></span>

### <a name="server-side-security"></a><span data-ttu-id="9e30f-129">サーバー側のセキュリティ</span><span class="sxs-lookup"><span data-stu-id="9e30f-129">Server-side security</span></span>

<span data-ttu-id="9e30f-130">無人でOfficeファイル コンテンツを処理する場合、それらのファイルに格納されているマクロが読み込みおよび実行されるのを防ぐために、その環境に固有の追加の保護は使用できません。</span><span class="sxs-lookup"><span data-stu-id="9e30f-130">When running Office unattended and processing arbitrary file content, no additional protections specific in that environment are available to prevent macros stored in those files from loading and running.</span></span> <span data-ttu-id="9e30f-131">Office、コードから意図せずにマクロを実行したり、マクロを実行する可能性がある別のサーバーを起動したりから保護したりしません。</span><span class="sxs-lookup"><span data-stu-id="9e30f-131">Office does not protect you from unintentionally running macros from your code, or from starting another server that might run macros.</span></span> <span data-ttu-id="9e30f-132">[Application.AutomationSecurity](https://docs.microsoft.com/office/vba/api/word.application.automationsecurity)のようなプロパティを使用してこのリスクを軽減できますが、信頼できるコンテンツのみを読み込む必要があります。</span><span class="sxs-lookup"><span data-stu-id="9e30f-132">You can use properties like [Application.AutomationSecurity](https://docs.microsoft.com/office/vba/api/word.application.automationsecurity) to mitigate this risk, but you should ensure that you are only loading trusted content.</span></span>

<span data-ttu-id="9e30f-133">さらに、Officeは、クライアントの認証情報をキャッシュして処理を高速化できる多くのコンポーネント (Simple MAPI、WinInet、MSDAIPP など) を使用します。</span><span class="sxs-lookup"><span data-stu-id="9e30f-133">Additionally, Office uses many components (such as Simple MAPI, WinInet, and MSDAIPP) that can cache client authentication information to speed processing.</span></span> <span data-ttu-id="9e30f-134">サーバー Office自動化され、複数のファイルを処理する場合、そのセッションに対して認証情報がキャッシュされている場合、あるクライアントは別のクライアントのキャッシュされた資格情報を使用できます。</span><span class="sxs-lookup"><span data-stu-id="9e30f-134">When Office is being automated server-side and processing multiple files, if authentication information has been cached for that session, one client can use the cached credentials of another client.</span></span> <span data-ttu-id="9e30f-135">そのため、クライアントは他のユーザーを偽装して、許可されていないアクセス許可を取得できます。</span><span class="sxs-lookup"><span data-stu-id="9e30f-135">Therefore, the client can gain non-granted access permissions by impersonating other users.</span></span>

### <a name="ui-changes"></a><span data-ttu-id="9e30f-136">UI の変更</span><span class="sxs-lookup"><span data-stu-id="9e30f-136">UI changes</span></span>

<span data-ttu-id="9e30f-137">Office の UI 要素は大きく安定していますが、UI 要素の特定の場所は保証されません。ユーザー フィードバックを組み込み、顧客のニーズを満たすために製品設計が進化するにつれて変化する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="9e30f-137">The UI elements in Office are largely stable, but the specific location of any UI element is not guaranteed and might change as the product design evolves to incorporate user feedback and meet customer needs.</span></span> <span data-ttu-id="9e30f-138">自動化のロジックは、これを考慮する必要があります。</span><span class="sxs-lookup"><span data-stu-id="9e30f-138">The logic of any automation must account for this.</span></span> <span data-ttu-id="9e30f-139">これらの変更により、ボタンまたはグループ タブの名前付けの変更、タブ間のコマンドの移動、新しいタブの追加、または機能廃止ポリシーに合わせてコマンドが削除される可能性があります。</span><span class="sxs-lookup"><span data-stu-id="9e30f-139">These changes might result in button or group tab naming changes, movement of commands between tabs, the addition of new tabs, or the removal of commands in alignment with our feature deprecation policies.</span></span> <span data-ttu-id="9e30f-140">これらの変更は、UI およびアプリケーションによって提供されるアクセシビリティ情報内で行う場合があります。この情報は、ユーザービリティを向上させるために変更され、継続的な顧客からのフィードバックを考慮し、異なるユーザーに対して異なる時間に展開される可能性があります。</span><span class="sxs-lookup"><span data-stu-id="9e30f-140">These changes can take place in the UI as well as within the accessibility information provided by the application, as that information is modified to improve usability and account for ongoing customer feedback, and might be rolled out for different users at different times.</span></span>

<span data-ttu-id="9e30f-141">製品の変更がない場合でも、システム環境 (画面サイズ、解像度、DPI など) の違いにより、画面のアイテムの場所が変更される可能性があります。</span><span class="sxs-lookup"><span data-stu-id="9e30f-141">Even without product changes, differences between system environments (such as screen size/resolution/DPI) can result in changes in the location of items on screen.</span></span> <span data-ttu-id="9e30f-142">ユーザー入力をシミュレートするために画面座標に依存する方法は、これらの変更を考慮し、対応する必要があります。</span><span class="sxs-lookup"><span data-stu-id="9e30f-142">Any approach that relies on screen coordinates to simulate user input must consider these changes and adapt accordingly.</span></span>

### <a name="single-threading"></a><span data-ttu-id="9e30f-143">シングル スレッド</span><span class="sxs-lookup"><span data-stu-id="9e30f-143">Single-threading</span></span>

<span data-ttu-id="9e30f-144">Officeアプリケーションは、単一のクライアントに多様でリソースを消費する機能を提供するように設計された、再入可能でない STA ベースのアプリケーションです。</span><span class="sxs-lookup"><span data-stu-id="9e30f-144">Office applications are non-reentrant, STA-based applications that are designed to provide diverse but resource-intensive functionality for a single client.</span></span> <span data-ttu-id="9e30f-145">アプリケーションは、メモリ マップされたファイル、グローバル アドインまたはテンプレート、共有オートメーション サーバーなどのグローバル リソースを使用します。</span><span class="sxs-lookup"><span data-stu-id="9e30f-145">The applications use global resources such as memory mapped files, global add-ins or templates, and shared automation servers.</span></span> <span data-ttu-id="9e30f-146">これにより、同時に実行できるインスタンスの数が制限され、アプリケーションがマルチクライアント環境で構成されている場合、競争状態が発生する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="9e30f-146">This can limit the number of instances that can run concurrently and can lead to race conditions if the applications are configured in a multiclient environment.</span></span> <span data-ttu-id="9e30f-147">任意の Office アプリケーションの複数のインスタンスを実行する予定の場合は、仮想マシン レベルで分離して、結果のソリューションの安定性を確保する必要があります。</span><span class="sxs-lookup"><span data-stu-id="9e30f-147">If you plan to run more than one instance of any Office application, you should plan to isolate them at the virtual machine level to ensure the stability of the resulting solution.</span></span>

### <a name="resiliency-and-stability"></a><span data-ttu-id="9e30f-148">復元性と安定性</span><span class="sxs-lookup"><span data-stu-id="9e30f-148">Resiliency and stability</span></span>

<span data-ttu-id="9e30f-149">上記の考慮事項を考慮しても、ユーザー入力をシミュレートする方法でアプリケーションが自動化されている場合や、対話型の使用を大幅に超えるセッション長の場合は、対話的に実行するときに存在しない問題が発生する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="9e30f-149">Even with the considerations above, if the applications are automated in ways that simulate user input or for session lengths that dramatically exceed interactive usage, they might encounter issues that are not present when run interactively.</span></span> <span data-ttu-id="9e30f-150">このコンテキストで Office を使用するソリューションは、アプリケーションの状態を監視し、必要に応じて再起動するメカニズム (および/または実行している仮想マシン) を事前に構築する必要があります。</span><span class="sxs-lookup"><span data-stu-id="9e30f-150">Solutions that utilize Office in this context should proactively build mechanisms to monitor the state of the application and restart them (and/or the virtual machine on which they are running) if/as needed.</span></span>

## <a name="suggested-alternatives"></a><span data-ttu-id="9e30f-151">推奨される代替案</span><span class="sxs-lookup"><span data-stu-id="9e30f-151">Suggested Alternatives</span></span>

<span data-ttu-id="9e30f-152">microsoft では、Office をインストールしてサーバー側で実行する必要がなく、この構成の自動化よりも効率的かつ迅速に一般的なタスクを実行できるいくつかの代替手段を強く推奨しています。</span><span class="sxs-lookup"><span data-stu-id="9e30f-152">Microsoft strongly recommends a few alternatives that do not require Office to be installed and run server-side, and that can perform common tasks more efficiently and more quickly than automation in this configuration.</span></span> <span data-ttu-id="9e30f-153">プロジェクトでサーバー Officeコンポーネントとして使用する前に、代替案を検討してください。</span><span class="sxs-lookup"><span data-stu-id="9e30f-153">Before you involve Office as a server-side component in your project, consider alternatives.</span></span>

### <a name="microsoft-graph"></a><span data-ttu-id="9e30f-154">Microsoft Graph</span><span class="sxs-lookup"><span data-stu-id="9e30f-154">Microsoft Graph</span></span>

<span data-ttu-id="9e30f-155">Microsoft Graph API は、ユーザーのメール/カレンダー/連絡先/ファイルへのアクセス、ドキュメント変換、Excel ブックの計算など、無人オートメーションのニーズをサポートする多くのサービスを含む、Microsoft クラウドの一部としてユーザーおよびソリューションが利用できるサービス、データ、およびインテリジェンスへのアクセスを提供します。</span><span class="sxs-lookup"><span data-stu-id="9e30f-155">The Microsoft Graph API provides access to the services, data, and intelligence that are available to users and solutions as part of the Microsoft cloud, including many services supporting the needs of unattended automation: access to users’ mail / calendar / contacts / files, document conversion, Excel workbook calculation, and more.</span></span> <span data-ttu-id="9e30f-156">これらのサービスは、無人使用と大規模アクセス用に設計され、標準の RESTful API 構文を使用します。</span><span class="sxs-lookup"><span data-stu-id="9e30f-156">These services are designed for unattended use and high-scale access, and utilize a standard RESTful API syntax.</span></span> <span data-ttu-id="9e30f-157">Microsoft Graphおよびユーザーのデータを使用する方法の詳細については、以下を参照してください。</span><span class="sxs-lookup"><span data-stu-id="9e30f-157">For more information on Microsoft Graph and how to use it to work with users’ data, visit the following:</span></span>

- [<span data-ttu-id="9e30f-158">Microsoft Graph の概要</span><span class="sxs-lookup"><span data-stu-id="9e30f-158">Overview of Microsoft Graph</span></span>](https://docs.microsoft.com/graph/overview) 
- [<span data-ttu-id="9e30f-159">Microsoft Graph の概要</span><span class="sxs-lookup"><span data-stu-id="9e30f-159">Get started with Microsoft Graph</span></span>](https://developer.microsoft.com/graph/get-started)
- <span data-ttu-id="9e30f-160">[別の形式でファイルをダウンロード](https://docs.microsoft.com/graph/api/driveitem-get-content-format?view=graph-rest-1.0&tabs=http) する (ファイル変換)</span><span class="sxs-lookup"><span data-stu-id="9e30f-160">[Download a file in another format](https://docs.microsoft.com/graph/api/driveitem-get-content-format?view=graph-rest-1.0&tabs=http) (file conversion)</span></span>
- <span data-ttu-id="9e30f-161">[Microsoft ExcelでのGraph操作](https://docs.microsoft.com/graph/api/resources/excel?view=graph-rest-1.0)(ブックの詳細)</span><span class="sxs-lookup"><span data-stu-id="9e30f-161">[Working with Excel in Microsoft Graph](https://docs.microsoft.com/graph/api/resources/excel?view=graph-rest-1.0) (workbook details)</span></span>

### <a name="open-xml-file-formats"></a><span data-ttu-id="9e30f-162">XML ファイル形式を開く</span><span class="sxs-lookup"><span data-stu-id="9e30f-162">Open XML file formats</span></span>

<span data-ttu-id="9e30f-163">多くのオートメーション タスクには、ドキュメントの作成または編集が含まれます。</span><span class="sxs-lookup"><span data-stu-id="9e30f-163">Many automation tasks involve document creation or editing.</span></span> <span data-ttu-id="9e30f-164">Officeは、ISO 29500 国際標準で定義されている標準の XML および ZIP テクノロジを使用して、開発者がファイル コンテンツを作成、編集、読み取り、変換できる Open XML ファイル形式をサポートしています。</span><span class="sxs-lookup"><span data-stu-id="9e30f-164">Office supports Open XML file formats that let developers create, edit, read, and transform file content using standard XML and ZIP technologies, defined in the ISO 29500 International Standard.</span></span> <span data-ttu-id="9e30f-165">これらのファイル形式は、Microsoft .NET 3.x Framework の System.IO.Package.IO 名前空間を含む、任意の ZIP/XML ツールを介して操作できます。</span><span class="sxs-lookup"><span data-stu-id="9e30f-165">These file formats can be manipulated via any ZIP/XML tools, including the System.IO.Package.IO namespace in the Microsoft .NET 3.x Framework.</span></span> <span data-ttu-id="9e30f-166">ファイル形式の直接編集は、サービスからのファイルの変更を処理するために推奨され、サポートOffice方法です。</span><span class="sxs-lookup"><span data-stu-id="9e30f-166">Direct editing of the file formats is the recommended and supported method for handling changes to Office files from a service.</span></span>

<span data-ttu-id="9e30f-167">Microsoft は、.NET 3.x Framework から Open XML ファイル形式を操作するための SDK を提供しています。</span><span class="sxs-lookup"><span data-stu-id="9e30f-167">Microsoft provides an SDK for manipulating Open XML file formats from the .NET 3.x Framework.</span></span> <span data-ttu-id="9e30f-168">SDK の詳細と SDK を使用して Open XML ファイルを作成または編集する方法については、次のトピックを参照してください。</span><span class="sxs-lookup"><span data-stu-id="9e30f-168">For more information about the SDK and how to use the SDK to create or edit Open XML files, visit the following:</span></span>

- [<span data-ttu-id="9e30f-169">Open XML ファイル形式について</span><span class="sxs-lookup"><span data-stu-id="9e30f-169">Understanding the Open XML file formats</span></span>](https://docs.microsoft.com/office/open-xml/understanding-the-open-xml-file-formats)
- [<span data-ttu-id="9e30f-170">Open XML SDK 2.5 for Office</span><span class="sxs-lookup"><span data-stu-id="9e30f-170">Welcome to the Open XML SDK 2.5 for Office</span></span>](https://docs.microsoft.com/office/open-xml/open-xml-sdk)
